{"id":"hq-01c","title":"Digest: mol-deacon-patrol","description":"Patrol 15: idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T23:20:16.062416082-05:00","updated_at":"2026-01-15T23:20:16.062416082-05:00","closed_at":"2026-01-15T23:20:16.062349457-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-01d","title":"Digest: mol-deacon-patrol","description":"Patrol 5 complete: idle town","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T23:39:49.100356627-05:00","updated_at":"2026-01-15T23:39:49.100356627-05:00","closed_at":"2026-01-15T23:39:49.10028546-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-02ku","title":"Digest: mol-deacon-patrol","description":"Patrol: cleaned 89 orphaned wisps, inbox empty, town idle, Mayor up, witnesses down (idle town OK)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:13:59.440591055-05:00","updated_at":"2026-01-16T22:13:59.440591055-05:00","closed_at":"2026-01-16T22:13:59.440539597-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-02ku","depends_on_id":"hq-wisp-t8l0","type":"parent-child","created_at":"2026-01-16T22:13:59.441449762-05:00","created_by":"deacon"}]}
{"id":"hq-04fl","title":"Digest: mol-deacon-patrol","description":"Patrol 3: 12 sessions healthy, no issues","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:19:24.202062745-05:00","updated_at":"2026-01-16T22:19:24.202062745-05:00","closed_at":"2026-01-16T22:19:24.201994204-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-04fl","depends_on_id":"hq-wisp-mptm","type":"parent-child","created_at":"2026-01-16T22:19:24.203041703-05:00","created_by":"deacon"}]}
{"id":"hq-08b","title":"Digest: mol-deacon-patrol","description":"Patrol 20: Town idle, all healthy. Witness running, refinery stopped (empty queue). No polecats, no dogs, no orphans. 1 stale lock noted for cleanup.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T23:01:26.877809434-05:00","updated_at":"2026-01-15T23:01:26.877809434-05:00","closed_at":"2026-01-15T23:01:26.877759017-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-0b293","title":"Digest: mol-deacon-patrol","description":"Patrol 3: inbox empty, witness/refinery healthy, dog pool ok (7 idle), no zombies, no cleanup needed","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:25:17.40932758-05:00","updated_at":"2026-01-17T00:25:17.40932758-05:00","closed_at":"2026-01-17T00:25:17.365059698-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-0b293","depends_on_id":"hq-wisp-kfnnv","type":"parent-child","created_at":"2026-01-17T00:25:17.410760036-05:00","created_by":"deacon"}]}
{"id":"hq-0ifa","title":"Digest: mol-deacon-patrol","description":"Patrol 3: Town idle, 3 dogs in stale working state","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:40:49.664322769-05:00","updated_at":"2026-01-16T01:40:49.664322769-05:00","closed_at":"2026-01-16T01:40:49.664270019-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-0ifa","depends_on_id":"hq-wisp-brbp","type":"parent-child","created_at":"2026-01-16T01:40:49.665096768-05:00","created_by":"deacon"}]}
{"id":"hq-0ko","title":"Digest: mol-deacon-patrol","description":"Patrol 19: idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T23:21:50.343946216-05:00","updated_at":"2026-01-15T23:21:50.343946216-05:00","closed_at":"2026-01-15T23:21:50.343892716-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-0ncna","title":"Digest: mol-deacon-patrol","description":"Patrol complete: checked inbox (0 msgs), gates (0), convoys (0), polecats (0 pending). Town idle - witness/refinery stopped. Dog pool healthy (1 idle/5 working). No zombies, orphans, or stuck dogs. Cleanup dispatched (formula error). Costs/logs ok.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:37:24.541490526-05:00","updated_at":"2026-01-16T23:37:24.541490526-05:00","closed_at":"2026-01-16T23:37:24.505948822-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-0ncna","depends_on_id":"hq-wisp-wjq8y","type":"parent-child","created_at":"2026-01-16T23:37:24.542634151-05:00","created_by":"deacon"}]}
{"id":"hq-0rbk","title":"Digest: mol-deacon-patrol","description":"Patrol 20 complete: all healthy, handing off","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:30:05.873594653-05:00","updated_at":"2026-01-16T01:30:05.873594653-05:00","closed_at":"2026-01-16T01:30:05.873536903-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-0rbk","depends_on_id":"hq-wisp-mlny","type":"parent-child","created_at":"2026-01-16T01:30:05.874378736-05:00","created_by":"deacon"}]}
{"id":"hq-0tkv","title":"Digest: mol-deacon-patrol","description":"Patrol 16: idle town, no messages, gastown witness/refinery stopped, 5 idle dogs, dispatched session-gc","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:34:40.451554961-05:00","updated_at":"2026-01-16T22:34:40.451554961-05:00","closed_at":"2026-01-16T22:34:40.451499753-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-0tkv","depends_on_id":"hq-wisp-vp00","type":"parent-child","created_at":"2026-01-16T22:34:40.452484335-05:00","created_by":"deacon"}]}
{"id":"hq-0yyr1","title":"Digest: mol-deacon-patrol","description":"Patrol 8: town healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T10:46:26.956843446-05:00","updated_at":"2026-01-17T10:46:26.956843446-05:00","closed_at":"2026-01-17T10:46:26.956792321-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-0yyr1","depends_on_id":"hq-wisp-21mtg","type":"parent-child","created_at":"2026-01-17T10:46:26.958035112-05:00","created_by":"deacon"}]}
{"id":"hq-13a5f","title":"Digest: mol-deacon-patrol","description":"Patrol 18: nominal","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:54:57.798887056-05:00","updated_at":"2026-01-17T00:54:57.798887056-05:00","closed_at":"2026-01-17T00:54:57.798818723-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-13u","title":"Digest: mol-deacon-patrol","description":"Patrol 17: idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T23:21:08.52944286-05:00","updated_at":"2026-01-15T23:21:08.52944286-05:00","closed_at":"2026-01-15T23:21:08.52937986-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-14tw","title":"Digest: mol-deacon-patrol","description":"Patrol 8: OK","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:43:41.267566698-05:00","updated_at":"2026-01-16T01:43:41.267566698-05:00","closed_at":"2026-01-16T01:43:41.267518907-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-14tw","depends_on_id":"hq-wisp-29b2","type":"parent-child","created_at":"2026-01-16T01:43:41.268307489-05:00","created_by":"deacon"}]}
{"id":"hq-19kkn","title":"Digest: mol-deacon-patrol","description":"Patrol #7: Quick idle cycle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:59:03.296749365-05:00","updated_at":"2026-01-16T22:59:03.296749365-05:00","closed_at":"2026-01-16T22:59:03.29668349-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-19kkn","depends_on_id":"hq-wisp-hafk","type":"parent-child","created_at":"2026-01-16T22:59:03.297697281-05:00","created_by":"deacon"}]}
{"id":"hq-1f9","title":"Digest: mol-deacon-patrol","description":"Patrol cycle 7: town idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T17:19:39.62220971-05:00","updated_at":"2026-01-15T17:19:39.62220971-05:00","closed_at":"2026-01-15T17:19:39.622159669-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-1h4g","title":"Digest: mol-deacon-patrol","description":"Patrol 15: Town idle, healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:42:54.126496776-05:00","updated_at":"2026-01-16T00:42:54.126496776-05:00","closed_at":"2026-01-16T00:42:54.126433318-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-1h4g","depends_on_id":"hq-wisp-4ak","type":"parent-child","created_at":"2026-01-16T00:42:54.1272734-05:00","created_by":"deacon"}]}
{"id":"hq-1nfid","title":"Digest: mol-deacon-patrol","description":"Patrol 11: Idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:48:22.835720855-05:00","updated_at":"2026-01-16T23:48:22.835720855-05:00","closed_at":"2026-01-16T23:48:22.835668397-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-1nfid","depends_on_id":"hq-wisp-yyvdp","type":"parent-child","created_at":"2026-01-16T23:48:22.836846432-05:00","created_by":"deacon"}]}
{"id":"hq-1sp1","title":"Digest: mol-deacon-patrol","description":"P12","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:24:54.880771019-05:00","updated_at":"2026-01-16T00:24:54.880771019-05:00","closed_at":"2026-01-16T00:24:54.880715686-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-1xlf","title":"Digest: mol-deacon-patrol","description":"Patrol complete: inbox empty, agents healthy, no cleanup dispatched (no idle dogs)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:40:11.300290217-05:00","updated_at":"2026-01-16T01:40:11.300290217-05:00","closed_at":"2026-01-16T01:40:11.300234384-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-1xlf","depends_on_id":"hq-wisp-chq2","type":"parent-child","created_at":"2026-01-16T01:40:11.301108217-05:00","created_by":"deacon"}]}
{"id":"hq-20n4w","title":"Digest: mol-deacon-patrol","description":"Patrol 10: Town idle. Quick cycle.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:04:23.864323528-05:00","updated_at":"2026-01-16T23:04:23.864323528-05:00","closed_at":"2026-01-16T23:04:23.864263486-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-20n4w","depends_on_id":"hq-wisp-xtbl","type":"parent-child","created_at":"2026-01-16T23:04:23.865394782-05:00","created_by":"deacon"}]}
{"id":"hq-24p","title":"Digest: mol-deacon-patrol","description":"Patrol 2: idle town, witness healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T22:46:11.544678614-05:00","updated_at":"2026-01-15T22:46:11.544678614-05:00","closed_at":"2026-01-15T22:46:11.544622072-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-29x","title":"Digest: mol-deacon-patrol","description":"Patrol 3 complete: idle town","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T23:37:13.98377505-05:00","updated_at":"2026-01-15T23:37:13.98377505-05:00","closed_at":"2026-01-15T23:37:13.983709258-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-2c4t","title":"Digest: mol-deacon-patrol","description":"Patrol 13: Town idle, healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:42:52.1063057-05:00","updated_at":"2026-01-16T00:42:52.1063057-05:00","closed_at":"2026-01-16T00:42:52.106180117-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-2c4t","depends_on_id":"hq-wisp-bcf","type":"parent-child","created_at":"2026-01-16T00:42:52.107173282-05:00","created_by":"deacon"}]}
{"id":"hq-2f3qa","title":"Digest: mol-deacon-patrol","description":"Patrol 13: idle town, no active work","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:19:13.453660622-05:00","updated_at":"2026-01-16T23:19:13.453660622-05:00","closed_at":"2026-01-16T23:19:13.45361283-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-2f3qa","depends_on_id":"hq-wisp-vckv","type":"parent-child","created_at":"2026-01-16T23:19:13.454637039-05:00","created_by":"deacon"}]}
{"id":"hq-2garj","title":"Digest: mol-deacon-patrol","description":"Patrol 16: idle town, pre-handoff","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:21:44.259286877-05:00","updated_at":"2026-01-16T23:21:44.259286877-05:00","closed_at":"2026-01-16T23:21:44.259223543-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-2garj","depends_on_id":"hq-wisp-jzed","type":"parent-child","created_at":"2026-01-16T23:21:44.260390002-05:00","created_by":"deacon"}]}
{"id":"hq-2klw","title":"Digest: mol-deacon-patrol","description":"Cleanup: orphaned patrol","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:44:54.206984308-05:00","updated_at":"2026-01-16T01:44:54.206984308-05:00","closed_at":"2026-01-16T01:44:54.206927725-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-2klw","depends_on_id":"hq-wisp-71rd","type":"parent-child","created_at":"2026-01-16T01:44:54.20779614-05:00","created_by":"deacon"}]}
{"id":"hq-2m3","title":"Digest: mol-deacon-patrol","description":"Patrol 6: idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T23:15:44.993462399-05:00","updated_at":"2026-01-15T23:15:44.993462399-05:00","closed_at":"2026-01-15T23:15:44.99340819-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-2mmu0","title":"Digest: mol-deacon-patrol","description":"Patrol 5: Idle town","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:32:02.384099775-05:00","updated_at":"2026-01-17T00:32:02.384099775-05:00","closed_at":"2026-01-17T00:32:02.365638012-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-2mmu0","depends_on_id":"hq-wisp-dug41","type":"parent-child","created_at":"2026-01-17T00:32:02.385613981-05:00","created_by":"deacon"}]}
{"id":"hq-2yb","title":"Digest: mol-deacon-patrol","description":"Patrol 3: town idle, witness healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T23:13:01.090682661-05:00","updated_at":"2026-01-15T23:13:01.090682661-05:00","closed_at":"2026-01-15T23:13:01.090624494-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-30j1","title":"Digest: mol-deacon-patrol","description":"Patrol 7: OK","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:43:16.642073432-05:00","updated_at":"2026-01-16T01:43:16.642073432-05:00","closed_at":"2026-01-16T01:43:16.642017308-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-30j1","depends_on_id":"hq-wisp-tmah","type":"parent-child","created_at":"2026-01-16T01:43:16.642953182-05:00","created_by":"deacon"}]}
{"id":"hq-315g","title":"Digest: mol-deacon-patrol","description":"Patrol cycle 11: Town idle, healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:41:28.882390154-05:00","updated_at":"2026-01-16T00:41:28.882390154-05:00","closed_at":"2026-01-16T00:41:28.882337279-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-36t3","title":"Digest: mol-deacon-patrol","description":"Patrol complete: inbox empty, witness running, refinery idle (normal), 3 idle dogs, no orphans, no zombies, cleanup dispatched to dog alpha, no costs to digest, 20 patrol threshold reached","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:37:38.873591749-05:00","updated_at":"2026-01-16T01:37:38.873591749-05:00","closed_at":"2026-01-16T01:37:38.873543165-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-36t3","depends_on_id":"hq-wisp-2aaz","type":"parent-child","created_at":"2026-01-16T01:37:38.874329748-05:00","created_by":"deacon"}]}
{"id":"hq-3iht2","title":"Digest: mol-deacon-patrol","description":"Patrol 15: Final cycle before handoff. Town idle.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:50:09.507711198-05:00","updated_at":"2026-01-16T23:50:09.507711198-05:00","closed_at":"2026-01-16T23:50:09.235177902-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-3iht2","depends_on_id":"hq-wisp-t4rk4","type":"parent-child","created_at":"2026-01-16T23:50:09.50879082-05:00","created_by":"deacon"}]}
{"id":"hq-3plr","title":"Digest: mol-deacon-patrol","description":"Patrol","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:09:35.624577093-05:00","updated_at":"2026-01-16T22:09:35.624577093-05:00","closed_at":"2026-01-16T22:09:35.624507635-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-3plr","depends_on_id":"hq-wisp-owhh","type":"parent-child","created_at":"2026-01-16T22:09:35.625441342-05:00","created_by":"deacon"}]}
{"id":"hq-3u7a","title":"Digest: mol-deacon-patrol","description":"Patrol complete: inbox empty, no pending spawns, gates clear, health OK (idle town)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:52:23.531947361-05:00","updated_at":"2026-01-16T01:52:23.531947361-05:00","closed_at":"2026-01-16T01:52:23.531893361-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-3u7a","depends_on_id":"hq-wisp-uavs","type":"parent-child","created_at":"2026-01-16T01:52:23.53276386-05:00","created_by":"deacon"}]}
{"id":"hq-3wb","title":"Digest: mol-deacon-patrol","description":"Patrol 8: idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T23:17:01.144616951-05:00","updated_at":"2026-01-15T23:17:01.144616951-05:00","closed_at":"2026-01-15T23:17:01.144568742-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-3yz04","title":"Digest: mol-deacon-patrol","description":"Patrol complete: all agents healthy, no incidents","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:13:16.897232551-05:00","updated_at":"2026-01-17T00:13:16.897232551-05:00","closed_at":"2026-01-17T00:13:16.897175884-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-46os8","title":"Digest: mol-deacon-patrol","description":"Patrol #3: Quick idle cycle, all checks passed, 4 dogs working on cleanup","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:56:26.081443844-05:00","updated_at":"2026-01-16T22:56:26.081443844-05:00","closed_at":"2026-01-16T22:56:26.081396719-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-46os8","depends_on_id":"hq-wisp-av8t","type":"parent-child","created_at":"2026-01-16T22:56:26.082320177-05:00","created_by":"deacon"}]}
{"id":"hq-48c9t","title":"Digest: mol-deacon-patrol","description":"Patrol 14: Idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:54:42.842156359-05:00","updated_at":"2026-01-16T23:54:42.842156359-05:00","closed_at":"2026-01-16T23:54:42.679519609-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-48c9t","depends_on_id":"hq-wisp-je3am","type":"parent-child","created_at":"2026-01-16T23:54:42.843607941-05:00","created_by":"deacon"}]}
{"id":"hq-48y06","title":"Digest: mol-deacon-patrol","description":"Patrol 12: idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:56:20.692589602-05:00","updated_at":"2026-01-16T23:56:20.692589602-05:00","closed_at":"2026-01-16T23:56:20.692537144-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-48y06","depends_on_id":"hq-wisp-rq8dy","type":"parent-child","created_at":"2026-01-16T23:56:20.694069808-05:00","created_by":"deacon"}]}
{"id":"hq-4dve","title":"Digest: mol-deacon-patrol","description":"P10","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:24:40.735893761-05:00","updated_at":"2026-01-16T00:24:40.735893761-05:00","closed_at":"2026-01-16T00:24:40.735844594-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-4ge4","title":"Digest: mol-deacon-patrol","description":"Patrol 10: all healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:24:45.910415968-05:00","updated_at":"2026-01-16T22:24:45.910415968-05:00","closed_at":"2026-01-16T22:24:45.91036676-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-4ge4","depends_on_id":"hq-wisp-pezd","type":"parent-child","created_at":"2026-01-16T22:24:45.911331342-05:00","created_by":"deacon"}]}
{"id":"hq-4i3e","title":"Digest: mol-deacon-patrol","description":"Patrol 3: Town idle. No callbacks, no gates, no polecats. 5 dogs idle. Cleanup needed but formula broken.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:55:34.878470432-05:00","updated_at":"2026-01-16T22:55:34.878470432-05:00","closed_at":"2026-01-16T22:55:34.878417349-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-4i3e","depends_on_id":"hq-wisp-5kqp","type":"parent-child","created_at":"2026-01-16T22:55:34.879450098-05:00","created_by":"deacon"}]}
{"id":"hq-4kw","title":"Digest: mol-deacon-patrol","description":"Patrol 2: All healthy, idle town","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:22:32.855170164-05:00","updated_at":"2026-01-16T00:22:32.855170164-05:00","closed_at":"2026-01-16T00:22:32.855115789-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-4l4k","title":"Digest: mol-deacon-patrol","description":"Patrol 2: Town idle, all healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:39:47.165430058-05:00","updated_at":"2026-01-16T01:39:47.165430058-05:00","closed_at":"2026-01-16T01:39:47.165373975-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-4l4k","depends_on_id":"hq-wisp-293e","type":"parent-child","created_at":"2026-01-16T01:39:47.166211766-05:00","created_by":"deacon"}]}
{"id":"hq-4pd1z","title":"Digest: mol-deacon-patrol","description":"P15: idle, preparing handoff","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:01:03.050638286-05:00","updated_at":"2026-01-17T00:01:03.050638286-05:00","closed_at":"2026-01-17T00:01:03.050580911-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-4pd1z","depends_on_id":"hq-wisp-hmwj4","type":"parent-child","created_at":"2026-01-17T00:01:03.051842076-05:00","created_by":"deacon"}]}
{"id":"hq-5349","title":"Digest: mol-deacon-patrol","description":"Patrol 3: town idle, alpha dog 19min (monitoring), all healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:27:08.598325631-05:00","updated_at":"2026-01-16T01:27:08.598325631-05:00","closed_at":"2026-01-16T01:27:08.598279757-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-5349","depends_on_id":"hq-wisp-0fch","type":"parent-child","created_at":"2026-01-16T01:27:08.598979214-05:00","created_by":"deacon"}]}
{"id":"hq-534w","title":"Digest: mol-deacon-patrol","description":"Patrol 2: idle town, all healthy, no work","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:48:26.331274161-05:00","updated_at":"2026-01-16T01:48:26.331274161-05:00","closed_at":"2026-01-16T01:48:26.331219911-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-55udg","title":"Digest: mol-deacon-patrol","description":"Patrol 13: Idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:52:36.849723438-05:00","updated_at":"2026-01-16T23:52:36.849723438-05:00","closed_at":"2026-01-16T23:52:36.834715367-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-55udg","depends_on_id":"hq-wisp-eo8a7","type":"parent-child","created_at":"2026-01-16T23:52:36.850981104-05:00","created_by":"deacon"}]}
{"id":"hq-585u2","title":"Digest: mol-deacon-patrol","description":"Patrol 16: nominal","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:52:47.664051863-05:00","updated_at":"2026-01-17T00:52:47.664051863-05:00","closed_at":"2026-01-17T00:52:47.663997113-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-5cph","title":"Digest: mol-deacon-patrol","description":"Patrol 9: all healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:24:08.732133923-05:00","updated_at":"2026-01-16T22:24:08.732133923-05:00","closed_at":"2026-01-16T22:24:08.732078256-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-5cph","depends_on_id":"hq-wisp-3nre","type":"parent-child","created_at":"2026-01-16T22:24:08.733189755-05:00","created_by":"deacon"}]}
{"id":"hq-5dz4","title":"Digest: mol-deacon-patrol","description":"Patrol 12 complete: all healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:26:20.01703352-05:00","updated_at":"2026-01-16T01:26:20.01703352-05:00","closed_at":"2026-01-16T01:26:20.01697652-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-5dz4","depends_on_id":"hq-wisp-b9jd","type":"parent-child","created_at":"2026-01-16T01:26:20.01781956-05:00","created_by":"deacon"}]}
{"id":"hq-5fl","title":"Digest: mol-deacon-patrol","description":"Patrol 13: Town idle, witness running, refinery stopped (empty queue), no work pending. 23 orphan processes noted for manual review.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T22:44:57.58991798-05:00","updated_at":"2026-01-15T22:44:57.58991798-05:00","closed_at":"2026-01-15T22:44:57.589864522-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-5ltro","title":"Digest: mol-deacon-patrol","description":"Patrol 14: idle town fast-path","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:20:25.017748591-05:00","updated_at":"2026-01-16T23:20:25.017748591-05:00","closed_at":"2026-01-16T23:20:25.01769305-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-5ltro","depends_on_id":"hq-wisp-ezwj","type":"parent-child","created_at":"2026-01-16T23:20:25.018768758-05:00","created_by":"deacon"}]}
{"id":"hq-5o9","title":"Digest: mol-deacon-patrol","description":"Patrol 17: Town idle, witness healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T23:00:13.589708108-05:00","updated_at":"2026-01-15T23:00:13.589708108-05:00","closed_at":"2026-01-15T23:00:13.589656233-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-5rz","title":"Digest: mol-deacon-patrol","description":"Patrol 1: All agents healthy, no issues","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:21:06.588248661-05:00","updated_at":"2026-01-16T00:21:06.588248661-05:00","closed_at":"2026-01-16T00:21:06.588193911-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-5z1z","title":"Digest: mol-deacon-patrol","description":"P13","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:24:55.84926837-05:00","updated_at":"2026-01-16T00:24:55.84926837-05:00","closed_at":"2026-01-16T00:24:55.849216078-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-5zvx9","title":"Digest: mol-deacon-patrol","description":"Patrol 15: nominal","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:51:45.74616684-05:00","updated_at":"2026-01-17T00:51:45.74616684-05:00","closed_at":"2026-01-17T00:51:45.746108382-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-65m9","title":"Digest: mol-deacon-patrol","description":"P14","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:24:56.859493662-05:00","updated_at":"2026-01-16T00:24:56.859493662-05:00","closed_at":"2026-01-16T00:24:56.859442329-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-69b6m","title":"Digest: mol-deacon-patrol","description":"Patrol 17: healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T10:48:51.516533111-05:00","updated_at":"2026-01-17T10:48:51.516533111-05:00","closed_at":"2026-01-17T10:48:51.516484486-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-69b6m","depends_on_id":"hq-wisp-mku51","type":"parent-child","created_at":"2026-01-17T10:48:51.517696568-05:00","created_by":"deacon"}]}
{"id":"hq-69i","title":"Digest: mol-deacon-patrol","description":"Patrol 16: Town idle, witness healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T22:57:56.522865885-05:00","updated_at":"2026-01-15T22:57:56.522865885-05:00","closed_at":"2026-01-15T22:57:56.522809385-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-6dj8b","title":"Digest: mol-deacon-patrol","description":"Patrol #2: town healthy, all idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T10:29:09.075275825-05:00","updated_at":"2026-01-17T10:29:09.075275825-05:00","closed_at":"2026-01-17T10:29:09.075109534-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-6dj8b","depends_on_id":"hq-wisp-dlxw2","type":"parent-child","created_at":"2026-01-17T10:29:09.084851851-05:00","created_by":"gastown/refinery"}]}
{"id":"hq-6ep","title":"Digest: mol-deacon-patrol","description":"Stale wisp - steps pre-completed, squashing to reset","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:30:34.227266261-05:00","updated_at":"2026-01-16T00:30:34.227266261-05:00","closed_at":"2026-01-16T00:30:34.227215011-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-6gki","title":"Digest: mol-deacon-patrol","description":"Patrol cycle 1: Town idle, witnesses healthy, 5 stale locks detected (formula error prevented dispatch). No work in progress.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:39:12.348823084-05:00","updated_at":"2026-01-16T00:39:12.348823084-05:00","closed_at":"2026-01-16T00:39:12.330386064-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-6o3i","title":"Digest: mol-deacon-patrol","description":"Patrol complete: inbox empty, witnesses running, town idle, cleanup deferred","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:53:02.716928829-05:00","updated_at":"2026-01-16T00:53:02.716928829-05:00","closed_at":"2026-01-16T00:53:02.716876912-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-6o3i","depends_on_id":"hq-wisp-rmc","type":"parent-child","created_at":"2026-01-16T00:53:02.71765408-05:00","created_by":"deacon"}]}
{"id":"hq-6om","title":"Digest: mol-deacon-patrol","description":"Patrol 14: idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T23:19:55.123442329-05:00","updated_at":"2026-01-15T23:19:55.123442329-05:00","closed_at":"2026-01-15T23:19:55.123380705-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-6pwq8","title":"Digest: mol-deacon-patrol","description":"Patrol 12: Idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:50:27.892274124-05:00","updated_at":"2026-01-16T23:50:27.892274124-05:00","closed_at":"2026-01-16T23:50:27.033335831-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-6pwq8","depends_on_id":"hq-wisp-03xfw","type":"parent-child","created_at":"2026-01-16T23:50:27.893532912-05:00","created_by":"deacon"}]}
{"id":"hq-6qk","title":"Digest: mol-deacon-patrol","description":"Patrol 4","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:24:01.753745881-05:00","updated_at":"2026-01-16T00:24:01.753745881-05:00","closed_at":"2026-01-16T00:24:01.753697298-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-6r50m","title":"Digest: mol-deacon-patrol","description":"Patrol 17: town idle, handoff threshold reached","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:54:53.550783841-05:00","updated_at":"2026-01-16T23:54:53.550783841-05:00","closed_at":"2026-01-16T23:54:53.55073197-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-6r50m","depends_on_id":"hq-wisp-5nkl1","type":"parent-child","created_at":"2026-01-16T23:54:53.551986837-05:00","created_by":"deacon"}]}
{"id":"hq-6uotu","title":"Digest: mol-deacon-patrol","description":"Patrol 15: Idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:56:55.173137532-05:00","updated_at":"2026-01-16T23:56:55.173137532-05:00","closed_at":"2026-01-16T23:56:55.173087657-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-6uotu","depends_on_id":"hq-wisp-gpjen","type":"parent-child","created_at":"2026-01-16T23:56:55.176397569-05:00","created_by":"deacon"}]}
{"id":"hq-6uv","title":"Digest: mol-deacon-patrol","description":"Patrol 5","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:24:10.330167377-05:00","updated_at":"2026-01-16T00:24:10.330167377-05:00","closed_at":"2026-01-16T00:24:10.330114336-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-71g","title":"Digest: mol-deacon-patrol","description":"Patrol 18: Final patrol before handoff. Town idle, witness healthy.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T23:01:40.405066116-05:00","updated_at":"2026-01-15T23:01:40.405066116-05:00","closed_at":"2026-01-15T23:01:40.405002825-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-73g3","title":"Digest: mol-deacon-patrol","description":"Patrol 20: final sweep before handoff, idle town","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:44:05.418309467-05:00","updated_at":"2026-01-16T22:44:05.418309467-05:00","closed_at":"2026-01-16T22:44:05.418260717-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-73g3","depends_on_id":"hq-wisp-ptlb","type":"parent-child","created_at":"2026-01-16T22:44:05.419149133-05:00","created_by":"deacon"}]}
{"id":"hq-76flv","title":"Digest: mol-deacon-patrol","description":"Patrol 18: healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T10:49:05.37518371-05:00","updated_at":"2026-01-17T10:49:05.37518371-05:00","closed_at":"2026-01-17T10:49:05.375138127-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-76flv","depends_on_id":"hq-wisp-4poac","type":"parent-child","created_at":"2026-01-17T10:49:05.376326418-05:00","created_by":"deacon"}]}
{"id":"hq-78nlx","title":"Digest: mol-deacon-patrol","description":"Fast patrol - town idle, no changes","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:32:25.161348244-05:00","updated_at":"2026-01-17T00:32:25.161348244-05:00","closed_at":"2026-01-17T00:32:25.151396509-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-78nlx","depends_on_id":"hq-wisp-ntfqr","type":"parent-child","created_at":"2026-01-17T00:32:25.162745909-05:00","created_by":"deacon"}]}
{"id":"hq-78or","title":"Digest: mol-deacon-patrol","description":"Patrol 11 complete: all healthy, 3 dogs working","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:25:32.836527277-05:00","updated_at":"2026-01-16T01:25:32.836527277-05:00","closed_at":"2026-01-16T01:25:32.836476486-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-78or","depends_on_id":"hq-wisp-yyvb","type":"parent-child","created_at":"2026-01-16T01:25:32.837312235-05:00","created_by":"deacon"}]}
{"id":"hq-794lf","title":"Digest: mol-deacon-patrol","description":"Patrol #6: Quick idle cycle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:57:35.932709559-05:00","updated_at":"2026-01-16T22:57:35.932709559-05:00","closed_at":"2026-01-16T22:57:35.932657726-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-794lf","depends_on_id":"hq-wisp-jje3","type":"parent-child","created_at":"2026-01-16T22:57:35.933644767-05:00","created_by":"deacon"}]}
{"id":"hq-7a8","title":"Digest: mol-deacon-patrol","description":"Patrol complete: town idle, no active work, mayor running, witness/refinery stopped (expected), no issues","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T17:09:59.544996713-05:00","updated_at":"2026-01-15T17:09:59.544996713-05:00","closed_at":"2026-01-15T17:09:59.54495488-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-7c9","title":"Digest: mol-deacon-patrol","description":"Patrol 13: idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T23:19:34.466777078-05:00","updated_at":"2026-01-15T23:19:34.466777078-05:00","closed_at":"2026-01-15T23:19:34.466729244-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-7hb5","title":"Digest: mol-deacon-patrol","description":"Patrol 2: all clear, witness running, 3 dogs working","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:40:07.415623035-05:00","updated_at":"2026-01-16T01:40:07.415623035-05:00","closed_at":"2026-01-16T01:40:07.415564827-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-7hb5","depends_on_id":"hq-wisp-xxs3","type":"parent-child","created_at":"2026-01-16T01:40:07.416465743-05:00","created_by":"deacon"}]}
{"id":"hq-7j7","title":"Digest: mol-deacon-patrol","description":"Patrol 1: Town idle, witness running, no callbacks, no gates","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T23:12:27.783140871-05:00","updated_at":"2026-01-15T23:12:27.783140871-05:00","closed_at":"2026-01-15T23:12:27.783093788-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-7qqve","title":"Digest: mol-deacon-patrol","description":"Patrol complete: inbox empty, witness/refinery healthy, fixed 2 stuck dogs (alpha/bravo), no orphans","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:01:18.005042926-05:00","updated_at":"2026-01-17T01:01:18.005042926-05:00","closed_at":"2026-01-17T01:01:17.735516219-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-7qqve","depends_on_id":"hq-wisp-gsu00","type":"parent-child","created_at":"2026-01-17T01:01:18.007033881-05:00","created_by":"deacon"}]}
{"id":"hq-7rtup","title":"Digest: mol-deacon-patrol","description":"Patrol 14: healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T10:48:07.352887201-05:00","updated_at":"2026-01-17T10:48:07.352887201-05:00","closed_at":"2026-01-17T10:48:07.352837618-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-7rtup","depends_on_id":"hq-wisp-5y1vf","type":"parent-child","created_at":"2026-01-17T10:48:07.354085867-05:00","created_by":"deacon"}]}
{"id":"hq-7twk","title":"Digest: mol-deacon-patrol","description":"Patrol complete: witness/refinery healthy, escalated stuck dogs (4 working 20h+ with no work), 5 stale locks noted","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:42:26.324091944-05:00","updated_at":"2026-01-16T21:42:26.324091944-05:00","closed_at":"2026-01-16T21:42:26.32402436-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-7twk","depends_on_id":"hq-wisp-eexj","type":"parent-child","created_at":"2026-01-16T21:42:26.325232567-05:00","created_by":"deacon"}]}
{"id":"hq-824m","title":"Digest: mol-deacon-patrol","description":"Patrol 20: Town idle, healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:42:59.320771861-05:00","updated_at":"2026-01-16T00:42:59.320771861-05:00","closed_at":"2026-01-16T00:42:59.320724111-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-824m","depends_on_id":"hq-wisp-4xp","type":"parent-child","created_at":"2026-01-16T00:42:59.321432068-05:00","created_by":"deacon"}]}
{"id":"hq-86l93","title":"Digest: mol-deacon-patrol","description":"Patrol 17: Town idle, witness/refinery stopped (no work), 5 stale locks detected but formula broken, all dogs idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:06:41.690219148-05:00","updated_at":"2026-01-17T00:06:41.690219148-05:00","closed_at":"2026-01-17T00:06:40.30134617-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-86l93","depends_on_id":"hq-wisp-l9on3","type":"parent-child","created_at":"2026-01-17T00:06:41.691752187-05:00","created_by":"deacon"}]}
{"id":"hq-89ru","title":"Digest: mol-deacon-patrol","description":"Patrol 4: All healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:41:31.197228601-05:00","updated_at":"2026-01-16T01:41:31.197228601-05:00","closed_at":"2026-01-16T01:41:31.197168893-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-8f33z","title":"Digest: mol-deacon-patrol","description":"Patrol 6: Idle town","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:34:24.426848624-05:00","updated_at":"2026-01-17T00:34:24.426848624-05:00","closed_at":"2026-01-17T00:34:24.426794749-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-8f33z","depends_on_id":"hq-wisp-176hh","type":"parent-child","created_at":"2026-01-17T00:34:24.42829958-05:00","created_by":"deacon"}]}
{"id":"hq-8ftzw","title":"Digest: mol-deacon-patrol","description":"Patrol complete. Town idle. Witness/Refinery running. 3 potential zombie polecats noted (no kill authority). Dog dispatch failed (boot missing .dog.json).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:29:00.259163056-05:00","updated_at":"2026-01-17T00:29:00.259163056-05:00","closed_at":"2026-01-17T00:29:00.217074159-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-8ftzw","depends_on_id":"hq-wisp-udn1h","type":"parent-child","created_at":"2026-01-17T00:29:00.261239428-05:00","created_by":"deacon"}]}
{"id":"hq-8g7","title":"Digest: mol-deacon-patrol","description":"Patrol 11: idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T23:18:41.695321168-05:00","updated_at":"2026-01-15T23:18:41.695321168-05:00","closed_at":"2026-01-15T23:18:41.695246627-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-8o6l","title":"Digest: mol-deacon-patrol","description":"Patrol #2: All healthy, added dog charlie","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:54:44.827260394-05:00","updated_at":"2026-01-16T00:54:44.827260394-05:00","closed_at":"2026-01-16T00:54:44.827167769-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-8o6l","depends_on_id":"hq-wisp-cpp","type":"parent-child","created_at":"2026-01-16T00:54:44.828056644-05:00","created_by":"deacon"}]}
{"id":"hq-8pvls","title":"Digest: mol-deacon-patrol","description":"Patrol 2: Town idle, all checks passed, no issues","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:33:34.911598781-05:00","updated_at":"2026-01-16T23:33:34.911598781-05:00","closed_at":"2026-01-16T23:33:34.91154999-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-8pvls","depends_on_id":"hq-wisp-wge8","type":"parent-child","created_at":"2026-01-16T23:33:34.912671031-05:00","created_by":"deacon"}]}
{"id":"hq-8sjx","title":"Digest: mol-deacon-patrol","description":"Patrol 11","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:08:15.040069507-05:00","updated_at":"2026-01-16T22:08:15.040069507-05:00","closed_at":"2026-01-16T22:08:15.040017591-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-8sjx","depends_on_id":"hq-wisp-z78q","type":"parent-child","created_at":"2026-01-16T22:08:15.040897048-05:00","created_by":"deacon"}]}
{"id":"hq-93c","title":"Align install command and install path across docs/Makefile","description":"dispatched_by: mayor\n\nDocs consistently use go install; Makefile install now uses go install to match GOPATH/GOBIN and avoid ~/.local/bin divergence.","status":"closed","priority":2,"issue_type":"task","assignee":"gastown/crew/mal","owner":"erik.labianca@gmail.com","created_at":"2026-01-15T22:03:47.00022734-05:00","created_by":"gastown/crew/mal","updated_at":"2026-01-17T11:42:52.061614674-05:00","closed_at":"2026-01-17T11:42:52.061614674-05:00","close_reason":"Already fixed in commit 7e0eb999 - Makefile install target now uses go install"}
{"id":"hq-98za","title":"Digest: mol-deacon-patrol","description":"Patrol 2: town idle, alpha dog 16min (monitoring), 44 orphan processes noted","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:25:20.202727016-05:00","updated_at":"2026-01-16T01:25:20.202727016-05:00","closed_at":"2026-01-16T01:25:20.20268285-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-9bdph","title":"Digest: mol-deacon-patrol","description":"Patrol 8: quick scan, nominal","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:37:43.59513056-05:00","updated_at":"2026-01-17T00:37:43.59513056-05:00","closed_at":"2026-01-17T00:37:43.336285875-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-9bdph","depends_on_id":"hq-wisp-gcvqu","type":"parent-child","created_at":"2026-01-17T00:37:43.598891263-05:00","created_by":"deacon"}]}
{"id":"hq-9drx","title":"Digest: mol-deacon-patrol","description":"Patrol 19: fast sweep, idle town","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:43:04.289389511-05:00","updated_at":"2026-01-16T22:43:04.289389511-05:00","closed_at":"2026-01-16T22:43:04.289336053-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-9drx","depends_on_id":"hq-wisp-jqvn","type":"parent-child","created_at":"2026-01-16T22:43:04.290297344-05:00","created_by":"deacon"}]}
{"id":"hq-9esa","title":"Digest: mol-deacon-patrol","description":"Patrol 12","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:08:42.753555873-05:00","updated_at":"2026-01-16T22:08:42.753555873-05:00","closed_at":"2026-01-16T22:08:42.753501456-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-9esa","depends_on_id":"hq-wisp-qtrc","type":"parent-child","created_at":"2026-01-16T22:08:42.75443133-05:00","created_by":"deacon"}]}
{"id":"hq-9npzw","title":"Digest: mol-deacon-patrol","description":"Patrol 7 complete: idle town, no issues, all checks passed","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:46:55.767189718-05:00","updated_at":"2026-01-16T23:46:55.767189718-05:00","closed_at":"2026-01-16T23:46:55.702562647-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-9npzw","depends_on_id":"hq-wisp-vrns7","type":"parent-child","created_at":"2026-01-16T23:46:55.768450085-05:00","created_by":"deacon"}]}
{"id":"hq-9pi","title":"Digest: mol-deacon-patrol","description":"Patrol 9: Town idle, witness running, no zombies, no orphans, no incidents","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T22:30:48.803656238-05:00","updated_at":"2026-01-15T22:30:48.803656238-05:00","closed_at":"2026-01-15T22:30:48.803600447-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-9wu","title":"Digest: mol-deacon-patrol","description":"Patrol cycle 2: town idle, mayor running, witness/refinery stopped (expected)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T17:11:59.885054465-05:00","updated_at":"2026-01-15T17:11:59.885054465-05:00","closed_at":"2026-01-15T17:11:59.884999048-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-9x0","title":"Digest: mol-deacon-patrol","description":"Patrol 5: idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T23:14:55.26686885-05:00","updated_at":"2026-01-15T23:14:55.26686885-05:00","closed_at":"2026-01-15T23:14:55.266809225-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-9xb","title":"Digest: mol-deacon-patrol","description":"Patrol cycle 9: town idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T17:22:41.711070636-05:00","updated_at":"2026-01-15T17:22:41.711070636-05:00","closed_at":"2026-01-15T17:22:41.711025428-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-9zlg","title":"Digest: mol-deacon-patrol","description":"Patrol 5: all clear, dogs stuck in working state (state bug)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:44:46.114740287-05:00","updated_at":"2026-01-16T01:44:46.114740287-05:00","closed_at":"2026-01-16T01:44:46.114693829-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-9zlg","depends_on_id":"hq-wisp-g1el","type":"parent-child","created_at":"2026-01-16T01:44:46.11545337-05:00","created_by":"deacon"}]}
{"id":"hq-a13h5","title":"Digest: mol-deacon-patrol","description":"Final patrol 20: idle town, preparing for handoff","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:26:29.364447585-05:00","updated_at":"2026-01-16T23:26:29.364447585-05:00","closed_at":"2026-01-16T23:26:29.364395251-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-a13h5","depends_on_id":"hq-wisp-dpw6","type":"parent-child","created_at":"2026-01-16T23:26:29.365557251-05:00","created_by":"deacon"}]}
{"id":"hq-a3oh","title":"Digest: mol-deacon-patrol","description":"Patrol 18: fast sweep, idle town","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:41:40.04245275-05:00","updated_at":"2026-01-16T22:41:40.04245275-05:00","closed_at":"2026-01-16T22:41:40.042406875-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-a3oh","depends_on_id":"hq-wisp-qe2w","type":"parent-child","created_at":"2026-01-16T22:41:40.043347917-05:00","created_by":"deacon"}]}
{"id":"hq-a4i","title":"Digest: mol-deacon-patrol","description":"Patrol 10: Town idle, all healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T22:33:39.23684777-05:00","updated_at":"2026-01-15T22:33:39.23684777-05:00","closed_at":"2026-01-15T22:33:39.236793396-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-a54e","title":"Digest: mol-deacon-patrol","description":"P20","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:25:25.834500218-05:00","updated_at":"2026-01-16T00:25:25.834500218-05:00","closed_at":"2026-01-16T00:25:25.834433009-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-af55s","title":"Digest: mol-deacon-patrol","description":"Patrol 13: Idle, batch","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:47:39.873511503-05:00","updated_at":"2026-01-16T23:47:39.873511503-05:00","closed_at":"2026-01-16T23:47:39.815917098-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-af55s","depends_on_id":"hq-wisp-qn14e","type":"parent-child","created_at":"2026-01-16T23:47:39.874846911-05:00","created_by":"deacon"}]}
{"id":"hq-agjng","title":"Digest: mol-deacon-patrol","description":"Patrol 16: town idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:53:51.306740506-05:00","updated_at":"2026-01-16T23:53:51.306740506-05:00","closed_at":"2026-01-16T23:53:51.27031895-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-agjng","depends_on_id":"hq-wisp-3xuzc","type":"parent-child","created_at":"2026-01-16T23:53:51.310588503-05:00","created_by":"deacon"}]}
{"id":"hq-ajrr","title":"Digest: mol-deacon-patrol","description":"Patrol 4: all clear, quick scan completed","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:41:05.824835878-05:00","updated_at":"2026-01-16T01:41:05.824835878-05:00","closed_at":"2026-01-16T01:41:05.82478292-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-ajrr","depends_on_id":"hq-wisp-09w6","type":"parent-child","created_at":"2026-01-16T01:41:05.825692503-05:00","created_by":"deacon"}]}
{"id":"hq-ajyq0","title":"Digest: mol-deacon-patrol","description":"Patrol 20: healthy, handoff threshold reached","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T10:49:34.346183759-05:00","updated_at":"2026-01-17T10:49:34.346183759-05:00","closed_at":"2026-01-17T10:49:34.346127634-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-ajyq0","depends_on_id":"hq-wisp-fpsqo","type":"parent-child","created_at":"2026-01-17T10:49:34.347363717-05:00","created_by":"deacon"}]}
{"id":"hq-atf7","title":"Test with explicit repo","description":"Test","status":"closed","priority":2,"issue_type":"message","assignee":"mayor","owner":"erik.labianca@gmail.com","created_at":"2026-01-16T21:37:50.67946643-05:00","created_by":"mayor","updated_at":"2026-01-17T07:37:52.383362569-05:00","closed_at":"2026-01-17T07:37:52.383362569-05:00","close_reason":"Closed"}
{"id":"hq-awdo","title":"Digest: mol-deacon-patrol","description":"Patrol 14 complete: all healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:27:57.133355708-05:00","updated_at":"2026-01-16T01:27:57.133355708-05:00","closed_at":"2026-01-16T01:27:57.133306875-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-awdo","depends_on_id":"hq-wisp-4mti","type":"parent-child","created_at":"2026-01-16T01:27:57.134101291-05:00","created_by":"deacon"}]}
{"id":"hq-b23vd","title":"Digest: mol-deacon-patrol","description":"Patrol 10: town healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T10:47:04.321988999-05:00","updated_at":"2026-01-17T10:47:04.321988999-05:00","closed_at":"2026-01-17T10:47:04.321943374-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-b23vd","depends_on_id":"hq-wisp-loso0","type":"parent-child","created_at":"2026-01-17T10:47:04.323029249-05:00","created_by":"deacon"}]}
{"id":"hq-b3f8j","title":"Digest: mol-deacon-patrol","description":"Patrol 2: Idle town, all steps passed","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:26:25.801918538-05:00","updated_at":"2026-01-17T00:26:25.801918538-05:00","closed_at":"2026-01-17T00:26:25.780661367-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-b7x","title":"Digest: mol-deacon-patrol","description":"Patrol cycle 8: town idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T17:21:11.151987979-05:00","updated_at":"2026-01-15T17:21:11.151987979-05:00","closed_at":"2026-01-15T17:21:11.151934854-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-bat7q","title":"Digest: mol-deacon-patrol","description":"Rapid patrol: idle town, no incidents","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:21:04.151420962-05:00","updated_at":"2026-01-16T23:21:04.151420962-05:00","closed_at":"2026-01-16T23:21:04.151374253-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-bat7q","depends_on_id":"hq-wisp-dob2","type":"parent-child","created_at":"2026-01-16T23:21:04.152328128-05:00","created_by":"deacon"}]}
{"id":"hq-bb9","title":"Digest: mol-deacon-patrol","description":"Patrol 3: Town idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T23:15:39.631597029-05:00","updated_at":"2026-01-15T23:15:39.631597029-05:00","closed_at":"2026-01-15T23:15:39.631545029-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-bbovc","title":"Digest: mol-deacon-patrol","description":"Patrol 19: quick check, all healthy, 9 idle dogs","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:09:27.942466337-05:00","updated_at":"2026-01-17T01:09:27.942466337-05:00","closed_at":"2026-01-17T01:09:27.829961471-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-bh57b","title":"Digest: mol-deacon-patrol","description":"Patrol 7: quick scan, all nominal","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:33:11.987111225-05:00","updated_at":"2026-01-17T00:33:11.987111225-05:00","closed_at":"2026-01-17T00:33:11.965098009-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-bh57b","depends_on_id":"hq-wisp-glvay","type":"parent-child","created_at":"2026-01-17T00:33:11.988589056-05:00","created_by":"deacon"}]}
{"id":"hq-bk1","title":"Digest: mol-deacon-patrol","description":"Patrol 15: Town idle, witness healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T22:54:15.187683687-05:00","updated_at":"2026-01-15T22:54:15.187683687-05:00","closed_at":"2026-01-15T22:54:15.187635021-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-bm06z","title":"Digest: mol-deacon-patrol","description":"Patrol 4: Idle town","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:29:58.687784477-05:00","updated_at":"2026-01-17T00:29:58.687784477-05:00","closed_at":"2026-01-17T00:29:58.681927486-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-bm06z","depends_on_id":"hq-wisp-nq4ui","type":"parent-child","created_at":"2026-01-17T00:29:58.689188267-05:00","created_by":"deacon"}]}
{"id":"hq-bnrm1","title":"Digest: mol-deacon-patrol","description":"Patrol 7: Idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:41:31.999012921-05:00","updated_at":"2026-01-16T23:41:31.999012921-05:00","closed_at":"2026-01-16T23:41:31.995783589-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-bnrm1","depends_on_id":"hq-wisp-ddr1z","type":"parent-child","created_at":"2026-01-16T23:41:32.000116963-05:00","created_by":"deacon"}]}
{"id":"hq-bwd41","title":"Digest: mol-deacon-patrol","description":"Patrol 13: healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T10:47:49.185254999-05:00","updated_at":"2026-01-17T10:47:49.185254999-05:00","closed_at":"2026-01-17T10:47:49.185188999-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-bwd41","depends_on_id":"hq-wisp-thou2","type":"parent-child","created_at":"2026-01-17T10:47:49.186519456-05:00","created_by":"deacon"}]}
{"id":"hq-c274","title":"Digest: mol-deacon-patrol","description":"Patrol 16: Town idle, healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:42:55.102764334-05:00","updated_at":"2026-01-16T00:42:55.102764334-05:00","closed_at":"2026-01-16T00:42:55.102713209-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-c274","depends_on_id":"hq-wisp-fx2","type":"parent-child","created_at":"2026-01-16T00:42:55.103437249-05:00","created_by":"deacon"}]}
{"id":"hq-cdih","title":"Digest: mol-deacon-patrol","description":"Patrol 2 complete: 12 sessions healthy, inbox clear, no pending work","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:15:31.676495022-05:00","updated_at":"2026-01-16T22:15:31.676495022-05:00","closed_at":"2026-01-16T22:15:31.676445314-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-cdih","depends_on_id":"hq-wisp-tp8x","type":"parent-child","created_at":"2026-01-16T22:15:31.677611646-05:00","created_by":"deacon"}]}
{"id":"hq-cewf","title":"Digest: mol-deacon-patrol","description":"Patrol 5: 12 sessions healthy, no issues","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:21:05.277267318-05:00","updated_at":"2026-01-16T22:21:05.277267318-05:00","closed_at":"2026-01-16T22:21:05.277212568-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-cewf","depends_on_id":"hq-wisp-vake","type":"parent-child","created_at":"2026-01-16T22:21:05.278339942-05:00","created_by":"deacon"}]}
{"id":"hq-cwq","title":"Digest: mol-deacon-patrol","description":"Patrol 20: idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T23:22:11.642502481-05:00","updated_at":"2026-01-15T23:22:11.642502481-05:00","closed_at":"2026-01-15T23:22:11.642390481-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-cxve7","title":"Digest: mol-deacon-patrol","description":"Patrol 16: Idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:58:51.882731764-05:00","updated_at":"2026-01-16T23:58:51.882731764-05:00","closed_at":"2026-01-16T23:58:51.882684722-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-cxve7","depends_on_id":"hq-wisp-5wda2","type":"parent-child","created_at":"2026-01-16T23:58:51.883868304-05:00","created_by":"deacon"}]}
{"id":"hq-d0zix","title":"Digest: mol-deacon-patrol","description":"Patrol 3: Idle town sweep","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:27:46.315951084-05:00","updated_at":"2026-01-17T00:27:46.315951084-05:00","closed_at":"2026-01-17T00:27:46.27657789-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-d0zix","depends_on_id":"hq-wisp-ibdxb","type":"parent-child","created_at":"2026-01-17T00:27:46.317481956-05:00","created_by":"deacon"}]}
{"id":"hq-d7x76","title":"Digest: mol-deacon-patrol","description":"Patrol complete: cleared 5 stuck dogs, dispatched orphan scan to dog, all steps done","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:32:39.304848443-05:00","updated_at":"2026-01-16T23:32:39.304848443-05:00","closed_at":"2026-01-16T23:32:39.287451362-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-d7x76","depends_on_id":"hq-wisp-nxbv","type":"parent-child","created_at":"2026-01-16T23:32:39.30582586-05:00","created_by":"deacon"}]}
{"id":"hq-d8a","title":"Digest: mol-deacon-patrol","description":"Patrol 4 complete: idle town","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T23:38:17.617798584-05:00","updated_at":"2026-01-15T23:38:17.617798584-05:00","closed_at":"2026-01-15T23:38:17.61774321-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-dd3","title":"Digest: mol-deacon-patrol","description":"Patrol cycle 3: town idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T17:13:39.260250157-05:00","updated_at":"2026-01-15T17:13:39.260250157-05:00","closed_at":"2026-01-15T17:13:39.260194824-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-dgkd","title":"Digest: mol-deacon-patrol","description":"P16","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:25:22.395474496-05:00","updated_at":"2026-01-16T00:25:22.395474496-05:00","closed_at":"2026-01-16T00:25:22.395421205-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-dh6","title":"Digest: mol-deacon-patrol","description":"P7","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:24:38.099097665-05:00","updated_at":"2026-01-16T00:24:38.099097665-05:00","closed_at":"2026-01-16T00:24:38.099042957-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-dh90q","title":"Digest: mol-deacon-patrol","description":"Patrol 9: Idle town, handoff after this","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:41:15.695220649-05:00","updated_at":"2026-01-17T00:41:15.695220649-05:00","closed_at":"2026-01-17T00:41:14.874639451-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-dh90q","depends_on_id":"hq-wisp-mrvtz","type":"parent-child","created_at":"2026-01-17T00:41:15.696862938-05:00","created_by":"deacon"}]}
{"id":"hq-dk4j6","title":"Digest: mol-deacon-patrol","description":"Patrol 6: Town idle, all clear. 0 inbox, 0 gates, 0 convoys. 6 dogs working. No zombies/orphans.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:39:23.271839403-05:00","updated_at":"2026-01-16T23:39:23.271839403-05:00","closed_at":"2026-01-16T23:39:23.247743239-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-dk4j6","depends_on_id":"hq-wisp-rzdz","type":"parent-child","created_at":"2026-01-16T23:39:23.273048944-05:00","created_by":"deacon"}]}
{"id":"hq-dqg5","title":"Digest: mol-deacon-patrol","description":"Patrol 17: Town idle, healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:42:56.233076501-05:00","updated_at":"2026-01-16T00:42:56.233076501-05:00","closed_at":"2026-01-16T00:42:56.233003126-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-dqg5","depends_on_id":"hq-wisp-ptk","type":"parent-child","created_at":"2026-01-16T00:42:56.234110541-05:00","created_by":"deacon"}]}
{"id":"hq-dtyc","title":"Digest: mol-deacon-patrol","description":"Patrol 19 complete: all healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:29:51.932619385-05:00","updated_at":"2026-01-16T01:29:51.932619385-05:00","closed_at":"2026-01-16T01:29:51.932573427-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-dtyc","depends_on_id":"hq-wisp-25tf","type":"parent-child","created_at":"2026-01-16T01:29:51.933508801-05:00","created_by":"deacon"}]}
{"id":"hq-dz8i","title":"Digest: mol-deacon-patrol","description":"Orphaned patrol - squashed for cleanup","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:55:44.020113081-05:00","updated_at":"2026-01-16T01:55:44.020113081-05:00","closed_at":"2026-01-16T01:55:44.020058164-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-e45i","title":"Digest: mol-deacon-patrol","description":"Patrol 8: 12 sessions healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:23:30.536009081-05:00","updated_at":"2026-01-16T22:23:30.536009081-05:00","closed_at":"2026-01-16T22:23:30.535955831-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-e45i","depends_on_id":"hq-wisp-hz58","type":"parent-child","created_at":"2026-01-16T22:23:30.537020372-05:00","created_by":"deacon"}]}
{"id":"hq-e7j","title":"Digest: mol-deacon-patrol","description":"Patrol 3: Healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:23:25.918219141-05:00","updated_at":"2026-01-16T00:23:25.918219141-05:00","closed_at":"2026-01-16T00:23:25.918163224-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-eivi","title":"Digest: mol-deacon-patrol","description":"Patrol quick cycle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:44:43.781839161-05:00","updated_at":"2026-01-16T01:44:43.781839161-05:00","closed_at":"2026-01-16T01:44:43.781793828-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-eivi","depends_on_id":"hq-wisp-ky6x","type":"parent-child","created_at":"2026-01-16T01:44:43.782712368-05:00","created_by":"deacon"}]}
{"id":"hq-ejy9o","title":"Digest: mol-deacon-patrol","description":"Patrol 10: Idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:46:00.559394914-05:00","updated_at":"2026-01-16T23:46:00.559394914-05:00","closed_at":"2026-01-16T23:46:00.254532192-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-ejy9o","depends_on_id":"hq-wisp-tpwpk","type":"parent-child","created_at":"2026-01-16T23:46:00.560931815-05:00","created_by":"deacon"}]}
{"id":"hq-epeg2","title":"Digest: mol-deacon-patrol","description":"Patrol complete: inbox clean, niflheim healthy, gastown witness/refinery stopped, 5 stale locks detected, no active polecat work","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:15:32.740325083-05:00","updated_at":"2026-01-16T23:15:32.740325083-05:00","closed_at":"2026-01-16T23:15:32.740264125-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-epeg2","depends_on_id":"hq-wisp-wof8","type":"parent-child","created_at":"2026-01-16T23:15:32.741270875-05:00","created_by":"deacon"}]}
{"id":"hq-es2","title":"Digest: mol-deacon-patrol","description":"Patrol cycle 6: town idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T17:18:11.159929451-05:00","updated_at":"2026-01-15T17:18:11.159929451-05:00","closed_at":"2026-01-15T17:18:11.159860368-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-evafs","title":"Digest: mol-deacon-patrol","description":"Patrol 17: nominal","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:53:56.099429744-05:00","updated_at":"2026-01-17T00:53:56.099429744-05:00","closed_at":"2026-01-17T00:53:55.873513018-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-exct","title":"Digest: mol-deacon-patrol","description":"Patrol 16 complete: all healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:29:05.3711027-05:00","updated_at":"2026-01-16T01:29:05.3711027-05:00","closed_at":"2026-01-16T01:29:05.371034867-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-f7wk7","title":"Digest: mol-deacon-patrol","description":"Patrol 13: nominal","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:49:07.654818843-05:00","updated_at":"2026-01-17T00:49:07.654818843-05:00","closed_at":"2026-01-17T00:49:07.654769052-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-f8p8k","title":"Digest: mol-deacon-patrol","description":"Patrol 3: town idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:00:08.846471155-05:00","updated_at":"2026-01-16T23:00:08.846471155-05:00","closed_at":"2026-01-16T23:00:08.846417072-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-f8p8k","depends_on_id":"hq-wisp-72tf","type":"parent-child","created_at":"2026-01-16T23:00:08.847389988-05:00","created_by":"deacon"}]}
{"id":"hq-fho","title":"Digest: mol-deacon-patrol","description":"Patrol complete: inbox empty, witness healthy, no orphans, idle town","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T22:44:27.441480404-05:00","updated_at":"2026-01-15T22:44:27.441480404-05:00","closed_at":"2026-01-15T22:44:27.441421821-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-fiooy","title":"Digest: mol-deacon-patrol","description":"Patrol 11: quick scan, nominal","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:46:00.090530459-05:00","updated_at":"2026-01-17T00:46:00.090530459-05:00","closed_at":"2026-01-17T00:46:00.049567063-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-firg","title":"Digest: mol-deacon-patrol","description":"Patrol 10: OK","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:44:09.248289144-05:00","updated_at":"2026-01-16T01:44:09.248289144-05:00","closed_at":"2026-01-16T01:44:09.24823131-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-firg","depends_on_id":"hq-wisp-xcad","type":"parent-child","created_at":"2026-01-16T01:44:09.249263893-05:00","created_by":"deacon"}]}
{"id":"hq-fxm8n","title":"Digest: mol-deacon-patrol","description":"Patrol 10: town idle, no incidents","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:53:58.155671403-05:00","updated_at":"2026-01-16T23:53:58.155671403-05:00","closed_at":"2026-01-16T23:53:58.035211538-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-fxm8n","depends_on_id":"hq-wisp-i50hl","type":"parent-child","created_at":"2026-01-16T23:53:58.156998569-05:00","created_by":"deacon"}]}
{"id":"hq-g12r","title":"Digest: mol-deacon-patrol","description":"Patrol complete: inbox empty, niflheim healthy, gastown/helix stopped (idle), 5 dogs ready, no zombies, cleanup formula bug noted","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:54:46.857801115-05:00","updated_at":"2026-01-16T22:54:46.857801115-05:00","closed_at":"2026-01-16T22:54:46.857744656-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-g12r","depends_on_id":"hq-wisp-b7xd","type":"parent-child","created_at":"2026-01-16T22:54:46.858718073-05:00","created_by":"deacon"}]}
{"id":"hq-g3dt","title":"Digest: mol-deacon-patrol","description":"Patrol 7: quick cycle, all healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:04:23.789763074-05:00","updated_at":"2026-01-16T22:04:23.789763074-05:00","closed_at":"2026-01-16T22:04:23.789711282-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-g3dt","depends_on_id":"hq-wisp-n2md","type":"parent-child","created_at":"2026-01-16T22:04:23.790580698-05:00","created_by":"deacon"}]}
{"id":"hq-g5wu1","title":"Digest: mol-deacon-patrol","description":"Patrol 9 complete: idle town, all healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:53:13.496784968-05:00","updated_at":"2026-01-16T23:53:13.496784968-05:00","closed_at":"2026-01-16T23:53:13.469520489-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-g5wu1","depends_on_id":"hq-wisp-fehhn","type":"parent-child","created_at":"2026-01-16T23:53:13.498174509-05:00","created_by":"deacon"}]}
{"id":"hq-gi1kw","title":"Digest: mol-deacon-patrol","description":"Patrol complete: all agents healthy, town idle, no issues","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T10:15:02.884568347-05:00","updated_at":"2026-01-17T10:15:02.884568347-05:00","closed_at":"2026-01-17T10:15:02.884465014-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-gi1kw","depends_on_id":"hq-wisp-90z8r","type":"parent-child","created_at":"2026-01-17T10:15:02.888455507-05:00","created_by":"gastown/refinery"}]}
{"id":"hq-gihoi","title":"Digest: mol-deacon-patrol","description":"Patrol 7: town healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T10:46:04.403156143-05:00","updated_at":"2026-01-17T10:46:04.403156143-05:00","closed_at":"2026-01-17T10:46:04.403103893-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-gihoi","depends_on_id":"hq-wisp-8avgc","type":"parent-child","created_at":"2026-01-17T10:46:04.404413642-05:00","created_by":"deacon"}]}
{"id":"hq-go16g","title":"Digest: mol-deacon-patrol","description":"Patrol 8: Idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:42:58.473629544-05:00","updated_at":"2026-01-16T23:42:58.473629544-05:00","closed_at":"2026-01-16T23:42:58.458506789-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-go16g","depends_on_id":"hq-wisp-6jzva","type":"parent-child","created_at":"2026-01-16T23:42:58.475007813-05:00","created_by":"deacon"}]}
{"id":"hq-gp7y","title":"Digest: mol-deacon-patrol","description":"Patrol 6: quick cycle, all healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:03:44.452566595-05:00","updated_at":"2026-01-16T22:03:44.452566595-05:00","closed_at":"2026-01-16T22:03:44.452512137-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-gp7y","depends_on_id":"hq-wisp-71b7","type":"parent-child","created_at":"2026-01-16T22:03:44.454133135-05:00","created_by":"deacon"}]}
{"id":"hq-gvrds","title":"Digest: mol-deacon-patrol","description":"Patrol 15: healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T10:48:21.328515524-05:00","updated_at":"2026-01-17T10:48:21.328515524-05:00","closed_at":"2026-01-17T10:48:21.328463524-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-gvrds","depends_on_id":"hq-wisp-cajvv","type":"parent-child","created_at":"2026-01-17T10:48:21.329700857-05:00","created_by":"deacon"}]}
{"id":"hq-gyml","title":"Digest: mol-deacon-patrol","description":"Patrol 17: idle town, session-gc running, no issues","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:38:08.692430614-05:00","updated_at":"2026-01-16T22:38:08.692430614-05:00","closed_at":"2026-01-16T22:38:08.692375905-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-gyml","depends_on_id":"hq-wisp-1eou","type":"parent-child","created_at":"2026-01-16T22:38:08.693307821-05:00","created_by":"deacon"}]}
{"id":"hq-h3hi","title":"Digest: mol-deacon-patrol","description":"Patrol 9","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:07:28.380545679-05:00","updated_at":"2026-01-16T22:07:28.380545679-05:00","closed_at":"2026-01-16T22:07:28.380493429-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-h3hi","depends_on_id":"hq-wisp-h1uu","type":"parent-child","created_at":"2026-01-16T22:07:28.381618886-05:00","created_by":"deacon"}]}
{"id":"hq-h3p","title":"Digest: mol-deacon-patrol","description":"P6","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:24:26.513486945-05:00","updated_at":"2026-01-16T00:24:26.513486945-05:00","closed_at":"2026-01-16T00:24:26.513441903-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-h5tp","title":"Digest: mol-deacon-patrol","description":"All steps auto-closed unexpectedly - investigating","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:52:12.27177183-05:00","updated_at":"2026-01-16T01:52:12.27177183-05:00","closed_at":"2026-01-16T01:52:12.271714913-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-h5tp","depends_on_id":"hq-wisp-rz64","type":"parent-child","created_at":"2026-01-16T01:52:12.272640204-05:00","created_by":"deacon"}]}
{"id":"hq-h73v","title":"Digest: mol-deacon-patrol","description":"P17","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:25:11.030006218-05:00","updated_at":"2026-01-16T00:25:11.030006218-05:00","closed_at":"2026-01-16T00:25:11.029947426-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-h7b13","title":"Digest: mol-deacon-patrol","description":"Patrol 4: Quick check, town idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:36:47.7749577-05:00","updated_at":"2026-01-16T23:36:47.7749577-05:00","closed_at":"2026-01-16T23:36:47.757271077-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-h7b13","depends_on_id":"hq-wisp-x1ww","type":"parent-child","created_at":"2026-01-16T23:36:47.776033866-05:00","created_by":"deacon"}]}
{"id":"hq-h8a5","title":"Digest: mol-deacon-patrol","description":"Patrol 6: all healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:21:58.95065212-05:00","updated_at":"2026-01-16T22:21:58.95065212-05:00","closed_at":"2026-01-16T22:21:58.950597495-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-h8a5","depends_on_id":"hq-wisp-eohz","type":"parent-child","created_at":"2026-01-16T22:21:58.951546536-05:00","created_by":"deacon"}]}
{"id":"hq-h9t7","title":"Digest: mol-deacon-patrol","description":"P15","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:24:57.770542719-05:00","updated_at":"2026-01-16T00:24:57.770542719-05:00","closed_at":"2026-01-16T00:24:57.77048251-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-hfr73","title":"Digest: mol-deacon-patrol","description":"Patrol 4: all rigs healthy, no issues","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:31:23.043299061-05:00","updated_at":"2026-01-17T00:31:23.043299061-05:00","closed_at":"2026-01-17T00:31:23.017643017-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-hfr73","depends_on_id":"hq-wisp-wttjk","type":"parent-child","created_at":"2026-01-17T00:31:23.044960933-05:00","created_by":"deacon"}]}
{"id":"hq-hs2u","title":"Digest: mol-deacon-patrol","description":"Patrol: inbox empty, Mayor up, town idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:14:41.17424771-05:00","updated_at":"2026-01-16T22:14:41.17424771-05:00","closed_at":"2026-01-16T22:14:41.174188627-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-hs2u","depends_on_id":"hq-wisp-04nb","type":"parent-child","created_at":"2026-01-16T22:14:41.175110917-05:00","created_by":"deacon"}]}
{"id":"hq-hso8e","title":"Digest: mol-deacon-patrol","description":"Rapid patrol 18: idle town","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:24:29.535140773-05:00","updated_at":"2026-01-16T23:24:29.535140773-05:00","closed_at":"2026-01-16T23:24:29.506268402-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-hso8e","depends_on_id":"hq-wisp-spyv","type":"parent-child","created_at":"2026-01-16T23:24:29.536442064-05:00","created_by":"deacon"}]}
{"id":"hq-hzf6","title":"Digest: mol-deacon-patrol","description":"Patrol 18: Town idle, healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:42:57.245996057-05:00","updated_at":"2026-01-16T00:42:57.245996057-05:00","closed_at":"2026-01-16T00:42:57.245943015-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-hzf6","depends_on_id":"hq-wisp-fhf","type":"parent-child","created_at":"2026-01-16T00:42:57.246691431-05:00","created_by":"deacon"}]}
{"id":"hq-i0t","title":"Digest: mol-deacon-patrol","description":"P8","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:24:39.001219776-05:00","updated_at":"2026-01-16T00:24:39.001219776-05:00","closed_at":"2026-01-16T00:24:39.001166776-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-i234g","title":"Digest: mol-deacon-patrol","description":"Patrol 8 complete: idle town, all checks passed","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:50:42.663041272-05:00","updated_at":"2026-01-16T23:50:42.663041272-05:00","closed_at":"2026-01-16T23:50:42.518058968-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-i234g","depends_on_id":"hq-wisp-53of7","type":"parent-child","created_at":"2026-01-16T23:50:42.664278688-05:00","created_by":"deacon"}]}
{"id":"hq-i47g0","title":"Digest: mol-deacon-patrol","description":"Patrol 12: Idle, batch","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:46:51.580174028-05:00","updated_at":"2026-01-16T23:46:51.580174028-05:00","closed_at":"2026-01-16T23:46:51.555051178-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-i47g0","depends_on_id":"hq-wisp-92nyy","type":"parent-child","created_at":"2026-01-16T23:46:51.581495978-05:00","created_by":"deacon"}]}
{"id":"hq-ige4","title":"Digest: mol-deacon-patrol","description":"Patrol 3: expedited, town idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:54:40.576581975-05:00","updated_at":"2026-01-16T00:54:40.576581975-05:00","closed_at":"2026-01-16T00:54:40.555195218-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-ige4","depends_on_id":"hq-wisp-chx","type":"parent-child","created_at":"2026-01-16T00:54:40.577780142-05:00","created_by":"deacon"}]}
{"id":"hq-ihb8","title":"Digest: mol-deacon-patrol","description":"P17","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:25:23.218197218-05:00","updated_at":"2026-01-16T00:25:23.218197218-05:00","closed_at":"2026-01-16T00:25:23.218140218-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-ine6","title":"Digest: mol-deacon-patrol","description":"P18","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:25:24.103805643-05:00","updated_at":"2026-01-16T00:25:24.103805643-05:00","closed_at":"2026-01-16T00:25:24.10374806-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-inkzo","title":"Digest: mol-deacon-patrol","description":"Patrol 10: quick scan, nominal","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:42:19.585584776-05:00","updated_at":"2026-01-17T00:42:19.585584776-05:00","closed_at":"2026-01-17T00:42:19.478795149-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-inkzo","depends_on_id":"hq-wisp-xhvqb","type":"parent-child","created_at":"2026-01-17T00:42:19.587659023-05:00","created_by":"deacon"}]}
{"id":"hq-iojio","title":"Digest: mol-deacon-patrol","description":"Patrol 14: nominal","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:50:35.297000072-05:00","updated_at":"2026-01-17T00:50:35.297000072-05:00","closed_at":"2026-01-17T00:50:34.787814024-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-iuieq","title":"Digest: mol-deacon-patrol","description":"Patrol 19: Idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:04:45.556113782-05:00","updated_at":"2026-01-17T00:04:45.556113782-05:00","closed_at":"2026-01-17T00:04:45.543884423-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-iuieq","depends_on_id":"hq-wisp-f81wh","type":"parent-child","created_at":"2026-01-17T00:04:45.557438655-05:00","created_by":"deacon"}]}
{"id":"hq-ix3aq","title":"Digest: mol-deacon-patrol","description":"Patrol 2: town idle, all healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:56:27.307281365-05:00","updated_at":"2026-01-16T22:56:27.307281365-05:00","closed_at":"2026-01-16T22:56:27.30723174-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-ix3aq","depends_on_id":"hq-wisp-me5p","type":"parent-child","created_at":"2026-01-16T22:56:27.308213156-05:00","created_by":"deacon"}]}
{"id":"hq-iyawo","title":"Digest: mol-deacon-patrol","description":"Patrol 6: Town idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:39:50.853051319-05:00","updated_at":"2026-01-16T23:39:50.853051319-05:00","closed_at":"2026-01-16T23:39:50.853002569-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-iyawo","depends_on_id":"hq-wisp-o5vic","type":"parent-child","created_at":"2026-01-16T23:39:50.854083944-05:00","created_by":"deacon"}]}
{"id":"hq-j21fv","title":"Digest: mol-deacon-patrol","description":"Ultra-fast patrol 8 - town idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:36:04.372021668-05:00","updated_at":"2026-01-17T00:36:04.372021668-05:00","closed_at":"2026-01-17T00:36:04.371956085-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-j21fv","depends_on_id":"hq-wisp-5maux","type":"parent-child","created_at":"2026-01-17T00:36:04.373778207-05:00","created_by":"deacon"}]}
{"id":"hq-j2e4","title":"Digest: mol-deacon-patrol","description":"Patrol #5: Final cycle before handoff, all healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:59:48.396914459-05:00","updated_at":"2026-01-16T00:59:48.396914459-05:00","closed_at":"2026-01-16T00:59:48.396843792-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-j2e4","depends_on_id":"hq-wisp-rfpi","type":"parent-child","created_at":"2026-01-16T00:59:48.397884291-05:00","created_by":"deacon"}]}
{"id":"hq-j61u","title":"Digest: mol-deacon-patrol","description":"Patrol 14: Quick cycle triggered by hq-93c completion. All healthy.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:32:19.048489595-05:00","updated_at":"2026-01-16T22:32:19.048489595-05:00","closed_at":"2026-01-16T22:32:19.048438512-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-j61u","depends_on_id":"hq-wisp-xxi3","type":"parent-child","created_at":"2026-01-16T22:32:19.049405346-05:00","created_by":"deacon"}]}
{"id":"hq-j84h","title":"Digest: mol-deacon-patrol","description":"Patrol cycle 1: Town idle, agents healthy, no incidents","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:45:52.082729689-05:00","updated_at":"2026-01-16T21:45:52.082729689-05:00","closed_at":"2026-01-16T21:45:52.082672189-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-j84h","depends_on_id":"hq-wisp-vkkp","type":"parent-child","created_at":"2026-01-16T21:45:52.08374802-05:00","created_by":"deacon"}]}
{"id":"hq-jf3tv","title":"Digest: mol-deacon-patrol","description":"Patrol 15: town idle, all checks passed","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:50:34.913398202-05:00","updated_at":"2026-01-16T23:50:34.913398202-05:00","closed_at":"2026-01-16T23:50:34.89326479-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-jf3tv","depends_on_id":"hq-wisp-k7sck","type":"parent-child","created_at":"2026-01-16T23:50:34.914587949-05:00","created_by":"deacon"}]}
{"id":"hq-jhqq","title":"Digest: mol-deacon-patrol","description":"Patrol 12: Town idle, healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:42:42.553022921-05:00","updated_at":"2026-01-16T00:42:42.553022921-05:00","closed_at":"2026-01-16T00:42:42.552971713-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-jhqq","depends_on_id":"hq-wisp-qr0","type":"parent-child","created_at":"2026-01-16T00:42:42.553833129-05:00","created_by":"deacon"}]}
{"id":"hq-jiqb","title":"Digest: mol-deacon-patrol","description":"Patrol wisp inherited complete - no active steps needed","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:54:39.597508048-05:00","updated_at":"2026-01-16T01:54:39.597508048-05:00","closed_at":"2026-01-16T01:54:39.588154892-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-jiqb","depends_on_id":"hq-wisp-2xjo","type":"parent-child","created_at":"2026-01-16T01:54:39.598399089-05:00","created_by":"deacon"}]}
{"id":"hq-jl4b","title":"Digest: mol-deacon-patrol","description":"Patrol 4: inbox empty, all agents healthy, added dog echo, no orphans","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:59:04.062762512-05:00","updated_at":"2026-01-16T21:59:04.062762512-05:00","closed_at":"2026-01-16T21:59:04.062708596-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-jl4b","depends_on_id":"hq-wisp-8bg4","type":"parent-child","created_at":"2026-01-16T21:59:04.063522887-05:00","created_by":"deacon"}]}
{"id":"hq-jl8y","title":"Digest: mol-deacon-patrol","description":"Patrol 15 complete: all healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:28:36.19604911-05:00","updated_at":"2026-01-16T01:28:36.19604911-05:00","closed_at":"2026-01-16T01:28:36.195993235-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-jl8y","depends_on_id":"hq-wisp-spb2","type":"parent-child","created_at":"2026-01-16T01:28:36.19682715-05:00","created_by":"deacon"}]}
{"id":"hq-jp8g","title":"Digest: mol-deacon-patrol","description":"Patrol 6: OK","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:42:52.111977227-05:00","updated_at":"2026-01-16T01:42:52.111977227-05:00","closed_at":"2026-01-16T01:42:52.111925311-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-k2x57","title":"Digest: mol-deacon-patrol","description":"Patrol 4: town healthy, 3 witnesses/refineries running, 8 dogs idle, inbox clean","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T10:43:48.224583134-05:00","updated_at":"2026-01-17T10:43:48.224583134-05:00","closed_at":"2026-01-17T10:43:48.224534926-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-k2x57","depends_on_id":"hq-wisp-qz2t4","type":"parent-child","created_at":"2026-01-17T10:43:48.225901633-05:00","created_by":"deacon"}]}
{"id":"hq-k48","title":"Digest: mol-deacon-patrol","description":"Patrol 2: town idle, witness healthy (active pings)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T23:10:56.457014741-05:00","updated_at":"2026-01-15T23:10:56.457014741-05:00","closed_at":"2026-01-15T23:10:56.428397097-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-kb3l","title":"Digest: mol-deacon-patrol","description":"Patrol complete: inbox empty, town healthy (gastown/helix stopped, niflheim running), cleared 4 stuck dogs (alpha/bravo/charlie/delta had stale working state)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:28:04.245222072-05:00","updated_at":"2026-01-16T22:28:04.245222072-05:00","closed_at":"2026-01-16T22:28:04.245156529-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-kb3l","depends_on_id":"hq-wisp-at2b","type":"parent-child","created_at":"2026-01-16T22:28:04.246153953-05:00","created_by":"deacon"}]}
{"id":"hq-ket3","title":"Digest: mol-deacon-patrol","description":"Patrol 8: quick cycle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:04:55.813281365-05:00","updated_at":"2026-01-16T22:04:55.813281365-05:00","closed_at":"2026-01-16T22:04:55.813225615-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-ket3","depends_on_id":"hq-wisp-llkt","type":"parent-child","created_at":"2026-01-16T22:04:55.814109406-05:00","created_by":"deacon"}]}
{"id":"hq-kgs","title":"Digest: mol-deacon-patrol","description":"Patrol 14: Quick sweep, town idle, witness healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T22:48:46.637773549-05:00","updated_at":"2026-01-15T22:48:46.637773549-05:00","closed_at":"2026-01-15T22:48:46.637712633-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-kmqok","title":"Digest: mol-deacon-patrol","description":"Patrol 12: inbox empty, health check (idle town), added dog golf, 5 stale locks detected (dispatch failed)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:45:02.812533216-05:00","updated_at":"2026-01-16T23:45:02.812533216-05:00","closed_at":"2026-01-16T23:45:02.812484675-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-kmqok","depends_on_id":"hq-wisp-le3g","type":"parent-child","created_at":"2026-01-16T23:45:02.813779078-05:00","created_by":"deacon"}]}
{"id":"hq-knk0","title":"Digest: mol-deacon-patrol","description":"Patrol complete: inbox empty, no gates/convoys, town healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:52:22.431543892-05:00","updated_at":"2026-01-16T01:52:22.431543892-05:00","closed_at":"2026-01-16T01:52:22.431481434-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-knk0","depends_on_id":"hq-wisp-kjyv","type":"parent-child","created_at":"2026-01-16T01:52:22.432358891-05:00","created_by":"deacon"}]}
{"id":"hq-knph","title":"Digest: mol-deacon-patrol","description":"Patrol 4: alpha dog stuck (20min, escalated to Mayor), town idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:28:27.718969991-05:00","updated_at":"2026-01-16T01:28:27.718969991-05:00","closed_at":"2026-01-16T01:28:27.718923366-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-knph","depends_on_id":"hq-wisp-xv6t","type":"parent-child","created_at":"2026-01-16T01:28:27.719648281-05:00","created_by":"deacon"}]}
{"id":"hq-koci","title":"Digest: mol-deacon-patrol","description":"Patrol 9 complete: all healthy, no orphans, cleanup dispatched to bravo","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:18:09.814754641-05:00","updated_at":"2026-01-16T01:18:09.814754641-05:00","closed_at":"2026-01-16T01:18:09.814695266-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-koci","depends_on_id":"hq-wisp-1xg1","type":"parent-child","created_at":"2026-01-16T01:18:09.815669474-05:00","created_by":"deacon"}]}
{"id":"hq-koq","title":"Digest: mol-deacon-patrol","description":"Patrol 3: idle town","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T22:47:40.076119827-05:00","updated_at":"2026-01-15T22:47:40.076119827-05:00","closed_at":"2026-01-15T22:47:40.076073577-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-kor73","title":"Digest: mol-deacon-patrol","description":"Patrol complete: inbox empty, dogs healthy (1 idle/4 working), no orphans, no cleanup executed","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:14:31.584971035-05:00","updated_at":"2026-01-16T23:14:31.584971035-05:00","closed_at":"2026-01-16T23:14:31.58491016-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-kor73","depends_on_id":"hq-wisp-5bv5","type":"parent-child","created_at":"2026-01-16T23:14:31.585957243-05:00","created_by":"deacon"}]}
{"id":"hq-kpas","title":"Digest: mol-deacon-patrol","description":"Patrol #6 complete (batch close)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:44:19.501171645-05:00","updated_at":"2026-01-16T01:44:19.501171645-05:00","closed_at":"2026-01-16T01:44:19.501121228-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-kpas","depends_on_id":"hq-wisp-f5z3","type":"parent-child","created_at":"2026-01-16T01:44:19.501958519-05:00","created_by":"deacon"}]}
{"id":"hq-kza1l","title":"Digest: mol-deacon-patrol","description":"Patrol #9: Quick idle cycle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:01:35.807409566-05:00","updated_at":"2026-01-16T23:01:35.807409566-05:00","closed_at":"2026-01-16T23:01:35.807352024-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-kza1l","depends_on_id":"hq-wisp-cdnb","type":"parent-child","created_at":"2026-01-16T23:01:35.808435398-05:00","created_by":"deacon"}]}
{"id":"hq-l3xii","title":"Digest: mol-deacon-patrol","description":"Patrol 16: healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T10:48:36.36389731-05:00","updated_at":"2026-01-17T10:48:36.36389731-05:00","closed_at":"2026-01-17T10:48:36.363850268-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-l3xii","depends_on_id":"hq-wisp-nr2yc","type":"parent-child","created_at":"2026-01-17T10:48:36.364993393-05:00","created_by":"deacon"}]}
{"id":"hq-l6ow3","title":"Digest: mol-deacon-patrol","description":"Patrol 9: town healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T10:46:43.864672886-05:00","updated_at":"2026-01-17T10:46:43.864672886-05:00","closed_at":"2026-01-17T10:46:43.864616469-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-l6ow3","depends_on_id":"hq-wisp-cxmm5","type":"parent-child","created_at":"2026-01-17T10:46:43.866450135-05:00","created_by":"deacon"}]}
{"id":"hq-l9emj","title":"Digest: mol-deacon-patrol","description":"P13: idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:59:27.027456891-05:00","updated_at":"2026-01-16T23:59:27.027456891-05:00","closed_at":"2026-01-16T23:59:27.027406683-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-l9emj","depends_on_id":"hq-wisp-z4dsy","type":"parent-child","created_at":"2026-01-16T23:59:27.028582265-05:00","created_by":"deacon"}]}
{"id":"hq-laq8","title":"Digest: mol-deacon-patrol","description":"Patrol 15: Quick follow-up cycle. All healthy.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:33:14.95394988-05:00","updated_at":"2026-01-16T22:33:14.95394988-05:00","closed_at":"2026-01-16T22:33:14.941499916-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-laq8","depends_on_id":"hq-wisp-2e8p","type":"parent-child","created_at":"2026-01-16T22:33:14.955055839-05:00","created_by":"deacon"}]}
{"id":"hq-lf726","title":"Digest: mol-deacon-patrol","description":"Patrol 12: idle town, no active work, 5 stale locks detected (formula error blocked cleanup)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:15:24.829172406-05:00","updated_at":"2026-01-16T23:15:24.829172406-05:00","closed_at":"2026-01-16T23:15:24.829121239-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-lf726","depends_on_id":"hq-wisp-746h","type":"parent-child","created_at":"2026-01-16T23:15:24.830115531-05:00","created_by":"deacon"}]}
{"id":"hq-lpwes","title":"Digest: mol-deacon-patrol","description":"Patrol 9: Idle town, rapid cycle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:44:01.763976241-05:00","updated_at":"2026-01-16T23:44:01.763976241-05:00","closed_at":"2026-01-16T23:44:01.714376831-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-lpwes","depends_on_id":"hq-wisp-wuybk","type":"parent-child","created_at":"2026-01-16T23:44:01.765105783-05:00","created_by":"deacon"}]}
{"id":"hq-lxzg3","title":"Digest: mol-deacon-patrol","description":"Quick patrol: idle town, no incidents","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:17:15.096527709-05:00","updated_at":"2026-01-16T23:17:15.096527709-05:00","closed_at":"2026-01-16T23:17:15.096475542-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-lxzg3","depends_on_id":"hq-wisp-97mw","type":"parent-child","created_at":"2026-01-16T23:17:15.09739675-05:00","created_by":"deacon"}]}
{"id":"hq-m3o","title":"Digest: mol-deacon-patrol","description":"Patrol 4: town idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T23:14:10.18164744-05:00","updated_at":"2026-01-15T23:14:10.18164744-05:00","closed_at":"2026-01-15T23:14:10.181594024-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-m8o5r","title":"Digest: mol-deacon-patrol","description":"Fast patrol cycle 7 - town idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:35:01.853976016-05:00","updated_at":"2026-01-17T00:35:01.853976016-05:00","closed_at":"2026-01-17T00:35:01.853926849-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-m8o5r","depends_on_id":"hq-wisp-tqjts","type":"parent-child","created_at":"2026-01-17T00:35:01.855338139-05:00","created_by":"deacon"}]}
{"id":"hq-m8wc","title":"Digest: mol-deacon-patrol","description":"Patrol 11: all healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:25:23.473351915-05:00","updated_at":"2026-01-16T22:25:23.473351915-05:00","closed_at":"2026-01-16T22:25:23.473296956-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-m8wc","depends_on_id":"hq-wisp-3pwr","type":"parent-child","created_at":"2026-01-16T22:25:23.474227258-05:00","created_by":"deacon"}]}
{"id":"hq-majg","title":"Digest: mol-deacon-patrol","description":"Patrol 19: Town idle, healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:42:58.289964409-05:00","updated_at":"2026-01-16T00:42:58.289964409-05:00","closed_at":"2026-01-16T00:42:58.289908868-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-majg","depends_on_id":"hq-wisp-qfo","type":"parent-child","created_at":"2026-01-16T00:42:58.290717033-05:00","created_by":"deacon"}]}
{"id":"hq-mbe5","title":"Digest: mol-deacon-patrol","description":"Patrol: all quiet","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:15:10.1898361-05:00","updated_at":"2026-01-16T22:15:10.1898361-05:00","closed_at":"2026-01-16T22:15:10.189774809-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-mbe5","depends_on_id":"hq-wisp-5ers","type":"parent-child","created_at":"2026-01-16T22:15:10.190735057-05:00","created_by":"deacon"}]}
{"id":"hq-mhjd","title":"Digest: mol-deacon-patrol","description":"P11","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:24:53.95975956-05:00","updated_at":"2026-01-16T00:24:53.95975956-05:00","closed_at":"2026-01-16T00:24:53.959710393-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-mirw","title":"Digest: mol-deacon-patrol","description":"Patrol 14: Town idle, healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:42:53.125524831-05:00","updated_at":"2026-01-16T00:42:53.125524831-05:00","closed_at":"2026-01-16T00:42:53.125460373-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-mirw","depends_on_id":"hq-wisp-458","type":"parent-child","created_at":"2026-01-16T00:42:53.12831787-05:00","created_by":"deacon"}]}
{"id":"hq-mrsn0","title":"Digest: mol-deacon-patrol","description":"P14: idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:00:16.100580628-05:00","updated_at":"2026-01-17T00:00:16.100580628-05:00","closed_at":"2026-01-17T00:00:16.100531253-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-mrsn0","depends_on_id":"hq-wisp-10bze","type":"parent-child","created_at":"2026-01-17T00:00:16.10166471-05:00","created_by":"deacon"}]}
{"id":"hq-mu861","title":"Digest: mol-deacon-patrol","description":"Patrol 19: healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T10:49:19.39781563-05:00","updated_at":"2026-01-17T10:49:19.39781563-05:00","closed_at":"2026-01-17T10:49:19.386675554-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-mu861","depends_on_id":"hq-wisp-gepi2","type":"parent-child","created_at":"2026-01-17T10:49:19.398961796-05:00","created_by":"deacon"}]}
{"id":"hq-n4v7a","title":"Digest: mol-deacon-patrol","description":"Patrol 14: Idle, batch","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:48:57.083381914-05:00","updated_at":"2026-01-16T23:48:57.083381914-05:00","closed_at":"2026-01-16T23:48:57.003519512-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-n4v7a","depends_on_id":"hq-wisp-u85et","type":"parent-child","created_at":"2026-01-16T23:48:57.084634328-05:00","created_by":"deacon"}]}
{"id":"hq-n6k8","title":"Digest: mol-deacon-patrol","description":"Patrol complete: inbox empty, town idle, 1 zombie detected (mal) - Mayor notified, dog pool maintained (1 idle), cleanup needed (5 stale locks)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:26:16.523863075-05:00","updated_at":"2026-01-16T00:26:16.523863075-05:00","closed_at":"2026-01-16T00:26:16.523813992-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-n6p","title":"Digest: mol-deacon-patrol","description":"Patrol 2 complete: idle town, all agents healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T23:35:50.833941954-05:00","updated_at":"2026-01-15T23:35:50.833941954-05:00","closed_at":"2026-01-15T23:35:50.833870829-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-nbj","title":"Digest: mol-deacon-patrol","description":"Patrol 6 complete: idle town, handing off due to await-signal issue","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T23:41:38.931138766-05:00","updated_at":"2026-01-15T23:41:38.931138766-05:00","closed_at":"2026-01-15T23:41:38.9310811-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-nbj","depends_on_id":"hq-wisp-clt","type":"parent-child","created_at":"2026-01-15T23:41:38.931924224-05:00","created_by":"deacon"}]}
{"id":"hq-njp8","title":"Digest: mol-deacon-patrol","description":"Patrol 13 complete: all healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:27:03.131323242-05:00","updated_at":"2026-01-16T01:27:03.131323242-05:00","closed_at":"2026-01-16T01:27:03.13127295-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-njp8","depends_on_id":"hq-wisp-py5p","type":"parent-child","created_at":"2026-01-16T01:27:03.132084574-05:00","created_by":"deacon"}]}
{"id":"hq-nkgc5","title":"Digest: mol-deacon-patrol","description":"Patrol 3: Quick check after signal, town idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:35:32.436835919-05:00","updated_at":"2026-01-16T23:35:32.436835919-05:00","closed_at":"2026-01-16T23:35:32.412022089-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-nkgc5","depends_on_id":"hq-wisp-rsxz","type":"parent-child","created_at":"2026-01-16T23:35:32.437864336-05:00","created_by":"deacon"}]}
{"id":"hq-nozzh","title":"Digest: mol-deacon-patrol","description":"Rapid patrol 16: idle town","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:22:11.642359655-05:00","updated_at":"2026-01-16T23:22:11.642359655-05:00","closed_at":"2026-01-16T23:22:11.642306655-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-nozzh","depends_on_id":"hq-wisp-5sng","type":"parent-child","created_at":"2026-01-16T23:22:11.643420738-05:00","created_by":"deacon"}]}
{"id":"hq-nuh","title":"Digest: mol-deacon-patrol","description":"Patrol cycle 5: town idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T17:16:43.538373242-05:00","updated_at":"2026-01-15T17:16:43.538373242-05:00","closed_at":"2026-01-15T17:16:43.538318575-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-nv6l","title":"Digest: mol-deacon-patrol","description":"Patrol complete: town idle, no active work, witness/refinery stopped, dispatched session-gc to dog bravo for cleanup","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:44:11.37365926-05:00","updated_at":"2026-01-16T22:44:11.37365926-05:00","closed_at":"2026-01-16T22:44:11.373600218-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-ocldw","title":"Digest: mol-deacon-patrol","description":"Patrol 5: town healthy and idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T10:44:36.866414451-05:00","updated_at":"2026-01-17T10:44:36.866414451-05:00","closed_at":"2026-01-17T10:44:36.86636241-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-ocldw","depends_on_id":"hq-wisp-p803c","type":"parent-child","created_at":"2026-01-17T10:44:36.867739029-05:00","created_by":"deacon"}]}
{"id":"hq-od2j","title":"Digest: mol-deacon-patrol","description":"Patrol #1: No callbacks, all witnesses/refinery healthy, added dog bravo, noted cleanup needs (5 stale locks)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:52:22.363100037-05:00","updated_at":"2026-01-16T00:52:22.363100037-05:00","closed_at":"2026-01-16T00:52:22.36304462-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-od2j","depends_on_id":"hq-wisp-bxj","type":"parent-child","created_at":"2026-01-16T00:52:22.36386162-05:00","created_by":"deacon"}]}
{"id":"hq-oocwd","title":"Digest: mol-deacon-patrol","description":"Patrol 5: town idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:03:45.043857624-05:00","updated_at":"2026-01-16T23:03:45.043857624-05:00","closed_at":"2026-01-16T23:03:45.043791249-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-oocwd","depends_on_id":"hq-wisp-v4ri","type":"parent-child","created_at":"2026-01-16T23:03:45.045073379-05:00","created_by":"deacon"}]}
{"id":"hq-opjl","title":"Digest: mol-deacon-patrol","description":"Patrol 7: 12 sessions healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:22:43.149336868-05:00","updated_at":"2026-01-16T22:22:43.149336868-05:00","closed_at":"2026-01-16T22:22:43.149281909-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-opjl","depends_on_id":"hq-wisp-qg7t","type":"parent-child","created_at":"2026-01-16T22:22:43.150383033-05:00","created_by":"deacon"}]}
{"id":"hq-osrff","title":"Digest: mol-deacon-patrol","description":"Rapid patrol 19: idle town","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:25:24.079152729-05:00","updated_at":"2026-01-16T23:25:24.079152729-05:00","closed_at":"2026-01-16T23:25:24.079101979-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-osrff","depends_on_id":"hq-wisp-4xy3","type":"parent-child","created_at":"2026-01-16T23:25:24.080257145-05:00","created_by":"deacon"}]}
{"id":"hq-oxip","title":"Digest: mol-deacon-patrol","description":"Patrol cycle 2: Town idle, agents healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:46:52.519721146-05:00","updated_at":"2026-01-16T21:46:52.519721146-05:00","closed_at":"2026-01-16T21:46:52.519652854-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-oxip","depends_on_id":"hq-wisp-tjlf","type":"parent-child","created_at":"2026-01-16T21:46:52.52042527-05:00","created_by":"deacon"}]}
{"id":"hq-p15x1","title":"Digest: mol-deacon-patrol","description":"Patrol 11: Idle, batch","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:46:06.279294973-05:00","updated_at":"2026-01-16T23:46:06.279294973-05:00","closed_at":"2026-01-16T23:46:06.232468312-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-p15x1","depends_on_id":"hq-wisp-uzura","type":"parent-child","created_at":"2026-01-16T23:46:06.280403514-05:00","created_by":"deacon"}]}
{"id":"hq-p7l","title":"Digest: mol-deacon-patrol","description":"Patrol 18: idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T23:21:29.819011091-05:00","updated_at":"2026-01-15T23:21:29.819011091-05:00","closed_at":"2026-01-15T23:21:29.8189558-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-pf6xv","title":"Digest: mol-deacon-patrol","description":"Patrol 3: witnesses starting, dogs idle, cleanup needs detected (sling failed), inbox clean","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T10:40:38.784895398-05:00","updated_at":"2026-01-17T10:40:38.784895398-05:00","closed_at":"2026-01-17T10:40:38.784844315-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-pf6xv","depends_on_id":"hq-wisp-2oxf0","type":"parent-child","created_at":"2026-01-17T10:40:38.786152898-05:00","created_by":"deacon"}]}
{"id":"hq-pi8","title":"Digest: mol-deacon-patrol","description":"Patrol cycle 4: town idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T17:15:13.482951107-05:00","updated_at":"2026-01-15T17:15:13.482951107-05:00","closed_at":"2026-01-15T17:15:13.482899899-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-prdq","title":"Digest: mol-deacon-patrol","description":"Patrol complete: idle town, no callbacks, witness healthy, 5 stale locks found (formula bug prevented dispatch), dog pool healthy (1 idle)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T02:04:49.454653726-05:00","updated_at":"2026-01-16T02:04:49.454653726-05:00","closed_at":"2026-01-16T02:04:49.454603059-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-prdq","depends_on_id":"hq-wisp-wmln","type":"parent-child","created_at":"2026-01-16T02:04:49.455528396-05:00","created_by":"deacon"}]}
{"id":"hq-q025","title":"Digest: mol-deacon-patrol","description":"Patrol 12: All agents healthy. gastown refinery stopped (OK, idle). Potential orphan: crew-mal. Noted abnormal WITNESS_PING frequency.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:40:55.788326148-05:00","updated_at":"2026-01-16T00:40:55.788326148-05:00","closed_at":"2026-01-16T00:40:55.788268315-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-q3kkp","title":"Digest: mol-deacon-patrol","description":"Patrol 20: Final before handoff","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:06:43.125337938-05:00","updated_at":"2026-01-17T00:06:43.125337938-05:00","closed_at":"2026-01-17T00:06:43.117403865-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-q3kkp","depends_on_id":"hq-wisp-jgonz","type":"parent-child","created_at":"2026-01-17T00:06:43.126643728-05:00","created_by":"deacon"}]}
{"id":"hq-q7sq","title":"Digest: mol-deacon-patrol","description":"Patrol complete: inbox clear, gastown witness running, no zombies, 3 dogs idle, stale locks detected (formula error blocked cleanup)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:38:26.717161448-05:00","updated_at":"2026-01-16T01:38:26.717161448-05:00","closed_at":"2026-01-16T01:38:26.717107948-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-q7sq","depends_on_id":"hq-wisp-9rhf","type":"parent-child","created_at":"2026-01-16T01:38:26.717959572-05:00","created_by":"deacon"}]}
{"id":"hq-qnst","title":"Digest: mol-deacon-patrol","description":"Patrol complete: checked inbox (0), health OK (witness running, refinery stopped), no orphans, no plugins, town idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:46:42.94032828-05:00","updated_at":"2026-01-16T01:46:42.94032828-05:00","closed_at":"2026-01-16T01:46:42.940266947-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-qnst","depends_on_id":"hq-wisp-gy6a","type":"parent-child","created_at":"2026-01-16T01:46:42.941172029-05:00","created_by":"deacon"}]}
{"id":"hq-r6d","title":"Digest: mol-deacon-patrol","description":"Patrol complete: inbox empty, witness healthy (active pings), no convoys/gates/polecats, town idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T23:09:48.608880292-05:00","updated_at":"2026-01-15T23:09:48.608880292-05:00","closed_at":"2026-01-15T23:09:48.608824375-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-rfm3","title":"Digest: mol-deacon-patrol","description":"Patrol 5: OK","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:42:15.475107658-05:00","updated_at":"2026-01-16T01:42:15.475107658-05:00","closed_at":"2026-01-16T01:42:15.47505395-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-rn4","title":"Digest: mol-deacon-patrol","description":"Patrol 10: idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T23:18:10.484657576-05:00","updated_at":"2026-01-15T23:18:10.484657576-05:00","closed_at":"2026-01-15T23:18:10.484608659-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-s31m","title":"Digest: mol-deacon-patrol","description":"Patrol #4 complete: town idle, all healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:42:38.107247517-05:00","updated_at":"2026-01-16T01:42:38.107247517-05:00","closed_at":"2026-01-16T01:42:38.1071956-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-s31m","depends_on_id":"hq-wisp-zfst","type":"parent-child","created_at":"2026-01-16T01:42:38.107998391-05:00","created_by":"deacon"}]}
{"id":"hq-s3ro","title":"Digest: mol-deacon-patrol","description":"Patrol #3: All healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:58:21.652825591-05:00","updated_at":"2026-01-16T00:58:21.652825591-05:00","closed_at":"2026-01-16T00:58:21.652723841-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-s3ro","depends_on_id":"hq-wisp-dua","type":"parent-child","created_at":"2026-01-16T00:58:21.653630382-05:00","created_by":"deacon"}]}
{"id":"hq-sb6fk","title":"Digest: mol-deacon-patrol","description":"Patrol 12: healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T10:47:35.040396192-05:00","updated_at":"2026-01-17T10:47:35.040396192-05:00","closed_at":"2026-01-17T10:47:35.040341817-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-sb6fk","depends_on_id":"hq-wisp-5ve4l","type":"parent-child","created_at":"2026-01-17T10:47:35.041789774-05:00","created_by":"deacon"}]}
{"id":"hq-sh64","title":"Digest: mol-deacon-patrol","description":"Patrol complete: town idle, all healthy, no callbacks","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:52:40.953649974-05:00","updated_at":"2026-01-16T01:52:40.953649974-05:00","closed_at":"2026-01-16T01:52:40.953600932-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-sh64","depends_on_id":"hq-wisp-km6p","type":"parent-child","created_at":"2026-01-16T01:52:40.95438439-05:00","created_by":"deacon"}]}
{"id":"hq-spg4","title":"Digest: mol-deacon-patrol","description":"Patrol complete: all steps done, inbox empty, no issues","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:55:07.292313357-05:00","updated_at":"2026-01-16T01:55:07.292313357-05:00","closed_at":"2026-01-16T01:55:07.292245565-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-spg4","depends_on_id":"hq-wisp-ycvp","type":"parent-child","created_at":"2026-01-16T01:55:07.293186189-05:00","created_by":"deacon"}]}
{"id":"hq-tecp2","title":"Digest: mol-deacon-patrol","description":"Patrol 19: nominal","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:56:06.327984719-05:00","updated_at":"2026-01-17T00:56:06.327984719-05:00","closed_at":"2026-01-17T00:56:06.263228543-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-thd4","title":"Digest: mol-deacon-patrol","description":"Patrol complete: all agents healthy (mayor, witness, refinery, 8 polecats), no pending spawns, inbox clear","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:13:57.329538475-05:00","updated_at":"2026-01-16T22:13:57.329538475-05:00","closed_at":"2026-01-16T22:13:57.329481642-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-thd4","depends_on_id":"hq-wisp-93xu","type":"parent-child","created_at":"2026-01-16T22:13:57.330346558-05:00","created_by":"deacon"}]}
{"id":"hq-tuec","title":"Digest: mol-deacon-patrol","description":"Patrol 18 complete: all healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:29:38.9606099-05:00","updated_at":"2026-01-16T01:29:38.9606099-05:00","closed_at":"2026-01-16T01:29:38.960551566-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-tuec","depends_on_id":"hq-wisp-198k","type":"parent-child","created_at":"2026-01-16T01:29:38.961387357-05:00","created_by":"deacon"}]}
{"id":"hq-tzsr","title":"Digest: mol-deacon-patrol","description":"Patrol 14","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:09:06.276094676-05:00","updated_at":"2026-01-16T22:09:06.276094676-05:00","closed_at":"2026-01-16T22:09:06.276040343-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-tzsr","depends_on_id":"hq-wisp-p1tv","type":"parent-child","created_at":"2026-01-16T22:09:06.277041383-05:00","created_by":"deacon"}]}
{"id":"hq-u0kwx","title":"Digest: mol-deacon-patrol","description":"Patrol #8: Quick idle cycle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:00:27.857627043-05:00","updated_at":"2026-01-16T23:00:27.857627043-05:00","closed_at":"2026-01-16T23:00:27.85757896-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-u0kwx","depends_on_id":"hq-wisp-3evq","type":"parent-child","created_at":"2026-01-16T23:00:27.858478043-05:00","created_by":"deacon"}]}
{"id":"hq-u4duc","title":"Digest: mol-deacon-patrol","description":"Patrol 9: Idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:44:27.919089292-05:00","updated_at":"2026-01-16T23:44:27.919089292-05:00","closed_at":"2026-01-16T23:44:27.909974971-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-u4duc","depends_on_id":"hq-wisp-s90va","type":"parent-child","created_at":"2026-01-16T23:44:27.920170239-05:00","created_by":"deacon"}]}
{"id":"hq-u6zgm","title":"Digest: mol-deacon-patrol","description":"Rapid patrol 17: idle town","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:23:23.039629639-05:00","updated_at":"2026-01-16T23:23:23.039629639-05:00","closed_at":"2026-01-16T23:23:23.039578055-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-u6zgm","depends_on_id":"hq-wisp-yf11","type":"parent-child","created_at":"2026-01-16T23:23:23.040611764-05:00","created_by":"deacon"}]}
{"id":"hq-ueg7","title":"Digest: mol-deacon-patrol","description":"Patrol complete: inbox empty, town idle, witness healthy, dispatched session-gc to charlie for stale locks","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:18:37.409876175-05:00","updated_at":"2026-01-16T01:18:37.409876175-05:00","closed_at":"2026-01-16T01:18:37.409826675-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-ueg7","depends_on_id":"hq-wisp-wbik","type":"parent-child","created_at":"2026-01-16T01:18:37.4105673-05:00","created_by":"deacon"}]}
{"id":"hq-ufzzx","title":"Digest: mol-deacon-patrol","description":"Patrol complete: inbox check, health verified (niflheim running, gastown idle), session GC dispatched, no incidents","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:33:16.625801818-05:00","updated_at":"2026-01-16T23:33:16.625801818-05:00","closed_at":"2026-01-16T23:33:16.625753068-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-ufzzx","depends_on_id":"hq-wisp-wot3","type":"parent-child","created_at":"2026-01-16T23:33:16.626810485-05:00","created_by":"deacon"}]}
{"id":"hq-usbjt","title":"Digest: mol-deacon-patrol","description":"Patrol 11: town idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:55:12.998625426-05:00","updated_at":"2026-01-16T23:55:12.998625426-05:00","closed_at":"2026-01-16T23:55:12.998575717-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-usbjt","depends_on_id":"hq-wisp-dq2ax","type":"parent-child","created_at":"2026-01-16T23:55:12.999844841-05:00","created_by":"deacon"}]}
{"id":"hq-v0bo4","title":"Digest: mol-deacon-patrol","description":"Patrol 7: Idle town","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:36:24.932631527-05:00","updated_at":"2026-01-17T00:36:24.932631527-05:00","closed_at":"2026-01-17T00:36:24.325362045-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-v0bo4","depends_on_id":"hq-wisp-cir04","type":"parent-child","created_at":"2026-01-17T00:36:24.934256441-05:00","created_by":"deacon"}]}
{"id":"hq-v3rit","title":"Digest: mol-deacon-patrol","description":"Patrol 5: Idle town, all clear","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:37:45.856646226-05:00","updated_at":"2026-01-16T23:37:45.856646226-05:00","closed_at":"2026-01-16T23:37:45.85327506-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-v3rit","depends_on_id":"hq-wisp-0o3o","type":"parent-child","created_at":"2026-01-16T23:37:45.857725434-05:00","created_by":"deacon"}]}
{"id":"hq-vioh","title":"Digest: mol-deacon-patrol","description":"P19","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:25:24.97515613-05:00","updated_at":"2026-01-16T00:25:24.97515613-05:00","closed_at":"2026-01-16T00:25:24.975105381-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-vjaxo","title":"Digest: mol-deacon-patrol","description":"Patrol 10 complete: idle town, all healthy, handoff threshold reached","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:53:56.239627877-05:00","updated_at":"2026-01-16T23:53:56.239627877-05:00","closed_at":"2026-01-16T23:53:56.122648967-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-vjaxo","depends_on_id":"hq-wisp-n9aoj","type":"parent-child","created_at":"2026-01-16T23:53:56.240994793-05:00","created_by":"deacon"}]}
{"id":"hq-vkx0n","title":"Digest: mol-deacon-patrol","description":"Patrol #12: idle town, all healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:17:40.221993976-05:00","updated_at":"2026-01-16T23:17:40.221993976-05:00","closed_at":"2026-01-16T23:17:40.221940851-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-vkx0n","depends_on_id":"hq-wisp-qqhr","type":"parent-child","created_at":"2026-01-16T23:17:40.222885809-05:00","created_by":"deacon"}]}
{"id":"hq-vpep","title":"Digest: mol-deacon-patrol","description":"P9","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:24:39.890727279-05:00","updated_at":"2026-01-16T00:24:39.890727279-05:00","closed_at":"2026-01-16T00:24:39.890660821-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-vxfhf","title":"Digest: mol-deacon-patrol","description":"Patrol 7: Town idle, all clear. Rapid cycle.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:41:02.470915067-05:00","updated_at":"2026-01-16T23:41:02.470915067-05:00","closed_at":"2026-01-16T23:41:02.439308155-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-vxfhf","depends_on_id":"hq-wisp-pbcd8","type":"parent-child","created_at":"2026-01-16T23:41:02.472362984-05:00","created_by":"deacon"}]}
{"id":"hq-w1en","title":"Digest: mol-deacon-patrol","description":"Patrol 10 complete: all healthy, 3 dogs working, no idle reserve","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:22:03.818273235-05:00","updated_at":"2026-01-16T01:22:03.818273235-05:00","closed_at":"2026-01-16T01:22:03.818225318-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-w1en","depends_on_id":"hq-wisp-cvy9","type":"parent-child","created_at":"2026-01-16T01:22:03.818934651-05:00","created_by":"deacon"}]}
{"id":"hq-w5di","title":"Digest: mol-deacon-patrol","description":"Patrol 1: All agents healthy, inbox empty, no issues","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:38:30.277675857-05:00","updated_at":"2026-01-16T01:38:30.277675857-05:00","closed_at":"2026-01-16T01:38:30.277623732-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-w5di","depends_on_id":"hq-wisp-4ajk","type":"parent-child","created_at":"2026-01-16T01:38:30.278464773-05:00","created_by":"deacon"}]}
{"id":"hq-w66oj","title":"Digest: mol-deacon-patrol","description":"Patrol complete: inbox empty, town idle (witness/refinery stopped), no zombies, no gates, 5 dogs in inconsistent working state (noted), 5 stale locks detected, daemon not running","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:29:25.569344516-05:00","updated_at":"2026-01-16T23:29:25.569344516-05:00","closed_at":"2026-01-16T23:29:25.569293432-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-w66oj","depends_on_id":"hq-wisp-uyot","type":"parent-child","created_at":"2026-01-16T23:29:25.570323307-05:00","created_by":"deacon"}]}
{"id":"hq-w6g","title":"Digest: mol-deacon-patrol","description":"Patrol 7: idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T23:16:19.547009658-05:00","updated_at":"2026-01-15T23:16:19.547009658-05:00","closed_at":"2026-01-15T23:16:19.546955867-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-wcy","title":"Digest: mol-deacon-patrol","description":"Patrol 1 complete: idle town, witness healthy, no polecats, no work","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T23:30:57.138466544-05:00","updated_at":"2026-01-15T23:30:57.138466544-05:00","closed_at":"2026-01-15T23:30:57.138403669-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-wisp-00pe","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:53:28.898911309-05:00","updated_at":"2026-01-16T01:54:17.606000156-05:00","closed_at":"2026-01-16T01:54:17.606000156-05:00","close_reason":"Orphan cleanup","dependencies":[{"issue_id":"hq-wisp-00pe","depends_on_id":"hq-wisp-eke2","type":"parent-child","created_at":"2026-01-16T01:53:28.911944836-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-00pe","depends_on_id":"hq-wisp-myg7","type":"blocks","created_at":"2026-01-16T01:53:28.950495919-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-02fs","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:15:44.214150963-05:00","updated_at":"2026-01-17T00:36:00.804961282-05:00","closed_at":"2026-01-17T00:36:00.804961282-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-02syo","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:49:35.721347172-05:00","updated_at":"2026-01-16T23:50:19.962020742-05:00","closed_at":"2026-01-16T23:50:19.962020742-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-02syo","depends_on_id":"hq-wisp-n4f70","type":"parent-child","created_at":"2026-01-16T23:49:36.678179033-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-02syo","depends_on_id":"hq-wisp-ipcwc","type":"blocks","created_at":"2026-01-16T23:49:39.116777807-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-02syo","depends_on_id":"hq-wisp-alrkg","type":"blocks","created_at":"2026-01-16T23:49:39.253023705-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-02syo","depends_on_id":"hq-wisp-krhtf","type":"blocks","created_at":"2026-01-16T23:49:39.389658852-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-02z3k","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:23:02.703417432-05:00","updated_at":"2026-01-17T00:24:10.374219271-05:00","closed_at":"2026-01-17T00:24:10.374219271-05:00","close_reason":"No activity","dependencies":[{"issue_id":"hq-wisp-02z3k","depends_on_id":"hq-wisp-93kdl","type":"parent-child","created_at":"2026-01-17T00:23:03.85328347-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-02z3k","depends_on_id":"hq-wisp-wn1y8","type":"blocks","created_at":"2026-01-17T00:23:07.328969645-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-03xfw","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:50:02.641464224-05:00","updated_at":"2026-01-17T00:35:30.693223038-05:00","closed_at":"2026-01-17T00:35:30.693223038-05:00","close_reason":"Cleanup","ephemeral":true}
{"id":"hq-wisp-04nb","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T22:14:17.867901035-05:00","updated_at":"2026-01-17T00:36:35.215722661-05:00","closed_at":"2026-01-17T00:36:35.215722661-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-065k4","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:03:11.644340824-05:00","updated_at":"2026-01-17T01:04:31.123776757-05:00","closed_at":"2026-01-17T01:04:31.123776757-05:00","close_reason":"Costs not tracked","dependencies":[{"issue_id":"hq-wisp-065k4","depends_on_id":"hq-wisp-zx2sm","type":"parent-child","created_at":"2026-01-17T01:03:20.016503138-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-065k4","depends_on_id":"hq-wisp-67o60","type":"blocks","created_at":"2026-01-17T01:03:32.183305672-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-06fk","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:05:01.105364547-05:00","updated_at":"2026-01-16T22:13:01.967987594-05:00","closed_at":"2026-01-16T22:13:01.967987594-05:00","close_reason":"Orphaned - forced cleanup","dependencies":[{"issue_id":"hq-wisp-06fk","depends_on_id":"hq-wisp-xrtb","type":"parent-child","created_at":"2026-01-16T22:05:01.240024543-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-06fk","depends_on_id":"hq-wisp-74dz","type":"blocks","created_at":"2026-01-16T22:05:01.412580284-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-079ed","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:50:53.893716268-05:00","updated_at":"2026-01-16T23:51:35.366124386-05:00","closed_at":"2026-01-16T23:51:35.366124386-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-079ed","depends_on_id":"hq-wisp-47par","type":"parent-child","created_at":"2026-01-16T23:50:54.329502388-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-079ed","depends_on_id":"hq-wisp-t9ys3","type":"blocks","created_at":"2026-01-16T23:50:56.880132368-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-07lk","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:56:35.922825684-05:00","updated_at":"2026-01-16T22:13:02.174168584-05:00","closed_at":"2026-01-16T22:13:02.174168584-05:00","close_reason":"Orphaned - forced cleanup","dependencies":[{"issue_id":"hq-wisp-07lk","depends_on_id":"hq-wisp-8d7d","type":"parent-child","created_at":"2026-01-16T01:56:35.955710564-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-07lk","depends_on_id":"hq-wisp-vj08","type":"blocks","created_at":"2026-01-16T01:56:36.009779339-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-07xzd","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:45:48.845750304-05:00","updated_at":"2026-01-16T23:47:20.891179846-05:00","closed_at":"2026-01-16T23:47:20.891179846-05:00","close_reason":"Patrol complete, looping","dependencies":[{"issue_id":"hq-wisp-07xzd","depends_on_id":"hq-wisp-2heyl","type":"parent-child","created_at":"2026-01-16T23:45:51.126017831-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-07xzd","depends_on_id":"hq-wisp-s0h4f","type":"blocks","created_at":"2026-01-16T23:45:53.693405266-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-08auo","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:56:40.331686461-05:00","updated_at":"2026-01-17T00:57:43.735194797-05:00","closed_at":"2026-01-17T00:57:43.735194797-05:00","close_reason":"No gate-ready molecules","dependencies":[{"issue_id":"hq-wisp-08auo","depends_on_id":"hq-wisp-an994","type":"parent-child","created_at":"2026-01-17T00:56:41.981639464-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-08auo","depends_on_id":"hq-wisp-tp9wz","type":"blocks","created_at":"2026-01-17T00:56:52.161270127-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-094qa","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:23:02.700095982-05:00","updated_at":"2026-01-17T00:23:38.765573545-05:00","closed_at":"2026-01-17T00:23:38.765573545-05:00","close_reason":"No pending polecats","dependencies":[{"issue_id":"hq-wisp-094qa","depends_on_id":"hq-wisp-93kdl","type":"parent-child","created_at":"2026-01-17T00:23:02.898339909-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-094qa","depends_on_id":"hq-wisp-1rj6c","type":"blocks","created_at":"2026-01-17T00:23:06.356306045-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-09rz","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:22:20.088636283-05:00","updated_at":"2026-01-16T01:52:14.041134362-05:00","closed_at":"2026-01-16T01:52:14.041134362-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-09rz","depends_on_id":"hq-wisp-gvqg","type":"parent-child","created_at":"2026-01-16T01:22:20.165847078-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-09w6","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T01:40:31.0898644-05:00","updated_at":"2026-01-16T01:50:39.024817308-05:00","closed_at":"2026-01-16T01:50:39.024817308-05:00","close_reason":"Stale patrol wisp cleanup","ephemeral":true}
{"id":"hq-wisp-0a1jl","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:44:43.636680245-05:00","updated_at":"2026-01-16T23:45:33.265527829-05:00","closed_at":"2026-01-16T23:45:33.265527829-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-0a1jl","depends_on_id":"hq-wisp-bhwu0","type":"parent-child","created_at":"2026-01-16T23:44:43.988437143-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-0a1jl","depends_on_id":"hq-wisp-d5fbk","type":"blocks","created_at":"2026-01-16T23:44:45.934123883-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-0a64y","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:02:45.700414589-05:00","updated_at":"2026-01-17T01:05:24.876010885-05:00","closed_at":"2026-01-17T01:05:24.876010885-05:00","close_reason":"Idle town patrol","dependencies":[{"issue_id":"hq-wisp-0a64y","depends_on_id":"hq-wisp-ji9jj","type":"parent-child","created_at":"2026-01-17T01:02:53.890300622-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-0a64y","depends_on_id":"hq-wisp-5ko7g","type":"blocks","created_at":"2026-01-17T01:03:05.707998314-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-0d55r","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:02:45.690925937-05:00","updated_at":"2026-01-17T01:05:30.90362928-05:00","closed_at":"2026-01-17T01:05:30.90362928-05:00","close_reason":"Idle town patrol","dependencies":[{"issue_id":"hq-wisp-0d55r","depends_on_id":"hq-wisp-ji9jj","type":"parent-child","created_at":"2026-01-17T01:02:47.457539069-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-0d55r","depends_on_id":"hq-wisp-cbidy","type":"blocks","created_at":"2026-01-17T01:02:58.003348611-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-0dhuj","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:02:22.556862692-05:00","updated_at":"2026-01-17T01:04:18.186090918-05:00","closed_at":"2026-01-17T01:04:18.186090918-05:00","close_reason":"No stuck dogs","dependencies":[{"issue_id":"hq-wisp-0dhuj","depends_on_id":"hq-wisp-xwv1q","type":"parent-child","created_at":"2026-01-17T01:02:28.981675924-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-0dhuj","depends_on_id":"hq-wisp-plkuf","type":"blocks","created_at":"2026-01-17T01:02:40.508308151-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-0e32","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:53:28.903530179-05:00","updated_at":"2026-01-16T01:54:17.59135813-05:00","closed_at":"2026-01-16T01:54:17.59135813-05:00","close_reason":"Orphan cleanup","dependencies":[{"issue_id":"hq-wisp-0e32","depends_on_id":"hq-wisp-eke2","type":"parent-child","created_at":"2026-01-16T01:53:28.923552032-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-0e32","depends_on_id":"hq-wisp-oagy","type":"blocks","created_at":"2026-01-16T01:53:28.962386531-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-0e32","depends_on_id":"hq-wisp-m0zz","type":"blocks","created_at":"2026-01-16T01:53:28.965286403-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-0e32","depends_on_id":"hq-wisp-2m1c","type":"blocks","created_at":"2026-01-16T01:53:28.967960025-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-0e8pe","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:49:57.520275616-05:00","updated_at":"2026-01-17T10:49:57.520275658-05:00","dependencies":[{"issue_id":"hq-wisp-0e8pe","depends_on_id":"hq-wisp-8agmn","type":"parent-child","created_at":"2026-01-17T10:49:57.75892006-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-0e8pe","depends_on_id":"hq-wisp-b7xpn","type":"blocks","created_at":"2026-01-17T10:49:58.45361232-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-0egyx","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:47:53.49970927-05:00","updated_at":"2026-01-16T23:48:35.22697136-05:00","closed_at":"2026-01-16T23:48:35.22697136-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-0egyx","depends_on_id":"hq-wisp-wj52z","type":"parent-child","created_at":"2026-01-16T23:47:54.176559171-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-0egyx","depends_on_id":"hq-wisp-3de3b","type":"blocks","created_at":"2026-01-16T23:47:56.585901226-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-0eum4","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:41:51.254021269-05:00","updated_at":"2026-01-16T23:42:47.616158491-05:00","closed_at":"2026-01-16T23:42:47.616158491-05:00","close_reason":"Routine checks passed","dependencies":[{"issue_id":"hq-wisp-0eum4","depends_on_id":"hq-wisp-tnkch","type":"parent-child","created_at":"2026-01-16T23:41:52.718032163-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-0eum4","depends_on_id":"hq-wisp-mniri","type":"blocks","created_at":"2026-01-16T23:41:54.841387847-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-0fch","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T01:25:31.937466922-05:00","updated_at":"2026-01-16T01:52:14.019902093-05:00","closed_at":"2026-01-16T01:52:14.019902093-05:00","close_reason":"Orphaned wisp cleanup","ephemeral":true}
{"id":"hq-wisp-0ihj","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:53:28.901453056-05:00","updated_at":"2026-01-16T01:54:17.597357749-05:00","closed_at":"2026-01-16T01:54:17.597357749-05:00","close_reason":"Orphan cleanup","dependencies":[{"issue_id":"hq-wisp-0ihj","depends_on_id":"hq-wisp-eke2","type":"parent-child","created_at":"2026-01-16T01:53:28.919090829-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-0ihj","depends_on_id":"hq-wisp-uhyo","type":"blocks","created_at":"2026-01-16T01:53:28.956982912-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-0iru","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:55:09.578826504-05:00","updated_at":"2026-01-16T00:55:15.934315542-05:00","closed_at":"2026-01-16T00:55:15.934315542-05:00","close_reason":"Town healthy","dependencies":[{"issue_id":"hq-wisp-0iru","depends_on_id":"hq-wisp-3o9w","type":"parent-child","created_at":"2026-01-16T00:55:09.611464681-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-0iru","depends_on_id":"hq-wisp-82sd","type":"blocks","created_at":"2026-01-16T00:55:09.702477793-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-0j5","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T22:54:32.034275148-05:00","updated_at":"2026-01-16T00:13:27.255488938-05:00","closed_at":"2026-01-16T00:13:27.255488938-05:00","close_reason":"Inbox empty, hygiene verified","ephemeral":true}
{"id":"hq-wisp-0jq8e","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:56:40.341816737-05:00","updated_at":"2026-01-17T00:58:24.601264207-05:00","closed_at":"2026-01-17T00:58:24.601264207-05:00","close_reason":"Logs rotated","dependencies":[{"issue_id":"hq-wisp-0jq8e","depends_on_id":"hq-wisp-an994","type":"parent-child","created_at":"2026-01-17T00:56:48.710983105-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-0jq8e","depends_on_id":"hq-wisp-9vr1y","type":"blocks","created_at":"2026-01-17T00:57:00.062703122-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-0kfk5","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:49:35.72639816-05:00","updated_at":"2026-01-16T23:50:18.320103235-05:00","closed_at":"2026-01-16T23:50:18.320103235-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-0kfk5","depends_on_id":"hq-wisp-n4f70","type":"parent-child","created_at":"2026-01-16T23:49:37.759625442-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-0kfk5","depends_on_id":"hq-wisp-on4vb","type":"blocks","created_at":"2026-01-16T23:49:40.508218052-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-0nlhz","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T00:58:39.886819354-05:00","updated_at":"2026-01-17T01:00:24.943413384-05:00","closed_at":"2026-01-17T01:00:24.943413384-05:00","close_reason":"Patrol 15 complete","ephemeral":true}
{"id":"hq-wisp-0o3o","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:37:03.287142901-05:00","updated_at":"2026-01-17T00:35:51.212055378-05:00","closed_at":"2026-01-17T00:35:51.212055378-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-0oza6","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:40:19.877528483-05:00","updated_at":"2026-01-16T23:41:29.20993599-05:00","closed_at":"2026-01-16T23:41:29.20993599-05:00","close_reason":"No issues found","dependencies":[{"issue_id":"hq-wisp-0oza6","depends_on_id":"hq-wisp-6gnpy","type":"parent-child","created_at":"2026-01-16T23:40:21.052688748-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-0oza6","depends_on_id":"hq-wisp-708me","type":"blocks","created_at":"2026-01-16T23:40:23.035780159-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-0p46q","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T00:45:21.229795552-05:00","updated_at":"2026-01-17T00:45:46.610350703-05:00","closed_at":"2026-01-17T00:45:46.610350703-05:00","close_reason":"OK","ephemeral":true}
{"id":"hq-wisp-0qcqq","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:44:42.005503345-05:00","updated_at":"2026-01-17T10:44:42.005503387-05:00","dependencies":[{"issue_id":"hq-wisp-0qcqq","depends_on_id":"hq-wisp-qd1hf","type":"parent-child","created_at":"2026-01-17T10:44:42.238787505-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-0qcqq","depends_on_id":"hq-wisp-2wuhl","type":"blocks","created_at":"2026-01-17T10:44:42.555564307-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-0sk3i","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:48:51.080681805-05:00","updated_at":"2026-01-16T23:49:16.825079538-05:00","closed_at":"2026-01-16T23:49:16.825079538-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-0sk3i","depends_on_id":"hq-wisp-de87j","type":"parent-child","created_at":"2026-01-16T23:48:53.183215512-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-0sk3i","depends_on_id":"hq-wisp-w8sqv","type":"blocks","created_at":"2026-01-16T23:48:56.053653469-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-0stnn","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T00:40:09.047115841-05:00","updated_at":"2026-01-17T00:40:27.711557509-05:00","closed_at":"2026-01-17T00:40:27.711557509-05:00","close_reason":"OK","ephemeral":true}
{"id":"hq-wisp-0tl0","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:55:06.234122786-05:00","updated_at":"2026-01-16T01:52:14.197842399-05:00","closed_at":"2026-01-16T01:52:14.197842399-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-0tl0","depends_on_id":"hq-wisp-lejg","type":"parent-child","created_at":"2026-01-16T00:55:06.259225336-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-0tl0","depends_on_id":"hq-wisp-gz1p","type":"blocks","created_at":"2026-01-16T00:55:06.328069691-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-0v4eo","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:43:56.994496525-05:00","updated_at":"2026-01-16T23:44:27.335892527-05:00","closed_at":"2026-01-16T23:44:27.335892527-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-0v4eo","depends_on_id":"hq-wisp-ywecn","type":"parent-child","created_at":"2026-01-16T23:43:58.034364307-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-0v4eo","depends_on_id":"hq-wisp-f665i","type":"blocks","created_at":"2026-01-16T23:44:00.123406245-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-0w0wf","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:47:53.49865861-05:00","updated_at":"2026-01-16T23:48:37.207518971-05:00","closed_at":"2026-01-16T23:48:37.207518971-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-0w0wf","depends_on_id":"hq-wisp-wj52z","type":"parent-child","created_at":"2026-01-16T23:47:53.904726217-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-0w0wf","depends_on_id":"hq-wisp-glu2w","type":"blocks","created_at":"2026-01-16T23:47:56.31782575-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-0x7f1","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:12:55.888654607-05:00","updated_at":"2026-01-17T01:59:51.045884213-05:00","closed_at":"2026-01-17T01:59:51.045884213-05:00","close_reason":"No cleanup needed","dependencies":[{"issue_id":"hq-wisp-0x7f1","depends_on_id":"hq-wisp-i2n82","type":"parent-child","created_at":"2026-01-17T01:13:03.814900823-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-0x7f1","depends_on_id":"hq-wisp-5dspi","type":"blocks","created_at":"2026-01-17T01:13:16.154045963-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-0yyg","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:46:01.529611575-05:00","updated_at":"2026-01-16T01:51:00.659760489-05:00","closed_at":"2026-01-16T01:51:00.659760489-05:00","close_reason":"No gate-ready molecules to dispatch","dependencies":[{"issue_id":"hq-wisp-0yyg","depends_on_id":"hq-wisp-xunp","type":"parent-child","created_at":"2026-01-16T01:46:01.562460289-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-0yyg","depends_on_id":"hq-wisp-pltm","type":"blocks","created_at":"2026-01-16T01:46:01.73893414-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-10avo","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:43:56.995412358-05:00","updated_at":"2026-01-16T23:44:22.766613732-05:00","closed_at":"2026-01-16T23:44:22.766613732-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-10avo","depends_on_id":"hq-wisp-ywecn","type":"parent-child","created_at":"2026-01-16T23:43:58.244817947-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-10avo","depends_on_id":"hq-wisp-frqti","type":"blocks","created_at":"2026-01-16T23:44:00.334847926-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-10bze","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:59:39.402374183-05:00","updated_at":"2026-01-17T00:35:09.145584249-05:00","closed_at":"2026-01-17T00:35:09.145584249-05:00","close_reason":"Cleanup","ephemeral":true}
{"id":"hq-wisp-10u87","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:51:56.833745232-05:00","updated_at":"2026-01-16T23:52:36.082262492-05:00","closed_at":"2026-01-16T23:52:36.082262492-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-10u87","depends_on_id":"hq-wisp-ri9se","type":"parent-child","created_at":"2026-01-16T23:51:58.810597865-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-10u87","depends_on_id":"hq-wisp-dxl08","type":"blocks","created_at":"2026-01-16T23:52:02.133260037-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-121ik","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:45:48.841846178-05:00","updated_at":"2026-01-16T23:46:48.219196761-05:00","closed_at":"2026-01-16T23:46:48.219196761-05:00","close_reason":"dog pool not implemented","dependencies":[{"issue_id":"hq-wisp-121ik","depends_on_id":"hq-wisp-2heyl","type":"parent-child","created_at":"2026-01-16T23:45:50.111318503-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-121ik","depends_on_id":"hq-wisp-yijs3","type":"blocks","created_at":"2026-01-16T23:45:52.660055884-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-123hh","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:25:52.713606575-05:00","updated_at":"2026-01-16T23:26:16.074514402-05:00","closed_at":"2026-01-16T23:26:16.074514402-05:00","close_reason":"Inbox empty","dependencies":[{"issue_id":"hq-wisp-123hh","depends_on_id":"hq-wisp-w4tn2","type":"parent-child","created_at":"2026-01-16T23:25:52.724208199-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-1294","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:42:27.173653005-05:00","updated_at":"2026-01-16T01:52:13.623981441-05:00","closed_at":"2026-01-16T01:52:13.623981441-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-1294","depends_on_id":"hq-wisp-wqti","type":"parent-child","created_at":"2026-01-16T01:42:27.248970881-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-1294","depends_on_id":"hq-wisp-ayg1","type":"blocks","created_at":"2026-01-16T01:42:27.466314561-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-12v9m","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T02:00:44.577998726-05:00","updated_at":"2026-01-17T02:01:56.409381889-05:00","closed_at":"2026-01-17T02:01:56.409381889-05:00","close_reason":"Idle patrol","dependencies":[{"issue_id":"hq-wisp-12v9m","depends_on_id":"hq-wisp-9a1wp","type":"parent-child","created_at":"2026-01-17T02:00:54.542943165-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-12v9m","depends_on_id":"hq-wisp-ujbb2","type":"blocks","created_at":"2026-01-17T02:01:07.338010129-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-1456a","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:28:16.227774098-05:00","updated_at":"2026-01-17T00:28:38.735576137-05:00","closed_at":"2026-01-17T00:28:38.735576137-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-1456a","depends_on_id":"hq-wisp-tbive","type":"parent-child","created_at":"2026-01-17T00:28:18.438069448-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-1456a","depends_on_id":"hq-wisp-9n19h","type":"blocks","created_at":"2026-01-17T00:28:22.878393952-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-14ebq","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:46:50.720592958-05:00","updated_at":"2026-01-17T10:46:50.720592999-05:00","dependencies":[{"issue_id":"hq-wisp-14ebq","depends_on_id":"hq-wisp-2vhlh","type":"parent-child","created_at":"2026-01-17T10:46:50.733468534-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-14v3d","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:47:53.505934108-05:00","updated_at":"2026-01-16T23:48:25.008914368-05:00","closed_at":"2026-01-16T23:48:25.008914368-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-14v3d","depends_on_id":"hq-wisp-wj52z","type":"parent-child","created_at":"2026-01-16T23:47:55.509152723-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-14v3d","depends_on_id":"hq-wisp-u4mvq","type":"blocks","created_at":"2026-01-16T23:47:58.230466992-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-157qz","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T00:41:59.861178336-05:00","updated_at":"2026-01-17T00:42:20.864923349-05:00","closed_at":"2026-01-17T00:42:20.864923349-05:00","close_reason":"OK","ephemeral":true}
{"id":"hq-wisp-16i0","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:19:36.436948863-05:00","updated_at":"2026-01-16T23:21:11.169159155-05:00","closed_at":"2026-01-16T23:21:11.169159155-05:00","close_reason":"Standard cleanup, context low, looping","dependencies":[{"issue_id":"hq-wisp-16i0","depends_on_id":"hq-wisp-pfs9","type":"parent-child","created_at":"2026-01-16T23:19:37.778276648-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-16i0","depends_on_id":"hq-wisp-i10r","type":"blocks","created_at":"2026-01-16T23:19:39.291693828-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-16ivr","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:02:45.69791951-05:00","updated_at":"2026-01-17T01:05:26.707381213-05:00","closed_at":"2026-01-17T01:05:26.707381213-05:00","close_reason":"Idle town patrol","dependencies":[{"issue_id":"hq-wisp-16ivr","depends_on_id":"hq-wisp-ji9jj","type":"parent-child","created_at":"2026-01-17T01:02:52.151078239-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-16ivr","depends_on_id":"hq-wisp-9pyi9","type":"blocks","created_at":"2026-01-17T01:03:03.939660226-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-16ked","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:47:34.370386995-05:00","updated_at":"2026-01-16T23:49:14.156121371-05:00","closed_at":"2026-01-16T23:49:14.156121371-05:00","close_reason":"Town idle patrol","dependencies":[{"issue_id":"hq-wisp-16ked","depends_on_id":"hq-wisp-ql31w","type":"parent-child","created_at":"2026-01-16T23:47:35.205109032-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-16ked","depends_on_id":"hq-wisp-jrhxn","type":"blocks","created_at":"2026-01-16T23:47:37.352082244-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-16ked","depends_on_id":"hq-wisp-w2xmz","type":"blocks","created_at":"2026-01-16T23:47:37.472964103-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-16ked","depends_on_id":"hq-wisp-u5qyi","type":"blocks","created_at":"2026-01-16T23:47:37.594268125-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-176hh","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon/","created_at":"2026-01-17T00:32:14.456770352-05:00","updated_at":"2026-01-17T00:33:18.703968467-05:00","closed_at":"2026-01-17T00:33:18.703968467-05:00","close_reason":"Patrol complete","ephemeral":true}
{"id":"hq-wisp-198k","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T01:29:28.802523502-05:00","updated_at":"2026-01-16T01:50:39.190946543-05:00","closed_at":"2026-01-16T01:50:39.190946543-05:00","close_reason":"Stale patrol wisp cleanup","ephemeral":true}
{"id":"hq-wisp-19cs","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T22:55:43.094035244-05:00","updated_at":"2026-01-17T00:36:15.561068241-05:00","closed_at":"2026-01-17T00:36:15.561068241-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-19z3","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:48:28.030727514-05:00","updated_at":"2026-01-16T22:13:02.119543903-05:00","closed_at":"2026-01-16T22:13:02.119543903-05:00","close_reason":"Orphaned - forced cleanup","dependencies":[{"issue_id":"hq-wisp-19z3","depends_on_id":"hq-wisp-mwjb","type":"parent-child","created_at":"2026-01-16T21:48:28.056926968-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-19z3","depends_on_id":"hq-wisp-szn0","type":"blocks","created_at":"2026-01-16T21:48:28.135100954-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-1bdm2","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:52:58.275504845-05:00","updated_at":"2026-01-16T23:53:17.900713789-05:00","closed_at":"2026-01-16T23:53:17.900713789-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-1bdm2","depends_on_id":"hq-wisp-a5ye3","type":"parent-child","created_at":"2026-01-16T23:52:58.772338629-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-1bdm2","depends_on_id":"hq-wisp-cj4km","type":"blocks","created_at":"2026-01-16T23:53:01.738094181-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-1bngg","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:00:26.064686763-05:00","updated_at":"2026-01-17T01:01:58.478464497-05:00","closed_at":"2026-01-17T01:01:58.478464497-05:00","close_reason":"No cleanup","dependencies":[{"issue_id":"hq-wisp-1bngg","depends_on_id":"hq-wisp-5yxyi","type":"parent-child","created_at":"2026-01-17T01:00:33.253571591-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-1bngg","depends_on_id":"hq-wisp-7mtni","type":"blocks","created_at":"2026-01-17T01:00:44.366191995-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-1cxa","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:43:15.720945012-05:00","updated_at":"2026-01-16T22:13:02.137250422-05:00","closed_at":"2026-01-16T22:13:02.137250422-05:00","close_reason":"Orphaned - forced cleanup","dependencies":[{"issue_id":"hq-wisp-1cxa","depends_on_id":"hq-wisp-l7vn","type":"parent-child","created_at":"2026-01-16T21:43:15.776928454-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-1cxa","depends_on_id":"hq-wisp-k8fo","type":"blocks","created_at":"2026-01-16T21:43:15.854192401-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-1dwlv","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:50:35.395840852-05:00","updated_at":"2026-01-16T23:51:24.823051857-05:00","closed_at":"2026-01-16T23:51:24.823051857-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-1dwlv","depends_on_id":"hq-wisp-t8b5z","type":"parent-child","created_at":"2026-01-16T23:50:35.785640922-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-1dwlv","depends_on_id":"hq-wisp-xrs04","type":"blocks","created_at":"2026-01-16T23:50:38.239334788-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-1eou","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T22:34:52.356573284-05:00","updated_at":"2026-01-17T00:36:18.833849954-05:00","closed_at":"2026-01-17T00:36:18.833849954-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-1ggz","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:46:01.528632201-05:00","updated_at":"2026-01-16T01:46:35.55464936-05:00","closed_at":"2026-01-16T01:46:35.55464936-05:00","close_reason":"Inbox empty, no callbacks to process","dependencies":[{"issue_id":"hq-wisp-1ggz","depends_on_id":"hq-wisp-xunp","type":"parent-child","created_at":"2026-01-16T01:46:01.534635945-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-1go3","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:21:24.470244636-05:00","updated_at":"2026-01-16T23:23:07.584966286-05:00","closed_at":"2026-01-16T23:23:07.584966286-05:00","close_reason":"No plugins, no stuck dogs","dependencies":[{"issue_id":"hq-wisp-1go3","depends_on_id":"hq-wisp-87xr","type":"parent-child","created_at":"2026-01-16T23:21:25.386291853-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-1go3","depends_on_id":"hq-wisp-wj30","type":"blocks","created_at":"2026-01-16T23:21:27.119072883-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-1gsz0","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:52:50.337234065-05:00","updated_at":"2026-01-17T00:56:16.085368717-05:00","closed_at":"2026-01-17T00:56:16.085368717-05:00","close_reason":"Logs rotated","dependencies":[{"issue_id":"hq-wisp-1gsz0","depends_on_id":"hq-wisp-xo3wl","type":"parent-child","created_at":"2026-01-17T00:52:58.524981802-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-1gsz0","depends_on_id":"hq-wisp-zducj","type":"blocks","created_at":"2026-01-17T00:53:09.480804889-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-1i840","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:58:39.889419058-05:00","updated_at":"2026-01-17T00:59:34.82560693-05:00","closed_at":"2026-01-17T00:59:34.82560693-05:00","close_reason":"No pending spawns","dependencies":[{"issue_id":"hq-wisp-1i840","depends_on_id":"hq-wisp-0nlhz","type":"parent-child","created_at":"2026-01-17T00:58:40.451398076-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-1i840","depends_on_id":"hq-wisp-dnyio","type":"blocks","created_at":"2026-01-17T00:58:50.293254826-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-1id0r","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:00:26.062244933-05:00","updated_at":"2026-01-17T01:01:26.71176124-05:00","closed_at":"2026-01-17T01:01:26.71176124-05:00","close_reason":"Pool healthy","dependencies":[{"issue_id":"hq-wisp-1id0r","depends_on_id":"hq-wisp-5yxyi","type":"parent-child","created_at":"2026-01-17T01:00:31.588433038-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-1id0r","depends_on_id":"hq-wisp-fnvo7","type":"blocks","created_at":"2026-01-17T01:00:42.687158547-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-1iewy","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:45:48.844818355-05:00","updated_at":"2026-01-16T23:47:14.139221825-05:00","closed_at":"2026-01-16T23:47:14.139221825-05:00","close_reason":"Inbox empty","dependencies":[{"issue_id":"hq-wisp-1iewy","depends_on_id":"hq-wisp-2heyl","type":"parent-child","created_at":"2026-01-16T23:45:50.870169261-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-1iewy","depends_on_id":"hq-wisp-booy4","type":"blocks","created_at":"2026-01-16T23:45:53.43539801-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-1ikvq","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:56:40.344642608-05:00","updated_at":"2026-01-17T00:58:32.809946855-05:00","closed_at":"2026-01-17T00:58:32.809946855-05:00","close_reason":"Looping - patrol 14 of 20","dependencies":[{"issue_id":"hq-wisp-1ikvq","depends_on_id":"hq-wisp-an994","type":"parent-child","created_at":"2026-01-17T00:56:50.503081025-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-1ikvq","depends_on_id":"hq-wisp-3mp5w","type":"blocks","created_at":"2026-01-17T00:57:01.748649427-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-1jhdg","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:09:41.610616388-05:00","updated_at":"2026-01-17T01:10:45.438136084-05:00","closed_at":"2026-01-17T01:10:45.438136084-05:00","close_reason":"All healthy","dependencies":[{"issue_id":"hq-wisp-1jhdg","depends_on_id":"hq-wisp-fsms9","type":"parent-child","created_at":"2026-01-17T01:09:45.885021816-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-1jhdg","depends_on_id":"hq-wisp-lep99","type":"blocks","created_at":"2026-01-17T01:09:56.822042178-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-1jhdg","depends_on_id":"hq-wisp-51c34","type":"blocks","created_at":"2026-01-17T01:09:57.426986522-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-1jhdg","depends_on_id":"hq-wisp-o56v1","type":"blocks","created_at":"2026-01-17T01:09:58.032408448-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-1jmuo","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:45:48.835809033-05:00","updated_at":"2026-01-16T23:46:37.236087356-05:00","closed_at":"2026-01-16T23:46:37.236087356-05:00","close_reason":"bd mol ready --gated not implemented","dependencies":[{"issue_id":"hq-wisp-1jmuo","depends_on_id":"hq-wisp-2heyl","type":"parent-child","created_at":"2026-01-16T23:45:49.219918467-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-1jmuo","depends_on_id":"hq-wisp-4j1te","type":"blocks","created_at":"2026-01-16T23:45:51.511242628-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-1kie5","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:49:35.722913502-05:00","updated_at":"2026-01-16T23:50:19.476832973-05:00","closed_at":"2026-01-16T23:50:19.476832973-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-1kie5","depends_on_id":"hq-wisp-n4f70","type":"parent-child","created_at":"2026-01-16T23:49:37.090146343-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-1kie5","depends_on_id":"hq-wisp-02syo","type":"blocks","created_at":"2026-01-16T23:49:39.809592728-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-1kiy","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:48:28.03302651-05:00","updated_at":"2026-01-16T22:13:02.086855277-05:00","closed_at":"2026-01-16T22:13:02.086855277-05:00","close_reason":"Orphaned - forced cleanup","dependencies":[{"issue_id":"hq-wisp-1kiy","depends_on_id":"hq-wisp-mwjb","type":"parent-child","created_at":"2026-01-16T21:48:28.08598975-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-1kiy","depends_on_id":"hq-wisp-3786","type":"blocks","created_at":"2026-01-16T21:48:28.182349162-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-1kzc5","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:50:53.897447432-05:00","updated_at":"2026-01-16T23:51:30.485536464-05:00","closed_at":"2026-01-16T23:51:30.485536464-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-1kzc5","depends_on_id":"hq-wisp-47par","type":"parent-child","created_at":"2026-01-16T23:50:55.322560701-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-1kzc5","depends_on_id":"hq-wisp-ms1lx","type":"blocks","created_at":"2026-01-16T23:50:58.175772946-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-1nlm3","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:47:24.578324647-05:00","updated_at":"2026-01-17T10:47:24.578324688-05:00","dependencies":[{"issue_id":"hq-wisp-1nlm3","depends_on_id":"hq-wisp-jag69","type":"parent-child","created_at":"2026-01-17T10:47:24.682808586-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-1nlm3","depends_on_id":"hq-wisp-3gss6","type":"blocks","created_at":"2026-01-17T10:47:25.242342092-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-1om0","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:23:47.735362866-05:00","updated_at":"2026-01-16T23:25:09.759832847-05:00","closed_at":"2026-01-16T23:25:09.759832847-05:00","close_reason":"No plugins, no stuck dogs","dependencies":[{"issue_id":"hq-wisp-1om0","depends_on_id":"hq-wisp-9we3","type":"parent-child","created_at":"2026-01-16T23:23:48.59965192-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-1om0","depends_on_id":"hq-wisp-acoj","type":"blocks","created_at":"2026-01-16T23:23:50.550658915-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-1onlb","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:05:32.485701417-05:00","updated_at":"2026-01-17T01:06:17.06180348-05:00","closed_at":"2026-01-17T01:06:17.06180348-05:00","close_reason":"Idle town","dependencies":[{"issue_id":"hq-wisp-1onlb","depends_on_id":"hq-wisp-p8n2g","type":"parent-child","created_at":"2026-01-17T01:05:33.672431801-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-1onlb","depends_on_id":"hq-wisp-w1g8e","type":"blocks","created_at":"2026-01-17T01:05:44.725608584-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-1oo3m","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:49:41.450058697-05:00","updated_at":"2026-01-16T23:50:13.480156934-05:00","closed_at":"2026-01-16T23:50:13.480156934-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-1oo3m","depends_on_id":"hq-wisp-q54v3","type":"parent-child","created_at":"2026-01-16T23:49:43.431365764-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-1oo3m","depends_on_id":"hq-wisp-tfhtb","type":"blocks","created_at":"2026-01-16T23:49:46.305837586-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-1pv3y","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:46:50.723757956-05:00","updated_at":"2026-01-17T10:46:50.723757998-05:00","dependencies":[{"issue_id":"hq-wisp-1pv3y","depends_on_id":"hq-wisp-2vhlh","type":"parent-child","created_at":"2026-01-17T10:46:50.861974-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-1pv3y","depends_on_id":"hq-wisp-fk674","type":"blocks","created_at":"2026-01-17T10:46:51.330808017-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-1qsl","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:54:43.648332055-05:00","updated_at":"2026-01-16T01:56:12.117516817-05:00","closed_at":"2026-01-16T01:56:12.117516817-05:00","close_reason":"Orphan wisp cleanup","dependencies":[{"issue_id":"hq-wisp-1qsl","depends_on_id":"hq-wisp-8okt","type":"parent-child","created_at":"2026-01-16T01:54:43.655962213-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-1qsl","depends_on_id":"hq-wisp-3yqg","type":"blocks","created_at":"2026-01-16T01:54:43.691672383-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-1rj6c","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:23:02.699390608-05:00","updated_at":"2026-01-17T00:23:37.535497955-05:00","closed_at":"2026-01-17T00:23:37.535497955-05:00","close_reason":"Inbox empty","dependencies":[{"issue_id":"hq-wisp-1rj6c","depends_on_id":"hq-wisp-93kdl","type":"parent-child","created_at":"2026-01-17T00:23:02.71273795-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-1saa6","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:43:06.014443398-05:00","updated_at":"2026-01-16T23:43:29.649795042-05:00","closed_at":"2026-01-16T23:43:29.649795042-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-1saa6","depends_on_id":"hq-wisp-p7g8j","type":"parent-child","created_at":"2026-01-16T23:43:07.626959761-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-1saa6","depends_on_id":"hq-wisp-pdlug","type":"blocks","created_at":"2026-01-16T23:43:09.884088383-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-1tu5c","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:47:55.321438616-05:00","updated_at":"2026-01-17T10:47:55.321438616-05:00","dependencies":[{"issue_id":"hq-wisp-1tu5c","depends_on_id":"hq-wisp-9hr1x","type":"parent-child","created_at":"2026-01-17T10:47:55.771256812-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-1tu5c","depends_on_id":"hq-wisp-lpdp5","type":"blocks","created_at":"2026-01-17T10:47:56.566406763-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-1u1e","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:48:28.033352843-05:00","updated_at":"2026-01-16T22:13:02.081808575-05:00","closed_at":"2026-01-16T22:13:02.081808575-05:00","close_reason":"Orphaned - forced cleanup","dependencies":[{"issue_id":"hq-wisp-1u1e","depends_on_id":"hq-wisp-mwjb","type":"parent-child","created_at":"2026-01-16T21:48:28.089911409-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-1u1e","depends_on_id":"hq-wisp-1kiy","type":"blocks","created_at":"2026-01-16T21:48:28.188354277-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-1u5a","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","assignee":"deacon","created_at":"2026-01-16T22:15:44.229049672-05:00","updated_at":"2026-01-17T00:36:31.613908162-05:00","closed_at":"2026-01-17T00:36:31.613908162-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-1vntb","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:31:03.242349383-05:00","updated_at":"2026-01-17T00:31:16.606155223-05:00","closed_at":"2026-01-17T00:31:16.606155223-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-1vntb","depends_on_id":"hq-wisp-apmz9","type":"parent-child","created_at":"2026-01-17T00:31:03.256927529-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-1vo6","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:23:47.726679076-05:00","updated_at":"2026-01-16T23:24:09.434355861-05:00","closed_at":"2026-01-16T23:24:09.434355861-05:00","close_reason":"Inbox empty","dependencies":[{"issue_id":"hq-wisp-1vo6","depends_on_id":"hq-wisp-9we3","type":"parent-child","created_at":"2026-01-16T23:23:47.744657698-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-1wn18","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:56:40.34029549-05:00","updated_at":"2026-01-17T00:58:18.34259309-05:00","closed_at":"2026-01-17T00:58:18.34259309-05:00","close_reason":"No cleanup","dependencies":[{"issue_id":"hq-wisp-1wn18","depends_on_id":"hq-wisp-an994","type":"parent-child","created_at":"2026-01-17T00:56:47.630050788-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-1wn18","depends_on_id":"hq-wisp-9vny6","type":"blocks","created_at":"2026-01-17T00:56:58.919848449-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-1xg1","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T01:09:49.479087295-05:00","updated_at":"2026-01-16T01:50:39.37759909-05:00","closed_at":"2026-01-16T01:50:39.37759909-05:00","close_reason":"Stale patrol wisp cleanup","ephemeral":true}
{"id":"hq-wisp-1yp82","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:41:51.252117894-05:00","updated_at":"2026-01-16T23:42:37.132050554-05:00","closed_at":"2026-01-16T23:42:37.132050554-05:00","close_reason":"Town idle / pool at capacity","dependencies":[{"issue_id":"hq-wisp-1yp82","depends_on_id":"hq-wisp-tnkch","type":"parent-child","created_at":"2026-01-16T23:41:52.304060216-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-1yp82","depends_on_id":"hq-wisp-ijoir","type":"blocks","created_at":"2026-01-16T23:41:54.409852361-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-1yv1","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:42:27.174711128-05:00","updated_at":"2026-01-16T01:52:13.588567271-05:00","closed_at":"2026-01-16T01:52:13.588567271-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-1yv1","depends_on_id":"hq-wisp-wqti","type":"parent-child","created_at":"2026-01-16T01:42:27.296492537-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-1yv1","depends_on_id":"hq-wisp-rcj5","type":"blocks","created_at":"2026-01-16T01:42:27.542423645-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-1z8z","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:37:49.088705974-05:00","updated_at":"2026-01-16T23:39:05.634353445-05:00","closed_at":"2026-01-16T23:39:05.634353445-05:00","close_reason":"No open convoys","dependencies":[{"issue_id":"hq-wisp-1z8z","depends_on_id":"hq-wisp-2zuj","type":"parent-child","created_at":"2026-01-16T23:37:49.452186844-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-1z8z","depends_on_id":"hq-wisp-rf4o","type":"blocks","created_at":"2026-01-16T23:37:51.071815175-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-1zxhh","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T02:00:44.569817563-05:00","updated_at":"2026-01-17T02:01:51.382476685-05:00","closed_at":"2026-01-17T02:01:51.382476685-05:00","close_reason":"Idle patrol","dependencies":[{"issue_id":"hq-wisp-1zxhh","depends_on_id":"hq-wisp-9a1wp","type":"parent-child","created_at":"2026-01-17T02:00:48.63751793-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-1zxhh","depends_on_id":"hq-wisp-wgv86","type":"blocks","created_at":"2026-01-17T02:01:00.906502015-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-21mtg","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T10:46:09.504148325-05:00","updated_at":"2026-01-17T10:46:26.268437182-05:00","closed_at":"2026-01-17T10:46:26.268437182-05:00","close_reason":"Patrol 8 complete","ephemeral":true}
{"id":"hq-wisp-225wv","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:25:52.7147227-05:00","updated_at":"2026-01-16T23:26:32.227025628-05:00","closed_at":"2026-01-16T23:26:32.227025628-05:00","close_reason":"No gates/convoys/pending","dependencies":[{"issue_id":"hq-wisp-225wv","depends_on_id":"hq-wisp-w4tn2","type":"parent-child","created_at":"2026-01-16T23:25:52.910694841-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-225wv","depends_on_id":"hq-wisp-123hh","type":"blocks","created_at":"2026-01-16T23:25:54.597722955-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-25tf","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T01:29:43.001817148-05:00","updated_at":"2026-01-16T01:50:39.165793946-05:00","closed_at":"2026-01-16T01:50:39.165793946-05:00","close_reason":"Stale patrol wisp cleanup","ephemeral":true}
{"id":"hq-wisp-277rl","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:52:58.278782176-05:00","updated_at":"2026-01-16T23:53:16.966158341-05:00","closed_at":"2026-01-16T23:53:16.966158341-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-277rl","depends_on_id":"hq-wisp-a5ye3","type":"parent-child","created_at":"2026-01-16T23:52:59.586254587-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-277rl","depends_on_id":"hq-wisp-3bz1l","type":"blocks","created_at":"2026-01-16T23:53:02.907771365-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-293e","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T01:38:46.585094669-05:00","updated_at":"2026-01-16T01:50:39.066556137-05:00","closed_at":"2026-01-16T01:50:39.066556137-05:00","close_reason":"Stale patrol wisp cleanup","ephemeral":true}
{"id":"hq-wisp-2975x","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:53:05.628838521-05:00","updated_at":"2026-01-16T23:53:43.931750763-05:00","closed_at":"2026-01-16T23:53:43.931750763-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-2975x","depends_on_id":"hq-wisp-xtx6n","type":"parent-child","created_at":"2026-01-16T23:53:08.588163578-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-2975x","depends_on_id":"hq-wisp-na0y3","type":"blocks","created_at":"2026-01-16T23:53:12.091951841-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-29b2","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-16T01:42:52.368534156-05:00","updated_at":"2026-01-16T01:52:13.505382987-05:00","closed_at":"2026-01-16T01:52:13.505382987-05:00","close_reason":"Orphaned wisp cleanup","ephemeral":true}
{"id":"hq-wisp-2aaz","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T01:29:54.63152249-05:00","updated_at":"2026-01-16T01:50:39.151611336-05:00","closed_at":"2026-01-16T01:50:39.151611336-05:00","close_reason":"Stale patrol wisp cleanup","ephemeral":true}
{"id":"hq-wisp-2aysb","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:12:55.887056776-05:00","updated_at":"2026-01-17T01:59:42.200466507-05:00","closed_at":"2026-01-17T01:59:42.200466507-05:00","close_reason":"No stuck dogs","dependencies":[{"issue_id":"hq-wisp-2aysb","depends_on_id":"hq-wisp-i2n82","type":"parent-child","created_at":"2026-01-17T01:13:02.612914663-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-2aysb","depends_on_id":"hq-wisp-fagoj","type":"blocks","created_at":"2026-01-17T01:13:14.927045717-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-2budu","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T00:33:57.895304742-05:00","updated_at":"2026-01-17T00:34:21.404036099-05:00","closed_at":"2026-01-17T00:34:21.404036099-05:00","close_reason":"Done","ephemeral":true}
{"id":"hq-wisp-2bx35","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:53:05.624008067-05:00","updated_at":"2026-01-16T23:53:52.717661795-05:00","closed_at":"2026-01-16T23:53:52.717661795-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-2bx35","depends_on_id":"hq-wisp-xtx6n","type":"parent-child","created_at":"2026-01-16T23:53:07.555671747-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-2bx35","depends_on_id":"hq-wisp-rjogw","type":"blocks","created_at":"2026-01-16T23:53:11.029955074-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-2csi","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:54:43.648640638-05:00","updated_at":"2026-01-16T01:56:11.900012345-05:00","closed_at":"2026-01-16T01:56:11.900012345-05:00","close_reason":"Orphan wisp cleanup","dependencies":[{"issue_id":"hq-wisp-2csi","depends_on_id":"hq-wisp-8okt","type":"parent-child","created_at":"2026-01-16T01:54:43.658292961-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-2csi","depends_on_id":"hq-wisp-3yqg","type":"blocks","created_at":"2026-01-16T01:54:43.693647881-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-2d40","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:55:36.781873419-05:00","updated_at":"2026-01-16T01:56:15.70378162-05:00","closed_at":"2026-01-16T01:56:15.70378162-05:00","close_reason":"Closed","dependencies":[{"issue_id":"hq-wisp-2d40","depends_on_id":"hq-wisp-ndqt","type":"parent-child","created_at":"2026-01-16T01:55:36.827538745-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-2d40","depends_on_id":"hq-wisp-mw9k","type":"blocks","created_at":"2026-01-16T01:55:36.950046486-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-2e8p","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T22:32:33.566225792-05:00","updated_at":"2026-01-17T00:36:19.138007195-05:00","closed_at":"2026-01-17T00:36:19.138007195-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-2ebwf","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:40:19.879686608-05:00","updated_at":"2026-01-16T23:41:34.836563888-05:00","closed_at":"2026-01-16T23:41:34.836563888-05:00","close_reason":"Routine checks passed","dependencies":[{"issue_id":"hq-wisp-2ebwf","depends_on_id":"hq-wisp-6gnpy","type":"parent-child","created_at":"2026-01-16T23:40:21.544398268-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-2ebwf","depends_on_id":"hq-wisp-6iifz","type":"blocks","created_at":"2026-01-16T23:40:23.545796635-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-2heyl","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:45:48.83231732-05:00","updated_at":"2026-01-16T23:47:22.280357268-05:00","closed_at":"2026-01-16T23:47:22.280357268-05:00","close_reason":"Patrol cycle 7 complete","ephemeral":true}
{"id":"hq-wisp-2hqil","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:09:41.618023752-05:00","updated_at":"2026-01-17T01:11:05.231252028-05:00","closed_at":"2026-01-17T01:11:05.231252028-05:00","close_reason":"Inbox clear","dependencies":[{"issue_id":"hq-wisp-2hqil","depends_on_id":"hq-wisp-fsms9","type":"parent-child","created_at":"2026-01-17T01:09:51.296176587-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-2hqil","depends_on_id":"hq-wisp-y0ei2","type":"blocks","created_at":"2026-01-17T01:10:03.771598456-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-2iclo","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:47:24.58433306-05:00","updated_at":"2026-01-17T10:47:24.58433306-05:00","dependencies":[{"issue_id":"hq-wisp-2iclo","depends_on_id":"hq-wisp-jag69","type":"parent-child","created_at":"2026-01-17T10:47:24.991218488-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-2iclo","depends_on_id":"hq-wisp-x72zc","type":"blocks","created_at":"2026-01-17T10:47:25.647514521-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-2iun","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:43:15.717606393-05:00","updated_at":"2026-01-16T21:44:49.362689361-05:00","closed_at":"2026-01-16T21:44:49.362689361-05:00","close_reason":"Closed","dependencies":[{"issue_id":"hq-wisp-2iun","depends_on_id":"hq-wisp-l7vn","type":"parent-child","created_at":"2026-01-16T21:43:15.736273984-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-2iun","depends_on_id":"hq-wisp-dn75","type":"blocks","created_at":"2026-01-16T21:43:15.797840792-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-2izgc","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:02:22.551865367-05:00","updated_at":"2026-01-17T01:04:02.306483841-05:00","closed_at":"2026-01-17T01:04:02.306483841-05:00","close_reason":"No cross-rig deps","dependencies":[{"issue_id":"hq-wisp-2izgc","depends_on_id":"hq-wisp-xwv1q","type":"parent-child","created_at":"2026-01-17T01:02:25.543946637-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-2izgc","depends_on_id":"hq-wisp-87q2n","type":"blocks","created_at":"2026-01-17T01:02:35.897214019-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-2jxf","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:36:59.344705203-05:00","updated_at":"2026-01-16T23:39:43.088197328-05:00","closed_at":"2026-01-16T23:39:43.088197328-05:00","close_reason":"Log 1.6MB - under 10MB threshold, no rotation needed","dependencies":[{"issue_id":"hq-wisp-2jxf","depends_on_id":"hq-wisp-c8tl","type":"parent-child","created_at":"2026-01-16T23:37:00.564104962-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-2jxf","depends_on_id":"hq-wisp-mlnx","type":"blocks","created_at":"2026-01-16T23:37:02.22506283-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-2m1c","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:53:28.902353222-05:00","updated_at":"2026-01-16T01:54:17.594396544-05:00","closed_at":"2026-01-16T01:54:17.594396544-05:00","close_reason":"Orphan cleanup","dependencies":[{"issue_id":"hq-wisp-2m1c","depends_on_id":"hq-wisp-eke2","type":"parent-child","created_at":"2026-01-16T01:53:28.921490868-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-2m1c","depends_on_id":"hq-wisp-0ihj","type":"blocks","created_at":"2026-01-16T01:53:28.959702618-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-2oxf0","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T10:30:15.9012629-05:00","updated_at":"2026-01-17T10:40:19.605651086-05:00","closed_at":"2026-01-17T10:40:19.605651086-05:00","close_reason":"Patrol cycle 3 complete","ephemeral":true}
{"id":"hq-wisp-2ptsx","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:05:32.498355814-05:00","updated_at":"2026-01-17T01:06:55.904065195-05:00","closed_at":"2026-01-17T01:06:55.904065195-05:00","close_reason":"Idle town","dependencies":[{"issue_id":"hq-wisp-2ptsx","depends_on_id":"hq-wisp-p8n2g","type":"parent-child","created_at":"2026-01-17T01:05:40.861821077-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-2ptsx","depends_on_id":"hq-wisp-ugvkw","type":"blocks","created_at":"2026-01-17T01:05:53.096408711-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-2r4u","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:46:01.531230323-05:00","updated_at":"2026-01-16T01:51:27.847209372-05:00","closed_at":"2026-01-16T01:51:27.847209372-05:00","close_reason":"All components healthy, town idle - skipped nudges per protocol","dependencies":[{"issue_id":"hq-wisp-2r4u","depends_on_id":"hq-wisp-xunp","type":"parent-child","created_at":"2026-01-16T01:46:01.600532207-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-2r4u","depends_on_id":"hq-wisp-pqco","type":"blocks","created_at":"2026-01-16T01:46:01.778721389-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-2r4u","depends_on_id":"hq-wisp-0yyg","type":"blocks","created_at":"2026-01-16T01:46:01.788858961-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-2r4u","depends_on_id":"hq-wisp-qvh6","type":"blocks","created_at":"2026-01-16T01:46:01.798895533-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-2rrek","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:53:25.151546794-05:00","updated_at":"2026-01-16T23:53:50.395206165-05:00","closed_at":"2026-01-16T23:53:50.395206165-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-2rrek","depends_on_id":"hq-wisp-of0wi","type":"parent-child","created_at":"2026-01-16T23:53:25.335644444-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-2rrek","depends_on_id":"hq-wisp-7a464","type":"blocks","created_at":"2026-01-16T23:53:28.352475415-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-2u8ir","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:41:51.247323644-05:00","updated_at":"2026-01-16T23:42:23.769126779-05:00","closed_at":"2026-01-16T23:42:23.769126779-05:00","close_reason":"No messages","dependencies":[{"issue_id":"hq-wisp-2u8ir","depends_on_id":"hq-wisp-tnkch","type":"parent-child","created_at":"2026-01-16T23:41:51.256560602-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-2uibz","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:56:40.328638216-05:00","updated_at":"2026-01-17T00:57:18.744787713-05:00","closed_at":"2026-01-17T00:57:18.744787713-05:00","close_reason":"Inbox clear","dependencies":[{"issue_id":"hq-wisp-2uibz","depends_on_id":"hq-wisp-an994","type":"parent-child","created_at":"2026-01-17T00:56:40.345836356-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-2uit","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:46:01.533674029-05:00","updated_at":"2026-01-16T01:51:58.30650637-05:00","closed_at":"2026-01-16T01:51:58.30650637-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-2uit","depends_on_id":"hq-wisp-xunp","type":"parent-child","created_at":"2026-01-16T01:46:01.689555402-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-2uwwm","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:03:11.639519997-05:00","updated_at":"2026-01-17T01:04:13.224739749-05:00","closed_at":"2026-01-17T01:04:13.224739749-05:00","close_reason":"No zombies","dependencies":[{"issue_id":"hq-wisp-2uwwm","depends_on_id":"hq-wisp-zx2sm","type":"parent-child","created_at":"2026-01-17T01:03:16.431282916-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-2uwwm","depends_on_id":"hq-wisp-d3ra0","type":"blocks","created_at":"2026-01-17T01:03:28.495183014-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-2vhlh","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"hooked","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T10:46:50.719289167-05:00","updated_at":"2026-01-17T10:46:52.126855385-05:00","ephemeral":true}
{"id":"hq-wisp-2wuhl","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:44:42.004904973-05:00","updated_at":"2026-01-17T10:44:42.004905014-05:00","dependencies":[{"issue_id":"hq-wisp-2wuhl","depends_on_id":"hq-wisp-qd1hf","type":"parent-child","created_at":"2026-01-17T10:44:42.225277473-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-2wuhl","depends_on_id":"hq-wisp-5w03x","type":"blocks","created_at":"2026-01-17T10:44:42.537324834-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-2xbe8","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:09:41.614710215-05:00","updated_at":"2026-01-17T01:10:52.03338825-05:00","closed_at":"2026-01-17T01:10:52.03338825-05:00","close_reason":"No abandoned work","dependencies":[{"issue_id":"hq-wisp-2xbe8","depends_on_id":"hq-wisp-fsms9","type":"parent-child","created_at":"2026-01-17T01:09:48.894555517-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-2xbe8","depends_on_id":"hq-wisp-zmeg0","type":"blocks","created_at":"2026-01-17T01:10:01.229522064-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-2xj8l","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:30:39.088291906-05:00","updated_at":"2026-01-17T00:30:56.615493198-05:00","closed_at":"2026-01-17T00:30:56.615493198-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-2xj8l","depends_on_id":"hq-wisp-tjzfo","type":"parent-child","created_at":"2026-01-17T00:30:41.611410933-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-2xj8l","depends_on_id":"hq-wisp-s10v0","type":"blocks","created_at":"2026-01-17T00:30:46.700421052-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-2xjo","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T01:53:53.175796294-05:00","updated_at":"2026-01-16T22:12:29.23249659-05:00","closed_at":"2026-01-16T22:12:29.23249659-05:00","close_reason":"Orphaned - bulk cleanup","ephemeral":true}
{"id":"hq-wisp-2y2a","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:27:24.234330389-05:00","updated_at":"2026-01-16T01:52:13.874536251-05:00","closed_at":"2026-01-16T01:52:13.874536251-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-2y2a","depends_on_id":"hq-wisp-nv4o","type":"parent-child","created_at":"2026-01-16T01:27:24.24853154-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-2y2a","depends_on_id":"hq-wisp-eiqy","type":"blocks","created_at":"2026-01-16T01:27:24.403466504-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-2y91t","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:51:56.826310571-05:00","updated_at":"2026-01-16T23:52:53.130946844-05:00","closed_at":"2026-01-16T23:52:53.130946844-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-2y91t","depends_on_id":"hq-wisp-ri9se","type":"parent-child","created_at":"2026-01-16T23:51:56.838492437-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-2zuj","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:37:49.085088058-05:00","updated_at":"2026-01-16T23:45:39.051984913-05:00","closed_at":"2026-01-16T23:45:39.051984913-05:00","close_reason":"Patrol cycle 6 complete","ephemeral":true}
{"id":"hq-wisp-3026p","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:53:25.152263127-05:00","updated_at":"2026-01-16T23:53:50.229633459-05:00","closed_at":"2026-01-16T23:53:50.229633459-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-3026p","depends_on_id":"hq-wisp-of0wi","type":"parent-child","created_at":"2026-01-16T23:53:25.502670482-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-3026p","depends_on_id":"hq-wisp-7a464","type":"blocks","created_at":"2026-01-16T23:53:28.522286076-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-31kox","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:05:32.484782835-05:00","updated_at":"2026-01-17T01:06:16.465523709-05:00","closed_at":"2026-01-17T01:06:16.465523709-05:00","close_reason":"Idle town","dependencies":[{"issue_id":"hq-wisp-31kox","depends_on_id":"hq-wisp-p8n2g","type":"parent-child","created_at":"2026-01-17T01:05:33.088480844-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-31kox","depends_on_id":"hq-wisp-w1g8e","type":"blocks","created_at":"2026-01-17T01:05:44.126422152-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-33dl","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:26:29.475980002-05:00","updated_at":"2026-01-16T01:52:13.961532573-05:00","closed_at":"2026-01-16T01:52:13.961532573-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-33dl","depends_on_id":"hq-wisp-zv2x","type":"parent-child","created_at":"2026-01-16T01:26:29.535455856-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-34kt4","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:52:50.330894285-05:00","updated_at":"2026-01-17T00:55:40.629035716-05:00","closed_at":"2026-01-17T00:55:40.629035716-05:00","close_reason":"No zombie polecats","dependencies":[{"issue_id":"hq-wisp-34kt4","depends_on_id":"hq-wisp-xo3wl","type":"parent-child","created_at":"2026-01-17T00:52:54.649549278-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-34kt4","depends_on_id":"hq-wisp-444g8","type":"blocks","created_at":"2026-01-17T00:53:05.630839357-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-35bd","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:43:15.716657061-05:00","updated_at":"2026-01-16T21:44:24.860148643-05:00","closed_at":"2026-01-16T21:44:24.860148643-05:00","close_reason":"Closed","dependencies":[{"issue_id":"hq-wisp-35bd","depends_on_id":"hq-wisp-l7vn","type":"parent-child","created_at":"2026-01-16T21:43:15.725928003-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-35bd","depends_on_id":"hq-wisp-dn75","type":"blocks","created_at":"2026-01-16T21:43:15.787462561-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-35jm","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:48:28.03200497-05:00","updated_at":"2026-01-16T22:13:02.101618425-05:00","closed_at":"2026-01-16T22:13:02.101618425-05:00","close_reason":"Orphaned - forced cleanup","dependencies":[{"issue_id":"hq-wisp-35jm","depends_on_id":"hq-wisp-mwjb","type":"parent-child","created_at":"2026-01-16T21:48:28.073937062-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-35jm","depends_on_id":"hq-wisp-fjjo","type":"blocks","created_at":"2026-01-16T21:48:28.164867318-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-3786","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:48:28.032662052-05:00","updated_at":"2026-01-16T22:13:02.091954271-05:00","closed_at":"2026-01-16T22:13:02.091954271-05:00","close_reason":"Orphaned - forced cleanup","dependencies":[{"issue_id":"hq-wisp-3786","depends_on_id":"hq-wisp-mwjb","type":"parent-child","created_at":"2026-01-16T21:48:28.082020465-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-3786","depends_on_id":"hq-wisp-r7j8","type":"blocks","created_at":"2026-01-16T21:48:28.175462008-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-37eju","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:02:22.554380321-05:00","updated_at":"2026-01-17T01:04:25.730273971-05:00","closed_at":"2026-01-17T01:04:25.730273971-05:00","close_reason":"No zombie polecats","dependencies":[{"issue_id":"hq-wisp-37eju","depends_on_id":"hq-wisp-xwv1q","type":"parent-child","created_at":"2026-01-17T01:02:27.270321415-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-37eju","depends_on_id":"hq-wisp-pz700","type":"blocks","created_at":"2026-01-17T01:02:38.776609048-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-3bz1l","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:52:58.278164926-05:00","updated_at":"2026-01-16T23:53:17.133977087-05:00","closed_at":"2026-01-16T23:53:17.133977087-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-3bz1l","depends_on_id":"hq-wisp-a5ye3","type":"parent-child","created_at":"2026-01-16T23:52:59.42167113-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-3bz1l","depends_on_id":"hq-wisp-vy7wm","type":"blocks","created_at":"2026-01-16T23:53:02.401417504-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-3bz1l","depends_on_id":"hq-wisp-1bdm2","type":"blocks","created_at":"2026-01-16T23:53:02.570572124-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-3bz1l","depends_on_id":"hq-wisp-6f29n","type":"blocks","created_at":"2026-01-16T23:53:02.738915536-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-3c9p","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:46:26.937104524-05:00","updated_at":"2026-01-16T01:47:17.051138686-05:00","closed_at":"2026-01-16T01:47:17.051138686-05:00","close_reason":"Inbox empty, no messages to process","dependencies":[{"issue_id":"hq-wisp-3c9p","depends_on_id":"hq-wisp-ybkc","type":"parent-child","created_at":"2026-01-16T01:46:26.942258518-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-3cr4","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:54:43.653070675-05:00","updated_at":"2026-01-16T01:56:30.763946593-05:00","closed_at":"2026-01-16T01:56:30.763946593-05:00","close_reason":"Orphan cleanup","dependencies":[{"issue_id":"hq-wisp-3cr4","depends_on_id":"hq-wisp-8okt","type":"parent-child","created_at":"2026-01-16T01:54:43.689703718-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-3cr4","depends_on_id":"hq-wisp-6mnt","type":"blocks","created_at":"2026-01-16T01:54:43.747572697-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-3de3b","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:47:53.49919369-05:00","updated_at":"2026-01-16T23:48:36.500196083-05:00","closed_at":"2026-01-16T23:48:36.500196083-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-3de3b","depends_on_id":"hq-wisp-wj52z","type":"parent-child","created_at":"2026-01-16T23:47:54.04245985-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-3de3b","depends_on_id":"hq-wisp-idkop","type":"blocks","created_at":"2026-01-16T23:47:56.451499074-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-3dy5","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:21:24.472256427-05:00","updated_at":"2026-01-16T23:23:37.600130442-05:00","closed_at":"2026-01-16T23:23:37.600130442-05:00","close_reason":"Standard end-of-cycle, looping","dependencies":[{"issue_id":"hq-wisp-3dy5","depends_on_id":"hq-wisp-87xr","type":"parent-child","created_at":"2026-01-16T23:21:25.810151299-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-3dy5","depends_on_id":"hq-wisp-nve0","type":"blocks","created_at":"2026-01-16T23:21:27.561257119-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-3e94u","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:27:30.734085168-05:00","updated_at":"2026-01-17T00:27:53.343657227-05:00","closed_at":"2026-01-17T00:27:53.343657227-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-3e94u","depends_on_id":"hq-wisp-72ja3","type":"parent-child","created_at":"2026-01-17T00:27:31.58794056-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-3e94u","depends_on_id":"hq-wisp-sjzmw","type":"blocks","created_at":"2026-01-17T00:27:35.345704842-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-3evq","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T22:59:22.614677444-05:00","updated_at":"2026-01-17T00:36:14.053372519-05:00","closed_at":"2026-01-17T00:36:14.053372519-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-3gss6","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:47:24.577732939-05:00","updated_at":"2026-01-17T10:47:24.57773298-05:00","dependencies":[{"issue_id":"hq-wisp-3gss6","depends_on_id":"hq-wisp-jag69","type":"parent-child","created_at":"2026-01-17T10:47:24.652641395-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-3gss6","depends_on_id":"hq-wisp-n9zhv","type":"blocks","created_at":"2026-01-17T10:47:25.21042336-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-3h08u","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T00:26:33.622129732-05:00","updated_at":"2026-01-17T00:27:05.962081315-05:00","closed_at":"2026-01-17T00:27:05.962081315-05:00","close_reason":"Patrol cycle 5 complete","ephemeral":true}
{"id":"hq-wisp-3hu7v","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:47:24.582643686-05:00","updated_at":"2026-01-17T10:47:24.582643728-05:00","dependencies":[{"issue_id":"hq-wisp-3hu7v","depends_on_id":"hq-wisp-jag69","type":"parent-child","created_at":"2026-01-17T10:47:24.898639834-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-3hu7v","depends_on_id":"hq-wisp-5vdg1","type":"blocks","created_at":"2026-01-17T10:47:25.541334792-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-3jtkw","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:07:28.965311143-05:00","updated_at":"2026-01-17T01:08:50.161347943-05:00","closed_at":"2026-01-17T01:08:50.161347943-05:00","close_reason":"No convoys","dependencies":[{"issue_id":"hq-wisp-3jtkw","depends_on_id":"hq-wisp-fnimo","type":"parent-child","created_at":"2026-01-17T01:07:31.352990697-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-3jtkw","depends_on_id":"hq-wisp-udjx9","type":"blocks","created_at":"2026-01-17T01:07:41.772703134-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-3jwx","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:36:59.345373494-05:00","updated_at":"2026-01-16T23:39:51.565597393-05:00","closed_at":"2026-01-16T23:39:51.565597393-05:00","close_reason":"Inbox empty - 0 messages","dependencies":[{"issue_id":"hq-wisp-3jwx","depends_on_id":"hq-wisp-c8tl","type":"parent-child","created_at":"2026-01-16T23:37:00.646420118-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-3jwx","depends_on_id":"hq-wisp-2jxf","type":"blocks","created_at":"2026-01-16T23:37:02.311637402-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-3mp5w","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:56:40.343475068-05:00","updated_at":"2026-01-17T00:58:31.841857266-05:00","closed_at":"2026-01-17T00:58:31.841857266-05:00","close_reason":"Context low","dependencies":[{"issue_id":"hq-wisp-3mp5w","depends_on_id":"hq-wisp-an994","type":"parent-child","created_at":"2026-01-17T00:56:49.908615685-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-3mp5w","depends_on_id":"hq-wisp-s5dac","type":"blocks","created_at":"2026-01-17T00:57:01.186555367-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-3mptm","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:24:43.30131687-05:00","updated_at":"2026-01-17T00:25:25.018765678-05:00","closed_at":"2026-01-17T00:25:25.018765678-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-3mptm","depends_on_id":"hq-wisp-5fw2b","type":"parent-child","created_at":"2026-01-17T00:24:45.833287456-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-3mptm","depends_on_id":"hq-wisp-6kykg","type":"blocks","created_at":"2026-01-17T00:24:49.795718281-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-3ngc","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:48:28.033644092-05:00","updated_at":"2026-01-16T22:13:02.076735915-05:00","closed_at":"2026-01-16T22:13:02.076735915-05:00","close_reason":"Orphaned - forced cleanup","dependencies":[{"issue_id":"hq-wisp-3ngc","depends_on_id":"hq-wisp-mwjb","type":"parent-child","created_at":"2026-01-16T21:48:28.093775402-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-3ngc","depends_on_id":"hq-wisp-1u1e","type":"blocks","created_at":"2026-01-16T21:48:28.193928892-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-3nre","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T22:23:33.635413952-05:00","updated_at":"2026-01-17T00:36:20.686447478-05:00","closed_at":"2026-01-17T00:36:20.686447478-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-3o5fd","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:28:49.929282431-05:00","updated_at":"2026-01-17T00:29:06.187828272-05:00","closed_at":"2026-01-17T00:29:06.187828272-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-3o5fd","depends_on_id":"hq-wisp-9l1zx","type":"parent-child","created_at":"2026-01-17T00:28:51.727926459-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-3o5fd","depends_on_id":"hq-wisp-juwzh","type":"blocks","created_at":"2026-01-17T00:28:56.19274047-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-3o9w","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T00:55:09.576496503-05:00","updated_at":"2026-01-16T00:55:16.276652233-05:00","closed_at":"2026-01-16T00:55:16.276652233-05:00","close_reason":"Patrol 5 complete","ephemeral":true}
{"id":"hq-wisp-3pwr","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T22:24:50.412465689-05:00","updated_at":"2026-01-17T00:36:20.041715679-05:00","closed_at":"2026-01-17T00:36:20.041715679-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-3q2bm","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:54:08.835733729-05:00","updated_at":"2026-01-16T23:54:53.220457799-05:00","closed_at":"2026-01-16T23:54:53.220457799-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-3q2bm","depends_on_id":"hq-wisp-oecdp","type":"parent-child","created_at":"2026-01-16T23:54:11.243929918-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-3q2bm","depends_on_id":"hq-wisp-b0e74","type":"blocks","created_at":"2026-01-16T23:54:14.515315151-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-3rda0","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:53:25.159675704-05:00","updated_at":"2026-01-16T23:53:48.01892291-05:00","closed_at":"2026-01-16T23:53:48.01892291-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-3rda0","depends_on_id":"hq-wisp-of0wi","type":"parent-child","created_at":"2026-01-16T23:53:27.501100653-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-3rda0","depends_on_id":"hq-wisp-9whmu","type":"blocks","created_at":"2026-01-16T23:53:30.91098028-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-3t10w","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:40:19.876653317-05:00","updated_at":"2026-01-16T23:41:27.985355398-05:00","closed_at":"2026-01-16T23:41:27.985355398-05:00","close_reason":"Pool at capacity / scan not available","dependencies":[{"issue_id":"hq-wisp-3t10w","depends_on_id":"hq-wisp-6gnpy","type":"parent-child","created_at":"2026-01-16T23:40:20.855438649-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-3t10w","depends_on_id":"hq-wisp-7lot5","type":"blocks","created_at":"2026-01-16T23:40:22.834794935-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-3tk87","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:27:30.737942162-05:00","updated_at":"2026-01-17T00:27:57.463723569-05:00","closed_at":"2026-01-17T00:27:57.463723569-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-3tk87","depends_on_id":"hq-wisp-72ja3","type":"parent-child","created_at":"2026-01-17T00:27:32.839860044-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-3tk87","depends_on_id":"hq-wisp-9ile6","type":"blocks","created_at":"2026-01-17T00:27:37.045559345-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-3tmj1","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:46:50.72186229-05:00","updated_at":"2026-01-17T10:46:50.721862332-05:00","dependencies":[{"issue_id":"hq-wisp-3tmj1","depends_on_id":"hq-wisp-2vhlh","type":"parent-child","created_at":"2026-01-17T10:46:50.783986462-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-3tmj1","depends_on_id":"hq-wisp-14ebq","type":"blocks","created_at":"2026-01-17T10:46:51.250028106-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-3unkx","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:50:53.894252226-05:00","updated_at":"2026-01-16T23:51:34.68663683-05:00","closed_at":"2026-01-16T23:51:34.68663683-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-3unkx","depends_on_id":"hq-wisp-47par","type":"parent-child","created_at":"2026-01-16T23:50:54.476244441-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-3unkx","depends_on_id":"hq-wisp-dmcr4","type":"blocks","created_at":"2026-01-16T23:50:57.022743549-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-3uuq7","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:46:10.412229168-05:00","updated_at":"2026-01-17T10:46:10.41222921-05:00","dependencies":[{"issue_id":"hq-wisp-3uuq7","depends_on_id":"hq-wisp-bio5t","type":"parent-child","created_at":"2026-01-17T10:46:10.747741389-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-3uuq7","depends_on_id":"hq-wisp-uw7gz","type":"blocks","created_at":"2026-01-17T10:46:11.174119473-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-3uzxy","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:04:43.437556195-05:00","updated_at":"2026-01-17T01:06:00.408025546-05:00","closed_at":"2026-01-17T01:06:00.408025546-05:00","close_reason":"No convoys","dependencies":[{"issue_id":"hq-wisp-3uzxy","depends_on_id":"hq-wisp-bkl5l","type":"parent-child","created_at":"2026-01-17T01:04:45.773291881-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-3uzxy","depends_on_id":"hq-wisp-au6rx","type":"blocks","created_at":"2026-01-17T01:04:56.575007388-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-3vhl0","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:02:45.688472108-05:00","updated_at":"2026-01-17T01:04:10.591135987-05:00","closed_at":"2026-01-17T01:04:10.591135987-05:00","close_reason":"Inbox empty, no callbacks","dependencies":[{"issue_id":"hq-wisp-3vhl0","depends_on_id":"hq-wisp-ji9jj","type":"parent-child","created_at":"2026-01-17T01:02:45.704642374-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-3vt2c","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:49:35.722410045-05:00","updated_at":"2026-01-16T23:50:19.665121002-05:00","closed_at":"2026-01-16T23:50:19.665121002-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-3vt2c","depends_on_id":"hq-wisp-n4f70","type":"parent-child","created_at":"2026-01-16T23:49:36.952192075-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-3vt2c","depends_on_id":"hq-wisp-nzo6r","type":"blocks","created_at":"2026-01-16T23:49:39.669034882-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-3vtxd","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:50:35.398696513-05:00","updated_at":"2026-01-16T23:51:23.912732647-05:00","closed_at":"2026-01-16T23:51:23.912732647-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-3vtxd","depends_on_id":"hq-wisp-t8b5z","type":"parent-child","created_at":"2026-01-16T23:50:36.439937722-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-3vtxd","depends_on_id":"hq-wisp-a0l5a","type":"blocks","created_at":"2026-01-16T23:50:39.175915644-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-3xb8","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:19:36.429979197-05:00","updated_at":"2026-01-16T23:20:18.776665522-05:00","closed_at":"2026-01-16T23:20:18.776665522-05:00","close_reason":"No gates/convoys/pending","dependencies":[{"issue_id":"hq-wisp-3xb8","depends_on_id":"hq-wisp-pfs9","type":"parent-child","created_at":"2026-01-16T23:19:36.512220104-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-3xb8","depends_on_id":"hq-wisp-bd21","type":"blocks","created_at":"2026-01-16T23:19:37.853673305-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-3xuzc","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:50:59.670040995-05:00","updated_at":"2026-01-16T23:52:16.157244241-05:00","closed_at":"2026-01-16T23:52:16.157244241-05:00","close_reason":"Duplicate wisps, cleaning up","ephemeral":true}
{"id":"hq-wisp-3yqg","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:54:43.647964764-05:00","updated_at":"2026-01-16T01:55:03.849081688-05:00","closed_at":"2026-01-16T01:55:03.849081688-05:00","close_reason":"Inbox empty, no callbacks to process","dependencies":[{"issue_id":"hq-wisp-3yqg","depends_on_id":"hq-wisp-8okt","type":"parent-child","created_at":"2026-01-16T01:54:43.653531591-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-3z8ul","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:54:08.83647802-05:00","updated_at":"2026-01-16T23:54:51.802825257-05:00","closed_at":"2026-01-16T23:54:51.802825257-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-3z8ul","depends_on_id":"hq-wisp-oecdp","type":"parent-child","created_at":"2026-01-16T23:54:11.405570127-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-3z8ul","depends_on_id":"hq-wisp-3q2bm","type":"blocks","created_at":"2026-01-16T23:54:14.681180273-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-40g0y","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:23:47.741402407-05:00","updated_at":"2026-01-16T23:25:43.234862979-05:00","closed_at":"2026-01-16T23:25:43.234862979-05:00","close_reason":"End-of-cycle, looping","dependencies":[{"issue_id":"hq-wisp-40g0y","depends_on_id":"hq-wisp-9we3","type":"parent-child","created_at":"2026-01-16T23:23:49.389717692-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-40g0y","depends_on_id":"hq-wisp-xphdw","type":"blocks","created_at":"2026-01-16T23:23:51.356677768-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-42fa","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:48:28.034529007-05:00","updated_at":"2026-01-16T22:13:02.060208436-05:00","closed_at":"2026-01-16T22:13:02.060208436-05:00","close_reason":"Orphaned - forced cleanup","dependencies":[{"issue_id":"hq-wisp-42fa","depends_on_id":"hq-wisp-mwjb","type":"parent-child","created_at":"2026-01-16T21:48:28.106372672-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-42fa","depends_on_id":"hq-wisp-d6yr","type":"blocks","created_at":"2026-01-16T21:48:28.211417111-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-42k93","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:52:28.536610054-05:00","updated_at":"2026-01-16T23:52:48.222440246-05:00","closed_at":"2026-01-16T23:52:48.222440246-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-42k93","depends_on_id":"hq-wisp-en6ig","type":"parent-child","created_at":"2026-01-16T23:52:30.959644549-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-42k93","depends_on_id":"hq-wisp-sosqh","type":"blocks","created_at":"2026-01-16T23:52:34.442210681-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-42vd2","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:58:39.900628831-05:00","updated_at":"2026-01-17T01:00:10.633733745-05:00","closed_at":"2026-01-17T01:00:10.633733745-05:00","close_reason":"Costs not tracked","dependencies":[{"issue_id":"hq-wisp-42vd2","depends_on_id":"hq-wisp-0nlhz","type":"parent-child","created_at":"2026-01-17T00:58:47.550870496-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-42vd2","depends_on_id":"hq-wisp-lmi73","type":"blocks","created_at":"2026-01-17T00:58:58.638672636-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-43dwi","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:40:19.874036234-05:00","updated_at":"2026-01-16T23:41:16.336734027-05:00","closed_at":"2026-01-16T23:41:16.336734027-05:00","close_reason":"Nothing pending","dependencies":[{"issue_id":"hq-wisp-43dwi","depends_on_id":"hq-wisp-6gnpy","type":"parent-child","created_at":"2026-01-16T23:40:20.270717599-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-43dwi","depends_on_id":"hq-wisp-rphq0","type":"blocks","created_at":"2026-01-16T23:40:22.04349237-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-444g8","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:52:50.330098204-05:00","updated_at":"2026-01-17T00:55:38.624997819-05:00","closed_at":"2026-01-17T00:55:38.624997819-05:00","close_reason":"All witnesses and refineries healthy","dependencies":[{"issue_id":"hq-wisp-444g8","depends_on_id":"hq-wisp-xo3wl","type":"parent-child","created_at":"2026-01-17T00:52:54.111012037-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-444g8","depends_on_id":"hq-wisp-cmkym","type":"blocks","created_at":"2026-01-17T00:53:03.98217749-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-444g8","depends_on_id":"hq-wisp-j11dp","type":"blocks","created_at":"2026-01-17T00:53:04.522540061-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-444g8","depends_on_id":"hq-wisp-ijxrz","type":"blocks","created_at":"2026-01-17T00:53:05.076013065-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-44czg","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:25:52.716179408-05:00","updated_at":"2026-01-16T23:26:42.423903047-05:00","closed_at":"2026-01-16T23:26:42.423903047-05:00","close_reason":"No activity","dependencies":[{"issue_id":"hq-wisp-44czg","depends_on_id":"hq-wisp-w4tn2","type":"parent-child","created_at":"2026-01-16T23:25:53.188478555-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-44czg","depends_on_id":"hq-wisp-y7cu5","type":"blocks","created_at":"2026-01-16T23:25:54.8855555-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-44ngw","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T00:25:48.576991715-05:00","updated_at":"2026-01-17T00:26:24.682372217-05:00","closed_at":"2026-01-17T00:26:24.682372217-05:00","close_reason":"Patrol cycle 4 complete","ephemeral":true}
{"id":"hq-wisp-458","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T00:42:52.360192192-05:00","updated_at":"2026-01-16T01:50:39.614622248-05:00","closed_at":"2026-01-16T01:50:39.614622248-05:00","close_reason":"Stale patrol wisp cleanup","ephemeral":true}
{"id":"hq-wisp-464ad","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:29:36.058354251-05:00","updated_at":"2026-01-17T00:29:49.612778828-05:00","closed_at":"2026-01-17T00:29:49.612778828-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-464ad","depends_on_id":"hq-wisp-w5z6p","type":"parent-child","created_at":"2026-01-17T00:29:36.312083065-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-464ad","depends_on_id":"hq-wisp-848n8","type":"blocks","created_at":"2026-01-17T00:29:40.644475404-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-46qvz","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:24:43.298059461-05:00","updated_at":"2026-01-17T00:25:15.876638304-05:00","closed_at":"2026-01-17T00:25:15.876638304-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-46qvz","depends_on_id":"hq-wisp-5fw2b","type":"parent-child","created_at":"2026-01-17T00:24:44.851766545-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-46qvz","depends_on_id":"hq-wisp-nek75","type":"blocks","created_at":"2026-01-17T00:24:48.796293169-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-470rc","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:12:55.88117541-05:00","updated_at":"2026-01-17T01:15:25.239471391-05:00","closed_at":"2026-01-17T01:15:25.239471391-05:00","close_reason":"No open convoys","dependencies":[{"issue_id":"hq-wisp-470rc","depends_on_id":"hq-wisp-i2n82","type":"parent-child","created_at":"2026-01-17T01:12:58.322013589-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-470rc","depends_on_id":"hq-wisp-k2tqt","type":"blocks","created_at":"2026-01-17T01:13:09.366750506-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-479m","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T22:08:46.767615034-05:00","updated_at":"2026-01-16T22:12:13.843004158-05:00","closed_at":"2026-01-16T22:12:13.843004158-05:00","close_reason":"Orphaned - bulk cleanup","ephemeral":true}
{"id":"hq-wisp-47par","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:50:53.890164021-05:00","updated_at":"2026-01-16T23:51:51.538756507-05:00","closed_at":"2026-01-16T23:51:51.538756507-05:00","close_reason":"Patrol cycle 14 complete","ephemeral":true}
{"id":"hq-wisp-4979p","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:30:39.083014997-05:00","updated_at":"2026-01-17T00:30:52.247675533-05:00","closed_at":"2026-01-17T00:30:52.247675533-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-4979p","depends_on_id":"hq-wisp-tjzfo","type":"parent-child","created_at":"2026-01-17T00:30:40.100267996-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-4979p","depends_on_id":"hq-wisp-efpag","type":"blocks","created_at":"2026-01-17T00:30:44.644686499-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-4a3w0","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:50:35.39922597-05:00","updated_at":"2026-01-16T23:51:23.716829299-05:00","closed_at":"2026-01-16T23:51:23.716829299-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-4a3w0","depends_on_id":"hq-wisp-t8b5z","type":"parent-child","created_at":"2026-01-16T23:50:36.571566964-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-4a3w0","depends_on_id":"hq-wisp-3vtxd","type":"blocks","created_at":"2026-01-16T23:50:39.307370792-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-4a7x","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:15:01.200944681-05:00","updated_at":"2026-01-16T23:19:16.241777554-05:00","closed_at":"2026-01-16T23:19:16.241777554-05:00","close_reason":"Inbox already clean","dependencies":[{"issue_id":"hq-wisp-4a7x","depends_on_id":"hq-wisp-9osz","type":"parent-child","created_at":"2026-01-16T23:15:02.310227378-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-4a7x","depends_on_id":"hq-wisp-e49p","type":"blocks","created_at":"2026-01-16T23:15:03.749497081-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-4aa7m","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:46:10.400481092-05:00","updated_at":"2026-01-17T10:46:10.400481134-05:00","dependencies":[{"issue_id":"hq-wisp-4aa7m","depends_on_id":"hq-wisp-bio5t","type":"parent-child","created_at":"2026-01-17T10:46:10.433082948-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-4aa7m","depends_on_id":"hq-wisp-bczni","type":"blocks","created_at":"2026-01-17T10:46:10.786099991-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-4ajk","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T01:30:28.309822665-05:00","updated_at":"2026-01-16T01:50:39.122617493-05:00","closed_at":"2026-01-16T01:50:39.122617493-05:00","close_reason":"Stale patrol wisp cleanup","ephemeral":true}
{"id":"hq-wisp-4ajnq","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:54:08.837661977-05:00","updated_at":"2026-01-16T23:54:42.27891525-05:00","closed_at":"2026-01-16T23:54:42.27891525-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-4ajnq","depends_on_id":"hq-wisp-oecdp","type":"parent-child","created_at":"2026-01-16T23:54:11.733648124-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-4ajnq","depends_on_id":"hq-wisp-c9f1n","type":"blocks","created_at":"2026-01-16T23:54:15.013851017-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-4ak","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T00:42:53.371207625-05:00","updated_at":"2026-01-16T01:50:39.600943138-05:00","closed_at":"2026-01-16T01:50:39.600943138-05:00","close_reason":"Stale patrol wisp cleanup","ephemeral":true}
{"id":"hq-wisp-4b4ep","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:52:58.276089345-05:00","updated_at":"2026-01-16T23:53:17.732575835-05:00","closed_at":"2026-01-16T23:53:17.732575835-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-4b4ep","depends_on_id":"hq-wisp-a5ye3","type":"parent-child","created_at":"2026-01-16T23:52:58.933767339-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-4b4ep","depends_on_id":"hq-wisp-b9h7w","type":"blocks","created_at":"2026-01-16T23:53:01.902771763-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-4b7v0","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:44:43.640881951-05:00","updated_at":"2026-01-16T23:45:27.743991052-05:00","closed_at":"2026-01-16T23:45:27.743991052-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-4b7v0","depends_on_id":"hq-wisp-bhwu0","type":"parent-child","created_at":"2026-01-16T23:44:44.635921067-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-4b7v0","depends_on_id":"hq-wisp-wo748","type":"blocks","created_at":"2026-01-16T23:44:46.820093892-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-4ciey","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:53:25.155663999-05:00","updated_at":"2026-01-16T23:53:49.339331311-05:00","closed_at":"2026-01-16T23:53:49.339331311-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-4ciey","depends_on_id":"hq-wisp-of0wi","type":"parent-child","created_at":"2026-01-16T23:53:26.329978346-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-4ciey","depends_on_id":"hq-wisp-2rrek","type":"blocks","created_at":"2026-01-16T23:53:29.371400381-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-4ciey","depends_on_id":"hq-wisp-5p6h9","type":"blocks","created_at":"2026-01-16T23:53:29.541795958-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-4ciey","depends_on_id":"hq-wisp-t9qfz","type":"blocks","created_at":"2026-01-16T23:53:29.718664905-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-4epnc","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:47:55.324542156-05:00","updated_at":"2026-01-17T10:47:55.324542156-05:00","dependencies":[{"issue_id":"hq-wisp-4epnc","depends_on_id":"hq-wisp-9hr1x","type":"parent-child","created_at":"2026-01-17T10:47:55.961381992-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-4epnc","depends_on_id":"hq-wisp-5l4c5","type":"blocks","created_at":"2026-01-17T10:47:56.783330428-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-4faw","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:53:28.906707467-05:00","updated_at":"2026-01-16T01:54:17.554454921-05:00","closed_at":"2026-01-16T01:54:17.554454921-05:00","close_reason":"Orphan cleanup","dependencies":[{"issue_id":"hq-wisp-4faw","depends_on_id":"hq-wisp-eke2","type":"parent-child","created_at":"2026-01-16T01:53:28.944473759-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-4faw","depends_on_id":"hq-wisp-s4p8","type":"blocks","created_at":"2026-01-16T01:53:28.998539825-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-4hlob","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:53:05.622880651-05:00","updated_at":"2026-01-16T23:53:53.910388836-05:00","closed_at":"2026-01-16T23:53:53.910388836-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-4hlob","depends_on_id":"hq-wisp-xtx6n","type":"parent-child","created_at":"2026-01-16T23:53:07.206756766-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-4hlob","depends_on_id":"hq-wisp-unbvr","type":"blocks","created_at":"2026-01-16T23:53:10.677366596-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-4ibhk","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:52:28.531404683-05:00","updated_at":"2026-01-16T23:52:50.093870639-05:00","closed_at":"2026-01-16T23:52:50.093870639-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-4ibhk","depends_on_id":"hq-wisp-en6ig","type":"parent-child","created_at":"2026-01-16T23:52:29.404799339-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-4ibhk","depends_on_id":"hq-wisp-g27z3","type":"blocks","created_at":"2026-01-16T23:52:32.51408476-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-4j1te","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:45:48.835272747-05:00","updated_at":"2026-01-16T23:46:28.608984535-05:00","closed_at":"2026-01-16T23:46:28.608984535-05:00","close_reason":"No open gates","dependencies":[{"issue_id":"hq-wisp-4j1te","depends_on_id":"hq-wisp-2heyl","type":"parent-child","created_at":"2026-01-16T23:45:49.094803153-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-4j1te","depends_on_id":"hq-wisp-pc777","type":"blocks","created_at":"2026-01-16T23:45:51.385358488-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-4mti","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T01:27:14.034662095-05:00","updated_at":"2026-01-16T01:50:39.269961416-05:00","closed_at":"2026-01-16T01:50:39.269961416-05:00","close_reason":"Stale patrol wisp cleanup","ephemeral":true}
{"id":"hq-wisp-4mu9s","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:58:39.891651137-05:00","updated_at":"2026-01-17T00:59:35.957022043-05:00","closed_at":"2026-01-17T00:59:35.957022043-05:00","close_reason":"No convoys","dependencies":[{"issue_id":"hq-wisp-4mu9s","depends_on_id":"hq-wisp-0nlhz","type":"parent-child","created_at":"2026-01-17T00:58:42.071094201-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-4mu9s","depends_on_id":"hq-wisp-dnyio","type":"blocks","created_at":"2026-01-17T00:58:51.945039939-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-4o2pg","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:00:26.056085693-05:00","updated_at":"2026-01-17T01:01:09.429441742-05:00","closed_at":"2026-01-17T01:01:09.429441742-05:00","close_reason":"No async gates","dependencies":[{"issue_id":"hq-wisp-4o2pg","depends_on_id":"hq-wisp-5yxyi","type":"parent-child","created_at":"2026-01-17T01:00:27.173355536-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-4o2pg","depends_on_id":"hq-wisp-ckrms","type":"blocks","created_at":"2026-01-17T01:00:37.128361787-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-4poac","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T10:48:55.010255442-05:00","updated_at":"2026-01-17T10:49:04.65841588-05:00","closed_at":"2026-01-17T10:49:04.65841588-05:00","close_reason":"Patrol 18 complete","ephemeral":true}
{"id":"hq-wisp-4pokn","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:43:06.009691975-05:00","updated_at":"2026-01-16T23:43:37.995697108-05:00","closed_at":"2026-01-16T23:43:37.995697108-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-4pokn","depends_on_id":"hq-wisp-p7g8j","type":"parent-child","created_at":"2026-01-16T23:43:06.549610557-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-4pokn","depends_on_id":"hq-wisp-cndgi","type":"blocks","created_at":"2026-01-16T23:43:08.499301163-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-4q87b","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:52:28.534283681-05:00","updated_at":"2026-01-16T23:52:49.20882182-05:00","closed_at":"2026-01-16T23:52:49.20882182-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-4q87b","depends_on_id":"hq-wisp-en6ig","type":"parent-child","created_at":"2026-01-16T23:52:30.260174925-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-4q87b","depends_on_id":"hq-wisp-go5rr","type":"blocks","created_at":"2026-01-16T23:52:33.740470684-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-4s1yl","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:31:03.247444043-05:00","updated_at":"2026-01-17T00:31:20.783220707-05:00","closed_at":"2026-01-17T00:31:20.783220707-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-4s1yl","depends_on_id":"hq-wisp-apmz9","type":"parent-child","created_at":"2026-01-17T00:31:04.773374375-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-4s1yl","depends_on_id":"hq-wisp-wvwb7","type":"blocks","created_at":"2026-01-17T00:31:09.453538606-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-4s27y","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:02:22.558478273-05:00","updated_at":"2026-01-17T01:04:26.886321249-05:00","closed_at":"2026-01-17T01:04:26.886321249-05:00","close_reason":"Cleanup formula broken, skipped","dependencies":[{"issue_id":"hq-wisp-4s27y","depends_on_id":"hq-wisp-xwv1q","type":"parent-child","created_at":"2026-01-17T01:02:30.134859842-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-4s27y","depends_on_id":"hq-wisp-mblbn","type":"blocks","created_at":"2026-01-17T01:02:41.659874155-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-4t09h","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:28:16.226463017-05:00","updated_at":"2026-01-17T00:28:39.187768359-05:00","closed_at":"2026-01-17T00:28:39.187768359-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-4t09h","depends_on_id":"hq-wisp-tbive","type":"parent-child","created_at":"2026-01-17T00:28:17.97809807-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-4t09h","depends_on_id":"hq-wisp-9n19h","type":"blocks","created_at":"2026-01-17T00:28:22.430369141-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-4usc8","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:44:41.996500171-05:00","updated_at":"2026-01-17T10:44:41.996500213-05:00","dependencies":[{"issue_id":"hq-wisp-4usc8","depends_on_id":"hq-wisp-qd1hf","type":"parent-child","created_at":"2026-01-17T10:44:42.064003208-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-4usc8","depends_on_id":"hq-wisp-utk0g","type":"blocks","created_at":"2026-01-17T10:44:42.309317113-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-4vd4u","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:46:50.724353372-05:00","updated_at":"2026-01-17T10:46:50.724353414-05:00","dependencies":[{"issue_id":"hq-wisp-4vd4u","depends_on_id":"hq-wisp-2vhlh","type":"parent-child","created_at":"2026-01-17T10:46:50.887552027-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-4vd4u","depends_on_id":"hq-wisp-1pv3y","type":"blocks","created_at":"2026-01-17T10:46:51.358042793-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-4xcz6","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:50:53.898489098-05:00","updated_at":"2026-01-16T23:51:28.616446789-05:00","closed_at":"2026-01-16T23:51:28.616446789-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-4xcz6","depends_on_id":"hq-wisp-47par","type":"parent-child","created_at":"2026-01-16T23:50:55.603886191-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-4xcz6","depends_on_id":"hq-wisp-9n87c","type":"blocks","created_at":"2026-01-16T23:50:58.466560929-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-4xp","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T00:42:58.537714159-05:00","updated_at":"2026-01-16T01:50:39.531619297-05:00","closed_at":"2026-01-16T01:50:39.531619297-05:00","close_reason":"Stale patrol wisp cleanup","ephemeral":true}
{"id":"hq-wisp-4xy3","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:24:34.633014148-05:00","updated_at":"2026-01-17T00:35:53.215915169-05:00","closed_at":"2026-01-17T00:35:53.215915169-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-4y8qo","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:58:39.895399173-05:00","updated_at":"2026-01-17T01:00:04.186748151-05:00","closed_at":"2026-01-17T01:00:04.186748151-05:00","close_reason":"No plugins","dependencies":[{"issue_id":"hq-wisp-4y8qo","depends_on_id":"hq-wisp-0nlhz","type":"parent-child","created_at":"2026-01-17T00:58:44.814195697-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-4y8qo","depends_on_id":"hq-wisp-dmpqg","type":"blocks","created_at":"2026-01-17T00:58:55.845181674-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-4z1dm","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:58:39.892389136-05:00","updated_at":"2026-01-17T00:59:45.138520443-05:00","closed_at":"2026-01-17T00:59:45.138520443-05:00","close_reason":"No external deps","dependencies":[{"issue_id":"hq-wisp-4z1dm","depends_on_id":"hq-wisp-0nlhz","type":"parent-child","created_at":"2026-01-17T00:58:42.621849863-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-4z1dm","depends_on_id":"hq-wisp-4mu9s","type":"blocks","created_at":"2026-01-17T00:58:52.488779655-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-50byl","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:08:16.848333888-05:00","updated_at":"2026-01-17T01:10:23.159901617-05:00","closed_at":"2026-01-17T01:10:23.159901617-05:00","close_reason":"Final patrol","dependencies":[{"issue_id":"hq-wisp-50byl","depends_on_id":"hq-wisp-vrsc5","type":"parent-child","created_at":"2026-01-17T01:08:20.489812604-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-50byl","depends_on_id":"hq-wisp-q79jk","type":"blocks","created_at":"2026-01-17T01:08:31.399511191-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-50z8q","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:03:11.645127781-05:00","updated_at":"2026-01-17T01:04:33.329900145-05:00","closed_at":"2026-01-17T01:04:33.329900145-05:00","close_reason":"Logs rotated","dependencies":[{"issue_id":"hq-wisp-50z8q","depends_on_id":"hq-wisp-zx2sm","type":"parent-child","created_at":"2026-01-17T01:03:20.630391432-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-50z8q","depends_on_id":"hq-wisp-065k4","type":"blocks","created_at":"2026-01-17T01:03:32.797038422-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-51c34","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:09:41.606798269-05:00","updated_at":"2026-01-17T01:10:34.723272415-05:00","closed_at":"2026-01-17T01:10:34.723272415-05:00","close_reason":"No gate-ready","dependencies":[{"issue_id":"hq-wisp-51c34","depends_on_id":"hq-wisp-fsms9","type":"parent-child","created_at":"2026-01-17T01:09:43.41376748-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-51c34","depends_on_id":"hq-wisp-v1feq","type":"blocks","created_at":"2026-01-17T01:09:54.332494204-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-51y9d","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:24:43.292880474-05:00","updated_at":"2026-01-17T00:25:01.09287615-05:00","closed_at":"2026-01-17T00:25:01.09287615-05:00","close_reason":"Town idle/healthy","dependencies":[{"issue_id":"hq-wisp-51y9d","depends_on_id":"hq-wisp-5fw2b","type":"parent-child","created_at":"2026-01-17T00:24:43.305270402-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-53of7","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:47:08.959428545-05:00","updated_at":"2026-01-17T00:35:33.407189361-05:00","closed_at":"2026-01-17T00:35:33.407189361-05:00","close_reason":"Cleanup","ephemeral":true}
{"id":"hq-wisp-53zc6","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:52:28.537226762-05:00","updated_at":"2026-01-16T23:52:47.945184834-05:00","closed_at":"2026-01-16T23:52:47.945184834-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-53zc6","depends_on_id":"hq-wisp-en6ig","type":"parent-child","created_at":"2026-01-16T23:52:31.134762664-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-53zc6","depends_on_id":"hq-wisp-42k93","type":"blocks","created_at":"2026-01-16T23:52:34.617857211-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-54ol","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:46:26.938530189-05:00","updated_at":"2026-01-16T01:50:29.305727104-05:00","closed_at":"2026-01-16T01:50:29.305727104-05:00","close_reason":"No work found","dependencies":[{"issue_id":"hq-wisp-54ol","depends_on_id":"hq-wisp-ybkc","type":"parent-child","created_at":"2026-01-16T01:46:26.994441462-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-54ol","depends_on_id":"hq-wisp-wtvw","type":"blocks","created_at":"2026-01-16T01:46:27.190090458-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-55yh5","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:24:43.295535342-05:00","updated_at":"2026-01-17T00:25:09.049933941-05:00","closed_at":"2026-01-17T00:25:09.049933941-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-55yh5","depends_on_id":"hq-wisp-5fw2b","type":"parent-child","created_at":"2026-01-17T00:24:44.079007826-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-55yh5","depends_on_id":"hq-wisp-51y9d","type":"blocks","created_at":"2026-01-17T00:24:47.599878981-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-57yq","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:05:01.100087637-05:00","updated_at":"2026-01-16T22:12:49.665041367-05:00","closed_at":"2026-01-16T22:12:49.665041367-05:00","close_reason":"Orphaned wisp step - cleanup","dependencies":[{"issue_id":"hq-wisp-57yq","depends_on_id":"hq-wisp-xrtb","type":"parent-child","created_at":"2026-01-16T22:05:01.106094129-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-59sc7","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:52:28.538925552-05:00","updated_at":"2026-01-16T23:52:47.233528965-05:00","closed_at":"2026-01-16T23:52:47.233528965-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-59sc7","depends_on_id":"hq-wisp-en6ig","type":"parent-child","created_at":"2026-01-16T23:52:31.649520348-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-59sc7","depends_on_id":"hq-wisp-wxwl0","type":"blocks","created_at":"2026-01-16T23:52:35.147506967-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-5af7","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:56:35.923718974-05:00","updated_at":"2026-01-16T22:13:02.162039849-05:00","closed_at":"2026-01-16T22:13:02.162039849-05:00","close_reason":"Orphaned - forced cleanup","dependencies":[{"issue_id":"hq-wisp-5af7","depends_on_id":"hq-wisp-8d7d","type":"parent-child","created_at":"2026-01-16T01:56:35.962524265-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-5af7","depends_on_id":"hq-wisp-uet7","type":"blocks","created_at":"2026-01-16T01:56:36.022372659-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-5bcy","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:43:15.721269261-05:00","updated_at":"2026-01-16T22:13:02.133283052-05:00","closed_at":"2026-01-16T22:13:02.133283052-05:00","close_reason":"Orphaned - forced cleanup","dependencies":[{"issue_id":"hq-wisp-5bcy","depends_on_id":"hq-wisp-l7vn","type":"parent-child","created_at":"2026-01-16T21:43:15.780586781-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-5bcy","depends_on_id":"hq-wisp-1cxa","type":"blocks","created_at":"2026-01-16T21:43:15.860322098-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-5bv5","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:05:13.834071345-05:00","updated_at":"2026-01-16T23:14:43.05811329-05:00","closed_at":"2026-01-16T23:14:43.05811329-05:00","close_reason":"Duplicate patrol wisp, cleaned up","ephemeral":true}
{"id":"hq-wisp-5dm7","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:37:49.090979057-05:00","updated_at":"2026-01-16T23:40:38.039681722-05:00","closed_at":"2026-01-16T23:40:38.039681722-05:00","close_reason":"No plugins registered","dependencies":[{"issue_id":"hq-wisp-5dm7","depends_on_id":"hq-wisp-2zuj","type":"parent-child","created_at":"2026-01-16T23:37:49.899416369-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-5dm7","depends_on_id":"hq-wisp-fu5t","type":"blocks","created_at":"2026-01-16T23:37:51.709091509-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-5dspi","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:12:55.887844233-05:00","updated_at":"2026-01-17T01:59:49.612173733-05:00","closed_at":"2026-01-17T01:59:49.612173733-05:00","close_reason":"No abandoned work detected","dependencies":[{"issue_id":"hq-wisp-5dspi","depends_on_id":"hq-wisp-i2n82","type":"parent-child","created_at":"2026-01-17T01:13:03.205907193-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-5dspi","depends_on_id":"hq-wisp-2aysb","type":"blocks","created_at":"2026-01-17T01:13:15.538975009-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-5ers","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T22:15:05.659511127-05:00","updated_at":"2026-01-17T00:36:34.524123475-05:00","closed_at":"2026-01-17T00:36:34.524123475-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-5fw2b","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T00:24:43.290914354-05:00","updated_at":"2026-01-17T00:25:30.53340551-05:00","closed_at":"2026-01-17T00:25:30.53340551-05:00","close_reason":"Patrol cycle 3 complete","ephemeral":true}
{"id":"hq-wisp-5g2fe","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:09:41.615541131-05:00","updated_at":"2026-01-17T01:10:54.596008526-05:00","closed_at":"2026-01-17T01:10:54.596008526-05:00","close_reason":"No cleanup","dependencies":[{"issue_id":"hq-wisp-5g2fe","depends_on_id":"hq-wisp-fsms9","type":"parent-child","created_at":"2026-01-17T01:09:49.500163359-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-5g2fe","depends_on_id":"hq-wisp-2xbe8","type":"blocks","created_at":"2026-01-17T01:10:01.943678903-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-5hbw","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:27:24.234972846-05:00","updated_at":"2026-01-16T01:52:13.860856391-05:00","closed_at":"2026-01-16T01:52:13.860856391-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-5hbw","depends_on_id":"hq-wisp-nv4o","type":"parent-child","created_at":"2026-01-16T01:27:24.265573648-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-5hbw","depends_on_id":"hq-wisp-7vx1","type":"blocks","created_at":"2026-01-16T01:27:24.420457486-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-5ko7g","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:02:45.69958559-05:00","updated_at":"2026-01-17T01:05:25.469593409-05:00","closed_at":"2026-01-17T01:05:25.469593409-05:00","close_reason":"Idle town patrol","dependencies":[{"issue_id":"hq-wisp-5ko7g","depends_on_id":"hq-wisp-ji9jj","type":"parent-child","created_at":"2026-01-17T01:02:53.306640862-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-5ko7g","depends_on_id":"hq-wisp-levrr","type":"blocks","created_at":"2026-01-17T01:03:05.11481711-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-5kqp","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T22:45:31.012622346-05:00","updated_at":"2026-01-17T00:36:16.848637676-05:00","closed_at":"2026-01-17T00:36:16.848637676-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-5l4c5","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:47:55.32363474-05:00","updated_at":"2026-01-17T10:47:55.323634782-05:00","dependencies":[{"issue_id":"hq-wisp-5l4c5","depends_on_id":"hq-wisp-9hr1x","type":"parent-child","created_at":"2026-01-17T10:47:55.924268972-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-5l4c5","depends_on_id":"hq-wisp-k5vy5","type":"blocks","created_at":"2026-01-17T10:47:56.740169036-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-5ll0l","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:49:57.528008903-05:00","updated_at":"2026-01-17T10:49:57.528008945-05:00","dependencies":[{"issue_id":"hq-wisp-5ll0l","depends_on_id":"hq-wisp-8agmn","type":"parent-child","created_at":"2026-01-17T10:49:58.177592107-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-5ll0l","depends_on_id":"hq-wisp-x4xrk","type":"blocks","created_at":"2026-01-17T10:49:58.980776678-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-5m63","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:19:36.430410031-05:00","updated_at":"2026-01-16T23:20:18.535578303-05:00","closed_at":"2026-01-16T23:20:18.535578303-05:00","close_reason":"No gates/convoys/pending","dependencies":[{"issue_id":"hq-wisp-5m63","depends_on_id":"hq-wisp-pfs9","type":"parent-child","created_at":"2026-01-16T23:19:36.592380343-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-5m63","depends_on_id":"hq-wisp-bd21","type":"blocks","created_at":"2026-01-16T23:19:37.927789546-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-5maux","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T00:35:15.986333718-05:00","updated_at":"2026-01-17T00:35:47.111506105-05:00","closed_at":"2026-01-17T00:35:47.111506105-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-5mtp","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:23:47.736083408-05:00","updated_at":"2026-01-16T23:25:01.462111472-05:00","closed_at":"2026-01-16T23:25:01.462111472-05:00","close_reason":"No zombies, dogs present","dependencies":[{"issue_id":"hq-wisp-5mtp","depends_on_id":"hq-wisp-9we3","type":"parent-child","created_at":"2026-01-16T23:23:48.695331241-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-5mtp","depends_on_id":"hq-wisp-u8f3","type":"blocks","created_at":"2026-01-16T23:23:50.650599443-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-5nkl1","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:54:01.727651072-05:00","updated_at":"2026-01-17T00:35:29.636569747-05:00","closed_at":"2026-01-17T00:35:29.636569747-05:00","close_reason":"Cleanup","ephemeral":true}
{"id":"hq-wisp-5nno","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:05:01.103310841-05:00","updated_at":"2026-01-16T22:13:02.012767996-05:00","closed_at":"2026-01-16T22:13:02.012767996-05:00","close_reason":"Orphaned - forced cleanup","dependencies":[{"issue_id":"hq-wisp-5nno","depends_on_id":"hq-wisp-xrtb","type":"parent-child","created_at":"2026-01-16T22:05:01.184621238-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-5nno","depends_on_id":"hq-wisp-t0jg","type":"blocks","created_at":"2026-01-16T22:05:01.348358906-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-5ondi","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:43:00.95935282-05:00","updated_at":"2026-01-17T00:51:42.865030698-05:00","closed_at":"2026-01-17T00:51:42.865030698-05:00","close_reason":"No plugins to execute","dependencies":[{"issue_id":"hq-wisp-5ondi","depends_on_id":"hq-wisp-jgnad","type":"parent-child","created_at":"2026-01-17T00:43:05.230449206-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-5ondi","depends_on_id":"hq-wisp-7vb7g","type":"blocks","created_at":"2026-01-17T00:43:14.775040269-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-5ot2b","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T10:47:55.318014202-05:00","updated_at":"2026-01-17T10:53:39.03830836-05:00","closed_at":"2026-01-17T10:53:39.03830836-05:00","close_reason":"No notifications to fire","dependencies":[{"issue_id":"hq-wisp-5ot2b","depends_on_id":"hq-wisp-9hr1x","type":"parent-child","created_at":"2026-01-17T10:47:55.547826651-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-5ot2b","depends_on_id":"hq-wisp-i83fr","type":"blocks","created_at":"2026-01-17T10:47:56.236135498-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-5p6h9","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:53:25.152858835-05:00","updated_at":"2026-01-16T23:53:50.028731155-05:00","closed_at":"2026-01-16T23:53:50.028731155-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-5p6h9","depends_on_id":"hq-wisp-of0wi","type":"parent-child","created_at":"2026-01-16T23:53:25.669067812-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-5p6h9","depends_on_id":"hq-wisp-3026p","type":"blocks","created_at":"2026-01-16T23:53:28.692491236-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-5qgho","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:43:00.961893733-05:00","updated_at":"2026-01-17T00:51:43.722143127-05:00","closed_at":"2026-01-17T00:51:43.722143127-05:00","close_reason":"No abandoned work detected","dependencies":[{"issue_id":"hq-wisp-5qgho","depends_on_id":"hq-wisp-jgnad","type":"parent-child","created_at":"2026-01-17T00:43:06.651136562-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-5qgho","depends_on_id":"hq-wisp-xtmg9","type":"blocks","created_at":"2026-01-17T00:43:16.211645684-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-5rro","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-16T01:44:35.522924322-05:00","updated_at":"2026-01-16T01:52:13.467948944-05:00","closed_at":"2026-01-16T01:52:13.467948944-05:00","close_reason":"Orphaned wisp cleanup","ephemeral":true}
{"id":"hq-wisp-5sng","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:21:21.160171347-05:00","updated_at":"2026-01-17T00:35:55.51496259-05:00","closed_at":"2026-01-17T00:35:55.51496259-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-5tfhu","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:07:28.967783056-05:00","updated_at":"2026-01-17T01:09:02.889310309-05:00","closed_at":"2026-01-17T01:09:02.889310309-05:00","close_reason":"All healthy","dependencies":[{"issue_id":"hq-wisp-5tfhu","depends_on_id":"hq-wisp-fnimo","type":"parent-child","created_at":"2026-01-17T01:07:33.112872983-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-5tfhu","depends_on_id":"hq-wisp-ck4hy","type":"blocks","created_at":"2026-01-17T01:07:43.517364403-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-5tfhu","depends_on_id":"hq-wisp-a2l31","type":"blocks","created_at":"2026-01-17T01:07:44.120857833-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-5tfhu","depends_on_id":"hq-wisp-amjfv","type":"blocks","created_at":"2026-01-17T01:07:44.722969682-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-5vdg1","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:47:24.580924562-05:00","updated_at":"2026-01-17T10:47:24.580924562-05:00","dependencies":[{"issue_id":"hq-wisp-5vdg1","depends_on_id":"hq-wisp-jag69","type":"parent-child","created_at":"2026-01-17T10:47:24.807063346-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-5vdg1","depends_on_id":"hq-wisp-t9cop","type":"blocks","created_at":"2026-01-17T10:47:25.371303724-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-5vdg1","depends_on_id":"hq-wisp-1nlm3","type":"blocks","created_at":"2026-01-17T10:47:25.40459608-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-5vdg1","depends_on_id":"hq-wisp-sa7wu","type":"blocks","created_at":"2026-01-17T10:47:25.438315185-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-5ve4l","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T10:47:23.2901924-05:00","updated_at":"2026-01-17T10:47:34.359100715-05:00","closed_at":"2026-01-17T10:47:34.359100715-05:00","close_reason":"Patrol 12 complete","ephemeral":true}
{"id":"hq-wisp-5veb","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:43:15.71874939-05:00","updated_at":"2026-01-16T22:12:49.696003411-05:00","closed_at":"2026-01-16T22:12:49.696003411-05:00","close_reason":"Orphaned wisp step - cleanup","dependencies":[{"issue_id":"hq-wisp-5veb","depends_on_id":"hq-wisp-l7vn","type":"parent-child","created_at":"2026-01-16T21:43:15.750335585-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-5veb","depends_on_id":"hq-wisp-up3n","type":"blocks","created_at":"2026-01-16T21:43:15.820415961-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-5vpe","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:27:24.238281759-05:00","updated_at":"2026-01-16T01:52:13.755594881-05:00","closed_at":"2026-01-16T01:52:13.755594881-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-5vpe","depends_on_id":"hq-wisp-nv4o","type":"parent-child","created_at":"2026-01-16T01:27:24.350835476-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-5w03x","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:44:42.00434135-05:00","updated_at":"2026-01-17T10:44:42.004341392-05:00","dependencies":[{"issue_id":"hq-wisp-5w03x","depends_on_id":"hq-wisp-qd1hf","type":"parent-child","created_at":"2026-01-17T10:44:42.212222147-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-5w03x","depends_on_id":"hq-wisp-rc1q8","type":"blocks","created_at":"2026-01-17T10:44:42.518673529-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-5w8m","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:19:36.433267947-05:00","updated_at":"2026-01-16T23:20:50.998881046-05:00","closed_at":"2026-01-16T23:20:50.998881046-05:00","close_reason":"No plugins, no stuck dogs","dependencies":[{"issue_id":"hq-wisp-5w8m","depends_on_id":"hq-wisp-pfs9","type":"parent-child","created_at":"2026-01-16T23:19:37.10544886-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-5w8m","depends_on_id":"hq-wisp-x0a7","type":"blocks","created_at":"2026-01-16T23:19:38.598654543-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-5wda2","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:58:33.756262803-05:00","updated_at":"2026-01-17T00:35:09.50411053-05:00","closed_at":"2026-01-17T00:35:09.50411053-05:00","close_reason":"Cleanup","ephemeral":true}
{"id":"hq-wisp-5y1vf","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T10:47:53.70098369-05:00","updated_at":"2026-01-17T10:48:06.679479346-05:00","closed_at":"2026-01-17T10:48:06.679479346-05:00","close_reason":"Patrol 14 complete","ephemeral":true}
{"id":"hq-wisp-5ygsv","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:49:59.359996831-05:00","updated_at":"2026-01-17T10:49:59.359996873-05:00","dependencies":[{"issue_id":"hq-wisp-5ygsv","depends_on_id":"hq-wisp-wxw0u","type":"parent-child","created_at":"2026-01-17T10:49:59.85544575-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-5ygsv","depends_on_id":"hq-wisp-8yoid","type":"blocks","created_at":"2026-01-17T10:50:00.777243169-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-5yxyi","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T01:00:26.052449574-05:00","updated_at":"2026-01-17T01:03:10.566102104-05:00","closed_at":"2026-01-17T01:03:10.566102104-05:00","close_reason":"Patrol 16 complete","ephemeral":true}
{"id":"hq-wisp-5z6z9","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T02:00:44.575070853-05:00","updated_at":"2026-01-17T02:01:55.150764922-05:00","closed_at":"2026-01-17T02:01:55.150764922-05:00","close_reason":"Idle patrol","dependencies":[{"issue_id":"hq-wisp-5z6z9","depends_on_id":"hq-wisp-9a1wp","type":"parent-child","created_at":"2026-01-17T02:00:53.281658616-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-5z6z9","depends_on_id":"hq-wisp-xa7pf","type":"blocks","created_at":"2026-01-17T02:01:06.005617691-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-61wp1","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T10:47:55.320258117-05:00","updated_at":"2026-01-17T10:54:45.074736858-05:00","closed_at":"2026-01-17T10:54:45.074736858-05:00","close_reason":"Town idle, dog pool healthy (8 idle), no polecats","dependencies":[{"issue_id":"hq-wisp-61wp1","depends_on_id":"hq-wisp-9hr1x","type":"parent-child","created_at":"2026-01-17T10:47:55.69725723-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-61wp1","depends_on_id":"hq-wisp-vwkwi","type":"blocks","created_at":"2026-01-17T10:47:56.482804479-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-65g1","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:15:01.197318141-05:00","updated_at":"2026-01-16T23:18:27.567702514-05:00","closed_at":"2026-01-16T23:18:27.567702514-05:00","close_reason":"Town idle, skip health nudges","dependencies":[{"issue_id":"hq-wisp-65g1","depends_on_id":"hq-wisp-9osz","type":"parent-child","created_at":"2026-01-16T23:15:01.684996317-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-65g1","depends_on_id":"hq-wisp-u9fu","type":"blocks","created_at":"2026-01-16T23:15:02.947146937-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-65g1","depends_on_id":"hq-wisp-igu9","type":"blocks","created_at":"2026-01-16T23:15:03.017703545-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-65g1","depends_on_id":"hq-wisp-8yiq","type":"blocks","created_at":"2026-01-16T23:15:03.088776737-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-67aiw","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:50:35.396393435-05:00","updated_at":"2026-01-16T23:51:24.663674647-05:00","closed_at":"2026-01-16T23:51:24.663674647-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-67aiw","depends_on_id":"hq-wisp-t8b5z","type":"parent-child","created_at":"2026-01-16T23:50:35.914776086-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-67aiw","depends_on_id":"hq-wisp-sbhw2","type":"blocks","created_at":"2026-01-16T23:50:38.379212012-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-67k6z","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:30:39.08511641-05:00","updated_at":"2026-01-17T00:30:55.075971759-05:00","closed_at":"2026-01-17T00:30:55.075971759-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-67k6z","depends_on_id":"hq-wisp-tjzfo","type":"parent-child","created_at":"2026-01-17T00:30:40.610256577-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-67k6z","depends_on_id":"hq-wisp-my4kk","type":"blocks","created_at":"2026-01-17T00:30:45.150853377-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-67o60","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:03:11.643528284-05:00","updated_at":"2026-01-17T01:04:23.710090209-05:00","closed_at":"2026-01-17T01:04:23.710090209-05:00","close_reason":"No cleanup","dependencies":[{"issue_id":"hq-wisp-67o60","depends_on_id":"hq-wisp-zx2sm","type":"parent-child","created_at":"2026-01-17T01:03:19.414463246-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-67o60","depends_on_id":"hq-wisp-e5j9p","type":"blocks","created_at":"2026-01-17T01:03:31.544557044-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-68c8","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:42:27.172253923-05:00","updated_at":"2026-01-16T01:52:13.666803228-05:00","closed_at":"2026-01-16T01:52:13.666803228-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-68c8","depends_on_id":"hq-wisp-wqti","type":"parent-child","created_at":"2026-01-16T01:42:27.189770737-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-68c8","depends_on_id":"hq-wisp-7xkx","type":"blocks","created_at":"2026-01-16T01:42:27.404096837-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-69i1c","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:40:19.873109984-05:00","updated_at":"2026-01-16T23:41:16.452234054-05:00","closed_at":"2026-01-16T23:41:16.452234054-05:00","close_reason":"Nothing pending","dependencies":[{"issue_id":"hq-wisp-69i1c","depends_on_id":"hq-wisp-6gnpy","type":"parent-child","created_at":"2026-01-16T23:40:20.076093624-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-69i1c","depends_on_id":"hq-wisp-rphq0","type":"blocks","created_at":"2026-01-16T23:40:21.841845605-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-69zre","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:23:02.709321125-05:00","updated_at":"2026-01-17T00:24:26.076237533-05:00","closed_at":"2026-01-17T00:24:26.076237533-05:00","close_reason":"Cycle complete","dependencies":[{"issue_id":"hq-wisp-69zre","depends_on_id":"hq-wisp-93kdl","type":"parent-child","created_at":"2026-01-17T00:23:05.366404237-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-69zre","depends_on_id":"hq-wisp-ekaom","type":"blocks","created_at":"2026-01-17T00:23:09.308406761-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-6avr","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:48:28.02820706-05:00","updated_at":"2026-01-16T22:12:53.931496136-05:00","closed_at":"2026-01-16T22:12:53.931496136-05:00","close_reason":"Orphaned wisp step - cleanup","dependencies":[{"issue_id":"hq-wisp-6avr","depends_on_id":"hq-wisp-mwjb","type":"parent-child","created_at":"2026-01-16T21:48:28.040028456-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-6avr","depends_on_id":"hq-wisp-npo8","type":"blocks","created_at":"2026-01-16T21:48:28.115502697-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-6bf7i","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:52:50.331704617-05:00","updated_at":"2026-01-17T00:56:03.267577054-05:00","closed_at":"2026-01-17T00:56:03.267577054-05:00","close_reason":"No plugins to execute","dependencies":[{"issue_id":"hq-wisp-6bf7i","depends_on_id":"hq-wisp-xo3wl","type":"parent-child","created_at":"2026-01-17T00:52:55.188850059-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-6bf7i","depends_on_id":"hq-wisp-34kt4","type":"blocks","created_at":"2026-01-17T00:53:06.182369531-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-6biiw","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:25:52.722834366-05:00","updated_at":"2026-01-16T23:27:57.2659358-05:00","closed_at":"2026-01-16T23:27:57.2659358-05:00","close_reason":"End-of-patrol, handoff","dependencies":[{"issue_id":"hq-wisp-6biiw","depends_on_id":"hq-wisp-w4tn2","type":"parent-child","created_at":"2026-01-16T23:25:54.313732033-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-6biiw","depends_on_id":"hq-wisp-8117d","type":"blocks","created_at":"2026-01-16T23:25:56.231390825-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-6cqlz","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T00:31:27.062350414-05:00","updated_at":"2026-01-17T00:34:59.108714284-05:00","closed_at":"2026-01-17T00:34:59.108714284-05:00","close_reason":"Cleanup","ephemeral":true}
{"id":"hq-wisp-6csym","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:00:26.066322927-05:00","updated_at":"2026-01-17T01:02:05.205396385-05:00","closed_at":"2026-01-17T01:02:05.205396385-05:00","close_reason":"Logs rotated","dependencies":[{"issue_id":"hq-wisp-6csym","depends_on_id":"hq-wisp-5yxyi","type":"parent-child","created_at":"2026-01-17T01:00:34.347038388-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-6csym","depends_on_id":"hq-wisp-s571g","type":"blocks","created_at":"2026-01-17T01:00:45.474858518-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-6dz9","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:36:59.339449787-05:00","updated_at":"2026-01-16T23:38:04.333240577-05:00","closed_at":"2026-01-16T23:38:04.333240577-05:00","close_reason":"Nothing to dispatch/resolve","dependencies":[{"issue_id":"hq-wisp-6dz9","depends_on_id":"hq-wisp-c8tl","type":"parent-child","created_at":"2026-01-16T23:36:59.58888588-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-6dz9","depends_on_id":"hq-wisp-wmnh","type":"blocks","created_at":"2026-01-16T23:37:01.058685231-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-6erjz","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:27:30.734751542-05:00","updated_at":"2026-01-17T00:27:54.759324724-05:00","closed_at":"2026-01-17T00:27:54.759324724-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-6erjz","depends_on_id":"hq-wisp-72ja3","type":"parent-child","created_at":"2026-01-17T00:27:31.796859716-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-6erjz","depends_on_id":"hq-wisp-3e94u","type":"blocks","created_at":"2026-01-17T00:27:35.557235328-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-6f29n","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:52:58.277293135-05:00","updated_at":"2026-01-16T23:53:17.303095582-05:00","closed_at":"2026-01-16T23:53:17.303095582-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-6f29n","depends_on_id":"hq-wisp-a5ye3","type":"parent-child","created_at":"2026-01-16T23:52:59.257970672-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-6f29n","depends_on_id":"hq-wisp-ec1p8","type":"blocks","created_at":"2026-01-16T23:53:02.23515984-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-6gnpy","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:40:19.870038151-05:00","updated_at":"2026-01-16T23:41:43.734285031-05:00","closed_at":"2026-01-16T23:41:43.734285031-05:00","close_reason":"Patrol cycle 6 complete","ephemeral":true}
{"id":"hq-wisp-6h08g","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:04:43.440877815-05:00","updated_at":"2026-01-17T01:06:13.928866365-05:00","closed_at":"2026-01-17T01:06:13.928866365-05:00","close_reason":"No zombies","dependencies":[{"issue_id":"hq-wisp-6h08g","depends_on_id":"hq-wisp-bkl5l","type":"parent-child","created_at":"2026-01-17T01:04:48.10808961-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-6h08g","depends_on_id":"hq-wisp-ir19j","type":"blocks","created_at":"2026-01-17T01:05:00.151930219-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-6hkl","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:43:15.718169808-05:00","updated_at":"2026-01-16T21:47:50.983160121-05:00","closed_at":"2026-01-16T21:47:50.983160121-05:00","close_reason":"Closed","dependencies":[{"issue_id":"hq-wisp-6hkl","depends_on_id":"hq-wisp-l7vn","type":"parent-child","created_at":"2026-01-16T21:43:15.743078681-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-6hkl","depends_on_id":"hq-wisp-l814","type":"blocks","created_at":"2026-01-16T21:43:15.804930571-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-6iifz","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:40:19.8792699-05:00","updated_at":"2026-01-16T23:41:34.670507618-05:00","closed_at":"2026-01-16T23:41:34.670507618-05:00","close_reason":"Routine checks passed","dependencies":[{"issue_id":"hq-wisp-6iifz","depends_on_id":"hq-wisp-6gnpy","type":"parent-child","created_at":"2026-01-16T23:40:21.445567573-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-6iifz","depends_on_id":"hq-wisp-a68it","type":"blocks","created_at":"2026-01-16T23:40:23.44285694-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-6jasf","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:49:59.355842084-05:00","updated_at":"2026-01-17T10:49:59.355842126-05:00","dependencies":[{"issue_id":"hq-wisp-6jasf","depends_on_id":"hq-wisp-wxw0u","type":"parent-child","created_at":"2026-01-17T10:49:59.543843974-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-6jasf","depends_on_id":"hq-wisp-bnofj","type":"blocks","created_at":"2026-01-17T10:50:00.343709381-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-6jvqp","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:56:40.335474039-05:00","updated_at":"2026-01-17T00:57:56.687836053-05:00","closed_at":"2026-01-17T00:57:56.687836053-05:00","close_reason":"All healthy","dependencies":[{"issue_id":"hq-wisp-6jvqp","depends_on_id":"hq-wisp-an994","type":"parent-child","created_at":"2026-01-17T00:56:44.165224354-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-6jvqp","depends_on_id":"hq-wisp-sjfjx","type":"blocks","created_at":"2026-01-17T00:56:54.441606772-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-6jvqp","depends_on_id":"hq-wisp-08auo","type":"blocks","created_at":"2026-01-17T00:56:55.030668495-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-6jvqp","depends_on_id":"hq-wisp-vxp6z","type":"blocks","created_at":"2026-01-17T00:56:55.589132186-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-6jzva","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:42:43.178357507-05:00","updated_at":"2026-01-17T00:35:37.786791705-05:00","closed_at":"2026-01-17T00:35:37.786791705-05:00","close_reason":"Cleanup","ephemeral":true}
{"id":"hq-wisp-6kykg","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:24:43.300655205-05:00","updated_at":"2026-01-17T00:25:16.675314762-05:00","closed_at":"2026-01-17T00:25:16.675314762-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-6kykg","depends_on_id":"hq-wisp-5fw2b","type":"parent-child","created_at":"2026-01-17T00:24:45.636969024-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-6kykg","depends_on_id":"hq-wisp-dv5cx","type":"blocks","created_at":"2026-01-17T00:24:49.595157793-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-6mnt","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:54:43.652821883-05:00","updated_at":"2026-01-16T01:56:30.76731584-05:00","closed_at":"2026-01-16T01:56:30.76731584-05:00","close_reason":"Orphan cleanup","dependencies":[{"issue_id":"hq-wisp-6mnt","depends_on_id":"hq-wisp-8okt","type":"parent-child","created_at":"2026-01-16T01:54:43.687773012-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-6mnt","depends_on_id":"hq-wisp-o5jr","type":"blocks","created_at":"2026-01-16T01:54:43.744297367-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-6my2t","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:08:16.85010226-05:00","updated_at":"2026-01-17T01:10:42.053308346-05:00","closed_at":"2026-01-17T01:10:42.053308346-05:00","close_reason":"Final patrol","dependencies":[{"issue_id":"hq-wisp-6my2t","depends_on_id":"hq-wisp-vrsc5","type":"parent-child","created_at":"2026-01-17T01:08:21.702297747-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-6my2t","depends_on_id":"hq-wisp-omz23","type":"blocks","created_at":"2026-01-17T01:08:33.840252286-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-6o2o","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T21:59:12.236297552-05:00","updated_at":"2026-01-16T22:12:18.935484417-05:00","closed_at":"2026-01-16T22:12:18.935484417-05:00","close_reason":"Orphaned - bulk cleanup","ephemeral":true}
{"id":"hq-wisp-6oed3","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:50:53.896925141-05:00","updated_at":"2026-01-16T23:51:31.287763217-05:00","closed_at":"2026-01-16T23:51:31.287763217-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-6oed3","depends_on_id":"hq-wisp-47par","type":"parent-child","created_at":"2026-01-16T23:50:55.180510187-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-6oed3","depends_on_id":"hq-wisp-wrste","type":"blocks","created_at":"2026-01-16T23:50:58.032643307-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-6oonj","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:44:41.999011245-05:00","updated_at":"2026-01-17T10:44:41.999011287-05:00","dependencies":[{"issue_id":"hq-wisp-6oonj","depends_on_id":"hq-wisp-qd1hf","type":"parent-child","created_at":"2026-01-17T10:44:42.118393918-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-6oonj","depends_on_id":"hq-wisp-fpw0o","type":"blocks","created_at":"2026-01-17T10:44:42.400793392-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-6p3v3","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:44:43.635565756-05:00","updated_at":"2026-01-16T23:45:35.77729493-05:00","closed_at":"2026-01-16T23:45:35.77729493-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-6p3v3","depends_on_id":"hq-wisp-bhwu0","type":"parent-child","created_at":"2026-01-16T23:44:43.776932734-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-6p3v3","depends_on_id":"hq-wisp-er67q","type":"blocks","created_at":"2026-01-16T23:44:45.717247113-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-6p5w2","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:26:33.627051931-05:00","updated_at":"2026-01-17T00:27:01.161884538-05:00","closed_at":"2026-01-17T00:27:01.161884538-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-6p5w2","depends_on_id":"hq-wisp-3h08u","type":"parent-child","created_at":"2026-01-17T00:26:34.65702074-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-6p5w2","depends_on_id":"hq-wisp-rjrbn","type":"blocks","created_at":"2026-01-17T00:26:38.306008203-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-6qmq6","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T10:47:55.315071245-05:00","updated_at":"2026-01-17T10:51:04.123933678-05:00","closed_at":"2026-01-17T10:51:04.123933678-05:00","close_reason":"Nothing to process","dependencies":[{"issue_id":"hq-wisp-6qmq6","depends_on_id":"hq-wisp-9hr1x","type":"parent-child","created_at":"2026-01-17T10:47:55.3632188-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-6qmq6","depends_on_id":"hq-wisp-qdo07","type":"blocks","created_at":"2026-01-17T10:47:56.037534447-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-6ric","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:21:24.472648427-05:00","updated_at":"2026-01-16T23:23:37.690632055-05:00","closed_at":"2026-01-16T23:23:37.690632055-05:00","close_reason":"Standard end-of-cycle, looping","dependencies":[{"issue_id":"hq-wisp-6ric","depends_on_id":"hq-wisp-87xr","type":"parent-child","created_at":"2026-01-16T23:21:25.917951119-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-6ric","depends_on_id":"hq-wisp-3dy5","type":"blocks","created_at":"2026-01-16T23:21:27.649808316-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-6xbx","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T22:09:18.608063708-05:00","updated_at":"2026-01-16T22:12:13.814004861-05:00","closed_at":"2026-01-16T22:12:13.814004861-05:00","close_reason":"Orphaned - bulk cleanup","ephemeral":true}
{"id":"hq-wisp-6xyr","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:05:01.104502756-05:00","updated_at":"2026-01-16T22:13:01.987891153-05:00","closed_at":"2026-01-16T22:13:01.987891153-05:00","close_reason":"Orphaned - forced cleanup","dependencies":[{"issue_id":"hq-wisp-6xyr","depends_on_id":"hq-wisp-xrtb","type":"parent-child","created_at":"2026-01-16T22:05:01.21634574-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-6xyr","depends_on_id":"hq-wisp-i79w","type":"blocks","created_at":"2026-01-16T22:05:01.384678402-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-6yq9a","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:07:28.968547763-05:00","updated_at":"2026-01-17T01:09:04.31945457-05:00","closed_at":"2026-01-17T01:09:04.31945457-05:00","close_reason":"No zombies","dependencies":[{"issue_id":"hq-wisp-6yq9a","depends_on_id":"hq-wisp-fnimo","type":"parent-child","created_at":"2026-01-17T01:07:33.683540048-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-6yq9a","depends_on_id":"hq-wisp-5tfhu","type":"blocks","created_at":"2026-01-17T01:07:45.320106247-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-708me","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:40:19.877075859-05:00","updated_at":"2026-01-16T23:41:28.981771394-05:00","closed_at":"2026-01-16T23:41:28.981771394-05:00","close_reason":"No issues found","dependencies":[{"issue_id":"hq-wisp-708me","depends_on_id":"hq-wisp-6gnpy","type":"parent-child","created_at":"2026-01-16T23:40:20.954568844-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-708me","depends_on_id":"hq-wisp-3t10w","type":"blocks","created_at":"2026-01-16T23:40:22.93505063-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-71b7","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T22:02:49.307882599-05:00","updated_at":"2026-01-16T22:12:18.925721388-05:00","closed_at":"2026-01-16T22:12:18.925721388-05:00","close_reason":"Orphaned - bulk cleanup","ephemeral":true}
{"id":"hq-wisp-71ebr","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:56:40.337110453-05:00","updated_at":"2026-01-17T00:58:08.473066928-05:00","closed_at":"2026-01-17T00:58:08.473066928-05:00","close_reason":"No plugins","dependencies":[{"issue_id":"hq-wisp-71ebr","depends_on_id":"hq-wisp-an994","type":"parent-child","created_at":"2026-01-17T00:56:45.267057367-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-71ebr","depends_on_id":"hq-wisp-l4pbu","type":"blocks","created_at":"2026-01-17T00:56:56.704971487-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-71rd","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-16T01:43:43.123706552-05:00","updated_at":"2026-01-16T01:52:13.477599184-05:00","closed_at":"2026-01-16T01:52:13.477599184-05:00","close_reason":"Orphaned wisp cleanup","ephemeral":true}
{"id":"hq-wisp-72ja3","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T00:27:30.729230425-05:00","updated_at":"2026-01-17T00:28:06.962127436-05:00","closed_at":"2026-01-17T00:28:06.962127436-05:00","close_reason":"Patrol cycle 6 complete","ephemeral":true}
{"id":"hq-wisp-72qqx","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:41:51.255928018-05:00","updated_at":"2026-01-16T23:42:53.778953848-05:00","closed_at":"2026-01-16T23:42:53.778953848-05:00","close_reason":"Patrol count 10, looping","dependencies":[{"issue_id":"hq-wisp-72qqx","depends_on_id":"hq-wisp-tnkch","type":"parent-child","created_at":"2026-01-16T23:41:53.13904215-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-72qqx","depends_on_id":"hq-wisp-hvy5h","type":"blocks","created_at":"2026-01-16T23:41:55.275184166-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-72tf","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T22:56:48.269005742-05:00","updated_at":"2026-01-17T00:36:14.959110375-05:00","closed_at":"2026-01-17T00:36:14.959110375-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-745ro","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:23:47.739209324-05:00","updated_at":"2026-01-16T23:25:38.117327647-05:00","closed_at":"2026-01-16T23:25:38.117327647-05:00","close_reason":"No costs to digest","dependencies":[{"issue_id":"hq-wisp-745ro","depends_on_id":"hq-wisp-9we3","type":"parent-child","created_at":"2026-01-16T23:23:49.093120814-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-745ro","depends_on_id":"hq-wisp-950b1","type":"blocks","created_at":"2026-01-16T23:23:51.052724849-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-746h","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:04:51.320928165-05:00","updated_at":"2026-01-16T23:14:43.339159807-05:00","closed_at":"2026-01-16T23:14:43.339159807-05:00","close_reason":"Duplicate patrol wisp, cleaned up","ephemeral":true}
{"id":"hq-wisp-74dz","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:05:01.105077506-05:00","updated_at":"2026-01-16T22:13:01.974802877-05:00","closed_at":"2026-01-16T22:13:01.974802877-05:00","close_reason":"Orphaned - forced cleanup","dependencies":[{"issue_id":"hq-wisp-74dz","depends_on_id":"hq-wisp-xrtb","type":"parent-child","created_at":"2026-01-16T22:05:01.232114595-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-74dz","depends_on_id":"hq-wisp-yj5m","type":"blocks","created_at":"2026-01-16T22:05:01.402944296-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-75p3a","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:49:57.521485574-05:00","updated_at":"2026-01-17T10:49:57.521485574-05:00","dependencies":[{"issue_id":"hq-wisp-75p3a","depends_on_id":"hq-wisp-8agmn","type":"parent-child","created_at":"2026-01-17T10:49:57.836646973-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-75p3a","depends_on_id":"hq-wisp-g6qj9","type":"blocks","created_at":"2026-01-17T10:49:58.609640437-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-75yld","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:54:08.834542646-05:00","updated_at":"2026-01-16T23:54:54.326373435-05:00","closed_at":"2026-01-16T23:54:54.326373435-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-75yld","depends_on_id":"hq-wisp-oecdp","type":"parent-child","created_at":"2026-01-16T23:54:10.918365876-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-75yld","depends_on_id":"hq-wisp-ws4d8","type":"blocks","created_at":"2026-01-16T23:54:14.184744322-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-7822f","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:49:59.353896127-05:00","updated_at":"2026-01-17T10:49:59.353896168-05:00","dependencies":[{"issue_id":"hq-wisp-7822f","depends_on_id":"hq-wisp-wxw0u","type":"parent-child","created_at":"2026-01-17T10:49:59.412459217-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-7822f","depends_on_id":"hq-wisp-bnofj","type":"blocks","created_at":"2026-01-17T10:50:00.210117376-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-7a464","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:53:25.150668836-05:00","updated_at":"2026-01-16T23:53:45.806779153-05:00","closed_at":"2026-01-16T23:53:45.806779153-05:00","close_reason":"Inbox empty","dependencies":[{"issue_id":"hq-wisp-7a464","depends_on_id":"hq-wisp-of0wi","type":"parent-child","created_at":"2026-01-16T23:53:25.162951452-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-7amw","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T00:58:26.08656449-05:00","updated_at":"2026-01-16T01:50:39.433008071-05:00","closed_at":"2026-01-16T01:50:39.433008071-05:00","close_reason":"Stale patrol wisp cleanup","ephemeral":true}
{"id":"hq-wisp-7be","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T00:55:03.035196448-05:00","updated_at":"2026-01-16T01:50:39.461436415-05:00","closed_at":"2026-01-16T01:50:39.461436415-05:00","close_reason":"Stale patrol wisp cleanup","ephemeral":true}
{"id":"hq-wisp-7cnr4","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:47:34.368189133-05:00","updated_at":"2026-01-16T23:49:14.761089659-05:00","closed_at":"2026-01-16T23:49:14.761089659-05:00","close_reason":"Town idle patrol","dependencies":[{"issue_id":"hq-wisp-7cnr4","depends_on_id":"hq-wisp-ql31w","type":"parent-child","created_at":"2026-01-16T23:47:34.854681133-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-7cnr4","depends_on_id":"hq-wisp-mr96h","type":"blocks","created_at":"2026-01-16T23:47:36.988955588-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-7eecb","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:05:32.500971726-05:00","updated_at":"2026-01-17T01:07:17.501272716-05:00","closed_at":"2026-01-17T01:07:17.501272716-05:00","close_reason":"Idle town","dependencies":[{"issue_id":"hq-wisp-7eecb","depends_on_id":"hq-wisp-p8n2g","type":"parent-child","created_at":"2026-01-17T01:05:42.936519773-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-7eecb","depends_on_id":"hq-wisp-xxd87","type":"blocks","created_at":"2026-01-17T01:05:54.890122349-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-7eg6s","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:05:32.496284192-05:00","updated_at":"2026-01-17T01:06:51.508899847-05:00","closed_at":"2026-01-17T01:06:51.508899847-05:00","close_reason":"Idle town","dependencies":[{"issue_id":"hq-wisp-7eg6s","depends_on_id":"hq-wisp-p8n2g","type":"parent-child","created_at":"2026-01-17T01:05:39.61891449-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-7eg6s","depends_on_id":"hq-wisp-jeg4m","type":"blocks","created_at":"2026-01-17T01:05:51.894585726-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-7es1a","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:02:22.550209494-05:00","updated_at":"2026-01-17T01:04:11.402671345-05:00","closed_at":"2026-01-17T01:04:11.402671345-05:00","close_reason":"No gate-ready molecules","dependencies":[{"issue_id":"hq-wisp-7es1a","depends_on_id":"hq-wisp-xwv1q","type":"parent-child","created_at":"2026-01-17T01:02:24.303396772-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-7es1a","depends_on_id":"hq-wisp-z8yzk","type":"blocks","created_at":"2026-01-17T01:02:34.758878245-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-7lot5","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:40:19.875315734-05:00","updated_at":"2026-01-16T23:41:26.599437369-05:00","closed_at":"2026-01-16T23:41:26.599437369-05:00","close_reason":"Town idle - skipped nudges","dependencies":[{"issue_id":"hq-wisp-7lot5","depends_on_id":"hq-wisp-6gnpy","type":"parent-child","created_at":"2026-01-16T23:40:20.562099312-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-7lot5","depends_on_id":"hq-wisp-cdwpr","type":"blocks","created_at":"2026-01-16T23:40:22.340207124-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-7lot5","depends_on_id":"hq-wisp-sm7wo","type":"blocks","created_at":"2026-01-16T23:40:22.439121819-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-7lot5","depends_on_id":"hq-wisp-rrwqw","type":"blocks","created_at":"2026-01-16T23:40:22.537425973-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-7lpvl","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:51:06.432213208-05:00","updated_at":"2026-01-16T23:52:15.979324504-05:00","closed_at":"2026-01-16T23:52:15.979324504-05:00","close_reason":"Duplicate wisps, cleaning up","ephemeral":true}
{"id":"hq-wisp-7mtni","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:00:26.063898597-05:00","updated_at":"2026-01-17T01:01:55.36041763-05:00","closed_at":"2026-01-17T01:01:55.36041763-05:00","close_reason":"No abandoned work","dependencies":[{"issue_id":"hq-wisp-7mtni","depends_on_id":"hq-wisp-5yxyi","type":"parent-child","created_at":"2026-01-17T01:00:32.699739599-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-7mtni","depends_on_id":"hq-wisp-ywkx2","type":"blocks","created_at":"2026-01-17T01:00:43.804085433-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-7nzgp","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:43:00.963379314-05:00","updated_at":"2026-01-17T00:51:58.461958153-05:00","closed_at":"2026-01-17T00:51:58.461958153-05:00","close_reason":"Costs not tracked this cycle","dependencies":[{"issue_id":"hq-wisp-7nzgp","depends_on_id":"hq-wisp-jgnad","type":"parent-child","created_at":"2026-01-17T00:43:07.591229407-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-7nzgp","depends_on_id":"hq-wisp-c6ziz","type":"blocks","created_at":"2026-01-17T00:43:17.176495157-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-7rf5r","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:48:51.079256725-05:00","updated_at":"2026-01-16T23:49:18.793704467-05:00","closed_at":"2026-01-16T23:49:18.793704467-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-7rf5r","depends_on_id":"hq-wisp-de87j","type":"parent-child","created_at":"2026-01-16T23:48:52.762911346-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-7rf5r","depends_on_id":"hq-wisp-dcjk5","type":"blocks","created_at":"2026-01-16T23:48:55.619537876-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-7sg0e","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:47:34.373509518-05:00","updated_at":"2026-01-16T23:49:12.602179205-05:00","closed_at":"2026-01-16T23:49:12.602179205-05:00","close_reason":"Town idle patrol","dependencies":[{"issue_id":"hq-wisp-7sg0e","depends_on_id":"hq-wisp-ql31w","type":"parent-child","created_at":"2026-01-16T23:47:35.918955377-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-7sg0e","depends_on_id":"hq-wisp-srb8i","type":"blocks","created_at":"2026-01-16T23:47:38.325001245-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-7tdpz","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:08:16.860086203-05:00","updated_at":"2026-01-17T01:11:01.964362105-05:00","closed_at":"2026-01-17T01:11:01.964362105-05:00","close_reason":"Final patrol","dependencies":[{"issue_id":"hq-wisp-7tdpz","depends_on_id":"hq-wisp-vrsc5","type":"parent-child","created_at":"2026-01-17T01:08:27.766407879-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-7tdpz","depends_on_id":"hq-wisp-oujdk","type":"blocks","created_at":"2026-01-17T01:08:39.981054256-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-7vb7g","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:43:00.95824653-05:00","updated_at":"2026-01-17T00:51:31.744956008-05:00","closed_at":"2026-01-17T00:51:31.744956008-05:00","close_reason":"No zombie polecats detected","dependencies":[{"issue_id":"hq-wisp-7vb7g","depends_on_id":"hq-wisp-jgnad","type":"parent-child","created_at":"2026-01-17T00:43:04.755843353-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-7vb7g","depends_on_id":"hq-wisp-df6ff","type":"blocks","created_at":"2026-01-17T00:43:14.297219088-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-7vx1","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:27:24.234659555-05:00","updated_at":"2026-01-16T01:52:13.867446093-05:00","closed_at":"2026-01-16T01:52:13.867446093-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-7vx1","depends_on_id":"hq-wisp-nv4o","type":"parent-child","created_at":"2026-01-16T01:27:24.257290531-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-7vx1","depends_on_id":"hq-wisp-eiqy","type":"blocks","created_at":"2026-01-16T01:27:24.411657829-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-7wx2v","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:47:53.50749264-05:00","updated_at":"2026-01-16T23:48:14.429124004-05:00","closed_at":"2026-01-16T23:48:14.429124004-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-7wx2v","depends_on_id":"hq-wisp-wj52z","type":"parent-child","created_at":"2026-01-16T23:47:55.91082194-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-7wx2v","depends_on_id":"hq-wisp-ix72d","type":"blocks","created_at":"2026-01-16T23:47:58.650713056-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-7x4am","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:51:56.8321149-05:00","updated_at":"2026-01-16T23:52:39.915771143-05:00","closed_at":"2026-01-16T23:52:39.915771143-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-7x4am","depends_on_id":"hq-wisp-ri9se","type":"parent-child","created_at":"2026-01-16T23:51:58.318246955-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-7x4am","depends_on_id":"hq-wisp-f4sm6","type":"blocks","created_at":"2026-01-16T23:52:01.631952218-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-7xkx","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:42:27.171894548-05:00","updated_at":"2026-01-16T01:52:13.675221802-05:00","closed_at":"2026-01-16T01:52:13.675221802-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-7xkx","depends_on_id":"hq-wisp-wqti","type":"parent-child","created_at":"2026-01-16T01:42:27.177230167-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-8036","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:26:29.476483584-05:00","updated_at":"2026-01-16T01:52:13.948925587-05:00","closed_at":"2026-01-16T01:52:13.948925587-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-8036","depends_on_id":"hq-wisp-zv2x","type":"parent-child","created_at":"2026-01-16T01:26:29.54818351-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-8036","depends_on_id":"hq-wisp-nbew","type":"blocks","created_at":"2026-01-16T01:26:29.68358291-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-80uv","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","assignee":"deacon","created_at":"2026-01-16T22:15:59.88817543-05:00","updated_at":"2026-01-17T00:36:23.154456972-05:00","closed_at":"2026-01-17T00:36:23.154456972-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-8117d","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:25:52.722314158-05:00","updated_at":"2026-01-16T23:27:57.174171396-05:00","closed_at":"2026-01-16T23:27:57.174171396-05:00","close_reason":"End-of-patrol, handoff","dependencies":[{"issue_id":"hq-wisp-8117d","depends_on_id":"hq-wisp-w4tn2","type":"parent-child","created_at":"2026-01-16T23:25:54.220997129-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-8117d","depends_on_id":"hq-wisp-miu2f","type":"blocks","created_at":"2026-01-16T23:25:56.134574129-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-82sd","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:55:09.578581254-05:00","updated_at":"2026-01-16T00:55:15.978653515-05:00","closed_at":"2026-01-16T00:55:15.978653515-05:00","close_reason":"Town healthy","dependencies":[{"issue_id":"hq-wisp-82sd","depends_on_id":"hq-wisp-3o9w","type":"parent-child","created_at":"2026-01-16T00:55:09.606761054-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-848n8","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:29:36.057613169-05:00","updated_at":"2026-01-17T00:29:48.219760227-05:00","closed_at":"2026-01-17T00:29:48.219760227-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-848n8","depends_on_id":"hq-wisp-w5z6p","type":"parent-child","created_at":"2026-01-17T00:29:36.071212525-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-85gqv","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:53:05.61990957-05:00","updated_at":"2026-01-16T23:53:57.473690303-05:00","closed_at":"2026-01-16T23:53:57.473690303-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-85gqv","depends_on_id":"hq-wisp-xtx6n","type":"parent-child","created_at":"2026-01-16T23:53:06.349523467-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-85gqv","depends_on_id":"hq-wisp-dl3f2","type":"blocks","created_at":"2026-01-16T23:53:09.454606536-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-87gyy","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:48:51.075766441-05:00","updated_at":"2026-01-16T23:49:26.341816303-05:00","closed_at":"2026-01-16T23:49:26.341816303-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-87gyy","depends_on_id":"hq-wisp-de87j","type":"parent-child","created_at":"2026-01-16T23:48:51.776715385-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-87gyy","depends_on_id":"hq-wisp-syrk7","type":"blocks","created_at":"2026-01-16T23:48:54.32471391-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-87pnc","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:49:35.724006791-05:00","updated_at":"2026-01-16T23:50:19.149710719-05:00","closed_at":"2026-01-16T23:50:19.149710719-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-87pnc","depends_on_id":"hq-wisp-n4f70","type":"parent-child","created_at":"2026-01-16T23:49:37.35859694-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-87pnc","depends_on_id":"hq-wisp-9p1es","type":"blocks","created_at":"2026-01-16T23:49:40.092560666-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-87q2n","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:02:22.551020368-05:00","updated_at":"2026-01-17T01:03:59.222867031-05:00","closed_at":"2026-01-17T01:03:59.222867031-05:00","close_reason":"No convoys","dependencies":[{"issue_id":"hq-wisp-87q2n","depends_on_id":"hq-wisp-xwv1q","type":"parent-child","created_at":"2026-01-17T01:02:24.901490802-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-87q2n","depends_on_id":"hq-wisp-jdost","type":"blocks","created_at":"2026-01-17T01:02:35.332380938-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-87xr","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:21:24.464703928-05:00","updated_at":"2026-01-17T00:35:55.114430664-05:00","closed_at":"2026-01-17T00:35:55.114430664-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-8881c","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:52:28.53779447-05:00","updated_at":"2026-01-16T23:52:47.773731882-05:00","closed_at":"2026-01-16T23:52:47.773731882-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-8881c","depends_on_id":"hq-wisp-en6ig","type":"parent-child","created_at":"2026-01-16T23:52:31.305963822-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-8881c","depends_on_id":"hq-wisp-53zc6","type":"blocks","created_at":"2026-01-16T23:52:34.792654743-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-8aa4","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:55:36.785016499-05:00","updated_at":"2026-01-16T01:56:32.663501441-05:00","closed_at":"2026-01-16T01:56:32.663501441-05:00","close_reason":"Closed","dependencies":[{"issue_id":"hq-wisp-8aa4","depends_on_id":"hq-wisp-ndqt","type":"parent-child","created_at":"2026-01-16T01:55:36.887952387-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-8aa4","depends_on_id":"hq-wisp-mewe","type":"blocks","created_at":"2026-01-16T01:55:37.032295897-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-8agmn","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"hooked","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T10:49:57.514391578-05:00","updated_at":"2026-01-17T10:50:06.223806899-05:00","ephemeral":true}
{"id":"hq-wisp-8avgc","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T10:45:42.444741387-05:00","updated_at":"2026-01-17T10:46:03.778423383-05:00","closed_at":"2026-01-17T10:46:03.778423383-05:00","close_reason":"Patrol 7 complete","ephemeral":true}
{"id":"hq-wisp-8b79","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:46:26.939796604-05:00","updated_at":"2026-01-16T01:51:56.558913689-05:00","closed_at":"2026-01-16T01:51:56.558913689-05:00","close_reason":"Added delta to pool - now 4 dogs (3 working, 1 idle)","dependencies":[{"issue_id":"hq-wisp-8b79","depends_on_id":"hq-wisp-ybkc","type":"parent-child","created_at":"2026-01-16T01:46:27.04828457-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-8b79","depends_on_id":"hq-wisp-f24f","type":"blocks","created_at":"2026-01-16T01:46:27.271874161-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-8bg4","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T21:49:02.388726894-05:00","updated_at":"2026-01-16T22:12:18.946417445-05:00","closed_at":"2026-01-16T22:12:18.946417445-05:00","close_reason":"Orphaned - bulk cleanup","ephemeral":true}
{"id":"hq-wisp-8c7bd","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:52:28.529659643-05:00","updated_at":"2026-01-16T23:52:50.71669566-05:00","closed_at":"2026-01-16T23:52:50.71669566-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-8c7bd","depends_on_id":"hq-wisp-en6ig","type":"parent-child","created_at":"2026-01-16T23:52:28.883157785-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-8c7bd","depends_on_id":"hq-wisp-gc9or","type":"blocks","created_at":"2026-01-16T23:52:31.997110536-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-8d16m","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T00:30:03.169230901-05:00","updated_at":"2026-01-17T00:30:31.87365679-05:00","closed_at":"2026-01-17T00:30:31.87365679-05:00","close_reason":"Patrol cycle 10 complete","ephemeral":true}
{"id":"hq-wisp-8d7d","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-16T01:56:35.915956858-05:00","updated_at":"2026-01-16T22:12:37.729573757-05:00","closed_at":"2026-01-16T22:12:37.729573757-05:00","close_reason":"Orphaned patrol wisp - cleanup","ephemeral":true}
{"id":"hq-wisp-8icmr","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:46:50.722453873-05:00","updated_at":"2026-01-17T10:46:50.722453915-05:00","dependencies":[{"issue_id":"hq-wisp-8icmr","depends_on_id":"hq-wisp-2vhlh","type":"parent-child","created_at":"2026-01-17T10:46:50.809585197-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-8icmr","depends_on_id":"hq-wisp-3tmj1","type":"blocks","created_at":"2026-01-17T10:46:51.277248632-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-8kaiy","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:53:25.157856872-05:00","updated_at":"2026-01-16T23:53:48.534920138-05:00","closed_at":"2026-01-16T23:53:48.534920138-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-8kaiy","depends_on_id":"hq-wisp-of0wi","type":"parent-child","created_at":"2026-01-16T23:53:27.001075496-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-8kaiy","depends_on_id":"hq-wisp-kvusq","type":"blocks","created_at":"2026-01-16T23:53:30.398413966-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-8kvi","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:46:26.94055102-05:00","updated_at":"2026-01-16T01:51:58.181167173-05:00","closed_at":"2026-01-16T01:51:58.181167173-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-8kvi","depends_on_id":"hq-wisp-ybkc","type":"parent-child","created_at":"2026-01-16T01:46:27.079499786-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-8kvi","depends_on_id":"hq-wisp-x1p4","type":"blocks","created_at":"2026-01-16T01:46:27.307347873-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-8mlf","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:20:43.78861421-05:00","updated_at":"2026-01-17T00:35:55.830411104-05:00","closed_at":"2026-01-17T00:35:55.830411104-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-8nw8z","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:25:52.717124117-05:00","updated_at":"2026-01-16T23:26:59.481217905-05:00","closed_at":"2026-01-16T23:26:59.481217905-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-8nw8z","depends_on_id":"hq-wisp-w4tn2","type":"parent-child","created_at":"2026-01-16T23:25:53.380013614-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-8nw8z","depends_on_id":"hq-wisp-uumat","type":"blocks","created_at":"2026-01-16T23:25:55.076901725-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-8nw8z","depends_on_id":"hq-wisp-keb5i","type":"blocks","created_at":"2026-01-16T23:25:55.172407713-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-8nw8z","depends_on_id":"hq-wisp-gdvf4","type":"blocks","created_at":"2026-01-16T23:25:55.270185825-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-8o8b","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:15:01.19854989-05:00","updated_at":"2026-01-16T23:18:37.925007459-05:00","closed_at":"2026-01-16T23:18:37.925007459-05:00","close_reason":"No zombies, dog pool present","dependencies":[{"issue_id":"hq-wisp-8o8b","depends_on_id":"hq-wisp-9osz","type":"parent-child","created_at":"2026-01-16T23:15:01.890938102-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-8o8b","depends_on_id":"hq-wisp-65g1","type":"blocks","created_at":"2026-01-16T23:15:03.309609351-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-8okt","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T01:54:43.647217223-05:00","updated_at":"2026-01-16T22:12:29.222527103-05:00","closed_at":"2026-01-16T22:12:29.222527103-05:00","close_reason":"Orphaned - bulk cleanup","ephemeral":true}
{"id":"hq-wisp-8pecv","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:23:02.706455924-05:00","updated_at":"2026-01-17T00:24:20.638694156-05:00","closed_at":"2026-01-17T00:24:20.638694156-05:00","close_reason":"Town idle/healthy","dependencies":[{"issue_id":"hq-wisp-8pecv","depends_on_id":"hq-wisp-93kdl","type":"parent-child","created_at":"2026-01-17T00:23:04.801481506-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-8pecv","depends_on_id":"hq-wisp-cbu7x","type":"blocks","created_at":"2026-01-17T00:23:08.694960775-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-8prl","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:55:36.783941084-05:00","updated_at":"2026-01-16T01:56:28.014588213-05:00","closed_at":"2026-01-16T01:56:28.014588213-05:00","close_reason":"Closed","dependencies":[{"issue_id":"hq-wisp-8prl","depends_on_id":"hq-wisp-ndqt","type":"parent-child","created_at":"2026-01-16T01:55:36.867436076-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-8prl","depends_on_id":"hq-wisp-wtm1","type":"blocks","created_at":"2026-01-16T01:55:37.00928538-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-8rp4p","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:43:00.953257663-05:00","updated_at":"2026-01-17T00:50:29.970143868-05:00","closed_at":"2026-01-17T00:50:29.970143868-05:00","close_reason":"No pending async gates","dependencies":[{"issue_id":"hq-wisp-8rp4p","depends_on_id":"hq-wisp-jgnad","type":"parent-child","created_at":"2026-01-17T00:43:01.921290173-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-8rp4p","depends_on_id":"hq-wisp-9ztqh","type":"blocks","created_at":"2026-01-17T00:43:10.487613616-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-8t1s8","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:29:36.064275035-05:00","updated_at":"2026-01-17T00:29:55.364468815-05:00","closed_at":"2026-01-17T00:29:55.364468815-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-8t1s8","depends_on_id":"hq-wisp-w5z6p","type":"parent-child","created_at":"2026-01-17T00:29:38.464720941-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-8t1s8","depends_on_id":"hq-wisp-it9ic","type":"blocks","created_at":"2026-01-17T00:29:43.302460868-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-8tjf","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","assignee":"deacon","created_at":"2026-01-16T22:15:51.27774204-05:00","updated_at":"2026-01-17T00:36:24.283249027-05:00","closed_at":"2026-01-17T00:36:24.283249027-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-8u71r","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:12:55.892478809-05:00","updated_at":"2026-01-17T02:00:09.402545073-05:00","closed_at":"2026-01-17T02:00:09.402545073-05:00","close_reason":"Context OK","dependencies":[{"issue_id":"hq-wisp-8u71r","depends_on_id":"hq-wisp-i2n82","type":"parent-child","created_at":"2026-01-17T01:13:06.274334139-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-8u71r","depends_on_id":"hq-wisp-od1uw","type":"blocks","created_at":"2026-01-17T01:13:18.636765659-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-8vn9","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:26:29.475388086-05:00","updated_at":"2026-01-16T01:52:13.973782352-05:00","closed_at":"2026-01-16T01:52:13.973782352-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-8vn9","depends_on_id":"hq-wisp-zv2x","type":"parent-child","created_at":"2026-01-16T01:26:29.522491245-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-8vn9","depends_on_id":"hq-wisp-bml8","type":"blocks","created_at":"2026-01-16T01:26:29.640867455-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-8vn9","depends_on_id":"hq-wisp-mwk8","type":"blocks","created_at":"2026-01-16T01:26:29.647897239-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-8vn9","depends_on_id":"hq-wisp-onoh","type":"blocks","created_at":"2026-01-16T01:26:29.65508919-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-8vsav","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T10:47:08.826826572-05:00","updated_at":"2026-01-17T10:47:17.400147097-05:00","closed_at":"2026-01-17T10:47:17.400147097-05:00","close_reason":"Patrol 11 complete","ephemeral":true}
{"id":"hq-wisp-8xr5y","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:47:24.587263142-05:00","updated_at":"2026-01-17T10:47:24.587263142-05:00","dependencies":[{"issue_id":"hq-wisp-8xr5y","depends_on_id":"hq-wisp-jag69","type":"parent-child","created_at":"2026-01-17T10:47:25.14833048-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-8xr5y","depends_on_id":"hq-wisp-960af","type":"blocks","created_at":"2026-01-17T10:47:25.826446708-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-8y5m2","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:03:11.648167236-05:00","updated_at":"2026-01-17T01:04:36.899836654-05:00","closed_at":"2026-01-17T01:04:36.899836654-05:00","close_reason":"Looping - patrol 17 of 20","dependencies":[{"issue_id":"hq-wisp-8y5m2","depends_on_id":"hq-wisp-zx2sm","type":"parent-child","created_at":"2026-01-17T01:03:22.469947024-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-8y5m2","depends_on_id":"hq-wisp-r7eue","type":"blocks","created_at":"2026-01-17T01:03:34.656586476-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-8yiq","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:15:01.196892474-05:00","updated_at":"2026-01-16T23:18:18.799811032-05:00","closed_at":"2026-01-16T23:18:18.799811032-05:00","close_reason":"No convoy or cross-rig events to notify","dependencies":[{"issue_id":"hq-wisp-8yiq","depends_on_id":"hq-wisp-9osz","type":"parent-child","created_at":"2026-01-16T23:15:01.615986459-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-8yiq","depends_on_id":"hq-wisp-xamf","type":"blocks","created_at":"2026-01-16T23:15:02.87570312-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-8yoid","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:49:59.35945904-05:00","updated_at":"2026-01-17T10:49:59.359459082-05:00","dependencies":[{"issue_id":"hq-wisp-8yoid","depends_on_id":"hq-wisp-wxw0u","type":"parent-child","created_at":"2026-01-17T10:49:59.811296442-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-8yoid","depends_on_id":"hq-wisp-92hvc","type":"blocks","created_at":"2026-01-17T10:50:00.727439281-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-8ztf","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-16T01:43:16.892325493-05:00","updated_at":"2026-01-16T01:52:13.496507621-05:00","closed_at":"2026-01-16T01:52:13.496507621-05:00","close_reason":"Orphaned wisp cleanup","ephemeral":true}
{"id":"hq-wisp-90n2b","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:43:56.998927108-05:00","updated_at":"2026-01-16T23:44:17.918396402-05:00","closed_at":"2026-01-16T23:44:17.918396402-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-90n2b","depends_on_id":"hq-wisp-ywecn","type":"parent-child","created_at":"2026-01-16T23:43:58.861448325-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-90n2b","depends_on_id":"hq-wisp-vxnla","type":"blocks","created_at":"2026-01-16T23:44:00.980744884-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-90z8r","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"hooked","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T10:00:04.152805697-05:00","updated_at":"2026-01-17T10:00:09.113048517-05:00","ephemeral":true}
{"id":"hq-wisp-92fzq","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:54:08.832250273-05:00","updated_at":"2026-01-16T23:54:56.187912408-05:00","closed_at":"2026-01-16T23:54:56.187912408-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-92fzq","depends_on_id":"hq-wisp-oecdp","type":"parent-child","created_at":"2026-01-16T23:54:10.279910784-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-92fzq","depends_on_id":"hq-wisp-n54rr","type":"blocks","created_at":"2026-01-16T23:54:13.527282203-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-92hvc","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:49:59.357658833-05:00","updated_at":"2026-01-17T10:49:59.357658874-05:00","dependencies":[{"issue_id":"hq-wisp-92hvc","depends_on_id":"hq-wisp-wxw0u","type":"parent-child","created_at":"2026-01-17T10:49:59.678782728-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-92hvc","depends_on_id":"hq-wisp-7822f","type":"blocks","created_at":"2026-01-17T10:50:00.481376009-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-92hvc","depends_on_id":"hq-wisp-lj5gj","type":"blocks","created_at":"2026-01-17T10:50:00.528178981-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-92hvc","depends_on_id":"hq-wisp-w12cw","type":"blocks","created_at":"2026-01-17T10:50:00.575514079-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-92nyy","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:46:12.169332877-05:00","updated_at":"2026-01-17T00:35:34.046470919-05:00","closed_at":"2026-01-17T00:35:34.046470919-05:00","close_reason":"Cleanup","ephemeral":true}
{"id":"hq-wisp-93kdl","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T00:23:02.69736078-05:00","updated_at":"2026-01-17T00:24:32.986265443-05:00","closed_at":"2026-01-17T00:24:32.986265443-05:00","close_reason":"Patrol cycle 2 complete: witnesses healthy, town idle","ephemeral":true}
{"id":"hq-wisp-93xu","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T22:11:38.382369194-05:00","updated_at":"2026-01-16T22:12:13.749526735-05:00","closed_at":"2026-01-16T22:12:13.749526735-05:00","close_reason":"Orphaned - bulk cleanup","ephemeral":true}
{"id":"hq-wisp-950b1","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:23:47.738468866-05:00","updated_at":"2026-01-16T23:25:33.679514518-05:00","closed_at":"2026-01-16T23:25:33.679514518-05:00","close_reason":"Cleanup noted","dependencies":[{"issue_id":"hq-wisp-950b1","depends_on_id":"hq-wisp-9we3","type":"parent-child","created_at":"2026-01-16T23:23:48.99490466-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-950b1","depends_on_id":"hq-wisp-gwgl","type":"blocks","created_at":"2026-01-16T23:23:50.950614946-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-960af","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:47:24.586675642-05:00","updated_at":"2026-01-17T10:47:24.586675684-05:00","dependencies":[{"issue_id":"hq-wisp-960af","depends_on_id":"hq-wisp-jag69","type":"parent-child","created_at":"2026-01-17T10:47:25.116986332-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-960af","depends_on_id":"hq-wisp-o4v14","type":"blocks","created_at":"2026-01-17T10:47:25.789884063-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-97mw","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:15:52.353595962-05:00","updated_at":"2026-01-16T23:18:08.54223766-05:00","closed_at":"2026-01-16T23:18:08.54223766-05:00","close_reason":"Stale duplicate","ephemeral":true}
{"id":"hq-wisp-9a1wp","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T02:00:44.562683941-05:00","updated_at":"2026-01-17T02:02:11.984786059-05:00","closed_at":"2026-01-17T02:02:11.984786059-05:00","close_reason":"Idle patrol","ephemeral":true}
{"id":"hq-wisp-9a6o9","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:02:45.702849835-05:00","updated_at":"2026-01-17T01:05:23.088889362-05:00","closed_at":"2026-01-17T01:05:23.088889362-05:00","close_reason":"Idle town patrol","dependencies":[{"issue_id":"hq-wisp-9a6o9","depends_on_id":"hq-wisp-ji9jj","type":"parent-child","created_at":"2026-01-17T01:02:55.654718882-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-9a6o9","depends_on_id":"hq-wisp-idqk8","type":"blocks","created_at":"2026-01-17T01:03:07.488536466-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-9b66w","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:58:39.89015589-05:00","updated_at":"2026-01-17T00:59:37.810523337-05:00","closed_at":"2026-01-17T00:59:37.810523337-05:00","close_reason":"No async gates","dependencies":[{"issue_id":"hq-wisp-9b66w","depends_on_id":"hq-wisp-0nlhz","type":"parent-child","created_at":"2026-01-17T00:58:40.993259212-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-9b66w","depends_on_id":"hq-wisp-dnyio","type":"blocks","created_at":"2026-01-17T00:58:50.842790866-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-9clup","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:43:00.954032953-05:00","updated_at":"2026-01-17T00:50:34.735293605-05:00","closed_at":"2026-01-17T00:50:34.735293605-05:00","close_reason":"No gate-ready molecules","dependencies":[{"issue_id":"hq-wisp-9clup","depends_on_id":"hq-wisp-jgnad","type":"parent-child","created_at":"2026-01-17T00:43:02.39355153-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-9clup","depends_on_id":"hq-wisp-8rp4p","type":"blocks","created_at":"2026-01-17T00:43:10.967942419-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-9eak","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:46:26.940041896-05:00","updated_at":"2026-01-16T01:51:58.25080618-05:00","closed_at":"2026-01-16T01:51:58.25080618-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-9eak","depends_on_id":"hq-wisp-ybkc","type":"parent-child","created_at":"2026-01-16T01:46:27.058855017-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-9eak","depends_on_id":"hq-wisp-8b79","type":"blocks","created_at":"2026-01-16T01:46:27.283757232-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-9fjdn","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T00:44:05.609945004-05:00","updated_at":"2026-01-17T00:44:28.096816608-05:00","closed_at":"2026-01-17T00:44:28.096816608-05:00","close_reason":"OK","ephemeral":true}
{"id":"hq-wisp-9g6u","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:05:01.103601674-05:00","updated_at":"2026-01-16T22:13:02.006287546-05:00","closed_at":"2026-01-16T22:13:02.006287546-05:00","close_reason":"Orphaned - forced cleanup","dependencies":[{"issue_id":"hq-wisp-9g6u","depends_on_id":"hq-wisp-xrtb","type":"parent-child","created_at":"2026-01-16T22:05:01.192612395-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-9g6u","depends_on_id":"hq-wisp-5nno","type":"blocks","created_at":"2026-01-16T22:05:01.357309812-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-9hkxz","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:49:57.526825904-05:00","updated_at":"2026-01-17T10:49:57.526825946-05:00","dependencies":[{"issue_id":"hq-wisp-9hkxz","depends_on_id":"hq-wisp-8agmn","type":"parent-child","created_at":"2026-01-17T10:49:58.101833109-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-9hkxz","depends_on_id":"hq-wisp-9yel4","type":"blocks","created_at":"2026-01-17T10:49:58.894812395-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-9hr1x","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"hooked","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T10:47:55.309210249-05:00","updated_at":"2026-01-17T10:47:57.168974285-05:00","ephemeral":true}
{"id":"hq-wisp-9ile6","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:27:30.736016415-05:00","updated_at":"2026-01-17T00:27:56.873585213-05:00","closed_at":"2026-01-17T00:27:56.873585213-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-9ile6","depends_on_id":"hq-wisp-72ja3","type":"parent-child","created_at":"2026-01-17T00:27:32.212733908-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-9ile6","depends_on_id":"hq-wisp-wn6pp","type":"blocks","created_at":"2026-01-17T00:27:35.984996585-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-9ile6","depends_on_id":"hq-wisp-jlopn","type":"blocks","created_at":"2026-01-17T00:27:36.195271032-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-9ile6","depends_on_id":"hq-wisp-rcvst","type":"blocks","created_at":"2026-01-17T00:27:36.407778766-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-9l1zx","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T00:28:49.921157652-05:00","updated_at":"2026-01-17T00:29:07.071135842-05:00","closed_at":"2026-01-17T00:29:07.071135842-05:00","close_reason":"Patrol cycle 8 complete","ephemeral":true}
{"id":"hq-wisp-9lhcg","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:12:55.890610271-05:00","updated_at":"2026-01-17T02:00:07.392713859-05:00","closed_at":"2026-01-17T02:00:07.392713859-05:00","close_reason":"Log rotation not needed","dependencies":[{"issue_id":"hq-wisp-9lhcg","depends_on_id":"hq-wisp-i2n82","type":"parent-child","created_at":"2026-01-17T01:13:05.0483136-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-9lhcg","depends_on_id":"hq-wisp-owh0h","type":"blocks","created_at":"2026-01-17T01:13:17.405414921-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-9lnf","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:42:27.174438254-05:00","updated_at":"2026-01-16T01:52:13.597343762-05:00","closed_at":"2026-01-16T01:52:13.597343762-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-9lnf","depends_on_id":"hq-wisp-wqti","type":"parent-child","created_at":"2026-01-16T01:42:27.284611509-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-9lnf","depends_on_id":"hq-wisp-e57c","type":"blocks","created_at":"2026-01-16T01:42:27.529288867-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-9mvk9","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:47:34.370917075-05:00","updated_at":"2026-01-16T23:49:13.88844994-05:00","closed_at":"2026-01-16T23:49:13.88844994-05:00","close_reason":"Town idle patrol","dependencies":[{"issue_id":"hq-wisp-9mvk9","depends_on_id":"hq-wisp-ql31w","type":"parent-child","created_at":"2026-01-16T23:47:35.3230142-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-9mvk9","depends_on_id":"hq-wisp-16ked","type":"blocks","created_at":"2026-01-16T23:47:37.717163722-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-9mws0","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:29:36.061010414-05:00","updated_at":"2026-01-17T00:29:51.069739256-05:00","closed_at":"2026-01-17T00:29:51.069739256-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-9mws0","depends_on_id":"hq-wisp-w5z6p","type":"parent-child","created_at":"2026-01-17T00:29:37.279158009-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-9mws0","depends_on_id":"hq-wisp-d37d3","type":"blocks","created_at":"2026-01-17T00:29:41.595477996-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-9n19h","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:28:16.225810934-05:00","updated_at":"2026-01-17T00:28:37.447077456-05:00","closed_at":"2026-01-17T00:28:37.447077456-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-9n19h","depends_on_id":"hq-wisp-tbive","type":"parent-child","created_at":"2026-01-17T00:28:17.761182384-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-9n19h","depends_on_id":"hq-wisp-ip01t","type":"blocks","created_at":"2026-01-17T00:28:21.760317484-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-9n19h","depends_on_id":"hq-wisp-skr05","type":"blocks","created_at":"2026-01-17T00:28:21.983758411-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-9n19h","depends_on_id":"hq-wisp-9vcwq","type":"blocks","created_at":"2026-01-17T00:28:22.207844379-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-9n87c","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:50:53.897965182-05:00","updated_at":"2026-01-16T23:51:29.96432066-05:00","closed_at":"2026-01-16T23:51:29.96432066-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-9n87c","depends_on_id":"hq-wisp-47par","type":"parent-child","created_at":"2026-01-16T23:50:55.462497009-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-9n87c","depends_on_id":"hq-wisp-1kzc5","type":"blocks","created_at":"2026-01-16T23:50:58.320412084-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-9nuh","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:05:01.103000967-05:00","updated_at":"2026-01-16T22:13:02.018971863-05:00","closed_at":"2026-01-16T22:13:02.018971863-05:00","close_reason":"Orphaned - forced cleanup","dependencies":[{"issue_id":"hq-wisp-9nuh","depends_on_id":"hq-wisp-xrtb","type":"parent-child","created_at":"2026-01-16T22:05:01.176710207-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-9nuh","depends_on_id":"hq-wisp-e0ky","type":"blocks","created_at":"2026-01-16T22:05:01.339487126-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-9ofmv","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:49:59.362224538-05:00","updated_at":"2026-01-17T10:49:59.36222458-05:00","dependencies":[{"issue_id":"hq-wisp-9ofmv","depends_on_id":"hq-wisp-wxw0u","type":"parent-child","created_at":"2026-01-17T10:49:59.987147964-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-9ofmv","depends_on_id":"hq-wisp-qbxwu","type":"blocks","created_at":"2026-01-17T10:50:00.959040354-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-9osz","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:15:01.19260585-05:00","updated_at":"2026-01-17T00:36:01.413376846-05:00","closed_at":"2026-01-17T00:36:01.413376846-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-9p1es","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:49:35.723455-05:00","updated_at":"2026-01-16T23:50:19.327921021-05:00","closed_at":"2026-01-16T23:50:19.327921021-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-9p1es","depends_on_id":"hq-wisp-n4f70","type":"parent-child","created_at":"2026-01-16T23:49:37.224099621-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-9p1es","depends_on_id":"hq-wisp-1kie5","type":"blocks","created_at":"2026-01-16T23:49:39.95117753-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-9pyi9","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:02:45.696866803-05:00","updated_at":"2026-01-17T01:05:27.365970344-05:00","closed_at":"2026-01-17T01:05:27.365970344-05:00","close_reason":"Idle town patrol","dependencies":[{"issue_id":"hq-wisp-9pyi9","depends_on_id":"hq-wisp-ji9jj","type":"parent-child","created_at":"2026-01-17T01:02:51.561562821-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-9pyi9","depends_on_id":"hq-wisp-lf8y9","type":"blocks","created_at":"2026-01-17T01:03:03.347095771-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-9r52","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:48:28.034817423-05:00","updated_at":"2026-01-16T22:13:02.054687943-05:00","closed_at":"2026-01-16T22:13:02.054687943-05:00","close_reason":"Orphaned - forced cleanup","dependencies":[{"issue_id":"hq-wisp-9r52","depends_on_id":"hq-wisp-mwjb","type":"parent-child","created_at":"2026-01-16T21:48:28.110827622-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-9r52","depends_on_id":"hq-wisp-42fa","type":"blocks","created_at":"2026-01-16T21:48:28.221406677-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-9rfof","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:04:43.444156601-05:00","updated_at":"2026-01-17T01:06:30.026294299-05:00","closed_at":"2026-01-17T01:06:30.026294299-05:00","close_reason":"No abandoned work","dependencies":[{"issue_id":"hq-wisp-9rfof","depends_on_id":"hq-wisp-bkl5l","type":"parent-child","created_at":"2026-01-17T01:04:50.520782426-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-9rfof","depends_on_id":"hq-wisp-f3joe","type":"blocks","created_at":"2026-01-17T01:05:02.546679021-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-9rhf","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T01:29:24.688995219-05:00","updated_at":"2026-01-16T01:50:39.208439899-05:00","closed_at":"2026-01-16T01:50:39.208439899-05:00","close_reason":"Stale patrol wisp cleanup","ephemeral":true}
{"id":"hq-wisp-9sdd","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:43:15.717286268-05:00","updated_at":"2026-01-16T21:45:02.718160682-05:00","closed_at":"2026-01-16T21:45:02.718160682-05:00","close_reason":"Closed","dependencies":[{"issue_id":"hq-wisp-9sdd","depends_on_id":"hq-wisp-l7vn","type":"parent-child","created_at":"2026-01-16T21:43:15.732787032-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-9sdd","depends_on_id":"hq-wisp-q4z4","type":"blocks","created_at":"2026-01-16T21:43:15.794328632-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-9t067","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:00:26.059153647-05:00","updated_at":"2026-01-17T01:01:17.345631783-05:00","closed_at":"2026-01-17T01:01:17.345631783-05:00","close_reason":"No notifications","dependencies":[{"issue_id":"hq-wisp-9t067","depends_on_id":"hq-wisp-5yxyi","type":"parent-child","created_at":"2026-01-17T01:00:29.375913774-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-9t067","depends_on_id":"hq-wisp-gw7j6","type":"blocks","created_at":"2026-01-17T01:00:39.348142663-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-9t7zk","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:44:43.6417549-05:00","updated_at":"2026-01-16T23:45:26.61519517-05:00","closed_at":"2026-01-16T23:45:26.61519517-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-9t7zk","depends_on_id":"hq-wisp-bhwu0","type":"parent-child","created_at":"2026-01-16T23:44:44.74437764-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-9t7zk","depends_on_id":"hq-wisp-eh1aj","type":"blocks","created_at":"2026-01-16T23:44:46.929814701-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-9vcwq","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:28:16.225149185-05:00","updated_at":"2026-01-17T00:28:36.357919571-05:00","closed_at":"2026-01-17T00:28:36.357919571-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-9vcwq","depends_on_id":"hq-wisp-tbive","type":"parent-child","created_at":"2026-01-17T00:28:17.542595908-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-9vcwq","depends_on_id":"hq-wisp-cw7xd","type":"blocks","created_at":"2026-01-17T00:28:21.537803055-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-9vny6","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:56:40.339506866-05:00","updated_at":"2026-01-17T00:58:07.099239059-05:00","closed_at":"2026-01-17T00:58:07.099239059-05:00","close_reason":"No abandoned work","dependencies":[{"issue_id":"hq-wisp-9vny6","depends_on_id":"hq-wisp-an994","type":"parent-child","created_at":"2026-01-17T00:56:47.050112957-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-9vny6","depends_on_id":"hq-wisp-w38er","type":"blocks","created_at":"2026-01-17T00:56:58.360166177-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-9vr1y","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:56:40.34106228-05:00","updated_at":"2026-01-17T00:58:19.66046397-05:00","closed_at":"2026-01-17T00:58:19.66046397-05:00","close_reason":"Costs not tracked","dependencies":[{"issue_id":"hq-wisp-9vr1y","depends_on_id":"hq-wisp-an994","type":"parent-child","created_at":"2026-01-17T00:56:48.168715887-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-9vr1y","depends_on_id":"hq-wisp-1wn18","type":"blocks","created_at":"2026-01-17T00:56:59.499739021-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-9w5t0","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:30:03.178540472-05:00","updated_at":"2026-01-17T00:30:30.393453268-05:00","closed_at":"2026-01-17T00:30:30.393453268-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-9w5t0","depends_on_id":"hq-wisp-8d16m","type":"parent-child","created_at":"2026-01-17T00:30:05.58535616-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-9w5t0","depends_on_id":"hq-wisp-loflk","type":"blocks","created_at":"2026-01-17T00:30:10.431844617-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-9we3","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:23:47.725351326-05:00","updated_at":"2026-01-17T00:35:53.533628305-05:00","closed_at":"2026-01-17T00:35:53.533628305-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-9whmu","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:53:25.159054371-05:00","updated_at":"2026-01-16T23:53:48.192441776-05:00","closed_at":"2026-01-16T23:53:48.192441776-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-9whmu","depends_on_id":"hq-wisp-of0wi","type":"parent-child","created_at":"2026-01-16T23:53:27.335035072-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-9whmu","depends_on_id":"hq-wisp-vd6rl","type":"blocks","created_at":"2026-01-16T23:53:30.738562162-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-9yel4","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:49:57.526179571-05:00","updated_at":"2026-01-17T10:49:57.526179571-05:00","dependencies":[{"issue_id":"hq-wisp-9yel4","depends_on_id":"hq-wisp-8agmn","type":"parent-child","created_at":"2026-01-17T10:49:58.064997714-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-9yel4","depends_on_id":"hq-wisp-w26ti","type":"blocks","created_at":"2026-01-17T10:49:58.852531878-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-9zavz","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:47:53.500897221-05:00","updated_at":"2026-01-16T23:48:33.109186396-05:00","closed_at":"2026-01-16T23:48:33.109186396-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-9zavz","depends_on_id":"hq-wisp-wj52z","type":"parent-child","created_at":"2026-01-16T23:47:54.443726569-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-9zavz","depends_on_id":"hq-wisp-bq5t5","type":"blocks","created_at":"2026-01-16T23:47:56.857277183-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-9zavz","depends_on_id":"hq-wisp-0w0wf","type":"blocks","created_at":"2026-01-16T23:47:56.995165689-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-9zavz","depends_on_id":"hq-wisp-ie1mh","type":"blocks","created_at":"2026-01-16T23:47:57.131669913-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-9ztqh","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:43:00.951092499-05:00","updated_at":"2026-01-17T00:44:50.389092553-05:00","closed_at":"2026-01-17T00:44:50.389092553-05:00","close_reason":"Inbox clear","dependencies":[{"issue_id":"hq-wisp-9ztqh","depends_on_id":"hq-wisp-jgnad","type":"parent-child","created_at":"2026-01-17T00:43:00.969591179-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-a0l5a","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:50:35.397981098-05:00","updated_at":"2026-01-16T23:51:24.122883109-05:00","closed_at":"2026-01-16T23:51:24.122883109-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-a0l5a","depends_on_id":"hq-wisp-t8b5z","type":"parent-child","created_at":"2026-01-16T23:50:36.305933236-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-a0l5a","depends_on_id":"hq-wisp-yazmn","type":"blocks","created_at":"2026-01-16T23:50:38.773765165-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-a0l5a","depends_on_id":"hq-wisp-1dwlv","type":"blocks","created_at":"2026-01-16T23:50:38.905988604-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-a0l5a","depends_on_id":"hq-wisp-xjqlz","type":"blocks","created_at":"2026-01-16T23:50:39.040469541-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-a2l31","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:07:28.964428769-05:00","updated_at":"2026-01-17T01:08:52.83089043-05:00","closed_at":"2026-01-17T01:08:52.83089043-05:00","close_reason":"No gate-ready","dependencies":[{"issue_id":"hq-wisp-a2l31","depends_on_id":"hq-wisp-fnimo","type":"parent-child","created_at":"2026-01-17T01:07:30.773575229-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-a2l31","depends_on_id":"hq-wisp-zq73z","type":"blocks","created_at":"2026-01-17T01:07:41.197719367-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-a2ocv","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:23:02.711345704-05:00","updated_at":"2026-01-17T00:24:26.784618577-05:00","closed_at":"2026-01-17T00:24:26.784618577-05:00","close_reason":"Cycle complete","dependencies":[{"issue_id":"hq-wisp-a2ocv","depends_on_id":"hq-wisp-93kdl","type":"parent-child","created_at":"2026-01-17T00:23:05.961304477-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-a2ocv","depends_on_id":"hq-wisp-yarnl","type":"blocks","created_at":"2026-01-17T00:23:09.894238691-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-a3xg","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:54:43.650919927-05:00","updated_at":"2026-01-16T01:56:30.787527609-05:00","closed_at":"2026-01-16T01:56:30.787527609-05:00","close_reason":"Orphan cleanup","dependencies":[{"issue_id":"hq-wisp-a3xg","depends_on_id":"hq-wisp-8okt","type":"parent-child","created_at":"2026-01-16T01:54:43.674472985-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-a3xg","depends_on_id":"hq-wisp-ngen","type":"blocks","created_at":"2026-01-16T01:54:43.721264184-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-a4qj7","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:53:25.156826206-05:00","updated_at":"2026-01-16T23:53:48.994660951-05:00","closed_at":"2026-01-16T23:53:48.994660951-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-a4qj7","depends_on_id":"hq-wisp-of0wi","type":"parent-child","created_at":"2026-01-16T23:53:26.664442963-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-a4qj7","depends_on_id":"hq-wisp-mgdg4","type":"blocks","created_at":"2026-01-16T23:53:30.059159768-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-a5ye3","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:52:58.27163039-05:00","updated_at":"2026-01-16T23:53:19.246841628-05:00","closed_at":"2026-01-16T23:53:19.246841628-05:00","close_reason":"Patrol 19 complete","ephemeral":true}
{"id":"hq-wisp-a64n7","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:43:06.012073936-05:00","updated_at":"2026-01-16T23:43:34.154136698-05:00","closed_at":"2026-01-16T23:43:34.154136698-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-a64n7","depends_on_id":"hq-wisp-p7g8j","type":"parent-child","created_at":"2026-01-16T23:43:07.0914184-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-a64n7","depends_on_id":"hq-wisp-dc7su","type":"blocks","created_at":"2026-01-16T23:43:09.270031253-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-a68it","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:40:19.878822275-05:00","updated_at":"2026-01-16T23:41:34.565143048-05:00","closed_at":"2026-01-16T23:41:34.565143048-05:00","close_reason":"Routine checks passed","dependencies":[{"issue_id":"hq-wisp-a68it","depends_on_id":"hq-wisp-6gnpy","type":"parent-child","created_at":"2026-01-16T23:40:21.34823821-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-a68it","depends_on_id":"hq-wisp-dvda1","type":"blocks","created_at":"2026-01-16T23:40:23.340139995-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-a7mlw","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:52:58.279345384-05:00","updated_at":"2026-01-16T23:53:16.758754834-05:00","closed_at":"2026-01-16T23:53:16.758754834-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-a7mlw","depends_on_id":"hq-wisp-a5ye3","type":"parent-child","created_at":"2026-01-16T23:52:59.754429249-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-a7mlw","depends_on_id":"hq-wisp-277rl","type":"blocks","created_at":"2026-01-16T23:53:03.076384235-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-a9xp","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:36:59.342545328-05:00","updated_at":"2026-01-16T23:39:02.979449748-05:00","closed_at":"2026-01-16T23:39:02.979449748-05:00","close_reason":"6 dogs working, pool at capacity (max 4)","dependencies":[{"issue_id":"hq-wisp-a9xp","depends_on_id":"hq-wisp-c8tl","type":"parent-child","created_at":"2026-01-16T23:37:00.153895431-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-a9xp","depends_on_id":"hq-wisp-ykx2","type":"blocks","created_at":"2026-01-16T23:37:01.800423468-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-aa5xc","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:31:03.245063129-05:00","updated_at":"2026-01-17T00:31:19.817618403-05:00","closed_at":"2026-01-17T00:31:19.817618403-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-aa5xc","depends_on_id":"hq-wisp-apmz9","type":"parent-child","created_at":"2026-01-17T00:31:04.013038809-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-aa5xc","depends_on_id":"hq-wisp-b0eny","type":"blocks","created_at":"2026-01-17T00:31:08.625432092-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-aap3","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:56:35.920802561-05:00","updated_at":"2026-01-16T22:13:02.198632136-05:00","closed_at":"2026-01-16T22:13:02.198632136-05:00","close_reason":"Orphaned - forced cleanup","dependencies":[{"issue_id":"hq-wisp-aap3","depends_on_id":"hq-wisp-8d7d","type":"parent-child","created_at":"2026-01-16T01:56:35.940455623-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-aap3","depends_on_id":"hq-wisp-kzrr","type":"blocks","created_at":"2026-01-16T01:56:35.980940954-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-aap3","depends_on_id":"hq-wisp-zstq","type":"blocks","created_at":"2026-01-16T01:56:35.983658576-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-aap3","depends_on_id":"hq-wisp-f1m8","type":"blocks","created_at":"2026-01-16T01:56:35.986661739-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-abai8","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:52:50.339687227-05:00","updated_at":"2026-01-17T00:56:28.70906302-05:00","closed_at":"2026-01-17T00:56:28.70906302-05:00","close_reason":"Looping - patrol 13 of 20","dependencies":[{"issue_id":"hq-wisp-abai8","depends_on_id":"hq-wisp-xo3wl","type":"parent-child","created_at":"2026-01-17T00:53:00.154154207-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-abai8","depends_on_id":"hq-wisp-pahey","type":"blocks","created_at":"2026-01-17T00:53:11.133740165-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ac04f","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:45:48.841350183-05:00","updated_at":"2026-01-16T23:46:53.864397875-05:00","closed_at":"2026-01-16T23:46:53.864397875-05:00","close_reason":"No plugins","dependencies":[{"issue_id":"hq-wisp-ac04f","depends_on_id":"hq-wisp-2heyl","type":"parent-child","created_at":"2026-01-16T23:45:49.988413999-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ac04f","depends_on_id":"hq-wisp-fktci","type":"blocks","created_at":"2026-01-16T23:45:52.528183807-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-aca21","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:41:51.248842811-05:00","updated_at":"2026-01-16T23:42:32.407699339-05:00","closed_at":"2026-01-16T23:42:32.407699339-05:00","close_reason":"Nothing to process","dependencies":[{"issue_id":"hq-wisp-aca21","depends_on_id":"hq-wisp-tnkch","type":"parent-child","created_at":"2026-01-16T23:41:51.569414186-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-aca21","depends_on_id":"hq-wisp-eue01","type":"blocks","created_at":"2026-01-16T23:41:53.451334193-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-acoj","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:23:47.7346782-05:00","updated_at":"2026-01-16T23:25:01.567978249-05:00","closed_at":"2026-01-16T23:25:01.567978249-05:00","close_reason":"No zombies, dogs present","dependencies":[{"issue_id":"hq-wisp-acoj","depends_on_id":"hq-wisp-9we3","type":"parent-child","created_at":"2026-01-16T23:23:48.504409682-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-acoj","depends_on_id":"hq-wisp-u8f3","type":"blocks","created_at":"2026-01-16T23:23:50.453422136-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-adb3l","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:51:56.827187321-05:00","updated_at":"2026-01-16T23:52:52.222867168-05:00","closed_at":"2026-01-16T23:52:52.222867168-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-adb3l","depends_on_id":"hq-wisp-ri9se","type":"parent-child","created_at":"2026-01-16T23:51:57.001697268-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-adb3l","depends_on_id":"hq-wisp-2y91t","type":"blocks","created_at":"2026-01-16T23:51:59.961179681-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-adcv","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:46:26.939546396-05:00","updated_at":"2026-01-16T01:51:58.262125043-05:00","closed_at":"2026-01-16T01:51:58.262125043-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-adcv","depends_on_id":"hq-wisp-ybkc","type":"parent-child","created_at":"2026-01-16T01:46:27.037726457-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-adcv","depends_on_id":"hq-wisp-zt3r","type":"blocks","created_at":"2026-01-16T01:46:27.25941205-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-aejyz","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:54:08.826895652-05:00","updated_at":"2026-01-16T23:55:04.174188872-05:00","closed_at":"2026-01-16T23:55:04.174188872-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-aejyz","depends_on_id":"hq-wisp-oecdp","type":"parent-child","created_at":"2026-01-16T23:54:08.838429102-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-afmq","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:21:24.466623178-05:00","updated_at":"2026-01-16T23:21:54.328094892-05:00","closed_at":"2026-01-16T23:21:54.328094892-05:00","close_reason":"No gates/convoys/pending","dependencies":[{"issue_id":"hq-wisp-afmq","depends_on_id":"hq-wisp-87xr","type":"parent-child","created_at":"2026-01-16T23:21:24.638095531-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-afmq","depends_on_id":"hq-wisp-epei","type":"blocks","created_at":"2026-01-16T23:21:26.178281752-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-aftt5","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:49:57.523180573-05:00","updated_at":"2026-01-17T10:49:57.523180615-05:00","dependencies":[{"issue_id":"hq-wisp-aftt5","depends_on_id":"hq-wisp-8agmn","type":"parent-child","created_at":"2026-01-17T10:49:57.912296137-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-aftt5","depends_on_id":"hq-wisp-g6qj9","type":"blocks","created_at":"2026-01-17T10:49:58.68802385-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-agne2","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:44:41.999959825-05:00","updated_at":"2026-01-17T10:44:41.999959866-05:00","dependencies":[{"issue_id":"hq-wisp-agne2","depends_on_id":"hq-wisp-qd1hf","type":"parent-child","created_at":"2026-01-17T10:44:42.131931867-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-agne2","depends_on_id":"hq-wisp-6oonj","type":"blocks","created_at":"2026-01-17T10:44:42.416230334-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-agsn","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-16T21:46:57.285331342-05:00","updated_at":"2026-01-16T21:47:34.037095425-05:00","closed_at":"2026-01-16T21:47:34.037095425-05:00","close_reason":"Idle","ephemeral":true}
{"id":"hq-wisp-agumj","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:46:50.732656701-05:00","updated_at":"2026-01-17T10:46:50.732656742-05:00","dependencies":[{"issue_id":"hq-wisp-agumj","depends_on_id":"hq-wisp-2vhlh","type":"parent-child","created_at":"2026-01-17T10:46:51.197727137-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-agumj","depends_on_id":"hq-wisp-qe6n6","type":"blocks","created_at":"2026-01-17T10:46:51.763158764-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-aiwl","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:26:29.473038755-05:00","updated_at":"2026-01-16T01:52:14.014586474-05:00","closed_at":"2026-01-16T01:52:14.014586474-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-aiwl","depends_on_id":"hq-wisp-zv2x","type":"parent-child","created_at":"2026-01-16T01:26:29.478657957-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-al98y","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:45:17.102488626-05:00","updated_at":"2026-01-17T00:35:34.732886196-05:00","closed_at":"2026-01-17T00:35:34.732886196-05:00","close_reason":"Cleanup","ephemeral":true}
{"id":"hq-wisp-alrkg","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:49:35.719222385-05:00","updated_at":"2026-01-16T23:50:21.259731242-05:00","closed_at":"2026-01-16T23:50:21.259731242-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-alrkg","depends_on_id":"hq-wisp-n4f70","type":"parent-child","created_at":"2026-01-16T23:49:36.134156773-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-alrkg","depends_on_id":"hq-wisp-nf972","type":"blocks","created_at":"2026-01-16T23:49:38.576031623-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-amjfv","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:07:28.966963932-05:00","updated_at":"2026-01-17T01:08:55.823098579-05:00","closed_at":"2026-01-17T01:08:55.823098579-05:00","close_reason":"No notifications","dependencies":[{"issue_id":"hq-wisp-amjfv","depends_on_id":"hq-wisp-fnimo","type":"parent-child","created_at":"2026-01-17T01:07:32.528107565-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-amjfv","depends_on_id":"hq-wisp-pzkc5","type":"blocks","created_at":"2026-01-17T01:07:42.933392734-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-an994","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T00:56:40.326516719-05:00","updated_at":"2026-01-17T00:58:38.695100263-05:00","closed_at":"2026-01-17T00:58:38.695100263-05:00","close_reason":"Patrol 14 complete","ephemeral":true}
{"id":"hq-wisp-ap4db","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:49:57.52244299-05:00","updated_at":"2026-01-17T10:49:57.522443032-05:00","dependencies":[{"issue_id":"hq-wisp-ap4db","depends_on_id":"hq-wisp-8agmn","type":"parent-child","created_at":"2026-01-17T10:49:57.874328617-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ap4db","depends_on_id":"hq-wisp-75p3a","type":"blocks","created_at":"2026-01-17T10:49:58.649172414-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ap4z","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T22:14:44.679394064-05:00","updated_at":"2026-01-17T00:36:34.822175392-05:00","closed_at":"2026-01-17T00:36:34.822175392-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-apmz9","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T00:31:03.240255011-05:00","updated_at":"2026-01-17T00:31:25.579575655-05:00","closed_at":"2026-01-17T00:31:25.579575655-05:00","close_reason":"Patrol cycle 12 complete","ephemeral":true}
{"id":"hq-wisp-aq9l","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:27:24.237186177-05:00","updated_at":"2026-01-16T01:52:13.786349431-05:00","closed_at":"2026-01-16T01:52:13.786349431-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-aq9l","depends_on_id":"hq-wisp-nv4o","type":"parent-child","created_at":"2026-01-16T01:27:24.31577672-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-aq9l","depends_on_id":"hq-wisp-eomm","type":"blocks","created_at":"2026-01-16T01:27:24.494654034-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-at2b","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T22:17:07.909996543-05:00","updated_at":"2026-01-17T00:36:22.552266399-05:00","closed_at":"2026-01-17T00:36:22.552266399-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-au6rx","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:04:43.434036825-05:00","updated_at":"2026-01-17T01:05:31.578801593-05:00","closed_at":"2026-01-17T01:05:31.578801593-05:00","close_reason":"Inbox clear","dependencies":[{"issue_id":"hq-wisp-au6rx","depends_on_id":"hq-wisp-bkl5l","type":"parent-child","created_at":"2026-01-17T01:04:43.450157384-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-au9x2","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T00:39:11.150356681-05:00","updated_at":"2026-01-17T00:39:28.368275397-05:00","closed_at":"2026-01-17T00:39:28.368275397-05:00","close_reason":"OK","ephemeral":true}
{"id":"hq-wisp-av8t","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T22:54:29.567685981-05:00","updated_at":"2026-01-17T00:36:16.507077118-05:00","closed_at":"2026-01-17T00:36:16.507077118-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-avs4h","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:43:06.014902266-05:00","updated_at":"2026-01-16T23:43:29.110304412-05:00","closed_at":"2026-01-16T23:43:29.110304412-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-avs4h","depends_on_id":"hq-wisp-p7g8j","type":"parent-child","created_at":"2026-01-16T23:43:07.734753138-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-avs4h","depends_on_id":"hq-wisp-1saa6","type":"blocks","created_at":"2026-01-16T23:43:09.99759121-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-axmec","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:23:47.739970157-05:00","updated_at":"2026-01-16T23:25:43.043289087-05:00","closed_at":"2026-01-16T23:25:43.043289087-05:00","close_reason":"End-of-cycle, looping","dependencies":[{"issue_id":"hq-wisp-axmec","depends_on_id":"hq-wisp-9we3","type":"parent-child","created_at":"2026-01-16T23:23:49.192184426-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-axmec","depends_on_id":"hq-wisp-745ro","type":"blocks","created_at":"2026-01-16T23:23:51.154368794-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ayg1","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:42:27.173398422-05:00","updated_at":"2026-01-16T01:52:13.632549765-05:00","closed_at":"2026-01-16T01:52:13.632549765-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-ayg1","depends_on_id":"hq-wisp-wqti","type":"parent-child","created_at":"2026-01-16T01:42:27.236773561-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ayg1","depends_on_id":"hq-wisp-ywu7","type":"blocks","created_at":"2026-01-16T01:42:27.453552116-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-b0e74","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:54:08.835134104-05:00","updated_at":"2026-01-16T23:54:53.87220728-05:00","closed_at":"2026-01-16T23:54:53.87220728-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-b0e74","depends_on_id":"hq-wisp-oecdp","type":"parent-child","created_at":"2026-01-16T23:54:11.082280709-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-b0e74","depends_on_id":"hq-wisp-75yld","type":"blocks","created_at":"2026-01-16T23:54:14.350517528-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-b0eny","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:31:03.244273964-05:00","updated_at":"2026-01-17T00:31:17.968930458-05:00","closed_at":"2026-01-17T00:31:17.968930458-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-b0eny","depends_on_id":"hq-wisp-apmz9","type":"parent-child","created_at":"2026-01-17T00:31:03.761068994-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-b0eny","depends_on_id":"hq-wisp-1vntb","type":"blocks","created_at":"2026-01-17T00:31:08.368653992-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-b28s8","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:51:56.83456044-05:00","updated_at":"2026-01-16T23:52:27.642645789-05:00","closed_at":"2026-01-16T23:52:27.642645789-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-b28s8","depends_on_id":"hq-wisp-ri9se","type":"parent-child","created_at":"2026-01-16T23:51:58.97360678-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-b28s8","depends_on_id":"hq-wisp-10u87","type":"blocks","created_at":"2026-01-16T23:52:02.300668199-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-b68x","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:48:28.029738891-05:00","updated_at":"2026-01-16T22:13:02.124215813-05:00","closed_at":"2026-01-16T22:13:02.124215813-05:00","close_reason":"Orphaned - forced cleanup","dependencies":[{"issue_id":"hq-wisp-b68x","depends_on_id":"hq-wisp-mwjb","type":"parent-child","created_at":"2026-01-16T21:48:28.048640732-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-b68x","depends_on_id":"hq-wisp-dr1h","type":"blocks","created_at":"2026-01-16T21:48:28.124953931-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-b7xd","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T22:44:38.049778166-05:00","updated_at":"2026-01-17T00:36:17.45600145-05:00","closed_at":"2026-01-17T00:36:17.45600145-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-b7xpn","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:49:57.51962445-05:00","updated_at":"2026-01-17T10:49:57.519624492-05:00","dependencies":[{"issue_id":"hq-wisp-b7xpn","depends_on_id":"hq-wisp-8agmn","type":"parent-child","created_at":"2026-01-17T10:49:57.720701749-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-b7xpn","depends_on_id":"hq-wisp-vs5wm","type":"blocks","created_at":"2026-01-17T10:49:58.413957843-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-b87qd","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:43:56.992660067-05:00","updated_at":"2026-01-16T23:44:32.264623222-05:00","closed_at":"2026-01-16T23:44:32.264623222-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-b87qd","depends_on_id":"hq-wisp-ywecn","type":"parent-child","created_at":"2026-01-16T23:43:57.613060112-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-b87qd","depends_on_id":"hq-wisp-gsuxv","type":"blocks","created_at":"2026-01-16T23:43:59.490241869-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-b9ea","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T01:53:32.244173625-05:00","updated_at":"2026-01-16T22:12:29.252216815-05:00","closed_at":"2026-01-16T22:12:29.252216815-05:00","close_reason":"Orphaned - bulk cleanup","ephemeral":true}
{"id":"hq-wisp-b9h7w","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:52:58.273656471-05:00","updated_at":"2026-01-16T23:53:14.302871182-05:00","closed_at":"2026-01-16T23:53:14.302871182-05:00","close_reason":"Inbox empty","dependencies":[{"issue_id":"hq-wisp-b9h7w","depends_on_id":"hq-wisp-a5ye3","type":"parent-child","created_at":"2026-01-16T23:52:58.286019004-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-b9jd","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T01:25:42.364118773-05:00","updated_at":"2026-01-16T01:50:39.322165025-05:00","closed_at":"2026-01-16T01:50:39.322165025-05:00","close_reason":"Stale patrol wisp cleanup","ephemeral":true}
{"id":"hq-wisp-bc416","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:44:41.997123711-05:00","updated_at":"2026-01-17T10:44:41.997123752-05:00","dependencies":[{"issue_id":"hq-wisp-bc416","depends_on_id":"hq-wisp-qd1hf","type":"parent-child","created_at":"2026-01-17T10:44:42.078014905-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-bc416","depends_on_id":"hq-wisp-4usc8","type":"blocks","created_at":"2026-01-17T10:44:42.323787475-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-bcf","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T00:42:51.251918249-05:00","updated_at":"2026-01-16T01:50:39.628484733-05:00","closed_at":"2026-01-16T01:50:39.628484733-05:00","close_reason":"Stale patrol wisp cleanup","ephemeral":true}
{"id":"hq-wisp-bcyui","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:02:45.701283629-05:00","updated_at":"2026-01-17T01:05:24.282779734-05:00","closed_at":"2026-01-17T01:05:24.282779734-05:00","close_reason":"Idle town patrol","dependencies":[{"issue_id":"hq-wisp-bcyui","depends_on_id":"hq-wisp-ji9jj","type":"parent-child","created_at":"2026-01-17T01:02:54.488790609-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-bcyui","depends_on_id":"hq-wisp-0a64y","type":"blocks","created_at":"2026-01-17T01:03:06.312143751-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-bczni","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:46:10.399703134-05:00","updated_at":"2026-01-17T10:46:10.399703176-05:00","dependencies":[{"issue_id":"hq-wisp-bczni","depends_on_id":"hq-wisp-bio5t","type":"parent-child","created_at":"2026-01-17T10:46:10.413570751-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-bd21","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:19:36.429480573-05:00","updated_at":"2026-01-16T23:20:09.509821177-05:00","closed_at":"2026-01-16T23:20:09.509821177-05:00","close_reason":"Inbox empty","dependencies":[{"issue_id":"hq-wisp-bd21","depends_on_id":"hq-wisp-pfs9","type":"parent-child","created_at":"2026-01-16T23:19:36.437559697-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-bdss1","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:04:43.438388319-05:00","updated_at":"2026-01-17T01:06:05.446345081-05:00","closed_at":"2026-01-17T01:06:05.446345081-05:00","close_reason":"No external deps","dependencies":[{"issue_id":"hq-wisp-bdss1","depends_on_id":"hq-wisp-bkl5l","type":"parent-child","created_at":"2026-01-17T01:04:46.354163932-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-bdss1","depends_on_id":"hq-wisp-3uzxy","type":"blocks","created_at":"2026-01-17T01:04:57.175615034-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-bfu9u","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T10:47:55.316883244-05:00","updated_at":"2026-01-17T10:51:04.186856933-05:00","closed_at":"2026-01-17T10:51:04.186856933-05:00","close_reason":"Nothing to process","dependencies":[{"issue_id":"hq-wisp-bfu9u","depends_on_id":"hq-wisp-9hr1x","type":"parent-child","created_at":"2026-01-17T10:47:55.474611402-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-bfu9u","depends_on_id":"hq-wisp-qdo07","type":"blocks","created_at":"2026-01-17T10:47:56.157185586-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-bgiy","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:43:15.720112596-05:00","updated_at":"2026-01-16T22:13:02.150102197-05:00","closed_at":"2026-01-16T22:13:02.150102197-05:00","close_reason":"Orphaned - forced cleanup","dependencies":[{"issue_id":"hq-wisp-bgiy","depends_on_id":"hq-wisp-l7vn","type":"parent-child","created_at":"2026-01-16T21:43:15.767158263-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-bgiy","depends_on_id":"hq-wisp-cdcw","type":"blocks","created_at":"2026-01-16T21:43:15.840802341-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-bgrao","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:07:28.976028959-05:00","updated_at":"2026-01-17T01:09:33.170231402-05:00","closed_at":"2026-01-17T01:09:33.170231402-05:00","close_reason":"Context low","dependencies":[{"issue_id":"hq-wisp-bgrao","depends_on_id":"hq-wisp-fnimo","type":"parent-child","created_at":"2026-01-17T01:07:38.891485853-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-bgrao","depends_on_id":"hq-wisp-uwinq","type":"blocks","created_at":"2026-01-17T01:07:50.588363999-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-bhwu0","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:44:43.550815019-05:00","updated_at":"2026-01-16T23:45:37.630231475-05:00","closed_at":"2026-01-16T23:45:37.630231475-05:00","close_reason":"Patrol cycle 10 complete","ephemeral":true}
{"id":"hq-wisp-bijru","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:44:43.644231416-05:00","updated_at":"2026-01-16T23:45:23.888190366-05:00","closed_at":"2026-01-16T23:45:23.888190366-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-bijru","depends_on_id":"hq-wisp-bhwu0","type":"parent-child","created_at":"2026-01-16T23:44:45.068999363-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-bijru","depends_on_id":"hq-wisp-suovp","type":"blocks","created_at":"2026-01-16T23:44:47.262278718-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-bio5t","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"hooked","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T10:46:10.396468219-05:00","updated_at":"2026-01-17T10:46:11.532111138-05:00","ephemeral":true}
{"id":"hq-wisp-bjgky","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:09:41.616374421-05:00","updated_at":"2026-01-17T01:11:02.670225708-05:00","closed_at":"2026-01-17T01:11:02.670225708-05:00","close_reason":"Costs not tracked","dependencies":[{"issue_id":"hq-wisp-bjgky","depends_on_id":"hq-wisp-fsms9","type":"parent-child","created_at":"2026-01-17T01:09:50.096289967-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-bjgky","depends_on_id":"hq-wisp-5g2fe","type":"blocks","created_at":"2026-01-17T01:10:02.548016373-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-bkl5l","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T01:04:43.431902662-05:00","updated_at":"2026-01-17T01:07:27.869254317-05:00","closed_at":"2026-01-17T01:07:27.869254317-05:00","close_reason":"Patrol 18 complete","ephemeral":true}
{"id":"hq-wisp-bm8pk","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:46:50.725527663-05:00","updated_at":"2026-01-17T10:46:50.725527705-05:00","dependencies":[{"issue_id":"hq-wisp-bm8pk","depends_on_id":"hq-wisp-2vhlh","type":"parent-child","created_at":"2026-01-17T10:46:50.938920872-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-bm8pk","depends_on_id":"hq-wisp-km5a5","type":"blocks","created_at":"2026-01-17T10:46:51.469116228-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-bmk","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T00:53:02.83970467-05:00","updated_at":"2026-01-16T00:54:15.240080223-05:00","closed_at":"2026-01-16T00:54:15.240080223-05:00","close_reason":"Town healthy","ephemeral":true}
{"id":"hq-wisp-bml8","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:26:29.473382171-05:00","updated_at":"2026-01-16T01:52:14.008919855-05:00","closed_at":"2026-01-16T01:52:14.008919855-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-bml8","depends_on_id":"hq-wisp-zv2x","type":"parent-child","created_at":"2026-01-16T01:26:29.484930659-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-bml8","depends_on_id":"hq-wisp-aiwl","type":"blocks","created_at":"2026-01-16T01:26:29.599738581-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-bn7j4","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:56:40.332507168-05:00","updated_at":"2026-01-17T00:57:34.915150338-05:00","closed_at":"2026-01-17T00:57:34.915150338-05:00","close_reason":"No convoys","dependencies":[{"issue_id":"hq-wisp-bn7j4","depends_on_id":"hq-wisp-an994","type":"parent-child","created_at":"2026-01-17T00:56:42.525742293-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-bn7j4","depends_on_id":"hq-wisp-2uibz","type":"blocks","created_at":"2026-01-17T00:56:52.711768789-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-bnofj","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T10:49:59.353160002-05:00","updated_at":"2026-01-17T11:42:50.583928167-05:00","closed_at":"2026-01-17T11:42:50.583928167-05:00","close_reason":"Inbox empty, no callbacks to process","dependencies":[{"issue_id":"hq-wisp-bnofj","depends_on_id":"hq-wisp-wxw0u","type":"parent-child","created_at":"2026-01-17T10:49:59.366528494-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-bns1","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:46:01.53393057-05:00","updated_at":"2026-01-16T01:51:58.295420549-05:00","closed_at":"2026-01-16T01:51:58.295420549-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-bns1","depends_on_id":"hq-wisp-xunp","type":"parent-child","created_at":"2026-01-16T01:46:01.699617266-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-bns1","depends_on_id":"hq-wisp-2uit","type":"blocks","created_at":"2026-01-16T01:46:01.901614131-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-bo26","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:42:27.172564464-05:00","updated_at":"2026-01-16T01:52:13.65846182-05:00","closed_at":"2026-01-16T01:52:13.65846182-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-bo26","depends_on_id":"hq-wisp-wqti","type":"parent-child","created_at":"2026-01-16T01:42:27.201802099-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-bo26","depends_on_id":"hq-wisp-7xkx","type":"blocks","created_at":"2026-01-16T01:42:27.416765198-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-booy4","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:45:48.844308986-05:00","updated_at":"2026-01-16T23:47:03.614258132-05:00","closed_at":"2026-01-16T23:47:03.614258132-05:00","close_reason":"Log size under threshold","dependencies":[{"issue_id":"hq-wisp-booy4","depends_on_id":"hq-wisp-2heyl","type":"parent-child","created_at":"2026-01-16T23:45:50.742104853-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-booy4","depends_on_id":"hq-wisp-iyayf","type":"blocks","created_at":"2026-01-16T23:45:53.306788483-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-bou8","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","assignee":"deacon","created_at":"2026-01-16T22:15:53.877117957-05:00","updated_at":"2026-01-17T00:36:23.753543383-05:00","closed_at":"2026-01-17T00:36:23.753543383-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-bp4d3","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:43:00.952379997-05:00","updated_at":"2026-01-17T00:50:24.744241132-05:00","closed_at":"2026-01-17T00:50:24.744241132-05:00","close_reason":"No pending spawns","dependencies":[{"issue_id":"hq-wisp-bp4d3","depends_on_id":"hq-wisp-jgnad","type":"parent-child","created_at":"2026-01-17T00:43:01.450141856-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-bp4d3","depends_on_id":"hq-wisp-9ztqh","type":"blocks","created_at":"2026-01-17T00:43:10.012504806-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-bq5t5","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:47:53.497585825-05:00","updated_at":"2026-01-16T23:48:39.017239887-05:00","closed_at":"2026-01-16T23:48:39.017239887-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-bq5t5","depends_on_id":"hq-wisp-wj52z","type":"parent-child","created_at":"2026-01-16T23:47:53.639645181-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-bq5t5","depends_on_id":"hq-wisp-idkop","type":"blocks","created_at":"2026-01-16T23:47:56.045394967-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-bqda7","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:49:41.448779741-05:00","updated_at":"2026-01-16T23:50:15.300738534-05:00","closed_at":"2026-01-16T23:50:15.300738534-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-bqda7","depends_on_id":"hq-wisp-q54v3","type":"parent-child","created_at":"2026-01-16T23:49:43.148591033-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-bqda7","depends_on_id":"hq-wisp-g8o7e","type":"blocks","created_at":"2026-01-16T23:49:46.014569959-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-bqrb","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:54:43.651490218-05:00","updated_at":"2026-01-16T01:56:30.78234349-05:00","closed_at":"2026-01-16T01:56:30.78234349-05:00","close_reason":"Orphan cleanup","dependencies":[{"issue_id":"hq-wisp-bqrb","depends_on_id":"hq-wisp-8okt","type":"parent-child","created_at":"2026-01-16T01:54:43.678292147-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-bqrb","depends_on_id":"hq-wisp-tffu","type":"blocks","created_at":"2026-01-16T01:54:43.727087219-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-brbp","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T01:39:57.148521117-05:00","updated_at":"2026-01-16T01:50:39.052529861-05:00","closed_at":"2026-01-16T01:50:39.052529861-05:00","close_reason":"Stale patrol wisp cleanup","ephemeral":true}
{"id":"hq-wisp-brdrk","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:43:00.955714451-05:00","updated_at":"2026-01-17T00:50:48.445237761-05:00","closed_at":"2026-01-17T00:50:48.445237761-05:00","close_reason":"No external deps to resolve","dependencies":[{"issue_id":"hq-wisp-brdrk","depends_on_id":"hq-wisp-jgnad","type":"parent-child","created_at":"2026-01-17T00:43:03.339848574-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-brdrk","depends_on_id":"hq-wisp-z9ofl","type":"blocks","created_at":"2026-01-17T00:43:11.915784877-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-brq0","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:56:35.921698935-05:00","updated_at":"2026-01-16T22:13:02.188766148-05:00","closed_at":"2026-01-16T22:13:02.188766148-05:00","close_reason":"Orphaned - forced cleanup","dependencies":[{"issue_id":"hq-wisp-brq0","depends_on_id":"hq-wisp-8d7d","type":"parent-child","created_at":"2026-01-16T01:56:35.946617908-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-brq0","depends_on_id":"hq-wisp-aap3","type":"blocks","created_at":"2026-01-16T01:56:35.995176521-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-bs78w","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:43:06.012548512-05:00","updated_at":"2026-01-16T23:43:33.461813586-05:00","closed_at":"2026-01-16T23:43:33.461813586-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-bs78w","depends_on_id":"hq-wisp-p7g8j","type":"parent-child","created_at":"2026-01-16T23:43:07.198017047-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-bs78w","depends_on_id":"hq-wisp-a64n7","type":"blocks","created_at":"2026-01-16T23:43:09.381822774-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-bsboi","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:12:55.88454003-05:00","updated_at":"2026-01-17T01:59:39.20394268-05:00","closed_at":"2026-01-17T01:59:39.20394268-05:00","close_reason":"No polecats to check for zombies","dependencies":[{"issue_id":"hq-wisp-bsboi","depends_on_id":"hq-wisp-i2n82","type":"parent-child","created_at":"2026-01-17T01:13:00.77639933-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-bsboi","depends_on_id":"hq-wisp-e6srr","type":"blocks","created_at":"2026-01-17T01:13:13.060959431-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-bt23x","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:25:48.57907017-05:00","updated_at":"2026-01-17T00:26:22.118524676-05:00","closed_at":"2026-01-17T00:26:22.118524676-05:00","close_reason":"Inbox empty","dependencies":[{"issue_id":"hq-wisp-bt23x","depends_on_id":"hq-wisp-44ngw","type":"parent-child","created_at":"2026-01-17T00:25:48.59417656-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-bv16","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:55:36.786051831-05:00","updated_at":"2026-01-16T01:56:30.729040048-05:00","closed_at":"2026-01-16T01:56:30.729040048-05:00","close_reason":"Orphan cleanup","dependencies":[{"issue_id":"hq-wisp-bv16","depends_on_id":"hq-wisp-ndqt","type":"parent-child","created_at":"2026-01-16T01:55:36.907979574-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-bv16","depends_on_id":"hq-wisp-ydb0","type":"blocks","created_at":"2026-01-16T01:55:37.056257537-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-bxau5","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T00:42:22.067760374-05:00","updated_at":"2026-01-17T00:43:00.083179418-05:00","closed_at":"2026-01-17T00:43:00.083179418-05:00","close_reason":"OK","ephemeral":true}
{"id":"hq-wisp-bxj","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T00:43:45.668332087-05:00","updated_at":"2026-01-16T01:50:39.517612521-05:00","closed_at":"2026-01-16T01:50:39.517612521-05:00","close_reason":"Stale patrol wisp cleanup","ephemeral":true}
{"id":"hq-wisp-bxtx","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:15:01.196035391-05:00","updated_at":"2026-01-16T23:15:59.131394365-05:00","closed_at":"2026-01-16T23:15:59.131394365-05:00","close_reason":"No gates, convoys, or pending polecats","dependencies":[{"issue_id":"hq-wisp-bxtx","depends_on_id":"hq-wisp-9osz","type":"parent-child","created_at":"2026-01-16T23:15:01.476868866-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-bxtx","depends_on_id":"hq-wisp-mut6","type":"blocks","created_at":"2026-01-16T23:15:02.733912862-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-bznmt","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:54:08.828741776-05:00","updated_at":"2026-01-16T23:55:01.531025234-05:00","closed_at":"2026-01-16T23:55:01.531025234-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-bznmt","depends_on_id":"hq-wisp-oecdp","type":"parent-child","created_at":"2026-01-16T23:54:09.317221067-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-bznmt","depends_on_id":"hq-wisp-okmju","type":"blocks","created_at":"2026-01-16T23:54:12.219112501-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-c0fhj","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:52:50.328546248-05:00","updated_at":"2026-01-17T00:55:04.779823838-05:00","closed_at":"2026-01-17T00:55:04.779823838-05:00","close_reason":"No external deps","dependencies":[{"issue_id":"hq-wisp-c0fhj","depends_on_id":"hq-wisp-xo3wl","type":"parent-child","created_at":"2026-01-17T00:52:53.034408262-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-c0fhj","depends_on_id":"hq-wisp-t27da","type":"blocks","created_at":"2026-01-17T00:53:02.885503004-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-c0jyu","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:49:41.452268733-05:00","updated_at":"2026-01-16T23:50:02.263585336-05:00","closed_at":"2026-01-16T23:50:02.263585336-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-c0jyu","depends_on_id":"hq-wisp-q54v3","type":"parent-child","created_at":"2026-01-16T23:49:43.992658109-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-c0jyu","depends_on_id":"hq-wisp-zs8z5","type":"blocks","created_at":"2026-01-16T23:49:46.884988266-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-c0nj","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:46:26.941566977-05:00","updated_at":"2026-01-16T01:51:58.13628268-05:00","closed_at":"2026-01-16T01:51:58.13628268-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-c0nj","depends_on_id":"hq-wisp-ybkc","type":"parent-child","created_at":"2026-01-16T01:46:27.123453739-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-c0nj","depends_on_id":"hq-wisp-l4uv","type":"blocks","created_at":"2026-01-16T01:46:27.355924695-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-c3ill","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:23:02.705229927-05:00","updated_at":"2026-01-17T00:24:20.178682499-05:00","closed_at":"2026-01-17T00:24:20.178682499-05:00","close_reason":"Town idle/healthy","dependencies":[{"issue_id":"hq-wisp-c3ill","depends_on_id":"hq-wisp-93kdl","type":"parent-child","created_at":"2026-01-17T00:23:04.430033297-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-c3ill","depends_on_id":"hq-wisp-xkq9n","type":"blocks","created_at":"2026-01-17T00:23:08.301645954-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-c41f","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T01:29:09.486961396-05:00","updated_at":"2026-01-16T01:50:39.227555962-05:00","closed_at":"2026-01-16T01:50:39.227555962-05:00","close_reason":"Stale patrol wisp cleanup","ephemeral":true}
{"id":"hq-wisp-c5h9e","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:52:58.284016422-05:00","updated_at":"2026-01-16T23:53:15.527761156-05:00","closed_at":"2026-01-16T23:53:15.527761156-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-c5h9e","depends_on_id":"hq-wisp-a5ye3","type":"parent-child","created_at":"2026-01-16T23:53:00.897566661-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-c5h9e","depends_on_id":"hq-wisp-ecsb1","type":"blocks","created_at":"2026-01-16T23:53:04.252289747-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-c5vaz","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:49:35.724523873-05:00","updated_at":"2026-01-16T23:50:18.82319013-05:00","closed_at":"2026-01-16T23:50:18.82319013-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-c5vaz","depends_on_id":"hq-wisp-n4f70","type":"parent-child","created_at":"2026-01-16T23:49:37.491931803-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-c5vaz","depends_on_id":"hq-wisp-87pnc","type":"blocks","created_at":"2026-01-16T23:49:40.232088223-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-c6w4d","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:56:40.337932702-05:00","updated_at":"2026-01-17T00:58:00.184668164-05:00","closed_at":"2026-01-17T00:58:00.184668164-05:00","close_reason":"Pool healthy","dependencies":[{"issue_id":"hq-wisp-c6w4d","depends_on_id":"hq-wisp-an994","type":"parent-child","created_at":"2026-01-17T00:56:45.899549477-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-c6w4d","depends_on_id":"hq-wisp-6jvqp","type":"blocks","created_at":"2026-01-17T00:56:57.25396111-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-c6ziz","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:43:00.962637607-05:00","updated_at":"2026-01-17T00:51:52.544401818-05:00","closed_at":"2026-01-17T00:51:52.544401818-05:00","close_reason":"No cleanup needed","dependencies":[{"issue_id":"hq-wisp-c6ziz","depends_on_id":"hq-wisp-jgnad","type":"parent-child","created_at":"2026-01-17T00:43:07.119984215-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-c6ziz","depends_on_id":"hq-wisp-5qgho","type":"blocks","created_at":"2026-01-17T00:43:16.693053443-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-c7svs","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:25:48.581914165-05:00","updated_at":"2026-01-17T00:26:22.971191665-05:00","closed_at":"2026-01-17T00:26:22.971191665-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-c7svs","depends_on_id":"hq-wisp-44ngw","type":"parent-child","created_at":"2026-01-17T00:25:49.39051723-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-c7svs","depends_on_id":"hq-wisp-bt23x","type":"blocks","created_at":"2026-01-17T00:25:53.093769225-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-c8tl","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:36:59.335734329-05:00","updated_at":"2026-01-16T23:40:14.750109479-05:00","closed_at":"2026-01-16T23:40:14.750109479-05:00","close_reason":"Patrol cycle 5 complete","ephemeral":true}
{"id":"hq-wisp-c9f1n","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:54:08.837064811-05:00","updated_at":"2026-01-16T23:54:43.524704292-05:00","closed_at":"2026-01-16T23:54:43.524704292-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-c9f1n","depends_on_id":"hq-wisp-oecdp","type":"parent-child","created_at":"2026-01-16T23:54:11.573301373-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-c9f1n","depends_on_id":"hq-wisp-3z8ul","type":"blocks","created_at":"2026-01-16T23:54:14.846710396-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-cajvv","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T10:48:11.023577679-05:00","updated_at":"2026-01-17T10:48:20.668693702-05:00","closed_at":"2026-01-17T10:48:20.668693702-05:00","close_reason":"Patrol 15 complete","ephemeral":true}
{"id":"hq-wisp-cbau5","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:50:35.40290817-05:00","updated_at":"2026-01-16T23:51:21.931092184-05:00","closed_at":"2026-01-16T23:51:21.931092184-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-cbau5","depends_on_id":"hq-wisp-t8b5z","type":"parent-child","created_at":"2026-01-16T23:50:37.486383913-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-cbau5","depends_on_id":"hq-wisp-k00mv","type":"blocks","created_at":"2026-01-16T23:50:40.236747571-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-cbidy","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:02:45.690095147-05:00","updated_at":"2026-01-17T01:05:12.573795863-05:00","closed_at":"2026-01-17T01:05:12.573795863-05:00","close_reason":"Idle town patrol","dependencies":[{"issue_id":"hq-wisp-cbidy","depends_on_id":"hq-wisp-ji9jj","type":"parent-child","created_at":"2026-01-17T01:02:46.865548447-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-cbidy","depends_on_id":"hq-wisp-3vhl0","type":"blocks","created_at":"2026-01-17T01:02:57.418700143-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-cbu7x","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:23:02.705881301-05:00","updated_at":"2026-01-17T00:24:20.437453153-05:00","closed_at":"2026-01-17T00:24:20.437453153-05:00","close_reason":"Town idle/healthy","dependencies":[{"issue_id":"hq-wisp-cbu7x","depends_on_id":"hq-wisp-93kdl","type":"parent-child","created_at":"2026-01-17T00:23:04.614321717-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-cbu7x","depends_on_id":"hq-wisp-wb167","type":"blocks","created_at":"2026-01-17T00:23:08.500739212-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-cc4n4","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:43:06.010174217-05:00","updated_at":"2026-01-16T23:43:37.371273355-05:00","closed_at":"2026-01-16T23:43:37.371273355-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-cc4n4","depends_on_id":"hq-wisp-p7g8j","type":"parent-child","created_at":"2026-01-16T23:43:06.657728638-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-cc4n4","depends_on_id":"hq-wisp-4pokn","type":"blocks","created_at":"2026-01-16T23:43:08.613723308-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-cdcw","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:43:15.71984568-05:00","updated_at":"2026-01-16T22:13:02.154322192-05:00","closed_at":"2026-01-16T22:13:02.154322192-05:00","close_reason":"Orphaned - forced cleanup","dependencies":[{"issue_id":"hq-wisp-cdcw","depends_on_id":"hq-wisp-l7vn","type":"parent-child","created_at":"2026-01-16T21:43:15.763622728-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-cdcw","depends_on_id":"hq-wisp-rrcs","type":"blocks","created_at":"2026-01-16T21:43:15.836594182-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-cdnb","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:00:50.759172434-05:00","updated_at":"2026-01-17T00:36:13.440724254-05:00","closed_at":"2026-01-17T00:36:13.440724254-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-cduoz","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:44:43.648054459-05:00","updated_at":"2026-01-16T23:45:08.19600998-05:00","closed_at":"2026-01-16T23:45:08.19600998-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-cduoz","depends_on_id":"hq-wisp-bhwu0","type":"parent-child","created_at":"2026-01-16T23:44:45.607449431-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-cduoz","depends_on_id":"hq-wisp-n23re","type":"blocks","created_at":"2026-01-16T23:44:47.828800949-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-cdwpr","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:40:19.872583151-05:00","updated_at":"2026-01-16T23:41:11.901581141-05:00","closed_at":"2026-01-16T23:41:11.901581141-05:00","close_reason":"Nothing pending","dependencies":[{"issue_id":"hq-wisp-cdwpr","depends_on_id":"hq-wisp-6gnpy","type":"parent-child","created_at":"2026-01-16T23:40:19.979853804-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-cdwpr","depends_on_id":"hq-wisp-rphq0","type":"blocks","created_at":"2026-01-16T23:40:21.743474951-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-cgoxi","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:46:10.412844501-05:00","updated_at":"2026-01-17T10:46:10.412844501-05:00","dependencies":[{"issue_id":"hq-wisp-cgoxi","depends_on_id":"hq-wisp-bio5t","type":"parent-child","created_at":"2026-01-17T10:46:10.766753336-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-cgoxi","depends_on_id":"hq-wisp-3uuq7","type":"blocks","created_at":"2026-01-17T10:46:11.19826525-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-chq2","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T01:31:27.155721596-05:00","updated_at":"2026-01-16T01:50:39.108219467-05:00","closed_at":"2026-01-16T01:50:39.108219467-05:00","close_reason":"Stale patrol wisp cleanup","ephemeral":true}
{"id":"hq-wisp-chx","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T00:53:17.652671001-05:00","updated_at":"2026-01-16T01:50:39.489670343-05:00","closed_at":"2026-01-16T01:50:39.489670343-05:00","close_reason":"Stale patrol wisp cleanup","ephemeral":true}
{"id":"hq-wisp-cir04","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon/","created_at":"2026-01-17T00:34:45.070649145-05:00","updated_at":"2026-01-17T00:35:04.50180819-05:00","closed_at":"2026-01-17T00:35:04.50180819-05:00","close_reason":"Cleanup","ephemeral":true}
{"id":"hq-wisp-cj4km","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:52:58.274926512-05:00","updated_at":"2026-01-16T23:53:18.06968445-05:00","closed_at":"2026-01-16T23:53:18.06968445-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-cj4km","depends_on_id":"hq-wisp-a5ye3","type":"parent-child","created_at":"2026-01-16T23:52:58.611807711-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-cj4km","depends_on_id":"hq-wisp-b9h7w","type":"blocks","created_at":"2026-01-16T23:53:01.574150391-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-cjbs","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:22:20.08708916-05:00","updated_at":"2026-01-16T01:52:14.071019787-05:00","closed_at":"2026-01-16T01:52:14.071019787-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-cjbs","depends_on_id":"hq-wisp-gvqg","type":"parent-child","created_at":"2026-01-16T01:22:20.135570568-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-cjylh","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:44:42.001360111-05:00","updated_at":"2026-01-17T10:44:42.001360153-05:00","dependencies":[{"issue_id":"hq-wisp-cjylh","depends_on_id":"hq-wisp-qd1hf","type":"parent-child","created_at":"2026-01-17T10:44:42.159101639-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-cjylh","depends_on_id":"hq-wisp-zmq86","type":"blocks","created_at":"2026-01-17T10:44:42.449366125-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ck4hy","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:07:28.96266548-05:00","updated_at":"2026-01-17T01:08:48.726749147-05:00","closed_at":"2026-01-17T01:08:48.726749147-05:00","close_reason":"No spawns","dependencies":[{"issue_id":"hq-wisp-ck4hy","depends_on_id":"hq-wisp-fnimo","type":"parent-child","created_at":"2026-01-17T01:07:29.584249924-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ck4hy","depends_on_id":"hq-wisp-udjx9","type":"blocks","created_at":"2026-01-17T01:07:40.050008414-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ckn7","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:37:49.088243849-05:00","updated_at":"2026-01-16T23:39:27.355692122-05:00","closed_at":"2026-01-16T23:39:27.355692122-05:00","close_reason":"bd mol ready --gated not implemented","dependencies":[{"issue_id":"hq-wisp-ckn7","depends_on_id":"hq-wisp-2zuj","type":"parent-child","created_at":"2026-01-16T23:37:49.362981522-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ckn7","depends_on_id":"hq-wisp-ql8o","type":"blocks","created_at":"2026-01-16T23:37:50.98194102-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ckrms","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:00:26.054421696-05:00","updated_at":"2026-01-17T01:01:06.368851702-05:00","closed_at":"2026-01-17T01:01:06.368851702-05:00","close_reason":"Inbox clear","dependencies":[{"issue_id":"hq-wisp-ckrms","depends_on_id":"hq-wisp-5yxyi","type":"parent-child","created_at":"2026-01-17T01:00:26.069571755-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-clt","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-15T23:40:04.822687142-05:00","updated_at":"2026-01-16T00:13:50.502338933-05:00","closed_at":"2026-01-16T00:13:50.502338933-05:00","close_reason":"Patrol 7 complete: idle town, inbox clear, 4 stale locks noted","ephemeral":true}
{"id":"hq-wisp-cmkym","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:52:50.325075422-05:00","updated_at":"2026-01-17T00:54:07.333270015-05:00","closed_at":"2026-01-17T00:54:07.333270015-05:00","close_reason":"No pending spawns","dependencies":[{"issue_id":"hq-wisp-cmkym","depends_on_id":"hq-wisp-xo3wl","type":"parent-child","created_at":"2026-01-17T00:52:50.880418172-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-cmkym","depends_on_id":"hq-wisp-ihlml","type":"blocks","created_at":"2026-01-17T00:53:00.699086394-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-cndgi","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:43:06.009210858-05:00","updated_at":"2026-01-16T23:43:38.511434666-05:00","closed_at":"2026-01-16T23:43:38.511434666-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-cndgi","depends_on_id":"hq-wisp-p7g8j","type":"parent-child","created_at":"2026-01-16T23:43:06.442111841-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-cndgi","depends_on_id":"hq-wisp-wy2ji","type":"blocks","created_at":"2026-01-16T23:43:08.38872583-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-co50","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:15:01.199753057-05:00","updated_at":"2026-01-16T23:18:51.113962465-05:00","closed_at":"2026-01-16T23:18:51.113962465-05:00","close_reason":"Cleanup noted, no idle dogs for dispatch","dependencies":[{"issue_id":"hq-wisp-co50","depends_on_id":"hq-wisp-9osz","type":"parent-child","created_at":"2026-01-16T23:15:02.100819678-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-co50","depends_on_id":"hq-wisp-msar","type":"blocks","created_at":"2026-01-16T23:15:03.528239383-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-coz41","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:40:19.880644691-05:00","updated_at":"2026-01-16T23:41:41.532863232-05:00","closed_at":"2026-01-16T23:41:41.532863232-05:00","close_reason":"Patrol count 9, looping","dependencies":[{"issue_id":"hq-wisp-coz41","depends_on_id":"hq-wisp-6gnpy","type":"parent-child","created_at":"2026-01-16T23:40:21.643945922-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-coz41","depends_on_id":"hq-wisp-2ebwf","type":"blocks","created_at":"2026-01-16T23:40:23.649979371-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-cpaes","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T02:00:44.566449606-05:00","updated_at":"2026-01-17T02:01:48.863065127-05:00","closed_at":"2026-01-17T02:01:48.863065127-05:00","close_reason":"Idle patrol","dependencies":[{"issue_id":"hq-wisp-cpaes","depends_on_id":"hq-wisp-9a1wp","type":"parent-child","created_at":"2026-01-17T02:00:45.827497488-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-cpaes","depends_on_id":"hq-wisp-ijfsf","type":"blocks","created_at":"2026-01-17T02:00:58.363504257-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-cpp","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T00:52:26.66937115-05:00","updated_at":"2026-01-16T01:50:39.503307453-05:00","closed_at":"2026-01-16T01:50:39.503307453-05:00","close_reason":"Stale patrol wisp cleanup","ephemeral":true}
{"id":"hq-wisp-cpt7i","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T00:38:34.530748774-05:00","updated_at":"2026-01-17T00:39:04.500249162-05:00","closed_at":"2026-01-17T00:39:04.500249162-05:00","close_reason":"Healthy","ephemeral":true}
{"id":"hq-wisp-crp73","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:03:11.632704339-05:00","updated_at":"2026-01-17T01:03:53.457237284-05:00","closed_at":"2026-01-17T01:03:53.457237284-05:00","close_reason":"No spawns","dependencies":[{"issue_id":"hq-wisp-crp73","depends_on_id":"hq-wisp-zx2sm","type":"parent-child","created_at":"2026-01-17T01:03:12.240334308-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-crp73","depends_on_id":"hq-wisp-srigs","type":"blocks","created_at":"2026-01-17T01:03:23.064569342-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ctarq","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:49:57.517289285-05:00","updated_at":"2026-01-17T10:49:57.517289326-05:00","dependencies":[{"issue_id":"hq-wisp-ctarq","depends_on_id":"hq-wisp-8agmn","type":"parent-child","created_at":"2026-01-17T10:49:57.606272941-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ctarq","depends_on_id":"hq-wisp-gtj8g","type":"blocks","created_at":"2026-01-17T10:49:58.294814746-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-cub4","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:36:59.342968203-05:00","updated_at":"2026-01-16T23:39:18.15248211-05:00","closed_at":"2026-01-16T23:39:18.15248211-05:00","close_reason":"All dogs active within 10 minutes - none stuck","dependencies":[{"issue_id":"hq-wisp-cub4","depends_on_id":"hq-wisp-c8tl","type":"parent-child","created_at":"2026-01-16T23:37:00.235846962-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-cub4","depends_on_id":"hq-wisp-a9xp","type":"blocks","created_at":"2026-01-16T23:37:01.885914624-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-cuu4r","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:24:43.296772548-05:00","updated_at":"2026-01-17T00:25:09.782236888-05:00","closed_at":"2026-01-17T00:25:09.782236888-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-cuu4r","depends_on_id":"hq-wisp-5fw2b","type":"parent-child","created_at":"2026-01-17T00:24:44.464160376-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-cuu4r","depends_on_id":"hq-wisp-pnhq6","type":"blocks","created_at":"2026-01-17T00:24:48.002446162-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-cvo8s","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:52:58.284601463-05:00","updated_at":"2026-01-16T23:53:15.35809962-05:00","closed_at":"2026-01-16T23:53:15.35809962-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-cvo8s","depends_on_id":"hq-wisp-a5ye3","type":"parent-child","created_at":"2026-01-16T23:53:01.0636717-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-cvo8s","depends_on_id":"hq-wisp-c5h9e","type":"blocks","created_at":"2026-01-16T23:53:04.422494616-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-cvy9","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T01:18:23.708228579-05:00","updated_at":"2026-01-16T01:50:39.363440439-05:00","closed_at":"2026-01-16T01:50:39.363440439-05:00","close_reason":"Stale patrol wisp cleanup","ephemeral":true}
{"id":"hq-wisp-cw7xd","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:28:16.224483728-05:00","updated_at":"2026-01-17T00:28:35.259748907-05:00","closed_at":"2026-01-17T00:28:35.259748907-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-cw7xd","depends_on_id":"hq-wisp-tbive","type":"parent-child","created_at":"2026-01-17T00:28:17.320908811-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-cw7xd","depends_on_id":"hq-wisp-dbyvu","type":"blocks","created_at":"2026-01-17T00:28:21.312704338-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-cwnmp","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:47:53.502032756-05:00","updated_at":"2026-01-16T23:48:30.360308162-05:00","closed_at":"2026-01-16T23:48:30.360308162-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-cwnmp","depends_on_id":"hq-wisp-wj52z","type":"parent-child","created_at":"2026-01-16T23:47:54.707473238-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-cwnmp","depends_on_id":"hq-wisp-gadyv","type":"blocks","created_at":"2026-01-16T23:47:57.406415766-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-cxmm5","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T10:46:31.164242734-05:00","updated_at":"2026-01-17T10:46:43.170986334-05:00","closed_at":"2026-01-17T10:46:43.170986334-05:00","close_reason":"Patrol 9 complete","ephemeral":true}
{"id":"hq-wisp-d0775","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:25:52.717618492-05:00","updated_at":"2026-01-16T23:27:07.931246177-05:00","closed_at":"2026-01-16T23:27:07.931246177-05:00","close_reason":"No zombies, dogs present","dependencies":[{"issue_id":"hq-wisp-d0775","depends_on_id":"hq-wisp-w4tn2","type":"parent-child","created_at":"2026-01-16T23:25:53.472893976-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-d0775","depends_on_id":"hq-wisp-8nw8z","type":"blocks","created_at":"2026-01-16T23:25:55.365244188-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-d0jmw","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:08:16.846612557-05:00","updated_at":"2026-01-17T01:09:35.949718134-05:00","closed_at":"2026-01-17T01:09:35.949718134-05:00","close_reason":"Final patrol","dependencies":[{"issue_id":"hq-wisp-d0jmw","depends_on_id":"hq-wisp-vrsc5","type":"parent-child","created_at":"2026-01-17T01:08:19.295582223-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-d0jmw","depends_on_id":"hq-wisp-r347z","type":"blocks","created_at":"2026-01-17T01:08:30.192241206-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-d1pfx","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:40:19.874456776-05:00","updated_at":"2026-01-16T23:41:18.000009187-05:00","closed_at":"2026-01-16T23:41:18.000009187-05:00","close_reason":"Nothing to process","dependencies":[{"issue_id":"hq-wisp-d1pfx","depends_on_id":"hq-wisp-6gnpy","type":"parent-child","created_at":"2026-01-16T23:40:20.368943378-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-d1pfx","depends_on_id":"hq-wisp-43dwi","type":"blocks","created_at":"2026-01-16T23:40:22.143246524-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-d37d3","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:29:36.060333749-05:00","updated_at":"2026-01-17T00:29:49.054032023-05:00","closed_at":"2026-01-17T00:29:49.054032023-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-d37d3","depends_on_id":"hq-wisp-w5z6p","type":"parent-child","created_at":"2026-01-17T00:29:37.037897762-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-d37d3","depends_on_id":"hq-wisp-848n8","type":"blocks","created_at":"2026-01-17T00:29:41.355663747-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-d3ra0","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:03:11.638678665-05:00","updated_at":"2026-01-17T01:04:12.307452973-05:00","closed_at":"2026-01-17T01:04:12.307452973-05:00","close_reason":"All healthy","dependencies":[{"issue_id":"hq-wisp-d3ra0","depends_on_id":"hq-wisp-zx2sm","type":"parent-child","created_at":"2026-01-17T01:03:15.834675267-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-d3ra0","depends_on_id":"hq-wisp-crp73","type":"blocks","created_at":"2026-01-17T01:03:26.682851479-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-d3ra0","depends_on_id":"hq-wisp-l67ve","type":"blocks","created_at":"2026-01-17T01:03:27.286302536-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-d3ra0","depends_on_id":"hq-wisp-px9wd","type":"blocks","created_at":"2026-01-17T01:03:27.896542074-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-d58a0","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:07:28.97011251-05:00","updated_at":"2026-01-17T01:09:05.896216268-05:00","closed_at":"2026-01-17T01:09:05.896216268-05:00","close_reason":"Pool healthy","dependencies":[{"issue_id":"hq-wisp-d58a0","depends_on_id":"hq-wisp-fnimo","type":"parent-child","created_at":"2026-01-17T01:07:34.847631559-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-d58a0","depends_on_id":"hq-wisp-5tfhu","type":"blocks","created_at":"2026-01-17T01:07:46.504138018-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-d5fbk","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:44:43.636159375-05:00","updated_at":"2026-01-16T23:45:33.997352328-05:00","closed_at":"2026-01-16T23:45:33.997352328-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-d5fbk","depends_on_id":"hq-wisp-bhwu0","type":"parent-child","created_at":"2026-01-16T23:44:43.883148496-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-d5fbk","depends_on_id":"hq-wisp-er67q","type":"blocks","created_at":"2026-01-16T23:44:45.825901433-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-d6x49","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:44:06.940138905-05:00","updated_at":"2026-01-17T00:35:37.108489374-05:00","closed_at":"2026-01-17T00:35:37.108489374-05:00","close_reason":"Cleanup","ephemeral":true}
{"id":"hq-wisp-d6yr","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:48:28.034248008-05:00","updated_at":"2026-01-16T22:13:02.065757846-05:00","closed_at":"2026-01-16T22:13:02.065757846-05:00","close_reason":"Orphaned - forced cleanup","dependencies":[{"issue_id":"hq-wisp-d6yr","depends_on_id":"hq-wisp-mwjb","type":"parent-child","created_at":"2026-01-16T21:48:28.101933471-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-d6yr","depends_on_id":"hq-wisp-mh58","type":"blocks","created_at":"2026-01-16T21:48:28.20554408-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-d9i0","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:22:20.0888917-05:00","updated_at":"2026-01-16T01:52:14.035850117-05:00","closed_at":"2026-01-16T01:52:14.035850117-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-d9i0","depends_on_id":"hq-wisp-gvqg","type":"parent-child","created_at":"2026-01-16T01:22:20.170694448-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-d9i0","depends_on_id":"hq-wisp-09rz","type":"blocks","created_at":"2026-01-16T01:22:20.282483623-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-dbyvu","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:28:16.223827645-05:00","updated_at":"2026-01-17T00:28:33.65409635-05:00","closed_at":"2026-01-17T00:28:33.65409635-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-dbyvu","depends_on_id":"hq-wisp-tbive","type":"parent-child","created_at":"2026-01-17T00:28:17.101761794-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-dbyvu","depends_on_id":"hq-wisp-ytsw1","type":"blocks","created_at":"2026-01-17T00:28:21.089045703-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-dc7su","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:43:06.010646793-05:00","updated_at":"2026-01-16T23:43:36.783405473-05:00","closed_at":"2026-01-16T23:43:36.783405473-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-dc7su","depends_on_id":"hq-wisp-p7g8j","type":"parent-child","created_at":"2026-01-16T23:43:06.767092448-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-dc7su","depends_on_id":"hq-wisp-s1r4p","type":"blocks","created_at":"2026-01-16T23:43:08.72258971-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-dc7su","depends_on_id":"hq-wisp-o9sho","type":"blocks","created_at":"2026-01-16T23:43:08.831626443-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-dc7su","depends_on_id":"hq-wisp-cc4n4","type":"blocks","created_at":"2026-01-16T23:43:08.940773007-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-dcjk5","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:48:51.078775518-05:00","updated_at":"2026-01-16T23:49:19.499249567-05:00","closed_at":"2026-01-16T23:49:19.499249567-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-dcjk5","depends_on_id":"hq-wisp-de87j","type":"parent-child","created_at":"2026-01-16T23:48:52.62351183-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-dcjk5","depends_on_id":"hq-wisp-kgfoe","type":"blocks","created_at":"2026-01-16T23:48:55.475034288-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-dd62e","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:47:24.585425309-05:00","updated_at":"2026-01-17T10:47:24.585425351-05:00","dependencies":[{"issue_id":"hq-wisp-dd62e","depends_on_id":"hq-wisp-jag69","type":"parent-child","created_at":"2026-01-17T10:47:25.054225868-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-dd62e","depends_on_id":"hq-wisp-t1x6s","type":"blocks","created_at":"2026-01-17T10:47:25.718187146-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-dd7xu","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:47:59.202067709-05:00","updated_at":"2026-01-17T00:35:32.407853191-05:00","closed_at":"2026-01-17T00:35:32.407853191-05:00","close_reason":"Cleanup","ephemeral":true}
{"id":"hq-wisp-ddnq","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:46:01.531535281-05:00","updated_at":"2026-01-16T01:52:05.897290188-05:00","closed_at":"2026-01-16T01:52:05.897290188-05:00","close_reason":"zombie-scan not implemented; noted gt-gastown-crew-mal has no hook (potential zombie but no kill authority)","dependencies":[{"issue_id":"hq-wisp-ddnq","depends_on_id":"hq-wisp-xunp","type":"parent-child","created_at":"2026-01-16T01:46:01.609838446-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ddnq","depends_on_id":"hq-wisp-2r4u","type":"blocks","created_at":"2026-01-16T01:46:01.808661315-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ddr1z","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:41:02.929070341-05:00","updated_at":"2026-01-17T00:35:47.754604949-05:00","closed_at":"2026-01-17T00:35:47.754604949-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-de87j","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:48:51.071282618-05:00","updated_at":"2026-01-16T23:49:31.82217256-05:00","closed_at":"2026-01-16T23:49:31.82217256-05:00","close_reason":"Patrol cycle 12 complete","ephemeral":true}
{"id":"hq-wisp-df6ff","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:43:00.957431948-05:00","updated_at":"2026-01-17T00:51:19.117466475-05:00","closed_at":"2026-01-17T00:51:19.117466475-05:00","close_reason":"All witnesses and refineries healthy","dependencies":[{"issue_id":"hq-wisp-df6ff","depends_on_id":"hq-wisp-jgnad","type":"parent-child","created_at":"2026-01-17T00:43:04.284918453-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-df6ff","depends_on_id":"hq-wisp-bp4d3","type":"blocks","created_at":"2026-01-17T00:43:12.869568118-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-df6ff","depends_on_id":"hq-wisp-9clup","type":"blocks","created_at":"2026-01-17T00:43:13.345813218-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-df6ff","depends_on_id":"hq-wisp-oju6w","type":"blocks","created_at":"2026-01-17T00:43:13.8232914-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-dj4y0","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:53:05.621124236-05:00","updated_at":"2026-01-16T23:53:56.005187891-05:00","closed_at":"2026-01-16T23:53:56.005187891-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-dj4y0","depends_on_id":"hq-wisp-xtx6n","type":"parent-child","created_at":"2026-01-16T23:53:06.689215622-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-dj4y0","depends_on_id":"hq-wisp-t4uk6","type":"blocks","created_at":"2026-01-16T23:53:09.80083352-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-djfak","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T00:40:57.189511278-05:00","updated_at":"2026-01-17T00:41:17.392772166-05:00","closed_at":"2026-01-17T00:41:17.392772166-05:00","close_reason":"OK","ephemeral":true}
{"id":"hq-wisp-dkoqg","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:29:36.059029167-05:00","updated_at":"2026-01-17T00:29:49.361613469-05:00","closed_at":"2026-01-17T00:29:49.361613469-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-dkoqg","depends_on_id":"hq-wisp-w5z6p","type":"parent-child","created_at":"2026-01-17T00:29:36.550653399-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-dkoqg","depends_on_id":"hq-wisp-848n8","type":"blocks","created_at":"2026-01-17T00:29:40.879347785-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-dl3f2","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:53:05.617324863-05:00","updated_at":"2026-01-16T23:53:59.46863356-05:00","closed_at":"2026-01-16T23:53:59.46863356-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-dl3f2","depends_on_id":"hq-wisp-xtx6n","type":"parent-child","created_at":"2026-01-16T23:53:05.630255729-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-dlk0f","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:53:05.618067946-05:00","updated_at":"2026-01-16T23:53:58.991223844-05:00","closed_at":"2026-01-16T23:53:58.991223844-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-dlk0f","depends_on_id":"hq-wisp-xtx6n","type":"parent-child","created_at":"2026-01-16T23:53:05.809616757-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-dlk0f","depends_on_id":"hq-wisp-dl3f2","type":"blocks","created_at":"2026-01-16T23:53:08.938169642-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-dlxw2","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"hooked","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T10:15:20.323689492-05:00","updated_at":"2026-01-17T10:15:25.735993455-05:00","ephemeral":true}
{"id":"hq-wisp-dmcr4","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:50:53.891923895-05:00","updated_at":"2026-01-16T23:51:44.029656749-05:00","closed_at":"2026-01-16T23:51:44.029656749-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-dmcr4","depends_on_id":"hq-wisp-47par","type":"parent-child","created_at":"2026-01-16T23:50:53.902380261-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-dmpqg","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:58:39.894661341-05:00","updated_at":"2026-01-17T00:59:54.152617652-05:00","closed_at":"2026-01-17T00:59:54.152617652-05:00","close_reason":"No zombies","dependencies":[{"issue_id":"hq-wisp-dmpqg","depends_on_id":"hq-wisp-0nlhz","type":"parent-child","created_at":"2026-01-17T00:58:44.264195659-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-dmpqg","depends_on_id":"hq-wisp-s8mx4","type":"blocks","created_at":"2026-01-17T00:58:55.291028933-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-dn5q","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:21:24.468299678-05:00","updated_at":"2026-01-16T23:22:32.185228967-05:00","closed_at":"2026-01-16T23:22:32.185228967-05:00","close_reason":"No events to notify","dependencies":[{"issue_id":"hq-wisp-dn5q","depends_on_id":"hq-wisp-87xr","type":"parent-child","created_at":"2026-01-16T23:21:24.968407239-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-dn5q","depends_on_id":"hq-wisp-un17","type":"blocks","created_at":"2026-01-16T23:21:26.516872085-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-dn75","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:43:15.716287478-05:00","updated_at":"2026-01-16T21:43:53.799485534-05:00","closed_at":"2026-01-16T21:43:53.799485534-05:00","close_reason":"Closed","dependencies":[{"issue_id":"hq-wisp-dn75","depends_on_id":"hq-wisp-l7vn","type":"parent-child","created_at":"2026-01-16T21:43:15.72198951-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-dnb3w","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:08:16.855962001-05:00","updated_at":"2026-01-17T01:10:43.867385087-05:00","closed_at":"2026-01-17T01:10:43.867385087-05:00","close_reason":"Final patrol","dependencies":[{"issue_id":"hq-wisp-dnb3w","depends_on_id":"hq-wisp-vrsc5","type":"parent-child","created_at":"2026-01-17T01:08:24.737090496-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-dnb3w","depends_on_id":"hq-wisp-xtmrv","type":"blocks","created_at":"2026-01-17T01:08:36.922136586-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-dncli","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:24:43.304489195-05:00","updated_at":"2026-01-17T00:25:26.080378974-05:00","closed_at":"2026-01-17T00:25:26.080378974-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-dncli","depends_on_id":"hq-wisp-5fw2b","type":"parent-child","created_at":"2026-01-17T00:24:46.809733009-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-dncli","depends_on_id":"hq-wisp-f5aqp","type":"blocks","created_at":"2026-01-17T00:24:50.834772741-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-dnyio","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:58:39.888604934-05:00","updated_at":"2026-01-17T00:59:21.094871201-05:00","closed_at":"2026-01-17T00:59:21.094871201-05:00","close_reason":"Inbox clear","dependencies":[{"issue_id":"hq-wisp-dnyio","depends_on_id":"hq-wisp-0nlhz","type":"parent-child","created_at":"2026-01-17T00:58:39.905019282-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-dob2","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:19:56.204034853-05:00","updated_at":"2026-01-17T00:35:59.426265654-05:00","closed_at":"2026-01-17T00:35:59.426265654-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-dpaul","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T00:39:48.964522976-05:00","updated_at":"2026-01-17T00:40:06.063111257-05:00","closed_at":"2026-01-17T00:40:06.063111257-05:00","close_reason":"OK","ephemeral":true}
{"id":"hq-wisp-dpw6","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:25:29.832731936-05:00","updated_at":"2026-01-17T00:35:52.900694654-05:00","closed_at":"2026-01-17T00:35:52.900694654-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-dq2ax","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:54:15.863467739-05:00","updated_at":"2026-01-17T00:35:29.314477118-05:00","closed_at":"2026-01-17T00:35:29.314477118-05:00","close_reason":"Cleanup","ephemeral":true}
{"id":"hq-wisp-dq5ps","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:23:02.701378853-05:00","updated_at":"2026-01-17T00:24:09.969756519-05:00","closed_at":"2026-01-17T00:24:09.969756519-05:00","close_reason":"No activity","dependencies":[{"issue_id":"hq-wisp-dq5ps","depends_on_id":"hq-wisp-93kdl","type":"parent-child","created_at":"2026-01-17T00:23:03.290286234-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-dq5ps","depends_on_id":"hq-wisp-koyjq","type":"blocks","created_at":"2026-01-17T00:23:06.751514278-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-dr1h","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:48:28.029387225-05:00","updated_at":"2026-01-16T22:12:53.923579563-05:00","closed_at":"2026-01-16T22:12:53.923579563-05:00","close_reason":"Orphaned wisp step - cleanup","dependencies":[{"issue_id":"hq-wisp-dr1h","depends_on_id":"hq-wisp-mwjb","type":"parent-child","created_at":"2026-01-16T21:48:28.044438365-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-dr1h","depends_on_id":"hq-wisp-npo8","type":"blocks","created_at":"2026-01-16T21:48:28.120253397-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-dsd8","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:36:59.343419328-05:00","updated_at":"2026-01-16T23:39:23.818286498-05:00","closed_at":"2026-01-16T23:39:23.818286498-05:00","close_reason":"No orphaned work - all in_progress issues have live sessions","dependencies":[{"issue_id":"hq-wisp-dsd8","depends_on_id":"hq-wisp-c8tl","type":"parent-child","created_at":"2026-01-16T23:37:00.317213035-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-dsd8","depends_on_id":"hq-wisp-cub4","type":"blocks","created_at":"2026-01-16T23:37:01.96975453-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-dspn","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:26:29.474817086-05:00","updated_at":"2026-01-16T01:52:13.985558339-05:00","closed_at":"2026-01-16T01:52:13.985558339-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-dspn","depends_on_id":"hq-wisp-zv2x","type":"parent-child","created_at":"2026-01-16T01:26:29.510792465-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-dsuuk","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:44:43.638191312-05:00","updated_at":"2026-01-16T23:45:30.50677594-05:00","closed_at":"2026-01-16T23:45:30.50677594-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-dsuuk","depends_on_id":"hq-wisp-bhwu0","type":"parent-child","created_at":"2026-01-16T23:44:44.308170418-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-dsuuk","depends_on_id":"hq-wisp-zeaj8","type":"blocks","created_at":"2026-01-16T23:44:46.263615723-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-dt7g","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","assignee":"deacon","created_at":"2026-01-16T22:15:41.988493467-05:00","updated_at":"2026-01-17T00:36:31.943434488-05:00","closed_at":"2026-01-17T00:36:31.943434488-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-dtbx","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:26:29.473701921-05:00","updated_at":"2026-01-16T01:52:14.003312278-05:00","closed_at":"2026-01-16T01:52:14.003312278-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-dtbx","depends_on_id":"hq-wisp-zv2x","type":"parent-child","created_at":"2026-01-16T01:26:29.491660819-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-dtbx","depends_on_id":"hq-wisp-aiwl","type":"blocks","created_at":"2026-01-16T01:26:29.605918366-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-du6oh","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:41:51.249326561-05:00","updated_at":"2026-01-16T23:42:27.984290247-05:00","closed_at":"2026-01-16T23:42:27.984290247-05:00","close_reason":"Nothing pending","dependencies":[{"issue_id":"hq-wisp-du6oh","depends_on_id":"hq-wisp-tnkch","type":"parent-child","created_at":"2026-01-16T23:41:51.682008172-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-du6oh","depends_on_id":"hq-wisp-2u8ir","type":"blocks","created_at":"2026-01-16T23:41:53.557096388-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-dua","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T00:55:02.778466326-05:00","updated_at":"2026-01-16T01:50:39.475909275-05:00","closed_at":"2026-01-16T01:50:39.475909275-05:00","close_reason":"Stale patrol wisp cleanup","ephemeral":true}
{"id":"hq-wisp-dug41","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon/","created_at":"2026-01-17T00:30:13.837337748-05:00","updated_at":"2026-01-17T00:35:04.821890822-05:00","closed_at":"2026-01-17T00:35:04.821890822-05:00","close_reason":"Cleanup","ephemeral":true}
{"id":"hq-wisp-dv2uh","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:02:45.703692417-05:00","updated_at":"2026-01-17T01:05:22.419542873-05:00","closed_at":"2026-01-17T01:05:22.419542873-05:00","close_reason":"Idle town patrol","dependencies":[{"issue_id":"hq-wisp-dv2uh","depends_on_id":"hq-wisp-ji9jj","type":"parent-child","created_at":"2026-01-17T01:02:56.244078884-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-dv2uh","depends_on_id":"hq-wisp-9a6o9","type":"blocks","created_at":"2026-01-17T01:03:08.087701494-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-dv5cx","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:24:43.300006123-05:00","updated_at":"2026-01-17T00:25:16.47989564-05:00","closed_at":"2026-01-17T00:25:16.47989564-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-dv5cx","depends_on_id":"hq-wisp-5fw2b","type":"parent-child","created_at":"2026-01-17T00:24:45.441112882-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-dv5cx","depends_on_id":"hq-wisp-pgkuw","type":"blocks","created_at":"2026-01-17T00:24:49.395075304-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-dvda1","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:40:19.878378858-05:00","updated_at":"2026-01-16T23:41:34.404591652-05:00","closed_at":"2026-01-16T23:41:34.404591652-05:00","close_reason":"Routine checks passed","dependencies":[{"issue_id":"hq-wisp-dvda1","depends_on_id":"hq-wisp-6gnpy","type":"parent-child","created_at":"2026-01-16T23:40:21.250075515-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-dvda1","depends_on_id":"hq-wisp-lulaz","type":"blocks","created_at":"2026-01-16T23:40:23.237522925-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-dx36k","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:45:48.843302955-05:00","updated_at":"2026-01-16T23:47:01.178152778-05:00","closed_at":"2026-01-16T23:47:01.178152778-05:00","close_reason":"Cleanup needs noted, dog dispatch not implemented","dependencies":[{"issue_id":"hq-wisp-dx36k","depends_on_id":"hq-wisp-2heyl","type":"parent-child","created_at":"2026-01-16T23:45:50.489189461-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-dx36k","depends_on_id":"hq-wisp-fbj17","type":"blocks","created_at":"2026-01-16T23:45:53.05041821-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-dxl08","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:51:56.833208274-05:00","updated_at":"2026-01-16T23:52:37.143026752-05:00","closed_at":"2026-01-16T23:52:37.143026752-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-dxl08","depends_on_id":"hq-wisp-ri9se","type":"parent-child","created_at":"2026-01-16T23:51:58.646979909-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-dxl08","depends_on_id":"hq-wisp-z77ud","type":"blocks","created_at":"2026-01-16T23:52:01.965966126-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-dyyq","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:27:24.235293388-05:00","updated_at":"2026-01-16T01:52:13.850461153-05:00","closed_at":"2026-01-16T01:52:13.850461153-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-dyyq","depends_on_id":"hq-wisp-nv4o","type":"parent-child","created_at":"2026-01-16T01:27:24.274289347-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-dyyq","depends_on_id":"hq-wisp-eiqy","type":"blocks","created_at":"2026-01-16T01:27:24.429594477-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-e0kvi","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:52:50.335583693-05:00","updated_at":"2026-01-17T00:56:10.020880496-05:00","closed_at":"2026-01-17T00:56:10.020880496-05:00","close_reason":"No cleanup needed","dependencies":[{"issue_id":"hq-wisp-e0kvi","depends_on_id":"hq-wisp-xo3wl","type":"parent-child","created_at":"2026-01-17T00:52:57.364528399-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-e0kvi","depends_on_id":"hq-wisp-trhbs","type":"blocks","created_at":"2026-01-17T00:53:08.372209843-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-e0ky","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:05:01.102711384-05:00","updated_at":"2026-01-16T22:13:02.025161355-05:00","closed_at":"2026-01-16T22:13:02.025161355-05:00","close_reason":"Orphaned - forced cleanup","dependencies":[{"issue_id":"hq-wisp-e0ky","depends_on_id":"hq-wisp-xrtb","type":"parent-child","created_at":"2026-01-16T22:05:01.168410967-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-e0ky","depends_on_id":"hq-wisp-t0jg","type":"blocks","created_at":"2026-01-16T22:05:01.330748929-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-e2j5i","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:28:16.222515689-05:00","updated_at":"2026-01-17T00:28:33.953145377-05:00","closed_at":"2026-01-17T00:28:33.953145377-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-e2j5i","depends_on_id":"hq-wisp-tbive","type":"parent-child","created_at":"2026-01-17T00:28:16.665772465-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-e2j5i","depends_on_id":"hq-wisp-ytsw1","type":"blocks","created_at":"2026-01-17T00:28:20.652208542-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-e2rv7","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:30:39.080951083-05:00","updated_at":"2026-01-17T00:30:52.52495998-05:00","closed_at":"2026-01-17T00:30:52.52495998-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-e2rv7","depends_on_id":"hq-wisp-tjzfo","type":"parent-child","created_at":"2026-01-17T00:30:39.596275198-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-e2rv7","depends_on_id":"hq-wisp-efpag","type":"blocks","created_at":"2026-01-17T00:30:44.139238036-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-e379f","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:53:25.160843203-05:00","updated_at":"2026-01-16T23:53:47.437044233-05:00","closed_at":"2026-01-16T23:53:47.437044233-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-e379f","depends_on_id":"hq-wisp-of0wi","type":"parent-child","created_at":"2026-01-16T23:53:27.833757189-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-e379f","depends_on_id":"hq-wisp-xfxwe","type":"blocks","created_at":"2026-01-16T23:53:31.258790387-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-e3e0","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:21:24.468697678-05:00","updated_at":"2026-01-16T23:22:47.233630526-05:00","closed_at":"2026-01-16T23:22:47.233630526-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-e3e0","depends_on_id":"hq-wisp-87xr","type":"parent-child","created_at":"2026-01-16T23:21:25.05145302-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-e3e0","depends_on_id":"hq-wisp-l8l0","type":"blocks","created_at":"2026-01-16T23:21:26.601853615-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-e3e0","depends_on_id":"hq-wisp-xfai","type":"blocks","created_at":"2026-01-16T23:21:26.688523854-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-e3e0","depends_on_id":"hq-wisp-dn5q","type":"blocks","created_at":"2026-01-16T23:21:26.774782302-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-e49p","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:15:01.200556765-05:00","updated_at":"2026-01-16T23:19:11.958037565-05:00","closed_at":"2026-01-16T23:19:11.958037565-05:00","close_reason":"Log under threshold (1.5MB)","dependencies":[{"issue_id":"hq-wisp-e49p","depends_on_id":"hq-wisp-9osz","type":"parent-child","created_at":"2026-01-16T23:15:02.240558353-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-e49p","depends_on_id":"hq-wisp-odcn","type":"blocks","created_at":"2026-01-16T23:15:03.675021307-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-e57c","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:42:27.174170837-05:00","updated_at":"2026-01-16T01:52:13.606235335-05:00","closed_at":"2026-01-16T01:52:13.606235335-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-e57c","depends_on_id":"hq-wisp-wqti","type":"parent-child","created_at":"2026-01-16T01:42:27.27270948-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-e57c","depends_on_id":"hq-wisp-rcj5","type":"blocks","created_at":"2026-01-16T01:42:27.516466381-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-e5j9p","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:03:11.64276016-05:00","updated_at":"2026-01-17T01:04:21.316232572-05:00","closed_at":"2026-01-17T01:04:21.316232572-05:00","close_reason":"No abandoned work","dependencies":[{"issue_id":"hq-wisp-e5j9p","depends_on_id":"hq-wisp-zx2sm","type":"parent-child","created_at":"2026-01-17T01:03:18.818631304-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-e5j9p","depends_on_id":"hq-wisp-hizs6","type":"blocks","created_at":"2026-01-17T01:03:30.932936666-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-e5vk","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:19:36.432446947-05:00","updated_at":"2026-01-16T23:20:36.551729727-05:00","closed_at":"2026-01-16T23:20:36.551729727-05:00","close_reason":"No events to notify, town idle","dependencies":[{"issue_id":"hq-wisp-e5vk","depends_on_id":"hq-wisp-pfs9","type":"parent-child","created_at":"2026-01-16T23:19:36.960475921-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-e5vk","depends_on_id":"hq-wisp-3xb8","type":"blocks","created_at":"2026-01-16T23:19:38.299747248-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-e5vk","depends_on_id":"hq-wisp-uujr","type":"blocks","created_at":"2026-01-16T23:19:38.373997655-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-e5vk","depends_on_id":"hq-wisp-hqwl","type":"blocks","created_at":"2026-01-16T23:19:38.448372437-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-e6od","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:46:01.532360822-05:00","updated_at":"2026-01-16T01:52:13.340645124-05:00","closed_at":"2026-01-16T01:52:13.340645124-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-e6od","depends_on_id":"hq-wisp-xunp","type":"parent-child","created_at":"2026-01-16T01:46:01.637904416-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-e6od","depends_on_id":"hq-wisp-ygqi","type":"blocks","created_at":"2026-01-16T01:46:01.839103365-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-e6srr","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:12:55.883699198-05:00","updated_at":"2026-01-17T01:59:37.506918594-05:00","closed_at":"2026-01-17T01:59:37.506918594-05:00","close_reason":"Witness healthy, town idle - skipped nudge per idle protocol","dependencies":[{"issue_id":"hq-wisp-e6srr","depends_on_id":"hq-wisp-i2n82","type":"parent-child","created_at":"2026-01-17T01:13:00.177848767-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-e6srr","depends_on_id":"hq-wisp-gjvqn","type":"blocks","created_at":"2026-01-17T01:13:11.212788574-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-e6srr","depends_on_id":"hq-wisp-k7wwo","type":"blocks","created_at":"2026-01-17T01:13:11.833232936-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-e6srr","depends_on_id":"hq-wisp-pq83c","type":"blocks","created_at":"2026-01-17T01:13:12.454439213-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-e86go","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:44:43.637173906-05:00","updated_at":"2026-01-16T23:45:32.166242346-05:00","closed_at":"2026-01-16T23:45:32.166242346-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-e86go","depends_on_id":"hq-wisp-bhwu0","type":"parent-child","created_at":"2026-01-16T23:44:44.095462688-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-e86go","depends_on_id":"hq-wisp-er67q","type":"blocks","created_at":"2026-01-16T23:44:46.042503247-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-eazru","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:49:59.363006663-05:00","updated_at":"2026-01-17T10:49:59.363006705-05:00","dependencies":[{"issue_id":"hq-wisp-eazru","depends_on_id":"hq-wisp-wxw0u","type":"parent-child","created_at":"2026-01-17T10:50:00.031253647-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-eazru","depends_on_id":"hq-wisp-9ofmv","type":"blocks","created_at":"2026-01-17T10:50:01.008810242-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ebths","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:05:32.491168783-05:00","updated_at":"2026-01-17T01:06:28.192085976-05:00","closed_at":"2026-01-17T01:06:28.192085976-05:00","close_reason":"Idle town","dependencies":[{"issue_id":"hq-wisp-ebths","depends_on_id":"hq-wisp-p8n2g","type":"parent-child","created_at":"2026-01-17T01:05:36.641252798-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ebths","depends_on_id":"hq-wisp-31kox","type":"blocks","created_at":"2026-01-17T01:05:47.695701997-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ebths","depends_on_id":"hq-wisp-iy2hm","type":"blocks","created_at":"2026-01-17T01:05:48.287181816-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ebths","depends_on_id":"hq-wisp-l65e3","type":"blocks","created_at":"2026-01-17T01:05:48.885817917-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ec1p8","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:52:58.276682511-05:00","updated_at":"2026-01-16T23:53:17.563757215-05:00","closed_at":"2026-01-16T23:53:17.563757215-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-ec1p8","depends_on_id":"hq-wisp-a5ye3","type":"parent-child","created_at":"2026-01-16T23:52:59.095265714-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ec1p8","depends_on_id":"hq-wisp-4b4ep","type":"blocks","created_at":"2026-01-16T23:53:02.067824511-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ecsb1","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:52:58.283373589-05:00","updated_at":"2026-01-16T23:53:15.697085609-05:00","closed_at":"2026-01-16T23:53:15.697085609-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-ecsb1","depends_on_id":"hq-wisp-a5ye3","type":"parent-child","created_at":"2026-01-16T23:53:00.735449786-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ecsb1","depends_on_id":"hq-wisp-kqzt5","type":"blocks","created_at":"2026-01-16T23:53:04.083771168-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-eexj","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T21:34:18.987152711-05:00","updated_at":"2026-01-16T22:12:18.965558545-05:00","closed_at":"2026-01-16T22:12:18.965558545-05:00","close_reason":"Orphaned - bulk cleanup","ephemeral":true}
{"id":"hq-wisp-efpag","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:30:39.079349002-05:00","updated_at":"2026-01-17T00:30:51.369681297-05:00","closed_at":"2026-01-17T00:30:51.369681297-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-efpag","depends_on_id":"hq-wisp-tjzfo","type":"parent-child","created_at":"2026-01-17T00:30:39.095385354-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-eh1aj","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:44:43.639069345-05:00","updated_at":"2026-01-16T23:45:29.602855952-05:00","closed_at":"2026-01-16T23:45:29.602855952-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-eh1aj","depends_on_id":"hq-wisp-bhwu0","type":"parent-child","created_at":"2026-01-16T23:44:44.419668416-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-eh1aj","depends_on_id":"hq-wisp-6p3v3","type":"blocks","created_at":"2026-01-16T23:44:46.375002472-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-eh1aj","depends_on_id":"hq-wisp-0a1jl","type":"blocks","created_at":"2026-01-16T23:44:46.486900883-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-eh1aj","depends_on_id":"hq-wisp-dsuuk","type":"blocks","created_at":"2026-01-16T23:44:46.59984145-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ehvhp","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:07:28.970968676-05:00","updated_at":"2026-01-17T01:09:08.872116567-05:00","closed_at":"2026-01-17T01:09:08.872116567-05:00","close_reason":"No stuck dogs","dependencies":[{"issue_id":"hq-wisp-ehvhp","depends_on_id":"hq-wisp-fnimo","type":"parent-child","created_at":"2026-01-17T01:07:35.431094937-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ehvhp","depends_on_id":"hq-wisp-d58a0","type":"blocks","created_at":"2026-01-17T01:07:47.091754307-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-eiqy","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:27:24.233944222-05:00","updated_at":"2026-01-16T01:52:13.881899993-05:00","closed_at":"2026-01-16T01:52:13.881899993-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-eiqy","depends_on_id":"hq-wisp-nv4o","type":"parent-child","created_at":"2026-01-16T01:27:24.239957674-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ekaom","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:23:02.708620002-05:00","updated_at":"2026-01-17T00:24:21.194994325-05:00","closed_at":"2026-01-17T00:24:21.194994325-05:00","close_reason":"Town idle/healthy","dependencies":[{"issue_id":"hq-wisp-ekaom","depends_on_id":"hq-wisp-93kdl","type":"parent-child","created_at":"2026-01-17T00:23:05.179167449-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ekaom","depends_on_id":"hq-wisp-ro3i8","type":"blocks","created_at":"2026-01-17T00:23:09.085023438-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-eke2","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T01:53:28.896481145-05:00","updated_at":"2026-01-16T01:54:11.928502337-05:00","closed_at":"2026-01-16T01:54:11.928502337-05:00","close_reason":"Orphan wisp from previous patrol","ephemeral":true}
{"id":"hq-wisp-ekmgr","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:41:51.249786686-05:00","updated_at":"2026-01-16T23:42:32.618416424-05:00","closed_at":"2026-01-16T23:42:32.618416424-05:00","close_reason":"Nothing to process","dependencies":[{"issue_id":"hq-wisp-ekmgr","depends_on_id":"hq-wisp-tnkch","type":"parent-child","created_at":"2026-01-16T23:41:51.784829658-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ekmgr","depends_on_id":"hq-wisp-du6oh","type":"blocks","created_at":"2026-01-16T23:41:53.662235333-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-en6ig","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:52:28.527047937-05:00","updated_at":"2026-01-16T23:52:52.759026547-05:00","closed_at":"2026-01-16T23:52:52.759026547-05:00","close_reason":"Patrol 18 complete","ephemeral":true}
{"id":"hq-wisp-enzl","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:37:49.089635849-05:00","updated_at":"2026-01-16T23:39:47.337891317-05:00","closed_at":"2026-01-16T23:39:47.337891317-05:00","close_reason":"No notifications needed (no convoy completions, no cross-rig resolutions)","dependencies":[{"issue_id":"hq-wisp-enzl","depends_on_id":"hq-wisp-2zuj","type":"parent-child","created_at":"2026-01-16T23:37:49.63143007-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-enzl","depends_on_id":"hq-wisp-wv2p","type":"blocks","created_at":"2026-01-16T23:37:51.252458818-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-eo8a7","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:52:08.830644175-05:00","updated_at":"2026-01-17T00:35:30.368149579-05:00","closed_at":"2026-01-17T00:35:30.368149579-05:00","close_reason":"Cleanup","ephemeral":true}
{"id":"hq-wisp-eohz","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T22:21:09.441328383-05:00","updated_at":"2026-01-17T00:36:21.596801119-05:00","closed_at":"2026-01-17T00:36:21.596801119-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-eolb","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","assignee":"deacon","created_at":"2026-01-16T22:15:26.317927181-05:00","updated_at":"2026-01-17T00:36:34.225323727-05:00","closed_at":"2026-01-17T00:36:34.225323727-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-eomm","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:27:24.236884511-05:00","updated_at":"2026-01-16T01:52:13.793716089-05:00","closed_at":"2026-01-16T01:52:13.793716089-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-eomm","depends_on_id":"hq-wisp-nv4o","type":"parent-child","created_at":"2026-01-16T01:27:24.307681854-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-eomm","depends_on_id":"hq-wisp-wewt","type":"blocks","created_at":"2026-01-16T01:27:24.485353335-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-eovp5","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:51:56.836646397-05:00","updated_at":"2026-01-16T23:52:21.692729197-05:00","closed_at":"2026-01-16T23:52:21.692729197-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-eovp5","depends_on_id":"hq-wisp-ri9se","type":"parent-child","created_at":"2026-01-16T23:51:59.461808277-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-eovp5","depends_on_id":"hq-wisp-suqt8","type":"blocks","created_at":"2026-01-16T23:52:02.806154182-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-epei","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:21:24.465619095-05:00","updated_at":"2026-01-16T23:21:43.840130222-05:00","closed_at":"2026-01-16T23:21:43.840130222-05:00","close_reason":"Inbox empty","dependencies":[{"issue_id":"hq-wisp-epei","depends_on_id":"hq-wisp-87xr","type":"parent-child","created_at":"2026-01-16T23:21:24.473654844-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-eqp37","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:24:43.298691209-05:00","updated_at":"2026-01-17T00:25:16.080836827-05:00","closed_at":"2026-01-17T00:25:16.080836827-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-eqp37","depends_on_id":"hq-wisp-5fw2b","type":"parent-child","created_at":"2026-01-17T00:24:45.050353721-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-eqp37","depends_on_id":"hq-wisp-46qvz","type":"blocks","created_at":"2026-01-17T00:24:48.995989159-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-eqrox","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:46:10.403710423-05:00","updated_at":"2026-01-17T10:46:10.403710465-05:00","dependencies":[{"issue_id":"hq-wisp-eqrox","depends_on_id":"hq-wisp-bio5t","type":"parent-child","created_at":"2026-01-17T10:46:10.511167235-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-eqrox","depends_on_id":"hq-wisp-rdwpv","type":"blocks","created_at":"2026-01-17T10:46:10.865869195-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-er67q","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:44:43.63472539-05:00","updated_at":"2026-01-16T23:45:36.34515223-05:00","closed_at":"2026-01-16T23:45:36.34515223-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-er67q","depends_on_id":"hq-wisp-bhwu0","type":"parent-child","created_at":"2026-01-16T23:44:43.649218322-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-es2lk","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:28:49.92565677-05:00","updated_at":"2026-01-17T00:29:03.487472289-05:00","closed_at":"2026-01-17T00:29:03.487472289-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-es2lk","depends_on_id":"hq-wisp-9l1zx","type":"parent-child","created_at":"2026-01-17T00:28:50.607322911-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-es2lk","depends_on_id":"hq-wisp-p8lln","type":"blocks","created_at":"2026-01-17T00:28:54.609384173-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-esgt7","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:44:41.997718958-05:00","updated_at":"2026-01-17T10:44:41.997718958-05:00","dependencies":[{"issue_id":"hq-wisp-esgt7","depends_on_id":"hq-wisp-qd1hf","type":"parent-child","created_at":"2026-01-17T10:44:42.091718644-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-esgt7","depends_on_id":"hq-wisp-bc416","type":"blocks","created_at":"2026-01-17T10:44:42.338641627-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-eue01","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:41:51.248349228-05:00","updated_at":"2026-01-16T23:42:28.090239821-05:00","closed_at":"2026-01-16T23:42:28.090239821-05:00","close_reason":"Nothing pending","dependencies":[{"issue_id":"hq-wisp-eue01","depends_on_id":"hq-wisp-tnkch","type":"parent-child","created_at":"2026-01-16T23:41:51.464502741-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-eue01","depends_on_id":"hq-wisp-2u8ir","type":"blocks","created_at":"2026-01-16T23:41:53.347332957-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ewec","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:23:47.732401492-05:00","updated_at":"2026-01-16T23:24:14.963894804-05:00","closed_at":"2026-01-16T23:24:14.963894804-05:00","close_reason":"No gates/convoys/pending/external deps","dependencies":[{"issue_id":"hq-wisp-ewec","depends_on_id":"hq-wisp-9we3","type":"parent-child","created_at":"2026-01-16T23:23:48.125008065-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ewec","depends_on_id":"hq-wisp-1vo6","type":"blocks","created_at":"2026-01-16T23:23:49.874343836-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-exeb","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:36:59.337424329-05:00","updated_at":"2026-01-16T23:37:22.122475381-05:00","closed_at":"2026-01-16T23:37:22.122475381-05:00","close_reason":"No messages in inbox","dependencies":[{"issue_id":"hq-wisp-exeb","depends_on_id":"hq-wisp-c8tl","type":"parent-child","created_at":"2026-01-16T23:36:59.347065994-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-exyeu","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:50:53.894777267-05:00","updated_at":"2026-01-16T23:51:33.848806022-05:00","closed_at":"2026-01-16T23:51:33.848806022-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-exyeu","depends_on_id":"hq-wisp-47par","type":"parent-child","created_at":"2026-01-16T23:50:54.619981163-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-exyeu","depends_on_id":"hq-wisp-3unkx","type":"blocks","created_at":"2026-01-16T23:50:57.165273522-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ezwj","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:19:30.43433368-05:00","updated_at":"2026-01-17T00:36:00.498830337-05:00","closed_at":"2026-01-17T00:36:00.498830337-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-f1m8","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:56:35.920505103-05:00","updated_at":"2026-01-16T22:13:02.214990032-05:00","closed_at":"2026-01-16T22:13:02.214990032-05:00","close_reason":"Orphaned - forced cleanup","dependencies":[{"issue_id":"hq-wisp-f1m8","depends_on_id":"hq-wisp-8d7d","type":"parent-child","created_at":"2026-01-16T01:56:35.938267958-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-f1m8","depends_on_id":"hq-wisp-j4js","type":"blocks","created_at":"2026-01-16T01:56:35.978328998-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-f24f","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:46:26.939026897-05:00","updated_at":"2026-01-16T01:51:15.879562034-05:00","closed_at":"2026-01-16T01:51:15.879562034-05:00","close_reason":"Idle town - witness running, refinery stopped (no work), healthy","dependencies":[{"issue_id":"hq-wisp-f24f","depends_on_id":"hq-wisp-ybkc","type":"parent-child","created_at":"2026-01-16T01:46:27.016637854-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-f24f","depends_on_id":"hq-wisp-h23u","type":"blocks","created_at":"2026-01-16T01:46:27.213649766-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-f24f","depends_on_id":"hq-wisp-yklj","type":"blocks","created_at":"2026-01-16T01:46:27.224986879-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-f24f","depends_on_id":"hq-wisp-y6dm","type":"blocks","created_at":"2026-01-16T01:46:27.236615908-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-f2fz8","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:52:58.281014882-05:00","updated_at":"2026-01-16T23:53:16.20886184-05:00","closed_at":"2026-01-16T23:53:16.20886184-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-f2fz8","depends_on_id":"hq-wisp-a5ye3","type":"parent-child","created_at":"2026-01-16T23:53:00.249112035-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-f2fz8","depends_on_id":"hq-wisp-rvypl","type":"blocks","created_at":"2026-01-16T23:53:03.577133808-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-f2j9","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:23:47.727735284-05:00","updated_at":"2026-01-16T23:24:27.207122161-05:00","closed_at":"2026-01-16T23:24:27.207122161-05:00","close_reason":"No activity, no pending","dependencies":[{"issue_id":"hq-wisp-f2j9","depends_on_id":"hq-wisp-9we3","type":"parent-child","created_at":"2026-01-16T23:23:47.936338507-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-f2j9","depends_on_id":"hq-wisp-1vo6","type":"blocks","created_at":"2026-01-16T23:23:49.680218154-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-f3abh","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:02:45.689327231-05:00","updated_at":"2026-01-17T01:05:13.16182882-05:00","closed_at":"2026-01-17T01:05:13.16182882-05:00","close_reason":"Idle town patrol","dependencies":[{"issue_id":"hq-wisp-f3abh","depends_on_id":"hq-wisp-ji9jj","type":"parent-child","created_at":"2026-01-17T01:02:46.281940561-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-f3abh","depends_on_id":"hq-wisp-3vhl0","type":"blocks","created_at":"2026-01-17T01:02:56.838531586-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-f3joe","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:04:43.443347103-05:00","updated_at":"2026-01-17T01:06:19.08690317-05:00","closed_at":"2026-01-17T01:06:19.08690317-05:00","close_reason":"No stuck dogs","dependencies":[{"issue_id":"hq-wisp-f3joe","depends_on_id":"hq-wisp-bkl5l","type":"parent-child","created_at":"2026-01-17T01:04:49.928334434-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-f3joe","depends_on_id":"hq-wisp-xt8ms","type":"blocks","created_at":"2026-01-17T01:05:01.939162012-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-f4no","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:55:36.782964876-05:00","updated_at":"2026-01-16T01:56:28.010325342-05:00","closed_at":"2026-01-16T01:56:28.010325342-05:00","close_reason":"Closed","dependencies":[{"issue_id":"hq-wisp-f4no","depends_on_id":"hq-wisp-ndqt","type":"parent-child","created_at":"2026-01-16T01:55:36.847390181-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-f4no","depends_on_id":"hq-wisp-zjn7","type":"blocks","created_at":"2026-01-16T01:55:36.98633028-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-f4sm6","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:51:56.831566859-05:00","updated_at":"2026-01-16T23:52:40.928781482-05:00","closed_at":"2026-01-16T23:52:40.928781482-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-f4sm6","depends_on_id":"hq-wisp-ri9se","type":"parent-child","created_at":"2026-01-16T23:51:58.151304543-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-f4sm6","depends_on_id":"hq-wisp-i3bqt","type":"blocks","created_at":"2026-01-16T23:52:01.461656017-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-f5aqp","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:24:43.303800322-05:00","updated_at":"2026-01-17T00:25:25.84849454-05:00","closed_at":"2026-01-17T00:25:25.84849454-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-f5aqp","depends_on_id":"hq-wisp-5fw2b","type":"parent-child","created_at":"2026-01-17T00:24:46.615068594-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-f5aqp","depends_on_id":"hq-wisp-y7hqg","type":"blocks","created_at":"2026-01-17T00:24:50.632727172-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-f5z3","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T01:43:49.116442817-05:00","updated_at":"2026-01-16T01:50:38.98313827-05:00","closed_at":"2026-01-16T01:50:38.98313827-05:00","close_reason":"Stale patrol wisp cleanup","ephemeral":true}
{"id":"hq-wisp-f665i","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:43:56.9931234-05:00","updated_at":"2026-01-16T23:44:31.189292572-05:00","closed_at":"2026-01-16T23:44:31.189292572-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-f665i","depends_on_id":"hq-wisp-ywecn","type":"parent-child","created_at":"2026-01-16T23:43:57.716513973-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-f665i","depends_on_id":"hq-wisp-icn4b","type":"blocks","created_at":"2026-01-16T23:43:59.596098564-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-f665i","depends_on_id":"hq-wisp-rz3yt","type":"blocks","created_at":"2026-01-16T23:43:59.701711883-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-f665i","depends_on_id":"hq-wisp-b87qd","type":"blocks","created_at":"2026-01-16T23:43:59.806441578-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-f6ui","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:27:24.239533675-05:00","updated_at":"2026-01-16T01:52:13.716304049-05:00","closed_at":"2026-01-16T01:52:13.716304049-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-f6ui","depends_on_id":"hq-wisp-nv4o","type":"parent-child","created_at":"2026-01-16T01:27:24.394976263-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-f6ui","depends_on_id":"hq-wisp-wlsa","type":"blocks","created_at":"2026-01-16T01:27:24.57891278-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-f6x3","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:23:47.727190492-05:00","updated_at":"2026-01-16T23:24:27.300625899-05:00","closed_at":"2026-01-16T23:24:27.300625899-05:00","close_reason":"No activity, no pending","dependencies":[{"issue_id":"hq-wisp-f6x3","depends_on_id":"hq-wisp-9we3","type":"parent-child","created_at":"2026-01-16T23:23:47.840340103-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-f6x3","depends_on_id":"hq-wisp-1vo6","type":"blocks","created_at":"2026-01-16T23:23:49.584150958-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-f81wh","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T00:04:27.448299636-05:00","updated_at":"2026-01-17T00:35:07.915105643-05:00","closed_at":"2026-01-17T00:35:07.915105643-05:00","close_reason":"Cleanup","ephemeral":true}
{"id":"hq-wisp-f91c9","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:52:50.326053253-05:00","updated_at":"2026-01-17T00:55:13.908450633-05:00","closed_at":"2026-01-17T00:55:13.908450633-05:00","close_reason":"No pending async gates","dependencies":[{"issue_id":"hq-wisp-f91c9","depends_on_id":"hq-wisp-xo3wl","type":"parent-child","created_at":"2026-01-17T00:52:51.411585677-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-f91c9","depends_on_id":"hq-wisp-ihlml","type":"blocks","created_at":"2026-01-17T00:53:01.250247236-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-fagoj","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:12:55.886239528-05:00","updated_at":"2026-01-17T01:59:40.599388342-05:00","closed_at":"2026-01-17T01:59:40.599388342-05:00","close_reason":"Dog pool maintenance not needed","dependencies":[{"issue_id":"hq-wisp-fagoj","depends_on_id":"hq-wisp-i2n82","type":"parent-child","created_at":"2026-01-17T01:13:02.001971244-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-fagoj","depends_on_id":"hq-wisp-e6srr","type":"blocks","created_at":"2026-01-17T01:13:14.306097564-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-fb21","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:23:47.733321158-05:00","updated_at":"2026-01-16T23:24:38.711107739-05:00","closed_at":"2026-01-16T23:24:38.711107739-05:00","close_reason":"No gated mols, no events","dependencies":[{"issue_id":"hq-wisp-fb21","depends_on_id":"hq-wisp-9we3","type":"parent-child","created_at":"2026-01-16T23:23:48.314713999-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-fb21","depends_on_id":"hq-wisp-w76s","type":"blocks","created_at":"2026-01-16T23:23:50.065106395-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-fbj17","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:45:48.842832251-05:00","updated_at":"2026-01-16T23:46:55.105128145-05:00","closed_at":"2026-01-16T23:46:55.105128145-05:00","close_reason":"No abandoned work","dependencies":[{"issue_id":"hq-wisp-fbj17","depends_on_id":"hq-wisp-2heyl","type":"parent-child","created_at":"2026-01-16T23:45:50.360907972-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-fbj17","depends_on_id":"hq-wisp-yztp9","type":"blocks","created_at":"2026-01-16T23:45:52.922025222-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-fcbm9","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:41:51.250259852-05:00","updated_at":"2026-01-16T23:42:32.725602895-05:00","closed_at":"2026-01-16T23:42:32.725602895-05:00","close_reason":"Nothing to process","dependencies":[{"issue_id":"hq-wisp-fcbm9","depends_on_id":"hq-wisp-tnkch","type":"parent-child","created_at":"2026-01-16T23:41:51.888747895-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-fcbm9","depends_on_id":"hq-wisp-ekmgr","type":"blocks","created_at":"2026-01-16T23:41:53.773007902-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-fd7wp","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:53:25.161593953-05:00","updated_at":"2026-01-16T23:53:47.229988892-05:00","closed_at":"2026-01-16T23:53:47.229988892-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-fd7wp","depends_on_id":"hq-wisp-of0wi","type":"parent-child","created_at":"2026-01-16T23:53:28.004635224-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-fd7wp","depends_on_id":"hq-wisp-e379f","type":"blocks","created_at":"2026-01-16T23:53:31.433295628-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-fd7zu","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:46:50.727314121-05:00","updated_at":"2026-01-17T10:46:50.727314162-05:00","dependencies":[{"issue_id":"hq-wisp-fd7zu","depends_on_id":"hq-wisp-2vhlh","type":"parent-child","created_at":"2026-01-17T10:46:51.015706243-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-fd7zu","depends_on_id":"hq-wisp-nggr1","type":"blocks","created_at":"2026-01-17T10:46:51.553898512-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-fehhn","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:50:47.928291104-05:00","updated_at":"2026-01-16T23:52:16.375190405-05:00","closed_at":"2026-01-16T23:52:16.375190405-05:00","close_reason":"Duplicate wisps, cleaning up","ephemeral":true}
{"id":"hq-wisp-feju9","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:08:16.845728892-05:00","updated_at":"2026-01-17T01:10:27.33912036-05:00","closed_at":"2026-01-17T01:10:27.33912036-05:00","close_reason":"Final patrol","dependencies":[{"issue_id":"hq-wisp-feju9","depends_on_id":"hq-wisp-vrsc5","type":"parent-child","created_at":"2026-01-17T01:08:18.69433904-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-feju9","depends_on_id":"hq-wisp-op9m8","type":"blocks","created_at":"2026-01-17T01:08:29.584645074-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-feqrq","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:53:05.621694443-05:00","updated_at":"2026-01-16T23:53:55.254716885-05:00","closed_at":"2026-01-16T23:53:55.254716885-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-feqrq","depends_on_id":"hq-wisp-xtx6n","type":"parent-child","created_at":"2026-01-16T23:53:06.860959615-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-feqrq","depends_on_id":"hq-wisp-dlk0f","type":"blocks","created_at":"2026-01-16T23:53:09.974153553-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-feqrq","depends_on_id":"hq-wisp-mgiu1","type":"blocks","created_at":"2026-01-16T23:53:10.149030127-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-feqrq","depends_on_id":"hq-wisp-dj4y0","type":"blocks","created_at":"2026-01-16T23:53:10.325777366-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-fhf","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T00:42:56.473352301-05:00","updated_at":"2026-01-16T01:50:39.559263017-05:00","closed_at":"2026-01-16T01:50:39.559263017-05:00","close_reason":"Stale patrol wisp cleanup","ephemeral":true}
{"id":"hq-wisp-fjhz7","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:48:51.073071989-05:00","updated_at":"2026-01-16T23:49:31.054017519-05:00","closed_at":"2026-01-16T23:49:31.054017519-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-fjhz7","depends_on_id":"hq-wisp-de87j","type":"parent-child","created_at":"2026-01-16T23:48:51.082921175-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-fjjo","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:48:28.031708929-05:00","updated_at":"2026-01-16T22:13:02.106259794-05:00","closed_at":"2026-01-16T22:13:02.106259794-05:00","close_reason":"Orphaned - forced cleanup","dependencies":[{"issue_id":"hq-wisp-fjjo","depends_on_id":"hq-wisp-mwjb","type":"parent-child","created_at":"2026-01-16T21:48:28.069320987-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-fjjo","depends_on_id":"hq-wisp-gsr9","type":"blocks","created_at":"2026-01-16T21:48:28.159862452-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-fjrs","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","assignee":"deacon","created_at":"2026-01-16T22:15:27.688794904-05:00","updated_at":"2026-01-17T00:36:33.880117258-05:00","closed_at":"2026-01-17T00:36:33.880117258-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-fk674","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:46:50.72310104-05:00","updated_at":"2026-01-17T10:46:50.723101081-05:00","dependencies":[{"issue_id":"hq-wisp-fk674","depends_on_id":"hq-wisp-2vhlh","type":"parent-child","created_at":"2026-01-17T10:46:50.834678891-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-fk674","depends_on_id":"hq-wisp-14ebq","type":"blocks","created_at":"2026-01-17T10:46:51.30355345-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-fktci","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:45:48.840799398-05:00","updated_at":"2026-01-16T23:46:47.267367759-05:00","closed_at":"2026-01-16T23:46:47.267367759-05:00","close_reason":"zombie-scan not implemented","dependencies":[{"issue_id":"hq-wisp-fktci","depends_on_id":"hq-wisp-2heyl","type":"parent-child","created_at":"2026-01-16T23:45:49.863710889-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-fktci","depends_on_id":"hq-wisp-yijs3","type":"blocks","created_at":"2026-01-16T23:45:52.400461062-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-fnimo","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T01:07:28.959182069-05:00","updated_at":"2026-01-17T01:09:40.042055388-05:00","closed_at":"2026-01-17T01:09:40.042055388-05:00","close_reason":"Patrol 19 complete","ephemeral":true}
{"id":"hq-wisp-fnkrw","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:49:41.442536172-05:00","updated_at":"2026-01-16T23:50:34.134854852-05:00","closed_at":"2026-01-16T23:50:34.134854852-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-fnkrw","depends_on_id":"hq-wisp-q54v3","type":"parent-child","created_at":"2026-01-16T23:49:41.736698668-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-fnkrw","depends_on_id":"hq-wisp-jixob","type":"blocks","created_at":"2026-01-16T23:49:44.280604078-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-fnvo7","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:00:26.059921812-05:00","updated_at":"2026-01-17T01:01:24.144146393-05:00","closed_at":"2026-01-17T01:01:24.144146393-05:00","close_reason":"All healthy","dependencies":[{"issue_id":"hq-wisp-fnvo7","depends_on_id":"hq-wisp-5yxyi","type":"parent-child","created_at":"2026-01-17T01:00:29.931724596-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-fnvo7","depends_on_id":"hq-wisp-khfm8","type":"blocks","created_at":"2026-01-17T01:00:39.90182953-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-fnvo7","depends_on_id":"hq-wisp-sfdxe","type":"blocks","created_at":"2026-01-17T01:00:40.46216297-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-fnvo7","depends_on_id":"hq-wisp-9t067","type":"blocks","created_at":"2026-01-17T01:00:41.013387341-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-forn7","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:47:53.503509622-05:00","updated_at":"2026-01-16T23:48:28.722688603-05:00","closed_at":"2026-01-16T23:48:28.722688603-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-forn7","depends_on_id":"hq-wisp-wj52z","type":"parent-child","created_at":"2026-01-16T23:47:54.975013092-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-forn7","depends_on_id":"hq-wisp-mmiv4","type":"blocks","created_at":"2026-01-16T23:47:57.680262041-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-fp4qm","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:31:27.064192911-05:00","updated_at":"2026-01-17T00:31:50.003670172-05:00","closed_at":"2026-01-17T00:31:50.003670172-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-fp4qm","depends_on_id":"hq-wisp-6cqlz","type":"parent-child","created_at":"2026-01-17T00:31:27.077483224-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-fpsqo","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T10:49:23.427754772-05:00","updated_at":"2026-01-17T10:49:33.675828568-05:00","closed_at":"2026-01-17T10:49:33.675828568-05:00","close_reason":"Patrol 20 complete","ephemeral":true}
{"id":"hq-wisp-fpw0o","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:44:41.998314581-05:00","updated_at":"2026-01-17T10:44:41.998314623-05:00","dependencies":[{"issue_id":"hq-wisp-fpw0o","depends_on_id":"hq-wisp-qd1hf","type":"parent-child","created_at":"2026-01-17T10:44:42.104791428-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-fpw0o","depends_on_id":"hq-wisp-hduio","type":"blocks","created_at":"2026-01-17T10:44:42.353932236-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-fpw0o","depends_on_id":"hq-wisp-yjyar","type":"blocks","created_at":"2026-01-17T10:44:42.369608677-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-fpw0o","depends_on_id":"hq-wisp-esgt7","type":"blocks","created_at":"2026-01-17T10:44:42.384984327-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-fqic4","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:04:43.435851614-05:00","updated_at":"2026-01-17T01:06:02.97840092-05:00","closed_at":"2026-01-17T01:06:02.97840092-05:00","close_reason":"No async gates","dependencies":[{"issue_id":"hq-wisp-fqic4","depends_on_id":"hq-wisp-bkl5l","type":"parent-child","created_at":"2026-01-17T01:04:44.612889485-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-fqic4","depends_on_id":"hq-wisp-au6rx","type":"blocks","created_at":"2026-01-17T01:04:55.396742561-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-frqti","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:43:56.994924275-05:00","updated_at":"2026-01-16T23:44:25.828907149-05:00","closed_at":"2026-01-16T23:44:25.828907149-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-frqti","depends_on_id":"hq-wisp-ywecn","type":"parent-child","created_at":"2026-01-16T23:43:58.13885121-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-frqti","depends_on_id":"hq-wisp-0v4eo","type":"blocks","created_at":"2026-01-16T23:44:00.229414315-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-fsms9","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T01:09:41.602741317-05:00","updated_at":"2026-01-17T01:11:14.260964962-05:00","closed_at":"2026-01-17T01:11:14.260964962-05:00","close_reason":"Patrol 20 complete - handoff","ephemeral":true}
{"id":"hq-wisp-fsufr","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:25:52.718425117-05:00","updated_at":"2026-01-16T23:27:16.19031536-05:00","closed_at":"2026-01-16T23:27:16.19031536-05:00","close_reason":"No plugins, no stuck dogs","dependencies":[{"issue_id":"hq-wisp-fsufr","depends_on_id":"hq-wisp-w4tn2","type":"parent-child","created_at":"2026-01-16T23:25:53.566561714-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-fsufr","depends_on_id":"hq-wisp-d0775","type":"blocks","created_at":"2026-01-16T23:25:55.461608259-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-fu5t","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:37:49.090535349-05:00","updated_at":"2026-01-16T23:40:12.434214736-05:00","closed_at":"2026-01-16T23:40:12.434214736-05:00","close_reason":"zombie-scan not implemented","dependencies":[{"issue_id":"hq-wisp-fu5t","depends_on_id":"hq-wisp-2zuj","type":"parent-child","created_at":"2026-01-16T23:37:49.808492131-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-fu5t","depends_on_id":"hq-wisp-qdxl","type":"blocks","created_at":"2026-01-16T23:37:51.618404979-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-fwsj","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:05:01.105654547-05:00","updated_at":"2026-01-16T22:13:01.960723937-05:00","closed_at":"2026-01-16T22:13:01.960723937-05:00","close_reason":"Orphaned - forced cleanup","dependencies":[{"issue_id":"hq-wisp-fwsj","depends_on_id":"hq-wisp-xrtb","type":"parent-child","created_at":"2026-01-16T22:05:01.248119033-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-fwsj","depends_on_id":"hq-wisp-06fk","type":"blocks","created_at":"2026-01-16T22:05:01.422356813-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-fx2","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T00:42:54.341468398-05:00","updated_at":"2026-01-16T01:50:39.587012987-05:00","closed_at":"2026-01-16T01:50:39.587012987-05:00","close_reason":"Stale patrol wisp cleanup","ephemeral":true}
{"id":"hq-wisp-fyj77","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:47:34.376063044-05:00","updated_at":"2026-01-16T23:49:10.731320095-05:00","closed_at":"2026-01-16T23:49:10.731320095-05:00","close_reason":"Town idle patrol","dependencies":[{"issue_id":"hq-wisp-fyj77","depends_on_id":"hq-wisp-ql31w","type":"parent-child","created_at":"2026-01-16T23:47:36.518928697-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-fyj77","depends_on_id":"hq-wisp-pwlv2","type":"blocks","created_at":"2026-01-16T23:47:38.948336424-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-fz6eg","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:26:33.628837012-05:00","updated_at":"2026-01-17T00:27:04.81029977-05:00","closed_at":"2026-01-17T00:27:04.81029977-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-fz6eg","depends_on_id":"hq-wisp-3h08u","type":"parent-child","created_at":"2026-01-17T00:26:35.259102078-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-fz6eg","depends_on_id":"hq-wisp-heht9","type":"blocks","created_at":"2026-01-17T00:26:39.320613747-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-g0v8","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:56:35.918921563-05:00","updated_at":"2026-01-16T22:12:53.967591174-05:00","closed_at":"2026-01-16T22:12:53.967591174-05:00","close_reason":"Orphaned wisp step - cleanup","dependencies":[{"issue_id":"hq-wisp-g0v8","depends_on_id":"hq-wisp-8d7d","type":"parent-child","created_at":"2026-01-16T01:56:35.92948751-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-g0v8","depends_on_id":"hq-wisp-gy61","type":"blocks","created_at":"2026-01-16T01:56:35.96890605-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-g1el","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T01:41:58.42693872-05:00","updated_at":"2026-01-16T01:50:39.011075239-05:00","closed_at":"2026-01-16T01:50:39.011075239-05:00","close_reason":"Stale patrol wisp cleanup","ephemeral":true}
{"id":"hq-wisp-g27z3","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:52:28.530810725-05:00","updated_at":"2026-01-16T23:52:50.260262136-05:00","closed_at":"2026-01-16T23:52:50.260262136-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-g27z3","depends_on_id":"hq-wisp-en6ig","type":"parent-child","created_at":"2026-01-16T23:52:29.232728056-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-g27z3","depends_on_id":"hq-wisp-gc9or","type":"blocks","created_at":"2026-01-16T23:52:32.342248894-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-g4cho","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:47:24.579752938-05:00","updated_at":"2026-01-17T10:47:24.579752979-05:00","dependencies":[{"issue_id":"hq-wisp-g4cho","depends_on_id":"hq-wisp-jag69","type":"parent-child","created_at":"2026-01-17T10:47:24.744353091-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-g4cho","depends_on_id":"hq-wisp-q4pks","type":"blocks","created_at":"2026-01-17T10:47:25.305867971-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-g6qj9","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:49:57.520867283-05:00","updated_at":"2026-01-17T10:49:57.520867324-05:00","dependencies":[{"issue_id":"hq-wisp-g6qj9","depends_on_id":"hq-wisp-8agmn","type":"parent-child","created_at":"2026-01-17T10:49:57.797007788-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-g6qj9","depends_on_id":"hq-wisp-s1wpx","type":"blocks","created_at":"2026-01-17T10:49:58.492077506-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-g6qj9","depends_on_id":"hq-wisp-rbxv9","type":"blocks","created_at":"2026-01-17T10:49:58.531353775-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-g6qj9","depends_on_id":"hq-wisp-0e8pe","type":"blocks","created_at":"2026-01-17T10:49:58.57083021-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-g8o7e","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:49:41.44779966-05:00","updated_at":"2026-01-16T23:50:17.28548751-05:00","closed_at":"2026-01-16T23:50:17.28548751-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-g8o7e","depends_on_id":"hq-wisp-q54v3","type":"parent-child","created_at":"2026-01-16T23:49:43.00444557-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-g8o7e","depends_on_id":"hq-wisp-sldzh","type":"blocks","created_at":"2026-01-16T23:49:45.866513879-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-gaduw","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:54:08.832805648-05:00","updated_at":"2026-01-16T23:54:55.699882435-05:00","closed_at":"2026-01-16T23:54:55.699882435-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-gaduw","depends_on_id":"hq-wisp-oecdp","type":"parent-child","created_at":"2026-01-16T23:54:10.438785745-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-gaduw","depends_on_id":"hq-wisp-gg4ys","type":"blocks","created_at":"2026-01-16T23:54:13.691039702-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-gadyv","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:47:53.501507384-05:00","updated_at":"2026-01-16T23:48:31.519328104-05:00","closed_at":"2026-01-16T23:48:31.519328104-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-gadyv","depends_on_id":"hq-wisp-wj52z","type":"parent-child","created_at":"2026-01-16T23:47:54.576351066-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-gadyv","depends_on_id":"hq-wisp-9zavz","type":"blocks","created_at":"2026-01-16T23:47:57.267933679-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-gb4c","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:26:29.478000958-05:00","updated_at":"2026-01-16T01:52:13.909297547-05:00","closed_at":"2026-01-16T01:52:13.909297547-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-gb4c","depends_on_id":"hq-wisp-zv2x","type":"parent-child","created_at":"2026-01-16T01:26:29.586673511-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-gb4c","depends_on_id":"hq-wisp-pbux","type":"blocks","created_at":"2026-01-16T01:26:29.72904228-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-gc9or","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:52:28.528356102-05:00","updated_at":"2026-01-16T23:52:44.964662786-05:00","closed_at":"2026-01-16T23:52:44.964662786-05:00","close_reason":"Inbox empty","dependencies":[{"issue_id":"hq-wisp-gc9or","depends_on_id":"hq-wisp-en6ig","type":"parent-child","created_at":"2026-01-16T23:52:28.539669718-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-gcvqu","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T00:33:25.589022602-05:00","updated_at":"2026-01-17T00:36:30.939589908-05:00","closed_at":"2026-01-17T00:36:30.939589908-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-gdmu0","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:29:36.059685624-05:00","updated_at":"2026-01-17T00:29:51.391329683-05:00","closed_at":"2026-01-17T00:29:51.391329683-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-gdmu0","depends_on_id":"hq-wisp-w5z6p","type":"parent-child","created_at":"2026-01-17T00:29:36.79290627-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-gdmu0","depends_on_id":"hq-wisp-dkoqg","type":"blocks","created_at":"2026-01-17T00:29:41.117101413-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-gdvf4","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:25:52.716657783-05:00","updated_at":"2026-01-16T23:26:51.151947783-05:00","closed_at":"2026-01-16T23:26:51.151947783-05:00","close_reason":"No events","dependencies":[{"issue_id":"hq-wisp-gdvf4","depends_on_id":"hq-wisp-w4tn2","type":"parent-child","created_at":"2026-01-16T23:25:53.286915876-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-gdvf4","depends_on_id":"hq-wisp-44czg","type":"blocks","created_at":"2026-01-16T23:25:54.980287696-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-gepi2","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T10:49:09.199146056-05:00","updated_at":"2026-01-17T10:49:18.719545402-05:00","closed_at":"2026-01-17T10:49:18.719545402-05:00","close_reason":"Patrol 19 complete","ephemeral":true}
{"id":"hq-wisp-gg4ys","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:54:08.830974232-05:00","updated_at":"2026-01-16T23:54:58.632650061-05:00","closed_at":"2026-01-16T23:54:58.632650061-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-gg4ys","depends_on_id":"hq-wisp-oecdp","type":"parent-child","created_at":"2026-01-16T23:54:09.961536654-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-gg4ys","depends_on_id":"hq-wisp-xdflg","type":"blocks","created_at":"2026-01-16T23:54:12.868465126-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-gg4ys","depends_on_id":"hq-wisp-bznmt","type":"blocks","created_at":"2026-01-16T23:54:13.032123292-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-gg4ys","depends_on_id":"hq-wisp-jwutk","type":"blocks","created_at":"2026-01-16T23:54:13.196327416-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ggqux","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:23:47.742141699-05:00","updated_at":"2026-01-16T23:25:43.3287583-05:00","closed_at":"2026-01-16T23:25:43.3287583-05:00","close_reason":"End-of-cycle, looping","dependencies":[{"issue_id":"hq-wisp-ggqux","depends_on_id":"hq-wisp-9we3","type":"parent-child","created_at":"2026-01-16T23:23:49.488051054-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ggqux","depends_on_id":"hq-wisp-40g0y","type":"blocks","created_at":"2026-01-16T23:23:51.455396588-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ghjl","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:43:15.719297848-05:00","updated_at":"2026-01-16T22:12:49.686990172-05:00","closed_at":"2026-01-16T22:12:49.686990172-05:00","close_reason":"Orphaned wisp step - cleanup","dependencies":[{"issue_id":"hq-wisp-ghjl","depends_on_id":"hq-wisp-l7vn","type":"parent-child","created_at":"2026-01-16T21:43:15.757004614-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ghjl","depends_on_id":"hq-wisp-up3n","type":"blocks","created_at":"2026-01-16T21:43:15.828407571-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-giwh3","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:53:05.626400731-05:00","updated_at":"2026-01-16T23:53:46.754459841-05:00","closed_at":"2026-01-16T23:53:46.754459841-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-giwh3","depends_on_id":"hq-wisp-xtx6n","type":"parent-child","created_at":"2026-01-16T23:53:08.073487432-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-giwh3","depends_on_id":"hq-wisp-k0i3t","type":"blocks","created_at":"2026-01-16T23:53:11.559374584-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-gjda","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:55:36.782194294-05:00","updated_at":"2026-01-16T01:56:25.988279669-05:00","closed_at":"2026-01-16T01:56:25.988279669-05:00","close_reason":"Orphan cleanup","dependencies":[{"issue_id":"hq-wisp-gjda","depends_on_id":"hq-wisp-ndqt","type":"parent-child","created_at":"2026-01-16T01:55:36.834103279-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-gjda","depends_on_id":"hq-wisp-w1lo","type":"blocks","created_at":"2026-01-16T01:55:36.957112687-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-gjda","depends_on_id":"hq-wisp-x8un","type":"blocks","created_at":"2026-01-16T01:55:36.964469554-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-gjda","depends_on_id":"hq-wisp-2d40","type":"blocks","created_at":"2026-01-16T01:55:36.971728046-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-gjvqn","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:12:55.878214165-05:00","updated_at":"2026-01-17T01:14:32.385136441-05:00","closed_at":"2026-01-17T01:14:32.385136441-05:00","close_reason":"No pending spawns","dependencies":[{"issue_id":"hq-wisp-gjvqn","depends_on_id":"hq-wisp-i2n82","type":"parent-child","created_at":"2026-01-17T01:12:56.498367444-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-gjvqn","depends_on_id":"hq-wisp-k2tqt","type":"blocks","created_at":"2026-01-17T01:13:07.501286843-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-gl6e","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:05:01.101503135-05:00","updated_at":"2026-01-16T22:12:53.887375025-05:00","closed_at":"2026-01-16T22:12:53.887375025-05:00","close_reason":"Orphaned wisp step - cleanup","dependencies":[{"issue_id":"hq-wisp-gl6e","depends_on_id":"hq-wisp-xrtb","type":"parent-child","created_at":"2026-01-16T22:05:01.137322257-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-gl6e","depends_on_id":"hq-wisp-57yq","type":"blocks","created_at":"2026-01-16T22:05:01.279990868-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-glu2w","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:47:53.498123738-05:00","updated_at":"2026-01-16T23:48:38.469269053-05:00","closed_at":"2026-01-16T23:48:38.469269053-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-glu2w","depends_on_id":"hq-wisp-wj52z","type":"parent-child","created_at":"2026-01-16T23:47:53.771746806-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-glu2w","depends_on_id":"hq-wisp-idkop","type":"blocks","created_at":"2026-01-16T23:47:56.181956023-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-glvay","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T00:31:39.418747721-05:00","updated_at":"2026-01-17T00:32:13.019968565-05:00","closed_at":"2026-01-17T00:32:13.019968565-05:00","close_reason":"Patrol cycle 13 complete","ephemeral":true}
{"id":"hq-wisp-go5rr","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:52:28.532550349-05:00","updated_at":"2026-01-16T23:52:49.721188718-05:00","closed_at":"2026-01-16T23:52:49.721188718-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-go5rr","depends_on_id":"hq-wisp-en6ig","type":"parent-child","created_at":"2026-01-16T23:52:29.746661949-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-go5rr","depends_on_id":"hq-wisp-vy1cp","type":"blocks","created_at":"2026-01-16T23:52:32.86500628-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-go5rr","depends_on_id":"hq-wisp-wlqws","type":"blocks","created_at":"2026-01-16T23:52:33.039247144-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-go5rr","depends_on_id":"hq-wisp-uqjc0","type":"blocks","created_at":"2026-01-16T23:52:33.215921924-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-godc7","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:07:28.974382004-05:00","updated_at":"2026-01-17T01:09:30.487244811-05:00","closed_at":"2026-01-17T01:09:30.487244811-05:00","close_reason":"Logs rotated","dependencies":[{"issue_id":"hq-wisp-godc7","depends_on_id":"hq-wisp-fnimo","type":"parent-child","created_at":"2026-01-17T01:07:37.734626831-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-godc7","depends_on_id":"hq-wisp-ri7hr","type":"blocks","created_at":"2026-01-17T01:07:49.42080966-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-goqqm","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:00:26.061500809-05:00","updated_at":"2026-01-17T01:01:56.970381214-05:00","closed_at":"2026-01-17T01:01:56.970381214-05:00","close_reason":"No plugins","dependencies":[{"issue_id":"hq-wisp-goqqm","depends_on_id":"hq-wisp-5yxyi","type":"parent-child","created_at":"2026-01-17T01:00:31.031558467-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-goqqm","depends_on_id":"hq-wisp-kfiv5","type":"blocks","created_at":"2026-01-17T01:00:42.127099232-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-gpjen","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:56:23.048738332-05:00","updated_at":"2026-01-17T00:35:10.557556117-05:00","closed_at":"2026-01-17T00:35:10.557556117-05:00","close_reason":"Cleanup","ephemeral":true}
{"id":"hq-wisp-gqb4","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T22:09:20.618767534-05:00","updated_at":"2026-01-16T22:12:13.772073706-05:00","closed_at":"2026-01-16T22:12:13.772073706-05:00","close_reason":"Orphaned - bulk cleanup","ephemeral":true}
{"id":"hq-wisp-gsr9","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:48:28.031398221-05:00","updated_at":"2026-01-16T22:13:02.110915747-05:00","closed_at":"2026-01-16T22:13:02.110915747-05:00","close_reason":"Orphaned - forced cleanup","dependencies":[{"issue_id":"hq-wisp-gsr9","depends_on_id":"hq-wisp-mwjb","type":"parent-child","created_at":"2026-01-16T21:48:28.06513887-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-gsr9","depends_on_id":"hq-wisp-6avr","type":"blocks","created_at":"2026-01-16T21:48:28.14497352-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-gsr9","depends_on_id":"hq-wisp-b68x","type":"blocks","created_at":"2026-01-16T21:48:28.149748678-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-gsr9","depends_on_id":"hq-wisp-kpob","type":"blocks","created_at":"2026-01-16T21:48:28.154768461-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-gsu00","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon/","created_at":"2026-01-17T00:41:35.94764513-05:00","updated_at":"2026-01-17T01:01:56.993727386-05:00","closed_at":"2026-01-17T01:01:56.993727386-05:00","close_reason":"Patrol #17 complete: inbox empty, all healthy","ephemeral":true}
{"id":"hq-wisp-gsuxv","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:43:56.9921839-05:00","updated_at":"2026-01-16T23:44:32.793284392-05:00","closed_at":"2026-01-16T23:44:32.793284392-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-gsuxv","depends_on_id":"hq-wisp-ywecn","type":"parent-child","created_at":"2026-01-16T23:43:57.510381125-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-gsuxv","depends_on_id":"hq-wisp-py9k5","type":"blocks","created_at":"2026-01-16T23:43:59.384359883-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-gtj8g","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:49:57.515561994-05:00","updated_at":"2026-01-17T10:49:57.515562036-05:00","dependencies":[{"issue_id":"hq-wisp-gtj8g","depends_on_id":"hq-wisp-8agmn","type":"parent-child","created_at":"2026-01-17T10:49:57.529359361-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-guj80","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:50:53.901166512-05:00","updated_at":"2026-01-16T23:51:23.260230569-05:00","closed_at":"2026-01-16T23:51:23.260230569-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-guj80","depends_on_id":"hq-wisp-47par","type":"parent-child","created_at":"2026-01-16T23:50:56.316560347-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-guj80","depends_on_id":"hq-wisp-jm12j","type":"blocks","created_at":"2026-01-16T23:50:59.204772898-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-guri6","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:49:59.358270624-05:00","updated_at":"2026-01-17T10:49:59.358270666-05:00","dependencies":[{"issue_id":"hq-wisp-guri6","depends_on_id":"hq-wisp-wxw0u","type":"parent-child","created_at":"2026-01-17T10:49:59.722303619-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-guri6","depends_on_id":"hq-wisp-92hvc","type":"blocks","created_at":"2026-01-17T10:50:00.62510355-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-gv92b","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:46:10.407078463-05:00","updated_at":"2026-01-17T10:46:10.407078505-05:00","dependencies":[{"issue_id":"hq-wisp-gv92b","depends_on_id":"hq-wisp-bio5t","type":"parent-child","created_at":"2026-01-17T10:46:10.591064564-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-gv92b","depends_on_id":"hq-wisp-v3dak","type":"blocks","created_at":"2026-01-17T10:46:10.992366787-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-gvqg","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T01:22:20.083987663-05:00","updated_at":"2026-01-16T01:50:39.336008594-05:00","closed_at":"2026-01-16T01:50:39.336008594-05:00","close_reason":"Stale patrol wisp cleanup","ephemeral":true}
{"id":"hq-wisp-gvu5f","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:54:44.991087622-05:00","updated_at":"2026-01-17T00:35:28.609457161-05:00","closed_at":"2026-01-17T00:35:28.609457161-05:00","close_reason":"Cleanup","ephemeral":true}
{"id":"hq-wisp-gw7j6","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:00:26.058380106-05:00","updated_at":"2026-01-17T01:01:15.968157922-05:00","closed_at":"2026-01-17T01:01:15.968157922-05:00","close_reason":"No external deps","dependencies":[{"issue_id":"hq-wisp-gw7j6","depends_on_id":"hq-wisp-5yxyi","type":"parent-child","created_at":"2026-01-17T01:00:28.815746334-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-gw7j6","depends_on_id":"hq-wisp-u2z19","type":"blocks","created_at":"2026-01-17T01:00:38.798623081-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-gwgl","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:23:47.737678283-05:00","updated_at":"2026-01-16T23:25:22.255966842-05:00","closed_at":"2026-01-16T23:25:22.255966842-05:00","close_reason":"No orphaned work","dependencies":[{"issue_id":"hq-wisp-gwgl","depends_on_id":"hq-wisp-9we3","type":"parent-child","created_at":"2026-01-16T23:23:48.894251673-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-gwgl","depends_on_id":"hq-wisp-tr40","type":"blocks","created_at":"2026-01-16T23:23:50.850205-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-gy61","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:56:35.91803598-05:00","updated_at":"2026-01-16T22:12:49.707822271-05:00","closed_at":"2026-01-16T22:12:49.707822271-05:00","close_reason":"Orphaned wisp step - cleanup","dependencies":[{"issue_id":"hq-wisp-gy61","depends_on_id":"hq-wisp-8d7d","type":"parent-child","created_at":"2026-01-16T01:56:35.924468473-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-gy6a","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T01:38:12.155196903-05:00","updated_at":"2026-01-16T01:50:39.094207774-05:00","closed_at":"2026-01-16T01:50:39.094207774-05:00","close_reason":"Stale patrol wisp cleanup","ephemeral":true}
{"id":"hq-wisp-gz1p","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:55:06.233883495-05:00","updated_at":"2026-01-16T01:52:14.201279146-05:00","closed_at":"2026-01-16T01:52:14.201279146-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-gz1p","depends_on_id":"hq-wisp-lejg","type":"parent-child","created_at":"2026-01-16T00:55:06.25591446-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-gza76","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:43:06.008046835-05:00","updated_at":"2026-01-16T23:43:39.73334405-05:00","closed_at":"2026-01-16T23:43:39.73334405-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-gza76","depends_on_id":"hq-wisp-p7g8j","type":"parent-child","created_at":"2026-01-16T23:43:06.228948713-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-gza76","depends_on_id":"hq-wisp-wy2ji","type":"blocks","created_at":"2026-01-16T23:43:08.170052583-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-gze5q","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T02:00:44.5809396-05:00","updated_at":"2026-01-17T02:01:58.288892114-05:00","closed_at":"2026-01-17T02:01:58.288892114-05:00","close_reason":"Idle patrol","dependencies":[{"issue_id":"hq-wisp-gze5q","depends_on_id":"hq-wisp-9a1wp","type":"parent-child","created_at":"2026-01-17T02:00:56.47416237-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-gze5q","depends_on_id":"hq-wisp-uq4kl","type":"blocks","created_at":"2026-01-17T02:01:09.25211884-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-h0zwb","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T00:02:31.840652464-05:00","updated_at":"2026-01-17T00:35:08.225717499-05:00","closed_at":"2026-01-17T00:35:08.225717499-05:00","close_reason":"Cleanup","ephemeral":true}
{"id":"hq-wisp-h1uu","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T22:05:00.700803892-05:00","updated_at":"2026-01-16T22:12:18.896180842-05:00","closed_at":"2026-01-16T22:12:18.896180842-05:00","close_reason":"Orphaned - bulk cleanup","ephemeral":true}
{"id":"hq-wisp-h1zpl","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:47:24.583190686-05:00","updated_at":"2026-01-17T10:47:24.583190686-05:00","dependencies":[{"issue_id":"hq-wisp-h1zpl","depends_on_id":"hq-wisp-jag69","type":"parent-child","created_at":"2026-01-17T10:47:24.929488733-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-h1zpl","depends_on_id":"hq-wisp-3hu7v","type":"blocks","created_at":"2026-01-17T10:47:25.575784105-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-h23u","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:46:26.937445898-05:00","updated_at":"2026-01-16T01:47:56.797675881-05:00","closed_at":"2026-01-16T01:47:56.797675881-05:00","close_reason":"No work found","dependencies":[{"issue_id":"hq-wisp-h23u","depends_on_id":"hq-wisp-ybkc","type":"parent-child","created_at":"2026-01-16T01:46:26.952767132-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-h23u","depends_on_id":"hq-wisp-3c9p","type":"blocks","created_at":"2026-01-16T01:46:27.145292548-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-h34b9","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:37:49.09405989-05:00","updated_at":"2026-01-16T23:45:03.874358549-05:00","closed_at":"2026-01-16T23:45:03.874358549-05:00","close_reason":"Inbox empty, no cleanup needed","dependencies":[{"issue_id":"hq-wisp-h34b9","depends_on_id":"hq-wisp-2zuj","type":"parent-child","created_at":"2026-01-16T23:37:50.526577287-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-h34b9","depends_on_id":"hq-wisp-msxkm","type":"blocks","created_at":"2026-01-16T23:37:52.356526633-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-h44sg","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:37:49.09230514-05:00","updated_at":"2026-01-16T23:41:00.119064121-05:00","closed_at":"2026-01-16T23:41:00.119064121-05:00","close_reason":"No abandoned work - only patrol wisps in progress","dependencies":[{"issue_id":"hq-wisp-h44sg","depends_on_id":"hq-wisp-2zuj","type":"parent-child","created_at":"2026-01-16T23:37:50.165964959-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-h44sg","depends_on_id":"hq-wisp-wt12x","type":"blocks","created_at":"2026-01-16T23:37:51.984976431-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-h4ppz","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:30:03.177195848-05:00","updated_at":"2026-01-17T00:30:30.662547643-05:00","closed_at":"2026-01-17T00:30:30.662547643-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-h4ppz","depends_on_id":"hq-wisp-8d16m","type":"parent-child","created_at":"2026-01-17T00:30:05.108183742-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-h4ppz","depends_on_id":"hq-wisp-loflk","type":"blocks","created_at":"2026-01-17T00:30:09.946063294-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-h5s6o","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:30:03.174428561-05:00","updated_at":"2026-01-17T00:30:25.562161123-05:00","closed_at":"2026-01-17T00:30:25.562161123-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-h5s6o","depends_on_id":"hq-wisp-8d16m","type":"parent-child","created_at":"2026-01-17T00:30:04.141971754-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-h5s6o","depends_on_id":"hq-wisp-ulxlo","type":"blocks","created_at":"2026-01-17T00:30:08.466872896-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-h6126","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:49:35.719765926-05:00","updated_at":"2026-01-16T23:50:20.778538298-05:00","closed_at":"2026-01-16T23:50:20.778538298-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-h6126","depends_on_id":"hq-wisp-n4f70","type":"parent-child","created_at":"2026-01-16T23:49:36.270334212-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-h6126","depends_on_id":"hq-wisp-xmlr6","type":"blocks","created_at":"2026-01-16T23:49:38.710675608-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-h7ji0","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:48:51.073651988-05:00","updated_at":"2026-01-16T23:49:30.043074824-05:00","closed_at":"2026-01-16T23:49:30.043074824-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-h7ji0","depends_on_id":"hq-wisp-de87j","type":"parent-child","created_at":"2026-01-16T23:48:51.221506609-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-h7ji0","depends_on_id":"hq-wisp-fjhz7","type":"blocks","created_at":"2026-01-16T23:48:53.754036753-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-h82k","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:22:20.086314577-05:00","updated_at":"2026-01-16T01:52:14.085600897-05:00","closed_at":"2026-01-16T01:52:14.085600897-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-h82k","depends_on_id":"hq-wisp-gvqg","type":"parent-child","created_at":"2026-01-16T01:22:20.120250542-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-h82k","depends_on_id":"hq-wisp-ye8u","type":"blocks","created_at":"2026-01-16T01:22:20.213029945-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-h86lv","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:49:35.728688114-05:00","updated_at":"2026-01-16T23:50:17.782209419-05:00","closed_at":"2026-01-16T23:50:17.782209419-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-h86lv","depends_on_id":"hq-wisp-n4f70","type":"parent-child","created_at":"2026-01-16T23:49:38.166546431-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-h86lv","depends_on_id":"hq-wisp-uxg7q","type":"blocks","created_at":"2026-01-16T23:49:40.924991102-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-hafk","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T22:57:57.657622241-05:00","updated_at":"2026-01-17T00:36:14.354793597-05:00","closed_at":"2026-01-17T00:36:14.354793597-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-hduio","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:44:41.994541054-05:00","updated_at":"2026-01-17T10:44:41.994541095-05:00","dependencies":[{"issue_id":"hq-wisp-hduio","depends_on_id":"hq-wisp-qd1hf","type":"parent-child","created_at":"2026-01-17T10:44:42.021805367-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-hduio","depends_on_id":"hq-wisp-utk0g","type":"blocks","created_at":"2026-01-17T10:44:42.265944235-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-heht9","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:26:33.628271471-05:00","updated_at":"2026-01-17T00:27:03.4733557-05:00","closed_at":"2026-01-17T00:27:03.4733557-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-heht9","depends_on_id":"hq-wisp-3h08u","type":"parent-child","created_at":"2026-01-17T00:26:35.060092546-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-heht9","depends_on_id":"hq-wisp-hlllj","type":"blocks","created_at":"2026-01-17T00:26:38.71340921-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-heht9","depends_on_id":"hq-wisp-xm8on","type":"blocks","created_at":"2026-01-17T00:26:38.914146864-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-heht9","depends_on_id":"hq-wisp-j8wha","type":"blocks","created_at":"2026-01-17T00:26:39.116195641-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-hfuye","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:53:05.618682571-05:00","updated_at":"2026-01-16T23:53:58.491953853-05:00","closed_at":"2026-01-16T23:53:58.491953853-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-hfuye","depends_on_id":"hq-wisp-xtx6n","type":"parent-child","created_at":"2026-01-16T23:53:06.005738023-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-hfuye","depends_on_id":"hq-wisp-dl3f2","type":"blocks","created_at":"2026-01-16T23:53:09.111164842-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-hirk5","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:49:41.443597295-05:00","updated_at":"2026-01-16T23:50:32.167891252-05:00","closed_at":"2026-01-16T23:50:32.167891252-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-hirk5","depends_on_id":"hq-wisp-q54v3","type":"parent-child","created_at":"2026-01-16T23:49:42.015355158-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-hirk5","depends_on_id":"hq-wisp-jixob","type":"blocks","created_at":"2026-01-16T23:49:44.57146754-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-hisz","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","assignee":"deacon","created_at":"2026-01-16T22:15:46.428263263-05:00","updated_at":"2026-01-17T00:36:31.259007625-05:00","closed_at":"2026-01-17T00:36:31.259007625-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-hizs6","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:03:11.641934952-05:00","updated_at":"2026-01-17T01:04:16.165540949-05:00","closed_at":"2026-01-17T01:04:16.165540949-05:00","close_reason":"No stuck dogs","dependencies":[{"issue_id":"hq-wisp-hizs6","depends_on_id":"hq-wisp-zx2sm","type":"parent-child","created_at":"2026-01-17T01:03:18.219033158-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-hizs6","depends_on_id":"hq-wisp-v4hid","type":"blocks","created_at":"2026-01-17T01:03:30.332859895-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-hlllj","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:26:33.624392144-05:00","updated_at":"2026-01-17T00:27:00.299706908-05:00","closed_at":"2026-01-17T00:27:00.299706908-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-hlllj","depends_on_id":"hq-wisp-3h08u","type":"parent-child","created_at":"2026-01-17T00:26:33.842744018-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-hlllj","depends_on_id":"hq-wisp-ivaul","type":"blocks","created_at":"2026-01-17T00:26:37.477938755-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-hlv3","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:27:24.236246887-05:00","updated_at":"2026-01-16T01:52:13.808120574-05:00","closed_at":"2026-01-16T01:52:13.808120574-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-hlv3","depends_on_id":"hq-wisp-nv4o","type":"parent-child","created_at":"2026-01-16T01:27:24.291124913-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-hlv3","depends_on_id":"hq-wisp-viq4","type":"blocks","created_at":"2026-01-16T01:27:24.447624791-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-hlyrw","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:50:53.892554269-05:00","updated_at":"2026-01-16T23:51:37.467747048-05:00","closed_at":"2026-01-16T23:51:37.467747048-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-hlyrw","depends_on_id":"hq-wisp-47par","type":"parent-child","created_at":"2026-01-16T23:50:54.043268777-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-hlyrw","depends_on_id":"hq-wisp-dmcr4","type":"blocks","created_at":"2026-01-16T23:50:56.59776142-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-hmwj4","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T00:00:28.808640099-05:00","updated_at":"2026-01-17T00:35:08.83874043-05:00","closed_at":"2026-01-17T00:35:08.83874043-05:00","close_reason":"Cleanup","ephemeral":true}
{"id":"hq-wisp-hqek3","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:04:43.434948657-05:00","updated_at":"2026-01-17T01:05:59.056936962-05:00","closed_at":"2026-01-17T01:05:59.056936962-05:00","close_reason":"No spawns","dependencies":[{"issue_id":"hq-wisp-hqek3","depends_on_id":"hq-wisp-bkl5l","type":"parent-child","created_at":"2026-01-17T01:04:44.028303897-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-hqek3","depends_on_id":"hq-wisp-au6rx","type":"blocks","created_at":"2026-01-17T01:04:54.805895067-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-hqwl","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:19:36.432038531-05:00","updated_at":"2026-01-16T23:20:36.448464741-05:00","closed_at":"2026-01-16T23:20:36.448464741-05:00","close_reason":"No events to notify, town idle","dependencies":[{"issue_id":"hq-wisp-hqwl","depends_on_id":"hq-wisp-pfs9","type":"parent-child","created_at":"2026-01-16T23:19:36.887929638-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-hqwl","depends_on_id":"hq-wisp-ic7n","type":"blocks","created_at":"2026-01-16T23:19:38.225324507-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-hqyxm","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:43:56.996280567-05:00","updated_at":"2026-01-16T23:44:20.789890026-05:00","closed_at":"2026-01-16T23:44:20.789890026-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-hqyxm","depends_on_id":"hq-wisp-ywecn","type":"parent-child","created_at":"2026-01-16T23:43:58.45026842-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-hqyxm","depends_on_id":"hq-wisp-qfy5q","type":"blocks","created_at":"2026-01-16T23:44:00.54835219-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-hr7me","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:25:48.57982171-05:00","updated_at":"2026-01-17T00:26:23.471114346-05:00","closed_at":"2026-01-17T00:26:23.471114346-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-hr7me","depends_on_id":"hq-wisp-44ngw","type":"parent-child","created_at":"2026-01-17T00:25:48.793873633-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-hr7me","depends_on_id":"hq-wisp-bt23x","type":"blocks","created_at":"2026-01-17T00:25:52.488250309-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-httb","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:54:43.648934054-05:00","updated_at":"2026-01-16T01:56:11.658717275-05:00","closed_at":"2026-01-16T01:56:11.658717275-05:00","close_reason":"Orphan wisp cleanup","dependencies":[{"issue_id":"hq-wisp-httb","depends_on_id":"hq-wisp-8okt","type":"parent-child","created_at":"2026-01-16T01:54:43.660544417-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-httb","depends_on_id":"hq-wisp-2csi","type":"blocks","created_at":"2026-01-16T01:54:43.695925045-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-hugir","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:47:55.325254364-05:00","updated_at":"2026-01-17T10:47:55.325254364-05:00","dependencies":[{"issue_id":"hq-wisp-hugir","depends_on_id":"hq-wisp-9hr1x","type":"parent-child","created_at":"2026-01-17T10:47:55.99877822-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-hugir","depends_on_id":"hq-wisp-4epnc","type":"blocks","created_at":"2026-01-17T10:47:56.826840361-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-huma","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:21:24.471015344-05:00","updated_at":"2026-01-16T23:23:32.307299135-05:00","closed_at":"2026-01-16T23:23:32.307299135-05:00","close_reason":"Cleanup noted","dependencies":[{"issue_id":"hq-wisp-huma","depends_on_id":"hq-wisp-87xr","type":"parent-child","created_at":"2026-01-16T23:21:25.555569873-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-huma","depends_on_id":"hq-wisp-ovv7","type":"blocks","created_at":"2026-01-16T23:21:27.294645819-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-hvy5h","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:41:51.255383393-05:00","updated_at":"2026-01-16T23:42:48.152618421-05:00","closed_at":"2026-01-16T23:42:48.152618421-05:00","close_reason":"Routine checks passed","dependencies":[{"issue_id":"hq-wisp-hvy5h","depends_on_id":"hq-wisp-tnkch","type":"parent-child","created_at":"2026-01-16T23:41:53.03432233-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-hvy5h","depends_on_id":"hq-wisp-pex77","type":"blocks","created_at":"2026-01-16T23:41:55.165568055-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-hwwk","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:55:36.780598546-05:00","updated_at":"2026-01-16T01:56:07.967098087-05:00","closed_at":"2026-01-16T01:56:07.967098087-05:00","close_reason":"Orphan wisp cleanup","dependencies":[{"issue_id":"hq-wisp-hwwk","depends_on_id":"hq-wisp-ndqt","type":"parent-child","created_at":"2026-01-16T01:55:36.800813774-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-hwwk","depends_on_id":"hq-wisp-rphz","type":"blocks","created_at":"2026-01-16T01:55:36.921649684-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-hxii","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:46:01.530607866-05:00","updated_at":"2026-01-16T01:50:40.355596316-05:00","closed_at":"2026-01-16T01:50:40.355596316-05:00","close_reason":"No cross-rig dependencies to resolve this cycle","dependencies":[{"issue_id":"hq-wisp-hxii","depends_on_id":"hq-wisp-xunp","type":"parent-child","created_at":"2026-01-16T01:46:01.581618894-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-hxii","depends_on_id":"hq-wisp-iyd7","type":"blocks","created_at":"2026-01-16T01:46:01.758786327-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-hyean","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T02:00:44.579125143-05:00","updated_at":"2026-01-17T02:01:57.045284808-05:00","closed_at":"2026-01-17T02:01:57.045284808-05:00","close_reason":"Idle patrol","dependencies":[{"issue_id":"hq-wisp-hyean","depends_on_id":"hq-wisp-9a1wp","type":"parent-child","created_at":"2026-01-17T02:00:55.167689672-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-hyean","depends_on_id":"hq-wisp-12v9m","type":"blocks","created_at":"2026-01-17T02:01:07.97446988-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-hypk","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:56:35.921425768-05:00","updated_at":"2026-01-16T22:13:02.191850269-05:00","closed_at":"2026-01-16T22:13:02.191850269-05:00","close_reason":"Orphaned - forced cleanup","dependencies":[{"issue_id":"hq-wisp-hypk","depends_on_id":"hq-wisp-8d7d","type":"parent-child","created_at":"2026-01-16T01:56:35.944565827-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-hypk","depends_on_id":"hq-wisp-qzv5","type":"blocks","created_at":"2026-01-16T01:56:35.992500274-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-hz58","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T22:22:47.329577204-05:00","updated_at":"2026-01-17T00:36:20.988820721-05:00","closed_at":"2026-01-17T00:36:20.988820721-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-i0osk","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T00:43:20.045817325-05:00","updated_at":"2026-01-17T00:43:42.279612363-05:00","closed_at":"2026-01-17T00:43:42.279612363-05:00","close_reason":"OK","ephemeral":true}
{"id":"hq-wisp-i10r","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:19:36.436552405-05:00","updated_at":"2026-01-16T23:21:11.090831332-05:00","closed_at":"2026-01-16T23:21:11.090831332-05:00","close_reason":"Standard cleanup, context low, looping","dependencies":[{"issue_id":"hq-wisp-i10r","depends_on_id":"hq-wisp-pfs9","type":"parent-child","created_at":"2026-01-16T23:19:37.703612241-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-i10r","depends_on_id":"hq-wisp-vkrx","type":"blocks","created_at":"2026-01-16T23:19:39.215405963-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-i1a9","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:54:43.649504054-05:00","updated_at":"2026-01-16T01:56:11.208543682-05:00","closed_at":"2026-01-16T01:56:11.208543682-05:00","close_reason":"Orphan wisp cleanup","dependencies":[{"issue_id":"hq-wisp-i1a9","depends_on_id":"hq-wisp-8okt","type":"parent-child","created_at":"2026-01-16T01:54:43.665073203-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-i1a9","depends_on_id":"hq-wisp-zgbd","type":"blocks","created_at":"2026-01-16T01:54:43.701432122-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-i20qn","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:46:50.728478578-05:00","updated_at":"2026-01-17T10:46:50.72847862-05:00","dependencies":[{"issue_id":"hq-wisp-i20qn","depends_on_id":"hq-wisp-2vhlh","type":"parent-child","created_at":"2026-01-17T10:46:51.066521547-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-i20qn","depends_on_id":"hq-wisp-wggie","type":"blocks","created_at":"2026-01-17T10:46:51.612467144-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-i2n82","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T01:12:55.875323295-05:00","updated_at":"2026-01-17T02:00:16.902821888-05:00","closed_at":"2026-01-17T02:00:16.902821888-05:00","close_reason":"Patrol cycle complete - town idle, witness healthy","ephemeral":true}
{"id":"hq-wisp-i2rba","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:04:43.448400845-05:00","updated_at":"2026-01-17T01:07:21.520762048-05:00","closed_at":"2026-01-17T01:07:21.520762048-05:00","close_reason":"Context low","dependencies":[{"issue_id":"hq-wisp-i2rba","depends_on_id":"hq-wisp-bkl5l","type":"parent-child","created_at":"2026-01-17T01:04:53.59089334-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-i2rba","depends_on_id":"hq-wisp-pced7","type":"blocks","created_at":"2026-01-17T01:05:05.54124747-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-i3bqt","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:51:56.830991026-05:00","updated_at":"2026-01-16T23:52:42.322407443-05:00","closed_at":"2026-01-16T23:52:42.322407443-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-i3bqt","depends_on_id":"hq-wisp-ri9se","type":"parent-child","created_at":"2026-01-16T23:51:57.987733337-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-i3bqt","depends_on_id":"hq-wisp-adb3l","type":"blocks","created_at":"2026-01-16T23:52:00.957246491-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-i3bqt","depends_on_id":"hq-wisp-mq0wx","type":"blocks","created_at":"2026-01-16T23:52:01.124251029-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-i3bqt","depends_on_id":"hq-wisp-xy5tf","type":"blocks","created_at":"2026-01-16T23:52:01.292321232-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-i4jex","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:47:55.322008158-05:00","updated_at":"2026-01-17T10:47:55.322008241-05:00","dependencies":[{"issue_id":"hq-wisp-i4jex","depends_on_id":"hq-wisp-9hr1x","type":"parent-child","created_at":"2026-01-17T10:47:55.80881954-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-i4jex","depends_on_id":"hq-wisp-1tu5c","type":"blocks","created_at":"2026-01-17T10:47:56.609862946-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-i50hl","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:51:37.952752171-05:00","updated_at":"2026-01-16T23:52:08.8308593-05:00","closed_at":"2026-01-16T23:52:08.8308593-05:00","close_reason":"Duplicate wisps, cleaning up","ephemeral":true}
{"id":"hq-wisp-i79w","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:05:01.104210299-05:00","updated_at":"2026-01-16T22:13:01.994083811-05:00","closed_at":"2026-01-16T22:13:01.994083811-05:00","close_reason":"Orphaned - forced cleanup","dependencies":[{"issue_id":"hq-wisp-i79w","depends_on_id":"hq-wisp-xrtb","type":"parent-child","created_at":"2026-01-16T22:05:01.208350958-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-i79w","depends_on_id":"hq-wisp-uckl","type":"blocks","created_at":"2026-01-16T22:05:01.37563208-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-i7jed","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:49:41.446073206-05:00","updated_at":"2026-01-16T23:50:24.913479414-05:00","closed_at":"2026-01-16T23:50:24.913479414-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-i7jed","depends_on_id":"hq-wisp-q54v3","type":"parent-child","created_at":"2026-01-16T23:49:42.71845018-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-i7jed","depends_on_id":"hq-wisp-ocw37","type":"blocks","created_at":"2026-01-16T23:49:45.574002921-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-i83fr","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T10:47:55.317459994-05:00","updated_at":"2026-01-17T10:53:29.371009365-05:00","closed_at":"2026-01-17T10:53:29.371009365-05:00","close_reason":"Nothing to process","dependencies":[{"issue_id":"hq-wisp-i83fr","depends_on_id":"hq-wisp-9hr1x","type":"parent-child","created_at":"2026-01-17T10:47:55.511271714-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-i83fr","depends_on_id":"hq-wisp-bfu9u","type":"blocks","created_at":"2026-01-17T10:47:56.196794563-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-i8q1e","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:49:59.360569123-05:00","updated_at":"2026-01-17T10:49:59.360569123-05:00","dependencies":[{"issue_id":"hq-wisp-i8q1e","depends_on_id":"hq-wisp-wxw0u","type":"parent-child","created_at":"2026-01-17T10:49:59.899267766-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-i8q1e","depends_on_id":"hq-wisp-5ygsv","type":"blocks","created_at":"2026-01-17T10:50:00.825341974-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-i92c","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:36:59.337928329-05:00","updated_at":"2026-01-16T23:37:39.056079356-05:00","closed_at":"2026-01-16T23:37:39.056079356-05:00","close_reason":"Nothing pending","dependencies":[{"issue_id":"hq-wisp-i92c","depends_on_id":"hq-wisp-c8tl","type":"parent-child","created_at":"2026-01-16T23:36:59.428328359-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-i92c","depends_on_id":"hq-wisp-exeb","type":"blocks","created_at":"2026-01-16T23:37:00.895413919-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-i9ygb","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:30:03.173558729-05:00","updated_at":"2026-01-17T00:30:27.467543761-05:00","closed_at":"2026-01-17T00:30:27.467543761-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-i9ygb","depends_on_id":"hq-wisp-8d16m","type":"parent-child","created_at":"2026-01-17T00:30:03.902443838-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-i9ygb","depends_on_id":"hq-wisp-tgv3q","type":"blocks","created_at":"2026-01-17T00:30:08.22730998-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ia4v","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:53:28.903969678-05:00","updated_at":"2026-01-16T01:54:17.587766384-05:00","closed_at":"2026-01-16T01:54:17.587766384-05:00","close_reason":"Orphan cleanup","dependencies":[{"issue_id":"hq-wisp-ia4v","depends_on_id":"hq-wisp-eke2","type":"parent-child","created_at":"2026-01-16T01:53:28.925499072-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ia4v","depends_on_id":"hq-wisp-0e32","type":"blocks","created_at":"2026-01-16T01:53:28.970990147-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ibdxb","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon/","created_at":"2026-01-17T00:26:41.86013358-05:00","updated_at":"2026-01-17T00:35:05.760482585-05:00","closed_at":"2026-01-17T00:35:05.760482585-05:00","close_reason":"Cleanup","ephemeral":true}
{"id":"hq-wisp-ic7n","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:19:36.431636989-05:00","updated_at":"2026-01-16T23:20:28.688070993-05:00","closed_at":"2026-01-16T23:20:28.688070993-05:00","close_reason":"No activity, no gated mols","dependencies":[{"issue_id":"hq-wisp-ic7n","depends_on_id":"hq-wisp-pfs9","type":"parent-child","created_at":"2026-01-16T23:19:36.814647481-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ic7n","depends_on_id":"hq-wisp-u4mw","type":"blocks","created_at":"2026-01-16T23:19:38.151028184-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-icn4b","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:43:56.990131359-05:00","updated_at":"2026-01-16T23:44:36.246588129-05:00","closed_at":"2026-01-16T23:44:36.246588129-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-icn4b","depends_on_id":"hq-wisp-ywecn","type":"parent-child","created_at":"2026-01-16T23:43:57.102155928-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-icn4b","depends_on_id":"hq-wisp-n8jfa","type":"blocks","created_at":"2026-01-16T23:43:58.96464652-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-idgu","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:43:15.719018557-05:00","updated_at":"2026-01-16T22:12:53.949059614-05:00","closed_at":"2026-01-16T22:12:53.949059614-05:00","close_reason":"Orphaned wisp step - cleanup","dependencies":[{"issue_id":"hq-wisp-idgu","depends_on_id":"hq-wisp-l7vn","type":"parent-child","created_at":"2026-01-16T21:43:15.753699162-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-idgu","depends_on_id":"hq-wisp-5veb","type":"blocks","created_at":"2026-01-16T21:43:15.824345829-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-idkop","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:47:53.496951995-05:00","updated_at":"2026-01-16T23:48:39.933671548-05:00","closed_at":"2026-01-16T23:48:39.933671548-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-idkop","depends_on_id":"hq-wisp-wj52z","type":"parent-child","created_at":"2026-01-16T23:47:53.508173261-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-idqk8","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:02:45.70203217-05:00","updated_at":"2026-01-17T01:05:23.685964464-05:00","closed_at":"2026-01-17T01:05:23.685964464-05:00","close_reason":"Idle town patrol","dependencies":[{"issue_id":"hq-wisp-idqk8","depends_on_id":"hq-wisp-ji9jj","type":"parent-child","created_at":"2026-01-17T01:02:55.065265964-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-idqk8","depends_on_id":"hq-wisp-bcyui","type":"blocks","created_at":"2026-01-17T01:03:06.900258379-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ie1mh","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:47:53.500210725-05:00","updated_at":"2026-01-16T23:48:34.018428324-05:00","closed_at":"2026-01-16T23:48:34.018428324-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-ie1mh","depends_on_id":"hq-wisp-wj52z","type":"parent-child","created_at":"2026-01-16T23:47:54.310085162-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ie1mh","depends_on_id":"hq-wisp-0egyx","type":"blocks","created_at":"2026-01-16T23:47:56.721120582-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ieezk","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:46:10.410462378-05:00","updated_at":"2026-01-17T10:46:10.410462419-05:00","dependencies":[{"issue_id":"hq-wisp-ieezk","depends_on_id":"hq-wisp-bio5t","type":"parent-child","created_at":"2026-01-17T10:46:10.690225922-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ieezk","depends_on_id":"hq-wisp-wc3v4","type":"blocks","created_at":"2026-01-17T10:46:11.103640514-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-igu9","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:15:01.195606974-05:00","updated_at":"2026-01-16T23:18:14.733042395-05:00","closed_at":"2026-01-16T23:18:14.733042395-05:00","close_reason":"No activity, no gated mols","dependencies":[{"issue_id":"hq-wisp-igu9","depends_on_id":"hq-wisp-9osz","type":"parent-child","created_at":"2026-01-16T23:15:01.407597966-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-igu9","depends_on_id":"hq-wisp-vgod","type":"blocks","created_at":"2026-01-16T23:15:02.66231117-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ih6qc","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:00:26.068625923-05:00","updated_at":"2026-01-17T01:02:08.373406007-05:00","closed_at":"2026-01-17T01:02:08.373406007-05:00","close_reason":"Looping - patrol 16 of 20","dependencies":[{"issue_id":"hq-wisp-ih6qc","depends_on_id":"hq-wisp-5yxyi","type":"parent-child","created_at":"2026-01-17T01:00:36.031660244-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ih6qc","depends_on_id":"hq-wisp-p21sr","type":"blocks","created_at":"2026-01-17T01:00:47.163511867-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ihlml","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:52:50.324263923-05:00","updated_at":"2026-01-17T00:53:55.531612435-05:00","closed_at":"2026-01-17T00:53:55.531612435-05:00","close_reason":"Inbox clear","dependencies":[{"issue_id":"hq-wisp-ihlml","depends_on_id":"hq-wisp-xo3wl","type":"parent-child","created_at":"2026-01-17T00:52:50.340631683-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ii8og","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:49:57.528597778-05:00","updated_at":"2026-01-17T10:49:57.52859782-05:00","dependencies":[{"issue_id":"hq-wisp-ii8og","depends_on_id":"hq-wisp-8agmn","type":"parent-child","created_at":"2026-01-17T10:49:58.215746668-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ii8og","depends_on_id":"hq-wisp-5ll0l","type":"blocks","created_at":"2026-01-17T10:49:59.024840861-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ijfsf","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T02:00:44.564647898-05:00","updated_at":"2026-01-17T02:01:40.040892946-05:00","closed_at":"2026-01-17T02:01:40.040892946-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-ijfsf","depends_on_id":"hq-wisp-9a1wp","type":"parent-child","created_at":"2026-01-17T02:00:44.5830276-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ijoir","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:41:51.250697769-05:00","updated_at":"2026-01-16T23:42:36.962189015-05:00","closed_at":"2026-01-16T23:42:36.962189015-05:00","close_reason":"Town idle / pool at capacity","dependencies":[{"issue_id":"hq-wisp-ijoir","depends_on_id":"hq-wisp-tnkch","type":"parent-child","created_at":"2026-01-16T23:41:51.99187434-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ijoir","depends_on_id":"hq-wisp-o47kv","type":"blocks","created_at":"2026-01-16T23:41:53.883004763-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ijoir","depends_on_id":"hq-wisp-aca21","type":"blocks","created_at":"2026-01-16T23:41:53.989175207-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ijoir","depends_on_id":"hq-wisp-fcbm9","type":"blocks","created_at":"2026-01-16T23:41:54.094861027-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ijxrz","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:52:50.329340247-05:00","updated_at":"2026-01-17T00:55:05.659027799-05:00","closed_at":"2026-01-17T00:55:05.659027799-05:00","close_reason":"No notifications","dependencies":[{"issue_id":"hq-wisp-ijxrz","depends_on_id":"hq-wisp-xo3wl","type":"parent-child","created_at":"2026-01-17T00:52:53.576818829-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ijxrz","depends_on_id":"hq-wisp-c0fhj","type":"blocks","created_at":"2026-01-17T00:53:03.435530515-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-il37x","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:48:06.61265674-05:00","updated_at":"2026-01-17T00:35:32.081266152-05:00","closed_at":"2026-01-17T00:35:32.081266152-05:00","close_reason":"Cleanup","ephemeral":true}
{"id":"hq-wisp-imeir","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:52:58.285186463-05:00","updated_at":"2026-01-16T23:53:14.953737931-05:00","closed_at":"2026-01-16T23:53:14.953737931-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-imeir","depends_on_id":"hq-wisp-a5ye3","type":"parent-child","created_at":"2026-01-16T23:53:01.233431694-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-imeir","depends_on_id":"hq-wisp-cvo8s","type":"blocks","created_at":"2026-01-16T23:53:04.595422733-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-in1p","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","assignee":"deacon","created_at":"2026-01-16T22:15:30.778354493-05:00","updated_at":"2026-01-17T00:36:33.168953727-05:00","closed_at":"2026-01-17T00:36:33.168953727-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-ip01t","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:28:16.221829232-05:00","updated_at":"2026-01-17T00:28:34.286941186-05:00","closed_at":"2026-01-17T00:28:34.286941186-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-ip01t","depends_on_id":"hq-wisp-tbive","type":"parent-child","created_at":"2026-01-17T00:28:16.449603653-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ip01t","depends_on_id":"hq-wisp-ytsw1","type":"blocks","created_at":"2026-01-17T00:28:20.42973878-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ipcwc","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:49:35.717969638-05:00","updated_at":"2026-01-16T23:50:22.42936141-05:00","closed_at":"2026-01-16T23:50:22.42936141-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-ipcwc","depends_on_id":"hq-wisp-n4f70","type":"parent-child","created_at":"2026-01-16T23:49:35.867135673-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ipcwc","depends_on_id":"hq-wisp-xmlr6","type":"blocks","created_at":"2026-01-16T23:49:38.303751952-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ir19j","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:04:43.440075774-05:00","updated_at":"2026-01-17T01:06:12.870896779-05:00","closed_at":"2026-01-17T01:06:12.870896779-05:00","close_reason":"All healthy","dependencies":[{"issue_id":"hq-wisp-ir19j","depends_on_id":"hq-wisp-bkl5l","type":"parent-child","created_at":"2026-01-17T01:04:47.526712726-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ir19j","depends_on_id":"hq-wisp-hqek3","type":"blocks","created_at":"2026-01-17T01:04:58.362013473-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ir19j","depends_on_id":"hq-wisp-qjzfm","type":"blocks","created_at":"2026-01-17T01:04:58.962596035-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ir19j","depends_on_id":"hq-wisp-vllyd","type":"blocks","created_at":"2026-01-17T01:04:59.558879729-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-islc","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:42:27.172868422-05:00","updated_at":"2026-01-16T01:52:13.649996329-05:00","closed_at":"2026-01-16T01:52:13.649996329-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-islc","depends_on_id":"hq-wisp-wqti","type":"parent-child","created_at":"2026-01-16T01:42:27.213713003-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-islc","depends_on_id":"hq-wisp-bo26","type":"blocks","created_at":"2026-01-16T01:42:27.428842893-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-it9ic","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:29:36.062336871-05:00","updated_at":"2026-01-17T00:29:54.062051921-05:00","closed_at":"2026-01-17T00:29:54.062051921-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-it9ic","depends_on_id":"hq-wisp-w5z6p","type":"parent-child","created_at":"2026-01-17T00:29:37.752936849-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-it9ic","depends_on_id":"hq-wisp-464ad","type":"blocks","created_at":"2026-01-17T00:29:42.073541372-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-it9ic","depends_on_id":"hq-wisp-gdmu0","type":"blocks","created_at":"2026-01-17T00:29:42.31654795-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-it9ic","depends_on_id":"hq-wisp-mbcdr","type":"blocks","created_at":"2026-01-17T00:29:42.562452149-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-iucl","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:54:43.650653886-05:00","updated_at":"2026-01-16T01:56:30.790343398-05:00","closed_at":"2026-01-16T01:56:30.790343398-05:00","close_reason":"Orphan cleanup","dependencies":[{"issue_id":"hq-wisp-iucl","depends_on_id":"hq-wisp-8okt","type":"parent-child","created_at":"2026-01-16T01:54:43.672633195-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-iucl","depends_on_id":"hq-wisp-q5l5","type":"blocks","created_at":"2026-01-16T01:54:43.718367354-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-iuqkz","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T02:00:44.571458479-05:00","updated_at":"2026-01-17T02:01:52.652673564-05:00","closed_at":"2026-01-17T02:01:52.652673564-05:00","close_reason":"Idle patrol","dependencies":[{"issue_id":"hq-wisp-iuqkz","depends_on_id":"hq-wisp-9a1wp","type":"parent-child","created_at":"2026-01-17T02:00:50.367780379-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-iuqkz","depends_on_id":"hq-wisp-yw2sm","type":"blocks","created_at":"2026-01-17T02:01:03.437847193-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ivaul","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:26:33.623444813-05:00","updated_at":"2026-01-17T00:26:52.166220407-05:00","closed_at":"2026-01-17T00:26:52.166220407-05:00","close_reason":"Inbox empty","dependencies":[{"issue_id":"hq-wisp-ivaul","depends_on_id":"hq-wisp-3h08u","type":"parent-child","created_at":"2026-01-17T00:26:33.635547792-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-iw1c","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:36:59.341655203-05:00","updated_at":"2026-01-16T23:39:03.854431468-05:00","closed_at":"2026-01-16T23:39:03.854431468-05:00","close_reason":"Zombie scan not available - detection skipped","dependencies":[{"issue_id":"hq-wisp-iw1c","depends_on_id":"hq-wisp-c8tl","type":"parent-child","created_at":"2026-01-16T23:36:59.991861702-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-iw1c","depends_on_id":"hq-wisp-ykx2","type":"blocks","created_at":"2026-01-16T23:37:01.633649365-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-iweh7","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:07:28.969318553-05:00","updated_at":"2026-01-17T01:09:21.581606211-05:00","closed_at":"2026-01-17T01:09:21.581606211-05:00","close_reason":"No plugins","dependencies":[{"issue_id":"hq-wisp-iweh7","depends_on_id":"hq-wisp-fnimo","type":"parent-child","created_at":"2026-01-17T01:07:34.267421259-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-iweh7","depends_on_id":"hq-wisp-6yq9a","type":"blocks","created_at":"2026-01-17T01:07:45.924706009-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ix72d","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:47:53.506981977-05:00","updated_at":"2026-01-16T23:48:22.837913592-05:00","closed_at":"2026-01-16T23:48:22.837913592-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-ix72d","depends_on_id":"hq-wisp-wj52z","type":"parent-child","created_at":"2026-01-16T23:47:55.777568114-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ix72d","depends_on_id":"hq-wisp-qqlky","type":"blocks","created_at":"2026-01-16T23:47:58.509369112-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ixkqa","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:47:24.581498978-05:00","updated_at":"2026-01-17T10:47:24.58149902-05:00","dependencies":[{"issue_id":"hq-wisp-ixkqa","depends_on_id":"hq-wisp-jag69","type":"parent-child","created_at":"2026-01-17T10:47:24.837610412-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ixkqa","depends_on_id":"hq-wisp-5vdg1","type":"blocks","created_at":"2026-01-17T10:47:25.471942874-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ixr3","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:15:01.201759348-05:00","updated_at":"2026-01-16T23:19:26.255905678-05:00","closed_at":"2026-01-16T23:19:26.255905678-05:00","close_reason":"Context low, looping","dependencies":[{"issue_id":"hq-wisp-ixr3","depends_on_id":"hq-wisp-9osz","type":"parent-child","created_at":"2026-01-16T23:15:02.449744887-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ixr3","depends_on_id":"hq-wisp-mkoo","type":"blocks","created_at":"2026-01-16T23:15:03.898036379-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-iy2hm","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:05:32.486562291-05:00","updated_at":"2026-01-17T01:06:27.602871527-05:00","closed_at":"2026-01-17T01:06:27.602871527-05:00","close_reason":"Idle town","dependencies":[{"issue_id":"hq-wisp-iy2hm","depends_on_id":"hq-wisp-p8n2g","type":"parent-child","created_at":"2026-01-17T01:05:34.26114025-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-iy2hm","depends_on_id":"hq-wisp-1onlb","type":"blocks","created_at":"2026-01-17T01:05:45.320299107-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-iya1j","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:27:30.732782086-05:00","updated_at":"2026-01-17T00:27:53.595534113-05:00","closed_at":"2026-01-17T00:27:53.595534113-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-iya1j","depends_on_id":"hq-wisp-72ja3","type":"parent-child","created_at":"2026-01-17T00:27:31.152946063-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-iya1j","depends_on_id":"hq-wisp-sjzmw","type":"blocks","created_at":"2026-01-17T00:27:34.927627237-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-iyayf","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:45:48.843801408-05:00","updated_at":"2026-01-16T23:47:02.265928549-05:00","closed_at":"2026-01-16T23:47:02.265928549-05:00","close_reason":"No session costs","dependencies":[{"issue_id":"hq-wisp-iyayf","depends_on_id":"hq-wisp-2heyl","type":"parent-child","created_at":"2026-01-16T23:45:50.615793968-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-iyayf","depends_on_id":"hq-wisp-dx36k","type":"blocks","created_at":"2026-01-16T23:45:53.177933958-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-iybfy","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:58:39.901537871-05:00","updated_at":"2026-01-17T01:00:11.544916875-05:00","closed_at":"2026-01-17T01:00:11.544916875-05:00","close_reason":"Logs rotated","dependencies":[{"issue_id":"hq-wisp-iybfy","depends_on_id":"hq-wisp-0nlhz","type":"parent-child","created_at":"2026-01-17T00:58:48.106394358-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-iybfy","depends_on_id":"hq-wisp-42vd2","type":"blocks","created_at":"2026-01-17T00:58:59.192037212-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-iyd7","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:46:01.530133491-05:00","updated_at":"2026-01-16T01:48:00.511648001-05:00","closed_at":"2026-01-16T01:48:00.511648001-05:00","close_reason":"No open convoys to check","dependencies":[{"issue_id":"hq-wisp-iyd7","depends_on_id":"hq-wisp-xunp","type":"parent-child","created_at":"2026-01-16T01:46:01.57226957-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-iyd7","depends_on_id":"hq-wisp-1ggz","type":"blocks","created_at":"2026-01-16T01:46:01.748828421-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-iyelx","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:09:41.61148222-05:00","updated_at":"2026-01-17T01:10:47.274909748-05:00","closed_at":"2026-01-17T01:10:47.274909748-05:00","close_reason":"No zombies","dependencies":[{"issue_id":"hq-wisp-iyelx","depends_on_id":"hq-wisp-fsms9","type":"parent-child","created_at":"2026-01-17T01:09:46.49847648-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-iyelx","depends_on_id":"hq-wisp-1jhdg","type":"blocks","created_at":"2026-01-17T01:09:58.635611962-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-izxww","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:08:16.843776478-05:00","updated_at":"2026-01-17T01:09:38.045314933-05:00","closed_at":"2026-01-17T01:09:38.045314933-05:00","close_reason":"Final patrol","dependencies":[{"issue_id":"hq-wisp-izxww","depends_on_id":"hq-wisp-vrsc5","type":"parent-child","created_at":"2026-01-17T01:08:17.47065608-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-izxww","depends_on_id":"hq-wisp-r347z","type":"blocks","created_at":"2026-01-17T01:08:28.378483129-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-j11dp","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:52:50.32694696-05:00","updated_at":"2026-01-17T00:55:15.042994385-05:00","closed_at":"2026-01-17T00:55:15.042994385-05:00","close_reason":"No gate-ready molecules","dependencies":[{"issue_id":"hq-wisp-j11dp","depends_on_id":"hq-wisp-xo3wl","type":"parent-child","created_at":"2026-01-17T00:52:51.949087754-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-j11dp","depends_on_id":"hq-wisp-f91c9","type":"blocks","created_at":"2026-01-17T00:53:01.790364057-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-j2rt","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T22:09:19.186347059-05:00","updated_at":"2026-01-16T22:12:13.804335415-05:00","closed_at":"2026-01-16T22:12:13.804335415-05:00","close_reason":"Orphaned - bulk cleanup","ephemeral":true}
{"id":"hq-wisp-j2tz","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:23:47.728168534-05:00","updated_at":"2026-01-16T23:24:38.850422721-05:00","closed_at":"2026-01-16T23:24:38.850422721-05:00","close_reason":"No gated mols, no events","dependencies":[{"issue_id":"hq-wisp-j2tz","depends_on_id":"hq-wisp-9we3","type":"parent-child","created_at":"2026-01-16T23:23:48.030291578-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-j2tz","depends_on_id":"hq-wisp-f2j9","type":"blocks","created_at":"2026-01-16T23:23:49.776661599-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-j476y","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:02:45.693342392-05:00","updated_at":"2026-01-17T01:05:29.737909155-05:00","closed_at":"2026-01-17T01:05:29.737909155-05:00","close_reason":"Idle town patrol","dependencies":[{"issue_id":"hq-wisp-j476y","depends_on_id":"hq-wisp-ji9jj","type":"parent-child","created_at":"2026-01-17T01:02:49.200015697-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-j476y","depends_on_id":"hq-wisp-s4vqw","type":"blocks","created_at":"2026-01-17T01:02:59.799729196-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-j48c1","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:49:41.445084666-05:00","updated_at":"2026-01-16T23:50:29.169303588-05:00","closed_at":"2026-01-16T23:50:29.169303588-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-j48c1","depends_on_id":"hq-wisp-q54v3","type":"parent-child","created_at":"2026-01-16T23:49:42.434151787-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-j48c1","depends_on_id":"hq-wisp-o909m","type":"blocks","created_at":"2026-01-16T23:49:45.000343312-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-j48c1","depends_on_id":"hq-wisp-sge1h","type":"blocks","created_at":"2026-01-16T23:49:45.142928529-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-j48c1","depends_on_id":"hq-wisp-jd54c","type":"blocks","created_at":"2026-01-16T23:49:45.286254827-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-j4ayh","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:03:11.646413572-05:00","updated_at":"2026-01-17T01:04:34.615464388-05:00","closed_at":"2026-01-17T01:04:34.615464388-05:00","close_reason":"Inbox clear","dependencies":[{"issue_id":"hq-wisp-j4ayh","depends_on_id":"hq-wisp-zx2sm","type":"parent-child","created_at":"2026-01-17T01:03:21.2771221-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-j4ayh","depends_on_id":"hq-wisp-50z8q","type":"blocks","created_at":"2026-01-17T01:03:33.399926022-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-j4js","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:56:35.920173228-05:00","updated_at":"2026-01-16T22:13:02.217875445-05:00","closed_at":"2026-01-16T22:13:02.217875445-05:00","close_reason":"Orphaned - forced cleanup","dependencies":[{"issue_id":"hq-wisp-j4js","depends_on_id":"hq-wisp-8d7d","type":"parent-child","created_at":"2026-01-16T01:56:35.936180586-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-j4js","depends_on_id":"hq-wisp-xaym","type":"blocks","created_at":"2026-01-16T01:56:35.975684959-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-j4myk","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:09:41.612340219-05:00","updated_at":"2026-01-17T01:10:53.438608881-05:00","closed_at":"2026-01-17T01:10:53.438608881-05:00","close_reason":"No plugins","dependencies":[{"issue_id":"hq-wisp-j4myk","depends_on_id":"hq-wisp-fsms9","type":"parent-child","created_at":"2026-01-17T01:09:47.095833502-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-j4myk","depends_on_id":"hq-wisp-iyelx","type":"blocks","created_at":"2026-01-17T01:09:59.247845377-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-j8mp5","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:44:43.645777983-05:00","updated_at":"2026-01-16T23:45:22.452352284-05:00","closed_at":"2026-01-16T23:45:22.452352284-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-j8mp5","depends_on_id":"hq-wisp-bhwu0","type":"parent-child","created_at":"2026-01-16T23:44:45.283903612-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-j8mp5","depends_on_id":"hq-wisp-zthb6","type":"blocks","created_at":"2026-01-16T23:44:47.490965114-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-j8wha","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:26:33.627692847-05:00","updated_at":"2026-01-17T00:27:02.5215122-05:00","closed_at":"2026-01-17T00:27:02.5215122-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-j8wha","depends_on_id":"hq-wisp-3h08u","type":"parent-child","created_at":"2026-01-17T00:26:34.859361392-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-j8wha","depends_on_id":"hq-wisp-6p5w2","type":"blocks","created_at":"2026-01-17T00:26:38.50987906-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-j9dts","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:47:34.367053265-05:00","updated_at":"2026-01-16T23:49:15.053243368-05:00","closed_at":"2026-01-16T23:49:15.053243368-05:00","close_reason":"Town idle patrol","dependencies":[{"issue_id":"hq-wisp-j9dts","depends_on_id":"hq-wisp-ql31w","type":"parent-child","created_at":"2026-01-16T23:47:34.615217819-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-j9dts","depends_on_id":"hq-wisp-mr96h","type":"blocks","created_at":"2026-01-16T23:47:36.753997705-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-jag69","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"hooked","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T10:47:24.575401023-05:00","updated_at":"2026-01-17T10:47:26.167082175-05:00","ephemeral":true}
{"id":"hq-wisp-jakn","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:42:27.174981086-05:00","updated_at":"2026-01-16T01:52:13.579581864-05:00","closed_at":"2026-01-16T01:52:13.579581864-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-jakn","depends_on_id":"hq-wisp-wqti","type":"parent-child","created_at":"2026-01-16T01:42:27.308584399-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-jakn","depends_on_id":"hq-wisp-1yv1","type":"blocks","created_at":"2026-01-16T01:42:27.555204714-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-jber","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:46:01.532644905-05:00","updated_at":"2026-01-16T01:52:13.329126179-05:00","closed_at":"2026-01-16T01:52:13.329126179-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-jber","depends_on_id":"hq-wisp-xunp","type":"parent-child","created_at":"2026-01-16T01:46:01.647460114-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-jber","depends_on_id":"hq-wisp-e6od","type":"blocks","created_at":"2026-01-16T01:46:01.849318729-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-jce6","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:56:35.923118308-05:00","updated_at":"2026-01-16T22:13:02.170450505-05:00","closed_at":"2026-01-16T22:13:02.170450505-05:00","close_reason":"Orphaned - forced cleanup","dependencies":[{"issue_id":"hq-wisp-jce6","depends_on_id":"hq-wisp-8d7d","type":"parent-child","created_at":"2026-01-16T01:56:35.957851479-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-jce6","depends_on_id":"hq-wisp-07lk","type":"blocks","created_at":"2026-01-16T01:56:36.013119169-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-jd54c","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:49:41.444593626-05:00","updated_at":"2026-01-16T23:50:30.053273198-05:00","closed_at":"2026-01-16T23:50:30.053273198-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-jd54c","depends_on_id":"hq-wisp-q54v3","type":"parent-child","created_at":"2026-01-16T23:49:42.293519191-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-jd54c","depends_on_id":"hq-wisp-ma08b","type":"blocks","created_at":"2026-01-16T23:49:44.857401263-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-jdost","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:02:22.547552623-05:00","updated_at":"2026-01-17T01:03:49.29970561-05:00","closed_at":"2026-01-17T01:03:49.29970561-05:00","close_reason":"Inbox empty","dependencies":[{"issue_id":"hq-wisp-jdost","depends_on_id":"hq-wisp-xwv1q","type":"parent-child","created_at":"2026-01-17T01:02:22.56372264-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-je3am","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:54:23.392502488-05:00","updated_at":"2026-01-17T00:35:28.993229987-05:00","closed_at":"2026-01-17T00:35:28.993229987-05:00","close_reason":"Cleanup","ephemeral":true}
{"id":"hq-wisp-jeg4m","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:05:32.495456193-05:00","updated_at":"2026-01-17T01:06:31.194135129-05:00","closed_at":"2026-01-17T01:06:31.194135129-05:00","close_reason":"Idle town","dependencies":[{"issue_id":"hq-wisp-jeg4m","depends_on_id":"hq-wisp-p8n2g","type":"parent-child","created_at":"2026-01-17T01:05:39.018523018-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-jeg4m","depends_on_id":"hq-wisp-tvo7l","type":"blocks","created_at":"2026-01-17T01:05:51.283725562-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-jepa","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T22:55:40.435135589-05:00","updated_at":"2026-01-17T00:36:15.864887732-05:00","closed_at":"2026-01-17T00:36:15.864887732-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-jgnad","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T00:43:00.949552377-05:00","updated_at":"2026-01-17T00:52:45.433905213-05:00","closed_at":"2026-01-17T00:52:45.433905213-05:00","close_reason":"Patrol 12 complete","ephemeral":true}
{"id":"hq-wisp-jgonz","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T00:06:24.416507983-05:00","updated_at":"2026-01-17T00:35:07.605177495-05:00","closed_at":"2026-01-17T00:35:07.605177495-05:00","close_reason":"Cleanup","ephemeral":true}
{"id":"hq-wisp-ji9jj","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T01:02:45.686488319-05:00","updated_at":"2026-01-17T01:05:56.470735905-05:00","closed_at":"2026-01-17T01:05:56.470735905-05:00","close_reason":"Patrol 17 complete","ephemeral":true}
{"id":"hq-wisp-jixob","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:49:41.441474633-05:00","updated_at":"2026-01-16T23:50:41.76359497-05:00","closed_at":"2026-01-16T23:50:41.76359497-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-jixob","depends_on_id":"hq-wisp-q54v3","type":"parent-child","created_at":"2026-01-16T23:49:41.453004648-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-jje3","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T22:56:37.330595389-05:00","updated_at":"2026-01-17T00:36:15.26017512-05:00","closed_at":"2026-01-17T00:36:15.26017512-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-jjtor","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:46:10.409168045-05:00","updated_at":"2026-01-17T10:46:10.409168087-05:00","dependencies":[{"issue_id":"hq-wisp-jjtor","depends_on_id":"hq-wisp-bio5t","type":"parent-child","created_at":"2026-01-17T10:46:10.650434946-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-jjtor","depends_on_id":"hq-wisp-p67t7","type":"blocks","created_at":"2026-01-17T10:46:11.058276249-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-jlopn","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:27:30.73341971-05:00","updated_at":"2026-01-17T00:27:54.982932151-05:00","closed_at":"2026-01-17T00:27:54.982932151-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-jlopn","depends_on_id":"hq-wisp-72ja3","type":"parent-child","created_at":"2026-01-17T00:27:31.383079231-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-jlopn","depends_on_id":"hq-wisp-iya1j","type":"blocks","created_at":"2026-01-17T00:27:35.136235936-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-jlrd","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:22:20.084978037-05:00","updated_at":"2026-01-16T01:52:14.107807456-05:00","closed_at":"2026-01-16T01:52:14.107807456-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-jlrd","depends_on_id":"hq-wisp-gvqg","type":"parent-child","created_at":"2026-01-16T01:22:20.095271735-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-jm12j","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:50:53.900661929-05:00","updated_at":"2026-01-16T23:51:25.795120353-05:00","closed_at":"2026-01-16T23:51:25.795120353-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-jm12j","depends_on_id":"hq-wisp-47par","type":"parent-child","created_at":"2026-01-16T23:50:56.174503415-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-jm12j","depends_on_id":"hq-wisp-wxuo8","type":"blocks","created_at":"2026-01-16T23:50:59.058876803-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-jm2rr","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:48:51.076784772-05:00","updated_at":"2026-01-16T23:49:24.013244111-05:00","closed_at":"2026-01-16T23:49:24.013244111-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-jm2rr","depends_on_id":"hq-wisp-de87j","type":"parent-child","created_at":"2026-01-16T23:48:52.060226489-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-jm2rr","depends_on_id":"hq-wisp-h7ji0","type":"blocks","created_at":"2026-01-16T23:48:54.608780805-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-jm2rr","depends_on_id":"hq-wisp-rakbu","type":"blocks","created_at":"2026-01-16T23:48:54.753018642-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-jm2rr","depends_on_id":"hq-wisp-m7kbh","type":"blocks","created_at":"2026-01-16T23:48:54.895863983-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-jmnm","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:54:43.652291092-05:00","updated_at":"2026-01-16T01:56:30.774013708-05:00","closed_at":"2026-01-16T01:56:30.774013708-05:00","close_reason":"Orphan cleanup","dependencies":[{"issue_id":"hq-wisp-jmnm","depends_on_id":"hq-wisp-8okt","type":"parent-child","created_at":"2026-01-16T01:54:43.684118224-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-jqvn","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T22:41:52.617667094-05:00","updated_at":"2026-01-17T00:36:18.190912652-05:00","closed_at":"2026-01-17T00:36:18.190912652-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-jrhxn","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:47:34.366453518-05:00","updated_at":"2026-01-16T23:49:15.199272619-05:00","closed_at":"2026-01-16T23:49:15.199272619-05:00","close_reason":"Town idle patrol","dependencies":[{"issue_id":"hq-wisp-jrhxn","depends_on_id":"hq-wisp-ql31w","type":"parent-child","created_at":"2026-01-16T23:47:34.495705868-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-jrhxn","depends_on_id":"hq-wisp-mr96h","type":"blocks","created_at":"2026-01-16T23:47:36.636951781-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-jrty","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:46:26.937723523-05:00","updated_at":"2026-01-16T01:47:56.829058347-05:00","closed_at":"2026-01-16T01:47:56.829058347-05:00","close_reason":"No work found","dependencies":[{"issue_id":"hq-wisp-jrty","depends_on_id":"hq-wisp-ybkc","type":"parent-child","created_at":"2026-01-16T01:46:26.963522162-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-jrty","depends_on_id":"hq-wisp-3c9p","type":"blocks","created_at":"2026-01-16T01:46:27.156233537-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-jstx7","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:02:45.694947764-05:00","updated_at":"2026-01-17T01:05:28.571722697-05:00","closed_at":"2026-01-17T01:05:28.571722697-05:00","close_reason":"Idle town patrol","dependencies":[{"issue_id":"hq-wisp-jstx7","depends_on_id":"hq-wisp-ji9jj","type":"parent-child","created_at":"2026-01-17T01:02:50.38847831-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-jstx7","depends_on_id":"hq-wisp-lf8y9","type":"blocks","created_at":"2026-01-17T01:03:02.170388265-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-jth9w","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:30:39.086539825-05:00","updated_at":"2026-01-17T00:30:56.893979227-05:00","closed_at":"2026-01-17T00:30:56.893979227-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-jth9w","depends_on_id":"hq-wisp-tjzfo","type":"parent-child","created_at":"2026-01-17T00:30:41.111305296-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-jth9w","depends_on_id":"hq-wisp-s10v0","type":"blocks","created_at":"2026-01-17T00:30:46.180764067-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-juwzh","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:28:49.928506766-05:00","updated_at":"2026-01-17T00:29:05.046637407-05:00","closed_at":"2026-01-17T00:29:05.046637407-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-juwzh","depends_on_id":"hq-wisp-9l1zx","type":"parent-child","created_at":"2026-01-17T00:28:51.502732784-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-juwzh","depends_on_id":"hq-wisp-r0bsf","type":"blocks","created_at":"2026-01-17T00:28:55.516864238-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-juwzh","depends_on_id":"hq-wisp-es2lk","type":"blocks","created_at":"2026-01-17T00:28:55.741161247-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-juwzh","depends_on_id":"hq-wisp-o5ago","type":"blocks","created_at":"2026-01-17T00:28:55.96633388-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-jwutk","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:54:08.830427899-05:00","updated_at":"2026-01-16T23:54:59.815518607-05:00","closed_at":"2026-01-16T23:54:59.815518607-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-jwutk","depends_on_id":"hq-wisp-oecdp","type":"parent-child","created_at":"2026-01-16T23:54:09.800048278-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-jwutk","depends_on_id":"hq-wisp-vn3t7","type":"blocks","created_at":"2026-01-16T23:54:12.705048794-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-jyac5","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:46:10.407648629-05:00","updated_at":"2026-01-17T10:46:10.407648671-05:00","dependencies":[{"issue_id":"hq-wisp-jyac5","depends_on_id":"hq-wisp-bio5t","type":"parent-child","created_at":"2026-01-17T10:46:10.610843594-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-jyac5","depends_on_id":"hq-wisp-vhfc0","type":"blocks","created_at":"2026-01-17T10:46:11.013566067-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-jzed","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:21:28.237945825-05:00","updated_at":"2026-01-16T23:23:39.40247079-05:00","closed_at":"2026-01-16T23:23:39.40247079-05:00","close_reason":"Stale wisp from previous session","ephemeral":true}
{"id":"hq-wisp-k00mv","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:50:35.402384254-05:00","updated_at":"2026-01-16T23:51:22.15723755-05:00","closed_at":"2026-01-16T23:51:22.15723755-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-k00mv","depends_on_id":"hq-wisp-t8b5z","type":"parent-child","created_at":"2026-01-16T23:50:37.354973515-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-k00mv","depends_on_id":"hq-wisp-p6rd5","type":"blocks","created_at":"2026-01-16T23:50:40.099647678-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-k018","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:36:59.345962286-05:00","updated_at":"2026-01-16T23:39:57.057791972-05:00","closed_at":"2026-01-16T23:39:57.057791972-05:00","close_reason":"Context usage check not available - using session age heuristic, context moderate","dependencies":[{"issue_id":"hq-wisp-k018","depends_on_id":"hq-wisp-c8tl","type":"parent-child","created_at":"2026-01-16T23:37:00.731684482-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-k018","depends_on_id":"hq-wisp-3jwx","type":"blocks","created_at":"2026-01-16T23:37:02.398214808-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-k0i3t","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:53:05.625180649-05:00","updated_at":"2026-01-16T23:53:50.077655618-05:00","closed_at":"2026-01-16T23:53:50.077655618-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-k0i3t","depends_on_id":"hq-wisp-xtx6n","type":"parent-child","created_at":"2026-01-16T23:53:07.900911648-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-k0i3t","depends_on_id":"hq-wisp-ymazc","type":"blocks","created_at":"2026-01-16T23:53:11.379990305-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-k0mt3","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:02:22.56176781-05:00","updated_at":"2026-01-17T01:04:40.215919892-05:00","closed_at":"2026-01-17T01:04:40.215919892-05:00","close_reason":"Context moderate","dependencies":[{"issue_id":"hq-wisp-k0mt3","depends_on_id":"hq-wisp-xwv1q","type":"parent-child","created_at":"2026-01-17T01:02:32.446048378-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-k0mt3","depends_on_id":"hq-wisp-xmd1a","type":"blocks","created_at":"2026-01-17T01:02:43.997557817-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-k12br","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:53:25.153433792-05:00","updated_at":"2026-01-16T23:53:49.859562786-05:00","closed_at":"2026-01-16T23:53:49.859562786-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-k12br","depends_on_id":"hq-wisp-of0wi","type":"parent-child","created_at":"2026-01-16T23:53:25.833247478-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-k12br","depends_on_id":"hq-wisp-7a464","type":"blocks","created_at":"2026-01-16T23:53:28.864868812-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-k2tqt","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:12:55.877263958-05:00","updated_at":"2026-01-17T01:13:52.765641977-05:00","closed_at":"2026-01-17T01:13:52.765641977-05:00","close_reason":"Inbox empty, no callbacks","dependencies":[{"issue_id":"hq-wisp-k2tqt","depends_on_id":"hq-wisp-i2n82","type":"parent-child","created_at":"2026-01-17T01:12:55.89439789-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-k59d","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:36:59.340343703-05:00","updated_at":"2026-01-16T23:38:04.440380271-05:00","closed_at":"2026-01-16T23:38:04.440380271-05:00","close_reason":"Nothing to dispatch/resolve","dependencies":[{"issue_id":"hq-wisp-k59d","depends_on_id":"hq-wisp-c8tl","type":"parent-child","created_at":"2026-01-16T23:36:59.750051234-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-k59d","depends_on_id":"hq-wisp-vdwj","type":"blocks","created_at":"2026-01-16T23:37:01.22293696-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-k5vy5","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:47:55.323091032-05:00","updated_at":"2026-01-17T10:47:55.323091074-05:00","dependencies":[{"issue_id":"hq-wisp-k5vy5","depends_on_id":"hq-wisp-9hr1x","type":"parent-child","created_at":"2026-01-17T10:47:55.885710286-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-k5vy5","depends_on_id":"hq-wisp-tr35k","type":"blocks","created_at":"2026-01-17T10:47:56.695700062-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-k7sck","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:49:48.467927366-05:00","updated_at":"2026-01-17T00:35:31.030895518-05:00","closed_at":"2026-01-17T00:35:31.030895518-05:00","close_reason":"Cleanup","ephemeral":true}
{"id":"hq-wisp-k7wwo","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:12:55.880282037-05:00","updated_at":"2026-01-17T01:59:30.04427868-05:00","closed_at":"2026-01-17T01:59:30.04427868-05:00","close_reason":"No molecules with resolved gates","dependencies":[{"issue_id":"hq-wisp-k7wwo","depends_on_id":"hq-wisp-i2n82","type":"parent-child","created_at":"2026-01-17T01:12:57.72205557-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-k7wwo","depends_on_id":"hq-wisp-xzn07","type":"blocks","created_at":"2026-01-17T01:13:08.741435152-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-k8b8i","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:50:53.895315517-05:00","updated_at":"2026-01-16T23:51:33.113865717-05:00","closed_at":"2026-01-16T23:51:33.113865717-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-k8b8i","depends_on_id":"hq-wisp-47par","type":"parent-child","created_at":"2026-01-16T23:50:54.760599387-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-k8b8i","depends_on_id":"hq-wisp-exyeu","type":"blocks","created_at":"2026-01-16T23:50:57.30927991-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-k8fo","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:43:15.720673512-05:00","updated_at":"2026-01-16T22:13:02.141082834-05:00","closed_at":"2026-01-16T22:13:02.141082834-05:00","close_reason":"Orphaned - forced cleanup","dependencies":[{"issue_id":"hq-wisp-k8fo","depends_on_id":"hq-wisp-l7vn","type":"parent-child","created_at":"2026-01-16T21:43:15.773458669-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-k8fo","depends_on_id":"hq-wisp-kwci","type":"blocks","created_at":"2026-01-16T21:43:15.849624117-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-kayyt","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:12:55.893330766-05:00","updated_at":"2026-01-17T02:00:15.986817413-05:00","closed_at":"2026-01-17T02:00:15.986817413-05:00","close_reason":"Patrol complete, looping","dependencies":[{"issue_id":"hq-wisp-kayyt","depends_on_id":"hq-wisp-i2n82","type":"parent-child","created_at":"2026-01-17T01:13:06.891622339-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-kayyt","depends_on_id":"hq-wisp-8u71r","type":"blocks","created_at":"2026-01-17T01:13:19.246739954-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-kbwbc","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:08:16.858504955-05:00","updated_at":"2026-01-17T01:10:58.416566164-05:00","closed_at":"2026-01-17T01:10:58.416566164-05:00","close_reason":"Final patrol","dependencies":[{"issue_id":"hq-wisp-kbwbc","depends_on_id":"hq-wisp-vrsc5","type":"parent-child","created_at":"2026-01-17T01:08:26.557399855-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-kbwbc","depends_on_id":"hq-wisp-r5iwu","type":"blocks","created_at":"2026-01-17T01:08:38.7500951-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-keb5i","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:25:52.715241575-05:00","updated_at":"2026-01-16T23:26:42.515698535-05:00","closed_at":"2026-01-16T23:26:42.515698535-05:00","close_reason":"No activity","dependencies":[{"issue_id":"hq-wisp-keb5i","depends_on_id":"hq-wisp-w4tn2","type":"parent-child","created_at":"2026-01-16T23:25:53.002771163-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-keb5i","depends_on_id":"hq-wisp-225wv","type":"blocks","created_at":"2026-01-16T23:25:54.695980442-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-keqqj","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:25:52.720128866-05:00","updated_at":"2026-01-16T23:27:27.171836149-05:00","closed_at":"2026-01-16T23:27:27.171836149-05:00","close_reason":"No orphans","dependencies":[{"issue_id":"hq-wisp-keqqj","depends_on_id":"hq-wisp-w4tn2","type":"parent-child","created_at":"2026-01-16T23:25:53.851193469-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-keqqj","depends_on_id":"hq-wisp-ml1cj","type":"blocks","created_at":"2026-01-16T23:25:55.746888138-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-kfiv5","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:00:26.060715811-05:00","updated_at":"2026-01-17T01:01:25.581720994-05:00","closed_at":"2026-01-17T01:01:25.581720994-05:00","close_reason":"No zombies","dependencies":[{"issue_id":"hq-wisp-kfiv5","depends_on_id":"hq-wisp-5yxyi","type":"parent-child","created_at":"2026-01-17T01:00:30.486056587-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-kfiv5","depends_on_id":"hq-wisp-fnvo7","type":"blocks","created_at":"2026-01-17T01:00:41.575217945-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-kfnnv","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T00:14:24.498103416-05:00","updated_at":"2026-01-17T00:35:06.686612535-05:00","closed_at":"2026-01-17T00:35:06.686612535-05:00","close_reason":"Cleanup","ephemeral":true}
{"id":"hq-wisp-kgfoe","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:48:51.078308352-05:00","updated_at":"2026-01-16T23:49:20.409081035-05:00","closed_at":"2026-01-16T23:49:20.409081035-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-kgfoe","depends_on_id":"hq-wisp-de87j","type":"parent-child","created_at":"2026-01-16T23:48:52.482761942-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-kgfoe","depends_on_id":"hq-wisp-jm2rr","type":"blocks","created_at":"2026-01-16T23:48:55.329561953-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-kgns","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:53:28.904624844-05:00","updated_at":"2026-01-16T01:54:17.580764809-05:00","closed_at":"2026-01-16T01:54:17.580764809-05:00","close_reason":"Orphan cleanup","dependencies":[{"issue_id":"hq-wisp-kgns","depends_on_id":"hq-wisp-eke2","type":"parent-child","created_at":"2026-01-16T01:53:28.9298314-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-kgns","depends_on_id":"hq-wisp-0e32","type":"blocks","created_at":"2026-01-16T01:53:28.976313475-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-khfm8","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:00:26.055312319-05:00","updated_at":"2026-01-17T01:01:07.434102632-05:00","closed_at":"2026-01-17T01:01:07.434102632-05:00","close_reason":"No pending spawns","dependencies":[{"issue_id":"hq-wisp-khfm8","depends_on_id":"hq-wisp-5yxyi","type":"parent-child","created_at":"2026-01-17T01:00:26.618768712-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-khfm8","depends_on_id":"hq-wisp-ckrms","type":"blocks","created_at":"2026-01-17T01:00:36.577751706-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-kitc4","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:31:03.243290132-05:00","updated_at":"2026-01-17T00:31:18.231632053-05:00","closed_at":"2026-01-17T00:31:18.231632053-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-kitc4","depends_on_id":"hq-wisp-apmz9","type":"parent-child","created_at":"2026-01-17T00:31:03.510535051-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-kitc4","depends_on_id":"hq-wisp-1vntb","type":"blocks","created_at":"2026-01-17T00:31:08.108867854-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-kjyv","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T01:46:34.204800405-05:00","updated_at":"2026-01-16T01:50:38.927648538-05:00","closed_at":"2026-01-16T01:50:38.927648538-05:00","close_reason":"Stale patrol wisp cleanup","ephemeral":true}
{"id":"hq-wisp-km5a5","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:46:50.724932955-05:00","updated_at":"2026-01-17T10:46:50.724932997-05:00","dependencies":[{"issue_id":"hq-wisp-km5a5","depends_on_id":"hq-wisp-2vhlh","type":"parent-child","created_at":"2026-01-17T10:46:50.913171553-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-km5a5","depends_on_id":"hq-wisp-tr4s7","type":"blocks","created_at":"2026-01-17T10:46:51.386993276-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-km5a5","depends_on_id":"hq-wisp-8icmr","type":"blocks","created_at":"2026-01-17T10:46:51.414175969-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-km5a5","depends_on_id":"hq-wisp-4vd4u","type":"blocks","created_at":"2026-01-17T10:46:51.441759661-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-km6p","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T01:45:28.059247439-05:00","updated_at":"2026-01-16T01:50:38.969176702-05:00","closed_at":"2026-01-16T01:50:38.969176702-05:00","close_reason":"Stale patrol wisp cleanup","ephemeral":true}
{"id":"hq-wisp-koyjq","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:23:02.700742022-05:00","updated_at":"2026-01-17T00:24:09.524521701-05:00","closed_at":"2026-01-17T00:24:09.524521701-05:00","close_reason":"No activity","dependencies":[{"issue_id":"hq-wisp-koyjq","depends_on_id":"hq-wisp-93kdl","type":"parent-child","created_at":"2026-01-17T00:23:03.097975792-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-koyjq","depends_on_id":"hq-wisp-1rj6c","type":"blocks","created_at":"2026-01-17T00:23:06.556632217-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-kphe0","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:51:45.024181519-05:00","updated_at":"2026-01-16T23:52:08.594318067-05:00","closed_at":"2026-01-16T23:52:08.594318067-05:00","close_reason":"Duplicate wisps, cleaning up","ephemeral":true}
{"id":"hq-wisp-kpob","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:48:28.031089305-05:00","updated_at":"2026-01-16T22:13:02.115334533-05:00","closed_at":"2026-01-16T22:13:02.115334533-05:00","close_reason":"Orphaned - forced cleanup","dependencies":[{"issue_id":"hq-wisp-kpob","depends_on_id":"hq-wisp-mwjb","type":"parent-child","created_at":"2026-01-16T21:48:28.06103796-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-kpob","depends_on_id":"hq-wisp-19z3","type":"blocks","created_at":"2026-01-16T21:48:28.140062404-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-kpqnr","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:58:39.896135421-05:00","updated_at":"2026-01-17T00:59:55.055734962-05:00","closed_at":"2026-01-17T00:59:55.055734962-05:00","close_reason":"Pool healthy","dependencies":[{"issue_id":"hq-wisp-kpqnr","depends_on_id":"hq-wisp-0nlhz","type":"parent-child","created_at":"2026-01-17T00:58:45.358898286-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-kpqnr","depends_on_id":"hq-wisp-s8mx4","type":"blocks","created_at":"2026-01-17T00:58:56.410463606-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-kpyzb","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:52:28.534859639-05:00","updated_at":"2026-01-16T23:52:48.755982543-05:00","closed_at":"2026-01-16T23:52:48.755982543-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-kpyzb","depends_on_id":"hq-wisp-en6ig","type":"parent-child","created_at":"2026-01-16T23:52:30.431981417-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-kpyzb","depends_on_id":"hq-wisp-4q87b","type":"blocks","created_at":"2026-01-16T23:52:33.916826672-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-kpzev","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:09:41.618839042-05:00","updated_at":"2026-01-17T01:11:06.589072484-05:00","closed_at":"2026-01-17T01:11:06.589072484-05:00","close_reason":"Context limit reached","dependencies":[{"issue_id":"hq-wisp-kpzev","depends_on_id":"hq-wisp-fsms9","type":"parent-child","created_at":"2026-01-17T01:09:51.893695234-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-kpzev","depends_on_id":"hq-wisp-2hqil","type":"blocks","created_at":"2026-01-17T01:10:04.38966782-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-kqhb","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:43:15.721538969-05:00","updated_at":"2026-01-16T22:13:02.128961307-05:00","closed_at":"2026-01-16T22:13:02.128961307-05:00","close_reason":"Orphaned - forced cleanup","dependencies":[{"issue_id":"hq-wisp-kqhb","depends_on_id":"hq-wisp-l7vn","type":"parent-child","created_at":"2026-01-16T21:43:15.784003525-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-kqhb","depends_on_id":"hq-wisp-5bcy","type":"blocks","created_at":"2026-01-16T21:43:15.865258465-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-kqzt5","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:52:58.282679214-05:00","updated_at":"2026-01-16T23:53:15.865944562-05:00","closed_at":"2026-01-16T23:53:15.865944562-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-kqzt5","depends_on_id":"hq-wisp-a5ye3","type":"parent-child","created_at":"2026-01-16T23:53:00.573607202-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-kqzt5","depends_on_id":"hq-wisp-xr4dn","type":"blocks","created_at":"2026-01-16T23:53:03.912463342-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-krhtf","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:49:35.720810756-05:00","updated_at":"2026-01-16T23:50:20.137392884-05:00","closed_at":"2026-01-16T23:50:20.137392884-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-krhtf","depends_on_id":"hq-wisp-n4f70","type":"parent-child","created_at":"2026-01-16T23:49:36.539948306-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-krhtf","depends_on_id":"hq-wisp-ycg5r","type":"blocks","created_at":"2026-01-16T23:49:38.981991989-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-krm9s","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:43:00.960194069-05:00","updated_at":"2026-01-17T00:51:37.569282737-05:00","closed_at":"2026-01-17T00:51:37.569282737-05:00","close_reason":"Dog pool healthy","dependencies":[{"issue_id":"hq-wisp-krm9s","depends_on_id":"hq-wisp-jgnad","type":"parent-child","created_at":"2026-01-17T00:43:05.704041436-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-krm9s","depends_on_id":"hq-wisp-df6ff","type":"blocks","created_at":"2026-01-17T00:43:15.252722701-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-krvh3","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:28:49.930587471-05:00","updated_at":"2026-01-17T00:29:05.913025342-05:00","closed_at":"2026-01-17T00:29:05.913025342-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-krvh3","depends_on_id":"hq-wisp-9l1zx","type":"parent-child","created_at":"2026-01-17T00:28:52.167656658-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-krvh3","depends_on_id":"hq-wisp-juwzh","type":"blocks","created_at":"2026-01-17T00:28:56.646663231-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-kvusq","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:53:25.157347873-05:00","updated_at":"2026-01-16T23:53:48.823716916-05:00","closed_at":"2026-01-16T23:53:48.823716916-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-kvusq","depends_on_id":"hq-wisp-of0wi","type":"parent-child","created_at":"2026-01-16T23:53:26.831643668-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-kvusq","depends_on_id":"hq-wisp-4ciey","type":"blocks","created_at":"2026-01-16T23:53:30.229516096-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-kwci","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:43:15.720392221-05:00","updated_at":"2026-01-16T22:13:02.145711453-05:00","closed_at":"2026-01-16T22:13:02.145711453-05:00","close_reason":"Orphaned - forced cleanup","dependencies":[{"issue_id":"hq-wisp-kwci","depends_on_id":"hq-wisp-l7vn","type":"parent-child","created_at":"2026-01-16T21:43:15.770384216-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-kwci","depends_on_id":"hq-wisp-bgiy","type":"blocks","created_at":"2026-01-16T21:43:15.845132083-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ky6x","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-16T01:44:36.302141848-05:00","updated_at":"2026-01-16T01:52:13.458483621-05:00","closed_at":"2026-01-16T01:52:13.458483621-05:00","close_reason":"Orphaned wisp cleanup","ephemeral":true}
{"id":"hq-wisp-kyk8d","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:54:08.833367355-05:00","updated_at":"2026-01-16T23:54:55.272161672-05:00","closed_at":"2026-01-16T23:54:55.272161672-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-kyk8d","depends_on_id":"hq-wisp-oecdp","type":"parent-child","created_at":"2026-01-16T23:54:10.598594081-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-kyk8d","depends_on_id":"hq-wisp-gaduw","type":"blocks","created_at":"2026-01-16T23:54:13.853477993-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-kzrr","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:56:35.918427063-05:00","updated_at":"2026-01-16T22:12:53.975461664-05:00","closed_at":"2026-01-16T22:12:53.975461664-05:00","close_reason":"Orphaned wisp step - cleanup","dependencies":[{"issue_id":"hq-wisp-kzrr","depends_on_id":"hq-wisp-8d7d","type":"parent-child","created_at":"2026-01-16T01:56:35.927036179-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-kzrr","depends_on_id":"hq-wisp-gy61","type":"blocks","created_at":"2026-01-16T01:56:35.966700219-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-l0yj","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T01:55:23.103076144-05:00","updated_at":"2026-01-16T22:12:29.212635448-05:00","closed_at":"2026-01-16T22:12:29.212635448-05:00","close_reason":"Orphaned - bulk cleanup","ephemeral":true}
{"id":"hq-wisp-l16x5","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:49:59.35644925-05:00","updated_at":"2026-01-17T10:49:59.356449292-05:00","dependencies":[{"issue_id":"hq-wisp-l16x5","depends_on_id":"hq-wisp-wxw0u","type":"parent-child","created_at":"2026-01-17T10:49:59.589748655-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-l16x5","depends_on_id":"hq-wisp-6jasf","type":"blocks","created_at":"2026-01-17T10:50:00.388247438-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-l3dxf","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:49:41.451130278-05:00","updated_at":"2026-01-16T23:50:10.629144933-05:00","closed_at":"2026-01-16T23:50:10.629144933-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-l3dxf","depends_on_id":"hq-wisp-q54v3","type":"parent-child","created_at":"2026-01-16T23:49:43.711721125-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-l3dxf","depends_on_id":"hq-wisp-pm9i0","type":"blocks","created_at":"2026-01-16T23:49:46.593578597-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-l45xc","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:47:53.504864198-05:00","updated_at":"2026-01-16T23:48:26.729419345-05:00","closed_at":"2026-01-16T23:48:26.729419345-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-l45xc","depends_on_id":"hq-wisp-wj52z","type":"parent-child","created_at":"2026-01-16T23:47:55.239712839-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-l45xc","depends_on_id":"hq-wisp-tge7z","type":"blocks","created_at":"2026-01-16T23:47:57.953678776-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-l4pbu","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:56:40.336313412-05:00","updated_at":"2026-01-17T00:57:57.940525542-05:00","closed_at":"2026-01-17T00:57:57.940525542-05:00","close_reason":"No zombies","dependencies":[{"issue_id":"hq-wisp-l4pbu","depends_on_id":"hq-wisp-an994","type":"parent-child","created_at":"2026-01-17T00:56:44.714401259-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-l4pbu","depends_on_id":"hq-wisp-6jvqp","type":"blocks","created_at":"2026-01-17T00:56:56.147013211-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-l4uv","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:46:26.941330478-05:00","updated_at":"2026-01-16T01:51:58.147549376-05:00","closed_at":"2026-01-16T01:51:58.147549376-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-l4uv","depends_on_id":"hq-wisp-ybkc","type":"parent-child","created_at":"2026-01-16T01:46:27.112488167-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-l5p5","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","assignee":"deacon","created_at":"2026-01-16T22:15:48.799771135-05:00","updated_at":"2026-01-17T00:36:24.586024144-05:00","closed_at":"2026-01-17T00:36:24.586024144-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-l65e3","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:05:32.49026216-05:00","updated_at":"2026-01-17T01:06:26.993214319-05:00","closed_at":"2026-01-17T01:06:26.993214319-05:00","close_reason":"Idle town","dependencies":[{"issue_id":"hq-wisp-l65e3","depends_on_id":"hq-wisp-p8n2g","type":"parent-child","created_at":"2026-01-17T01:05:36.047108358-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-l65e3","depends_on_id":"hq-wisp-qicx2","type":"blocks","created_at":"2026-01-17T01:05:47.106298049-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-l67ve","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:03:11.634346004-05:00","updated_at":"2026-01-17T01:04:03.229091941-05:00","closed_at":"2026-01-17T01:04:03.229091941-05:00","close_reason":"No gate-ready","dependencies":[{"issue_id":"hq-wisp-l67ve","depends_on_id":"hq-wisp-zx2sm","type":"parent-child","created_at":"2026-01-17T01:03:13.429597903-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-l67ve","depends_on_id":"hq-wisp-zevyw","type":"blocks","created_at":"2026-01-17T01:03:24.264690215-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-l70zf","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:12:55.885373404-05:00","updated_at":"2026-01-17T01:59:52.555950539-05:00","closed_at":"2026-01-17T01:59:52.555950539-05:00","close_reason":"No plugins to execute","dependencies":[{"issue_id":"hq-wisp-l70zf","depends_on_id":"hq-wisp-i2n82","type":"parent-child","created_at":"2026-01-17T01:13:01.389285745-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-l70zf","depends_on_id":"hq-wisp-bsboi","type":"blocks","created_at":"2026-01-17T01:13:13.681799834-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-l7vn","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T21:43:15.715514396-05:00","updated_at":"2026-01-16T22:12:18.956034932-05:00","closed_at":"2026-01-16T22:12:18.956034932-05:00","close_reason":"Orphaned - bulk cleanup","ephemeral":true}
{"id":"hq-wisp-l814","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:43:15.717889142-05:00","updated_at":"2026-01-16T21:47:41.729640487-05:00","closed_at":"2026-01-16T21:47:41.729640487-05:00","close_reason":"Closed","dependencies":[{"issue_id":"hq-wisp-l814","depends_on_id":"hq-wisp-l7vn","type":"parent-child","created_at":"2026-01-16T21:43:15.739595354-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-l814","depends_on_id":"hq-wisp-2iun","type":"blocks","created_at":"2026-01-16T21:43:15.801470536-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-l8g7z","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:24:43.301921743-05:00","updated_at":"2026-01-17T00:25:25.227529485-05:00","closed_at":"2026-01-17T00:25:25.227529485-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-l8g7z","depends_on_id":"hq-wisp-5fw2b","type":"parent-child","created_at":"2026-01-17T00:24:46.028685938-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-l8g7z","depends_on_id":"hq-wisp-3mptm","type":"blocks","created_at":"2026-01-17T00:24:49.999417471-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-l8l0","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:21:24.466156303-05:00","updated_at":"2026-01-16T23:21:54.413428881-05:00","closed_at":"2026-01-16T23:21:54.413428881-05:00","close_reason":"No gates/convoys/pending","dependencies":[{"issue_id":"hq-wisp-l8l0","depends_on_id":"hq-wisp-87xr","type":"parent-child","created_at":"2026-01-16T23:21:24.556646875-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-l8l0","depends_on_id":"hq-wisp-epei","type":"blocks","created_at":"2026-01-16T23:21:26.094587138-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-l9on3","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:55:14.740938725-05:00","updated_at":"2026-01-17T00:35:11.475183371-05:00","closed_at":"2026-01-17T00:35:11.475183371-05:00","close_reason":"Cleanup","ephemeral":true}
{"id":"hq-wisp-lchj","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:19:36.43530553-05:00","updated_at":"2026-01-16T23:21:10.785523662-05:00","closed_at":"2026-01-16T23:21:10.785523662-05:00","close_reason":"Standard cleanup, context low, looping","dependencies":[{"issue_id":"hq-wisp-lchj","depends_on_id":"hq-wisp-pfs9","type":"parent-child","created_at":"2026-01-16T23:19:37.481159853-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-lchj","depends_on_id":"hq-wisp-x9uc","type":"blocks","created_at":"2026-01-16T23:19:38.981166035-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-le3g","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:33:13.009379493-05:00","updated_at":"2026-01-17T00:35:52.256694187-05:00","closed_at":"2026-01-17T00:35:52.256694187-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-le3sl","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T00:38:05.57825307-05:00","updated_at":"2026-01-17T00:38:33.443939029-05:00","closed_at":"2026-01-17T00:38:33.443939029-05:00","close_reason":"Healthy","ephemeral":true}
{"id":"hq-wisp-lejg","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T00:55:06.231582827-05:00","updated_at":"2026-01-16T01:50:39.447207681-05:00","closed_at":"2026-01-16T01:50:39.447207681-05:00","close_reason":"Stale patrol wisp cleanup","ephemeral":true}
{"id":"hq-wisp-lens0","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:52:28.53311914-05:00","updated_at":"2026-01-16T23:52:49.551946306-05:00","closed_at":"2026-01-16T23:52:49.551946306-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-lens0","depends_on_id":"hq-wisp-en6ig","type":"parent-child","created_at":"2026-01-16T23:52:29.916684109-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-lens0","depends_on_id":"hq-wisp-go5rr","type":"blocks","created_at":"2026-01-16T23:52:33.390137456-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-lep99","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:09:41.605137189-05:00","updated_at":"2026-01-17T01:10:28.704057555-05:00","closed_at":"2026-01-17T01:10:28.704057555-05:00","close_reason":"No spawns","dependencies":[{"issue_id":"hq-wisp-lep99","depends_on_id":"hq-wisp-fsms9","type":"parent-child","created_at":"2026-01-17T01:09:42.217922104-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-lep99","depends_on_id":"hq-wisp-rd4pm","type":"blocks","created_at":"2026-01-17T01:09:53.121676727-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-levrr","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:02:45.698766508-05:00","updated_at":"2026-01-17T01:05:26.103194413-05:00","closed_at":"2026-01-17T01:05:26.103194413-05:00","close_reason":"Idle town patrol","dependencies":[{"issue_id":"hq-wisp-levrr","depends_on_id":"hq-wisp-ji9jj","type":"parent-child","created_at":"2026-01-17T01:02:52.72912605-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-levrr","depends_on_id":"hq-wisp-16ivr","type":"blocks","created_at":"2026-01-17T01:03:04.52725673-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-lf8y9","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:02:45.694131307-05:00","updated_at":"2026-01-17T01:05:29.154488489-05:00","closed_at":"2026-01-17T01:05:29.154488489-05:00","close_reason":"Idle town patrol","dependencies":[{"issue_id":"hq-wisp-lf8y9","depends_on_id":"hq-wisp-ji9jj","type":"parent-child","created_at":"2026-01-17T01:02:49.791238237-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-lf8y9","depends_on_id":"hq-wisp-f3abh","type":"blocks","created_at":"2026-01-17T01:03:00.382001167-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-lf8y9","depends_on_id":"hq-wisp-0d55r","type":"blocks","created_at":"2026-01-17T01:03:00.976498577-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-lf8y9","depends_on_id":"hq-wisp-j476y","type":"blocks","created_at":"2026-01-17T01:03:01.581190472-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-li0jr","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T00:41:18.437210187-05:00","updated_at":"2026-01-17T00:41:58.146960766-05:00","closed_at":"2026-01-17T00:41:58.146960766-05:00","close_reason":"OK","ephemeral":true}
{"id":"hq-wisp-lj5gj","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:49:59.355220209-05:00","updated_at":"2026-01-17T10:49:59.355220251-05:00","dependencies":[{"issue_id":"hq-wisp-lj5gj","depends_on_id":"hq-wisp-wxw0u","type":"parent-child","created_at":"2026-01-17T10:49:59.499414417-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-lj5gj","depends_on_id":"hq-wisp-ljxi0","type":"blocks","created_at":"2026-01-17T10:50:00.299336282-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ljxi0","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:49:59.354553918-05:00","updated_at":"2026-01-17T10:49:59.35455396-05:00","dependencies":[{"issue_id":"hq-wisp-ljxi0","depends_on_id":"hq-wisp-wxw0u","type":"parent-child","created_at":"2026-01-17T10:49:59.455839942-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ljxi0","depends_on_id":"hq-wisp-bnofj","type":"blocks","created_at":"2026-01-17T10:50:00.254843058-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-lk44y","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:55:34.883261295-05:00","updated_at":"2026-01-17T00:35:10.86198444-05:00","closed_at":"2026-01-17T00:35:10.86198444-05:00","close_reason":"Cleanup","ephemeral":true}
{"id":"hq-wisp-llkt","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T22:04:28.606131066-05:00","updated_at":"2026-01-16T22:12:18.905916329-05:00","closed_at":"2026-01-16T22:12:18.905916329-05:00","close_reason":"Orphaned - bulk cleanup","ephemeral":true}
{"id":"hq-wisp-lmi73","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:58:39.899450833-05:00","updated_at":"2026-01-17T01:00:05.359295739-05:00","closed_at":"2026-01-17T01:00:05.359295739-05:00","close_reason":"No cleanup","dependencies":[{"issue_id":"hq-wisp-lmi73","depends_on_id":"hq-wisp-0nlhz","type":"parent-child","created_at":"2026-01-17T00:58:47.002249121-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-lmi73","depends_on_id":"hq-wisp-sx94r","type":"blocks","created_at":"2026-01-17T00:58:58.072451706-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-loflk","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:30:03.176514474-05:00","updated_at":"2026-01-17T00:30:29.322072136-05:00","closed_at":"2026-01-17T00:30:29.322072136-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-loflk","depends_on_id":"hq-wisp-8d16m","type":"parent-child","created_at":"2026-01-17T00:30:04.872207696-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-loflk","depends_on_id":"hq-wisp-qsnye","type":"blocks","created_at":"2026-01-17T00:30:09.201658623-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-loflk","depends_on_id":"hq-wisp-i9ygb","type":"blocks","created_at":"2026-01-17T00:30:09.448166821-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-loflk","depends_on_id":"hq-wisp-rsanv","type":"blocks","created_at":"2026-01-17T00:30:09.703372215-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-loqnl","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:49:57.523770781-05:00","updated_at":"2026-01-17T10:49:57.523770781-05:00","dependencies":[{"issue_id":"hq-wisp-loqnl","depends_on_id":"hq-wisp-8agmn","type":"parent-child","created_at":"2026-01-17T10:49:57.952344405-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-loqnl","depends_on_id":"hq-wisp-aftt5","type":"blocks","created_at":"2026-01-17T10:49:58.727404952-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-loso0","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T10:46:49.63483651-05:00","updated_at":"2026-01-17T10:47:03.697282156-05:00","closed_at":"2026-01-17T10:47:03.697282156-05:00","close_reason":"Patrol 10 complete","ephemeral":true}
{"id":"hq-wisp-loui","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T22:44:58.434733815-05:00","updated_at":"2026-01-17T00:36:17.148958839-05:00","closed_at":"2026-01-17T00:36:17.148958839-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-lpdp5","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T10:47:55.320860533-05:00","updated_at":"2026-01-17T10:55:18.05860863-05:00","closed_at":"2026-01-17T10:55:18.05860863-05:00","close_reason":"Dog alpha working 13min, under 2x threshold - will check next cycle","dependencies":[{"issue_id":"hq-wisp-lpdp5","depends_on_id":"hq-wisp-9hr1x","type":"parent-child","created_at":"2026-01-17T10:47:55.734015792-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-lpdp5","depends_on_id":"hq-wisp-61wp1","type":"blocks","created_at":"2026-01-17T10:47:56.524464829-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-lqlcq","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:40:24.002424409-05:00","updated_at":"2026-01-17T00:35:48.069391881-05:00","closed_at":"2026-01-17T00:35:48.069391881-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-lulaz","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:40:19.877949442-05:00","updated_at":"2026-01-16T23:41:29.318599184-05:00","closed_at":"2026-01-16T23:41:29.318599184-05:00","close_reason":"No issues found","dependencies":[{"issue_id":"hq-wisp-lulaz","depends_on_id":"hq-wisp-6gnpy","type":"parent-child","created_at":"2026-01-16T23:40:21.153539319-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-lulaz","depends_on_id":"hq-wisp-0oza6","type":"blocks","created_at":"2026-01-16T23:40:23.136602438-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-lvq6d","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:50:53.899580764-05:00","updated_at":"2026-01-16T23:51:27.417514303-05:00","closed_at":"2026-01-16T23:51:27.417514303-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-lvq6d","depends_on_id":"hq-wisp-47par","type":"parent-child","created_at":"2026-01-16T23:50:55.887971721-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-lvq6d","depends_on_id":"hq-wisp-za4fx","type":"blocks","created_at":"2026-01-16T23:50:58.762377283-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-lxty4","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:25:48.580594917-05:00","updated_at":"2026-01-17T00:26:23.265792283-05:00","closed_at":"2026-01-17T00:26:23.265792283-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-lxty4","depends_on_id":"hq-wisp-44ngw","type":"parent-child","created_at":"2026-01-17T00:25:48.992042958-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-lxty4","depends_on_id":"hq-wisp-bt23x","type":"blocks","created_at":"2026-01-17T00:25:52.687901132-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-lz4sh","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:04:43.449196885-05:00","updated_at":"2026-01-17T01:07:22.611818132-05:00","closed_at":"2026-01-17T01:07:22.611818132-05:00","close_reason":"Looping - patrol 18 of 20","dependencies":[{"issue_id":"hq-wisp-lz4sh","depends_on_id":"hq-wisp-bkl5l","type":"parent-child","created_at":"2026-01-17T01:04:54.221572522-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-lz4sh","depends_on_id":"hq-wisp-i2rba","type":"blocks","created_at":"2026-01-17T01:05:06.132301756-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-lztam","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:03:11.636014543-05:00","updated_at":"2026-01-17T01:03:54.520136874-05:00","closed_at":"2026-01-17T01:03:54.520136874-05:00","close_reason":"No convoys","dependencies":[{"issue_id":"hq-wisp-lztam","depends_on_id":"hq-wisp-zx2sm","type":"parent-child","created_at":"2026-01-17T01:03:14.042879655-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-lztam","depends_on_id":"hq-wisp-srigs","type":"blocks","created_at":"2026-01-17T01:03:24.871521351-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-m043e","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:24:43.294173762-05:00","updated_at":"2026-01-17T00:25:08.842736465-05:00","closed_at":"2026-01-17T00:25:08.842736465-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-m043e","depends_on_id":"hq-wisp-5fw2b","type":"parent-child","created_at":"2026-01-17T00:24:43.694897274-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-m043e","depends_on_id":"hq-wisp-51y9d","type":"blocks","created_at":"2026-01-17T00:24:47.206555408-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-m0zz","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:53:28.899364225-05:00","updated_at":"2026-01-16T01:54:17.603313284-05:00","closed_at":"2026-01-16T01:54:17.603313284-05:00","close_reason":"Orphan cleanup","dependencies":[{"issue_id":"hq-wisp-m0zz","depends_on_id":"hq-wisp-eke2","type":"parent-child","created_at":"2026-01-16T01:53:28.91433-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-m0zz","depends_on_id":"hq-wisp-00pe","type":"blocks","created_at":"2026-01-16T01:53:28.952588459-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-m2hbp","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:58:39.903990867-05:00","updated_at":"2026-01-17T01:00:19.494197115-05:00","closed_at":"2026-01-17T01:00:19.494197115-05:00","close_reason":"Looping - patrol 15 of 20","dependencies":[{"issue_id":"hq-wisp-m2hbp","depends_on_id":"hq-wisp-0nlhz","type":"parent-child","created_at":"2026-01-17T00:58:49.749421527-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-m2hbp","depends_on_id":"hq-wisp-r3w7z","type":"blocks","created_at":"2026-01-17T00:59:00.856437933-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-m3nss","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:48:51.077821728-05:00","updated_at":"2026-01-16T23:49:21.184670517-05:00","closed_at":"2026-01-16T23:49:21.184670517-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-m3nss","depends_on_id":"hq-wisp-de87j","type":"parent-child","created_at":"2026-01-16T23:48:52.343400635-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-m3nss","depends_on_id":"hq-wisp-z4703","type":"blocks","created_at":"2026-01-16T23:48:55.183785994-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-m3oj","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:26:29.476973667-05:00","updated_at":"2026-01-16T01:52:13.935482227-05:00","closed_at":"2026-01-16T01:52:13.935482227-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-m3oj","depends_on_id":"hq-wisp-zv2x","type":"parent-child","created_at":"2026-01-16T01:26:29.561119538-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-m4y","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T00:54:33.972700275-05:00","updated_at":"2026-01-16T00:54:52.476112047-05:00","closed_at":"2026-01-16T00:54:52.476112047-05:00","close_reason":"Patrol 4 complete","ephemeral":true}
{"id":"hq-wisp-m53q","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:37:49.087277016-05:00","updated_at":"2026-01-16T23:39:06.082813053-05:00","closed_at":"2026-01-16T23:39:06.082813053-05:00","close_reason":"gt deacon pending not implemented","dependencies":[{"issue_id":"hq-wisp-m53q","depends_on_id":"hq-wisp-2zuj","type":"parent-child","created_at":"2026-01-16T23:37:49.18495542-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-m53q","depends_on_id":"hq-wisp-rf4o","type":"blocks","created_at":"2026-01-16T23:37:50.801211543-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-m57ur","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:52:28.535440763-05:00","updated_at":"2026-01-16T23:52:48.585752716-05:00","closed_at":"2026-01-16T23:52:48.585752716-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-m57ur","depends_on_id":"hq-wisp-en6ig","type":"parent-child","created_at":"2026-01-16T23:52:30.615970524-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-m57ur","depends_on_id":"hq-wisp-kpyzb","type":"blocks","created_at":"2026-01-16T23:52:34.091730036-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-m7kbh","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:48:51.07628194-05:00","updated_at":"2026-01-16T23:49:25.098337512-05:00","closed_at":"2026-01-16T23:49:25.098337512-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-m7kbh","depends_on_id":"hq-wisp-de87j","type":"parent-child","created_at":"2026-01-16T23:48:51.917022815-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-m7kbh","depends_on_id":"hq-wisp-87gyy","type":"blocks","created_at":"2026-01-16T23:48:54.465899047-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-m7zn","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:27:24.237467677-05:00","updated_at":"2026-01-16T01:52:13.779022272-05:00","closed_at":"2026-01-16T01:52:13.779022272-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-m7zn","depends_on_id":"hq-wisp-nv4o","type":"parent-child","created_at":"2026-01-16T01:27:24.324605503-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-m7zn","depends_on_id":"hq-wisp-wewt","type":"blocks","created_at":"2026-01-16T01:27:24.503971899-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-m89eg","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:00:26.067105009-05:00","updated_at":"2026-01-17T01:02:06.132979778-05:00","closed_at":"2026-01-17T01:02:06.132979778-05:00","close_reason":"Inbox clear","dependencies":[{"issue_id":"hq-wisp-m89eg","depends_on_id":"hq-wisp-5yxyi","type":"parent-child","created_at":"2026-01-17T01:00:34.907739869-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-m89eg","depends_on_id":"hq-wisp-6csym","type":"blocks","created_at":"2026-01-17T01:00:46.036463039-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ma08b","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:49:41.444104544-05:00","updated_at":"2026-01-16T23:50:31.052702753-05:00","closed_at":"2026-01-16T23:50:31.052702753-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-ma08b","depends_on_id":"hq-wisp-q54v3","type":"parent-child","created_at":"2026-01-16T23:49:42.155197006-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ma08b","depends_on_id":"hq-wisp-hirk5","type":"blocks","created_at":"2026-01-16T23:49:44.715788211-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-mbcdr","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:29:36.061658997-05:00","updated_at":"2026-01-17T00:29:53.104411797-05:00","closed_at":"2026-01-17T00:29:53.104411797-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-mbcdr","depends_on_id":"hq-wisp-w5z6p","type":"parent-child","created_at":"2026-01-17T00:29:37.518698384-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-mbcdr","depends_on_id":"hq-wisp-9mws0","type":"blocks","created_at":"2026-01-17T00:29:41.83108971-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-mblbn","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:02:22.557711233-05:00","updated_at":"2026-01-17T01:04:19.271939764-05:00","closed_at":"2026-01-17T01:04:19.271939764-05:00","close_reason":"No abandoned work","dependencies":[{"issue_id":"hq-wisp-mblbn","depends_on_id":"hq-wisp-xwv1q","type":"parent-child","created_at":"2026-01-17T01:02:29.552341955-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-mblbn","depends_on_id":"hq-wisp-0dhuj","type":"blocks","created_at":"2026-01-17T01:02:41.074195106-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-mdbw0","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T00:44:29.188301886-05:00","updated_at":"2026-01-17T00:44:53.897829653-05:00","closed_at":"2026-01-17T00:44:53.897829653-05:00","close_reason":"OK","ephemeral":true}
{"id":"hq-wisp-me5p","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T22:55:06.768324127-05:00","updated_at":"2026-01-17T00:36:16.207005288-05:00","closed_at":"2026-01-17T00:36:16.207005288-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-mewe","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:55:36.784713874-05:00","updated_at":"2026-01-16T01:56:32.661102944-05:00","closed_at":"2026-01-16T01:56:32.661102944-05:00","close_reason":"Closed","dependencies":[{"issue_id":"hq-wisp-mewe","depends_on_id":"hq-wisp-ndqt","type":"parent-child","created_at":"2026-01-16T01:55:36.880996103-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-mewe","depends_on_id":"hq-wisp-yzut","type":"blocks","created_at":"2026-01-16T01:55:37.024593197-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-mgdg4","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:53:25.156261999-05:00","updated_at":"2026-01-16T23:53:49.166582944-05:00","closed_at":"2026-01-16T23:53:49.166582944-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-mgdg4","depends_on_id":"hq-wisp-of0wi","type":"parent-child","created_at":"2026-01-16T23:53:26.496152176-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-mgdg4","depends_on_id":"hq-wisp-4ciey","type":"blocks","created_at":"2026-01-16T23:53:29.88862665-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-mgiu1","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:53:05.619285279-05:00","updated_at":"2026-01-16T23:53:57.988688865-05:00","closed_at":"2026-01-16T23:53:57.988688865-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-mgiu1","depends_on_id":"hq-wisp-xtx6n","type":"parent-child","created_at":"2026-01-16T23:53:06.177705932-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-mgiu1","depends_on_id":"hq-wisp-hfuye","type":"blocks","created_at":"2026-01-16T23:53:09.284789667-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-mgzp1","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T10:47:55.315680078-05:00","updated_at":"2026-01-17T10:51:04.23754607-05:00","closed_at":"2026-01-17T10:51:04.23754607-05:00","close_reason":"Nothing to process","dependencies":[{"issue_id":"hq-wisp-mgzp1","depends_on_id":"hq-wisp-9hr1x","type":"parent-child","created_at":"2026-01-17T10:47:55.400767903-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-mgzp1","depends_on_id":"hq-wisp-qdo07","type":"blocks","created_at":"2026-01-17T10:47:56.075461217-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-mh58","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:48:28.033930842-05:00","updated_at":"2026-01-16T22:13:02.071436755-05:00","closed_at":"2026-01-16T22:13:02.071436755-05:00","close_reason":"Orphaned - forced cleanup","dependencies":[{"issue_id":"hq-wisp-mh58","depends_on_id":"hq-wisp-mwjb","type":"parent-child","created_at":"2026-01-16T21:48:28.09770402-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-mh58","depends_on_id":"hq-wisp-3ngc","type":"blocks","created_at":"2026-01-16T21:48:28.19955984-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-mi3k","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T22:09:19.867420862-05:00","updated_at":"2026-01-16T22:12:13.794526969-05:00","closed_at":"2026-01-16T22:12:13.794526969-05:00","close_reason":"Orphaned - bulk cleanup","ephemeral":true}
{"id":"hq-wisp-miu2f","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:25:52.721545741-05:00","updated_at":"2026-01-16T23:27:57.0769957-05:00","closed_at":"2026-01-16T23:27:57.0769957-05:00","close_reason":"End-of-patrol, handoff","dependencies":[{"issue_id":"hq-wisp-miu2f","depends_on_id":"hq-wisp-w4tn2","type":"parent-child","created_at":"2026-01-16T23:25:54.128627557-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-miu2f","depends_on_id":"hq-wisp-wql5l","type":"blocks","created_at":"2026-01-16T23:25:56.037506392-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-mkoo","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:15:01.201365098-05:00","updated_at":"2026-01-16T23:19:21.439847133-05:00","closed_at":"2026-01-16T23:19:21.439847133-05:00","close_reason":"Context low, continue looping","dependencies":[{"issue_id":"hq-wisp-mkoo","depends_on_id":"hq-wisp-9osz","type":"parent-child","created_at":"2026-01-16T23:15:02.379883654-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-mkoo","depends_on_id":"hq-wisp-4a7x","type":"blocks","created_at":"2026-01-16T23:15:03.823909397-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-mku51","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T10:48:40.277618062-05:00","updated_at":"2026-01-17T10:48:50.838071133-05:00","closed_at":"2026-01-17T10:48:50.838071133-05:00","close_reason":"Patrol 17 complete","ephemeral":true}
{"id":"hq-wisp-ml1cj","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:25:52.719596408-05:00","updated_at":"2026-01-16T23:27:16.055968877-05:00","closed_at":"2026-01-16T23:27:16.055968877-05:00","close_reason":"No plugins, no stuck dogs","dependencies":[{"issue_id":"hq-wisp-ml1cj","depends_on_id":"hq-wisp-w4tn2","type":"parent-child","created_at":"2026-01-16T23:25:53.755755148-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ml1cj","depends_on_id":"hq-wisp-nfat7","type":"blocks","created_at":"2026-01-16T23:25:55.651682109-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-mlnx","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:36:59.344278536-05:00","updated_at":"2026-01-16T23:39:33.941994391-05:00","closed_at":"2026-01-16T23:39:33.941994391-05:00","close_reason":"Cost digest skipped - command timeout in previous cycle","dependencies":[{"issue_id":"hq-wisp-mlnx","depends_on_id":"hq-wisp-c8tl","type":"parent-child","created_at":"2026-01-16T23:37:00.482761389-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-mlnx","depends_on_id":"hq-wisp-w5d8","type":"blocks","created_at":"2026-01-16T23:37:02.140070424-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-mlny","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T01:29:56.157016276-05:00","updated_at":"2026-01-16T01:50:39.136984852-05:00","closed_at":"2026-01-16T01:50:39.136984852-05:00","close_reason":"Stale patrol wisp cleanup","ephemeral":true}
{"id":"hq-wisp-mmiv4","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:47:53.502575961-05:00","updated_at":"2026-01-16T23:48:29.684654952-05:00","closed_at":"2026-01-16T23:48:29.684654952-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-mmiv4","depends_on_id":"hq-wisp-wj52z","type":"parent-child","created_at":"2026-01-16T23:47:54.839839403-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-mmiv4","depends_on_id":"hq-wisp-9zavz","type":"blocks","created_at":"2026-01-16T23:47:57.542843448-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-mniri","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:41:51.253576227-05:00","updated_at":"2026-01-16T23:42:42.083869706-05:00","closed_at":"2026-01-16T23:42:42.083869706-05:00","close_reason":"No issues found","dependencies":[{"issue_id":"hq-wisp-mniri","depends_on_id":"hq-wisp-tnkch","type":"parent-child","created_at":"2026-01-16T23:41:52.614544385-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-mniri","depends_on_id":"hq-wisp-r9bop","type":"blocks","created_at":"2026-01-16T23:41:54.733938569-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-motjv","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:43:06.01349508-05:00","updated_at":"2026-01-16T23:43:31.230902747-05:00","closed_at":"2026-01-16T23:43:31.230902747-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-motjv","depends_on_id":"hq-wisp-p7g8j","type":"parent-child","created_at":"2026-01-16T23:43:07.411845622-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-motjv","depends_on_id":"hq-wisp-mxzza","type":"blocks","created_at":"2026-01-16T23:43:09.66052959-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-mptm","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T22:15:36.291922721-05:00","updated_at":"2026-01-17T00:36:32.542785691-05:00","closed_at":"2026-01-17T00:36:32.542785691-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-mpw84","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:37:49.093166682-05:00","updated_at":"2026-01-16T23:44:22.305545521-05:00","closed_at":"2026-01-16T23:44:22.305545521-05:00","close_reason":"No session cost wisps to digest (same as previous cycle)","dependencies":[{"issue_id":"hq-wisp-mpw84","depends_on_id":"hq-wisp-2zuj","type":"parent-child","created_at":"2026-01-16T23:37:50.343813103-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-mpw84","depends_on_id":"hq-wisp-wgsda","type":"blocks","created_at":"2026-01-16T23:37:52.168346782-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-mq0wx","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:51:56.828458236-05:00","updated_at":"2026-01-16T23:52:46.792631721-05:00","closed_at":"2026-01-16T23:52:46.792631721-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-mq0wx","depends_on_id":"hq-wisp-ri9se","type":"parent-child","created_at":"2026-01-16T23:51:57.328024265-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-mq0wx","depends_on_id":"hq-wisp-vu2re","type":"blocks","created_at":"2026-01-16T23:52:00.29084455-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-mqaw7","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:05:32.499285562-05:00","updated_at":"2026-01-17T01:07:16.160445232-05:00","closed_at":"2026-01-17T01:07:16.160445232-05:00","close_reason":"Idle town","dependencies":[{"issue_id":"hq-wisp-mqaw7","depends_on_id":"hq-wisp-p8n2g","type":"parent-child","created_at":"2026-01-17T01:05:41.459188513-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-mqaw7","depends_on_id":"hq-wisp-2ptsx","type":"blocks","created_at":"2026-01-17T01:05:53.695154478-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-mr96h","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:47:34.365723356-05:00","updated_at":"2026-01-16T23:49:02.240193075-05:00","closed_at":"2026-01-16T23:49:02.240193075-05:00","close_reason":"Inbox empty","dependencies":[{"issue_id":"hq-wisp-mr96h","depends_on_id":"hq-wisp-ql31w","type":"parent-child","created_at":"2026-01-16T23:47:34.376765581-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-mrvtz","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon/","created_at":"2026-01-17T00:38:48.86762584-05:00","updated_at":"2026-01-17T01:12:41.616234952-05:00","closed_at":"2026-01-17T01:12:41.616236702-05:00","ephemeral":true}
{"id":"hq-wisp-ms1lx","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:50:53.895836225-05:00","updated_at":"2026-01-16T23:51:32.555597067-05:00","closed_at":"2026-01-16T23:51:32.555597067-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-ms1lx","depends_on_id":"hq-wisp-47par","type":"parent-child","created_at":"2026-01-16T23:50:54.900985945-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ms1lx","depends_on_id":"hq-wisp-hlyrw","type":"blocks","created_at":"2026-01-16T23:50:57.45378084-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ms1lx","depends_on_id":"hq-wisp-079ed","type":"blocks","created_at":"2026-01-16T23:50:57.600887142-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ms1lx","depends_on_id":"hq-wisp-k8b8i","type":"blocks","created_at":"2026-01-16T23:50:57.746109321-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-msar","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:15:01.199368057-05:00","updated_at":"2026-01-16T23:18:46.760899235-05:00","closed_at":"2026-01-16T23:18:46.760899235-05:00","close_reason":"No orphaned work","dependencies":[{"issue_id":"hq-wisp-msar","depends_on_id":"hq-wisp-9osz","type":"parent-child","created_at":"2026-01-16T23:15:02.031056528-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-msar","depends_on_id":"hq-wisp-tlnw","type":"blocks","created_at":"2026-01-16T23:15:03.455099192-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-msxkm","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:37:49.09363289-05:00","updated_at":"2026-01-16T23:44:36.712943326-05:00","closed_at":"2026-01-16T23:44:36.712943326-05:00","close_reason":"Daemon log 1.7MB, under 10MB threshold, no rotation needed","dependencies":[{"issue_id":"hq-wisp-msxkm","depends_on_id":"hq-wisp-2zuj","type":"parent-child","created_at":"2026-01-16T23:37:50.435128549-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-msxkm","depends_on_id":"hq-wisp-mpw84","type":"blocks","created_at":"2026-01-16T23:37:52.263401645-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-mut6","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:15:01.194255225-05:00","updated_at":"2026-01-16T23:15:29.128592309-05:00","closed_at":"2026-01-16T23:15:29.128592309-05:00","close_reason":"Closed","dependencies":[{"issue_id":"hq-wisp-mut6","depends_on_id":"hq-wisp-9osz","type":"parent-child","created_at":"2026-01-16T23:15:01.202308014-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-mvs7","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:42:27.176803709-05:00","updated_at":"2026-01-16T01:52:13.514309435-05:00","closed_at":"2026-01-16T01:52:13.514309435-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-mvs7","depends_on_id":"hq-wisp-wqti","type":"parent-child","created_at":"2026-01-16T01:42:27.39182085-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-mvs7","depends_on_id":"hq-wisp-zboi","type":"blocks","created_at":"2026-01-16T01:42:27.646541073-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-mw9k","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:55:36.781581003-05:00","updated_at":"2026-01-16T01:56:11.587427978-05:00","closed_at":"2026-01-16T01:56:11.587427978-05:00","close_reason":"Closed","dependencies":[{"issue_id":"hq-wisp-mw9k","depends_on_id":"hq-wisp-ndqt","type":"parent-child","created_at":"2026-01-16T01:55:36.820728877-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-mw9k","depends_on_id":"hq-wisp-xjlq","type":"blocks","created_at":"2026-01-16T01:55:36.942638411-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-mwjb","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-16T21:48:28.027129229-05:00","updated_at":"2026-01-16T22:12:37.707469952-05:00","closed_at":"2026-01-16T22:12:37.707469952-05:00","close_reason":"Orphaned patrol wisp - cleanup","ephemeral":true}
{"id":"hq-wisp-mwk8","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:26:29.473989004-05:00","updated_at":"2026-01-16T01:52:13.997460201-05:00","closed_at":"2026-01-16T01:52:13.997460201-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-mwk8","depends_on_id":"hq-wisp-zv2x","type":"parent-child","created_at":"2026-01-16T01:26:29.498389645-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-mwk8","depends_on_id":"hq-wisp-dtbx","type":"blocks","created_at":"2026-01-16T01:26:29.612558443-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-mwv8","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:15:01.198144265-05:00","updated_at":"2026-01-16T23:18:43.144159952-05:00","closed_at":"2026-01-16T23:18:43.144159952-05:00","close_reason":"No plugins, no stuck dogs","dependencies":[{"issue_id":"hq-wisp-mwv8","depends_on_id":"hq-wisp-9osz","type":"parent-child","created_at":"2026-01-16T23:15:01.822447452-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-mwv8","depends_on_id":"hq-wisp-omhx","type":"blocks","created_at":"2026-01-16T23:15:03.234272119-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-mxzza","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:43:06.013008213-05:00","updated_at":"2026-01-16T23:43:32.392977953-05:00","closed_at":"2026-01-16T23:43:32.392977953-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-mxzza","depends_on_id":"hq-wisp-p7g8j","type":"parent-child","created_at":"2026-01-16T23:43:07.305227101-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-mxzza","depends_on_id":"hq-wisp-bs78w","type":"blocks","created_at":"2026-01-16T23:43:09.532987616-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-my4kk","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:30:39.083792204-05:00","updated_at":"2026-01-17T00:30:53.715659863-05:00","closed_at":"2026-01-17T00:30:53.715659863-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-my4kk","depends_on_id":"hq-wisp-tjzfo","type":"parent-child","created_at":"2026-01-17T00:30:40.359389885-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-my4kk","depends_on_id":"hq-wisp-4979p","type":"blocks","created_at":"2026-01-17T00:30:44.895304108-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-myg7","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:53:28.897502894-05:00","updated_at":"2026-01-16T01:54:17.642340867-05:00","closed_at":"2026-01-16T01:54:17.642340867-05:00","close_reason":"Orphan cleanup","dependencies":[{"issue_id":"hq-wisp-myg7","depends_on_id":"hq-wisp-eke2","type":"parent-child","created_at":"2026-01-16T01:53:28.9074663-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-mz3y","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:05:01.100553511-05:00","updated_at":"2026-01-16T22:12:53.904345504-05:00","closed_at":"2026-01-16T22:12:53.904345504-05:00","close_reason":"Orphaned wisp step - cleanup","dependencies":[{"issue_id":"hq-wisp-mz3y","depends_on_id":"hq-wisp-xrtb","type":"parent-child","created_at":"2026-01-16T22:05:01.114130994-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-mz3y","depends_on_id":"hq-wisp-57yq","type":"blocks","created_at":"2026-01-16T22:05:01.25607944-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-mzpqk","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:51:56.829084777-05:00","updated_at":"2026-01-16T23:52:45.465810211-05:00","closed_at":"2026-01-16T23:52:45.465810211-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-mzpqk","depends_on_id":"hq-wisp-ri9se","type":"parent-child","created_at":"2026-01-16T23:51:57.490699014-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-mzpqk","depends_on_id":"hq-wisp-2y91t","type":"blocks","created_at":"2026-01-16T23:52:00.456087464-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-n001","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:46:01.53418082-05:00","updated_at":"2026-01-16T01:51:58.283932853-05:00","closed_at":"2026-01-16T01:51:58.283932853-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-n001","depends_on_id":"hq-wisp-xunp","type":"parent-child","created_at":"2026-01-16T01:46:01.709021756-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-n001","depends_on_id":"hq-wisp-bns1","type":"blocks","created_at":"2026-01-16T01:46:01.912163452-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-n20i2","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:04:43.446621889-05:00","updated_at":"2026-01-17T01:07:18.978393737-05:00","closed_at":"2026-01-17T01:07:18.978393737-05:00","close_reason":"Logs rotated","dependencies":[{"issue_id":"hq-wisp-n20i2","depends_on_id":"hq-wisp-bkl5l","type":"parent-child","created_at":"2026-01-17T01:04:52.321409864-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-n20i2","depends_on_id":"hq-wisp-ya8st","type":"blocks","created_at":"2026-01-17T01:05:04.351637036-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-n23re","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:44:43.647244967-05:00","updated_at":"2026-01-16T23:45:09.791257642-05:00","closed_at":"2026-01-16T23:45:09.791257642-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-n23re","depends_on_id":"hq-wisp-bhwu0","type":"parent-child","created_at":"2026-01-16T23:44:45.499711434-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-n23re","depends_on_id":"hq-wisp-wgpch","type":"blocks","created_at":"2026-01-16T23:44:47.71693583-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-n2md","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T22:03:48.260529754-05:00","updated_at":"2026-01-16T22:12:18.915864192-05:00","closed_at":"2026-01-16T22:12:18.915864192-05:00","close_reason":"Orphaned - bulk cleanup","ephemeral":true}
{"id":"hq-wisp-n2yzo","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:49:57.524361947-05:00","updated_at":"2026-01-17T10:49:57.524361947-05:00","dependencies":[{"issue_id":"hq-wisp-n2yzo","depends_on_id":"hq-wisp-8agmn","type":"parent-child","created_at":"2026-01-17T10:49:57.9902238-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-n2yzo","depends_on_id":"hq-wisp-loqnl","type":"blocks","created_at":"2026-01-17T10:49:58.769140427-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-n4f70","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:49:35.715413769-05:00","updated_at":"2026-01-16T23:50:29.606008675-05:00","closed_at":"2026-01-16T23:50:29.606008675-05:00","close_reason":"Patrol 9 complete","ephemeral":true}
{"id":"hq-wisp-n54rr","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:54:08.831632898-05:00","updated_at":"2026-01-16T23:54:56.980563808-05:00","closed_at":"2026-01-16T23:54:56.980563808-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-n54rr","depends_on_id":"hq-wisp-oecdp","type":"parent-child","created_at":"2026-01-16T23:54:10.120889032-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-n54rr","depends_on_id":"hq-wisp-gg4ys","type":"blocks","created_at":"2026-01-16T23:54:13.358790624-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-n86bg","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T00:36:49.153754504-05:00","updated_at":"2026-01-17T00:37:14.229349373-05:00","closed_at":"2026-01-17T00:37:14.229349373-05:00","close_reason":"Town healthy","ephemeral":true}
{"id":"hq-wisp-n8jfa","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:43:56.989458359-05:00","updated_at":"2026-01-16T23:44:37.514904424-05:00","closed_at":"2026-01-16T23:44:37.514904424-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-n8jfa","depends_on_id":"hq-wisp-ywecn","type":"parent-child","created_at":"2026-01-16T23:43:56.999650399-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-n9aoj","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:53:31.789084771-05:00","updated_at":"2026-01-17T00:35:30.003760807-05:00","closed_at":"2026-01-17T00:35:30.003760807-05:00","close_reason":"Cleanup","ephemeral":true}
{"id":"hq-wisp-n9zhv","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:47:24.576517189-05:00","updated_at":"2026-01-17T10:47:24.576517189-05:00","dependencies":[{"issue_id":"hq-wisp-n9zhv","depends_on_id":"hq-wisp-jag69","type":"parent-child","created_at":"2026-01-17T10:47:24.588022183-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-na0y3","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:53:05.628189897-05:00","updated_at":"2026-01-16T23:53:44.719482782-05:00","closed_at":"2026-01-16T23:53:44.719482782-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-na0y3","depends_on_id":"hq-wisp-xtx6n","type":"parent-child","created_at":"2026-01-16T23:53:08.414645295-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-na0y3","depends_on_id":"hq-wisp-ynldu","type":"blocks","created_at":"2026-01-16T23:53:11.914030186-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-nbew","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:26:29.476232918-05:00","updated_at":"2026-01-16T01:52:13.955432163-05:00","closed_at":"2026-01-16T01:52:13.955432163-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-nbew","depends_on_id":"hq-wisp-zv2x","type":"parent-child","created_at":"2026-01-16T01:26:29.541837725-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-nbew","depends_on_id":"hq-wisp-8vn9","type":"blocks","created_at":"2026-01-16T01:26:29.676020377-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-nc6j","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T22:56:51.069551624-05:00","updated_at":"2026-01-17T00:36:14.658521963-05:00","closed_at":"2026-01-17T00:36:14.658521963-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-ndqt","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T01:55:36.779150297-05:00","updated_at":"2026-01-16T22:12:29.203023419-05:00","closed_at":"2026-01-16T22:12:29.203023419-05:00","close_reason":"Orphaned - bulk cleanup","ephemeral":true}
{"id":"hq-wisp-nek75","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:24:43.297425629-05:00","updated_at":"2026-01-17T00:25:15.620743578-05:00","closed_at":"2026-01-17T00:25:15.620743578-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-nek75","depends_on_id":"hq-wisp-5fw2b","type":"parent-child","created_at":"2026-01-17T00:24:44.658395813-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-nek75","depends_on_id":"hq-wisp-s6om7","type":"blocks","created_at":"2026-01-17T00:24:48.200709779-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-nek75","depends_on_id":"hq-wisp-wir3g","type":"blocks","created_at":"2026-01-17T00:24:48.398803937-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-nek75","depends_on_id":"hq-wisp-cuu4r","type":"blocks","created_at":"2026-01-17T00:24:48.597362429-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-nesmi","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:26:33.629965968-05:00","updated_at":"2026-01-17T00:27:04.295039805-05:00","closed_at":"2026-01-17T00:27:04.295039805-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-nesmi","depends_on_id":"hq-wisp-3h08u","type":"parent-child","created_at":"2026-01-17T00:26:35.663827922-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-nesmi","depends_on_id":"hq-wisp-heht9","type":"blocks","created_at":"2026-01-17T00:26:39.729712209-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-nf972","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:49:35.718643011-05:00","updated_at":"2026-01-16T23:50:21.966298965-05:00","closed_at":"2026-01-16T23:50:21.966298965-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-nf972","depends_on_id":"hq-wisp-n4f70","type":"parent-child","created_at":"2026-01-16T23:49:36.001915282-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-nf972","depends_on_id":"hq-wisp-xmlr6","type":"blocks","created_at":"2026-01-16T23:49:38.438987394-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-nfat7","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:25:52.718991116-05:00","updated_at":"2026-01-16T23:27:07.772894489-05:00","closed_at":"2026-01-16T23:27:07.772894489-05:00","close_reason":"No zombies, dogs present","dependencies":[{"issue_id":"hq-wisp-nfat7","depends_on_id":"hq-wisp-w4tn2","type":"parent-child","created_at":"2026-01-16T23:25:53.657768619-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-nfat7","depends_on_id":"hq-wisp-8nw8z","type":"blocks","created_at":"2026-01-16T23:25:55.556971913-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ng78","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:42:27.175547211-05:00","updated_at":"2026-01-16T01:52:13.561966883-05:00","closed_at":"2026-01-16T01:52:13.561966883-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-ng78","depends_on_id":"hq-wisp-wqti","type":"parent-child","created_at":"2026-01-16T01:42:27.332380332-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ngen","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:54:43.650072136-05:00","updated_at":"2026-01-16T01:56:34.053708802-05:00","closed_at":"2026-01-16T01:56:34.053708802-05:00","close_reason":"Witnesses running, niflheim refinery running, gastown refinery stopped (idle town, acceptable)","dependencies":[{"issue_id":"hq-wisp-ngen","depends_on_id":"hq-wisp-8okt","type":"parent-child","created_at":"2026-01-16T01:54:43.668897533-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ngen","depends_on_id":"hq-wisp-1qsl","type":"blocks","created_at":"2026-01-16T01:54:43.706901533-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ngen","depends_on_id":"hq-wisp-httb","type":"blocks","created_at":"2026-01-16T01:54:43.709740655-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ngen","depends_on_id":"hq-wisp-o7el","type":"blocks","created_at":"2026-01-16T01:54:43.712412444-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-nggr1","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:46:50.726734413-05:00","updated_at":"2026-01-17T10:46:50.726734454-05:00","dependencies":[{"issue_id":"hq-wisp-nggr1","depends_on_id":"hq-wisp-2vhlh","type":"parent-child","created_at":"2026-01-17T10:46:50.990428092-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-nggr1","depends_on_id":"hq-wisp-km5a5","type":"blocks","created_at":"2026-01-17T10:46:51.525433737-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ngw3","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:22:20.086567494-05:00","updated_at":"2026-01-16T01:52:14.080728444-05:00","closed_at":"2026-01-16T01:52:14.080728444-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-ngw3","depends_on_id":"hq-wisp-gvqg","type":"parent-child","created_at":"2026-01-16T01:22:20.125288453-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ngw3","depends_on_id":"hq-wisp-jlrd","type":"blocks","created_at":"2026-01-16T01:22:20.218622898-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ngw3","depends_on_id":"hq-wisp-y6sb","type":"blocks","created_at":"2026-01-16T01:22:20.224092892-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ngw3","depends_on_id":"hq-wisp-h82k","type":"blocks","created_at":"2026-01-16T01:22:20.229831928-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-njhz7","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:43:56.990661484-05:00","updated_at":"2026-01-16T23:44:35.6146095-05:00","closed_at":"2026-01-16T23:44:35.6146095-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-njhz7","depends_on_id":"hq-wisp-ywecn","type":"parent-child","created_at":"2026-01-16T23:43:57.20349004-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-njhz7","depends_on_id":"hq-wisp-n8jfa","type":"blocks","created_at":"2026-01-16T23:43:59.068746465-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-nm93c","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T02:00:44.581914017-05:00","updated_at":"2026-01-17T02:01:58.923701658-05:00","closed_at":"2026-01-17T02:01:58.923701658-05:00","close_reason":"Idle patrol","dependencies":[{"issue_id":"hq-wisp-nm93c","depends_on_id":"hq-wisp-9a1wp","type":"parent-child","created_at":"2026-01-17T02:00:57.090886546-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-nm93c","depends_on_id":"hq-wisp-gze5q","type":"blocks","created_at":"2026-01-17T02:01:09.886534426-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-nmt0","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:53:28.904929136-05:00","updated_at":"2026-01-16T01:54:17.577209646-05:00","closed_at":"2026-01-16T01:54:17.577209646-05:00","close_reason":"Orphan cleanup","dependencies":[{"issue_id":"hq-wisp-nmt0","depends_on_id":"hq-wisp-eke2","type":"parent-child","created_at":"2026-01-16T01:53:28.932259273-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-nmt0","depends_on_id":"hq-wisp-kgns","type":"blocks","created_at":"2026-01-16T01:53:28.979322388-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-no6c","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:21:24.473062677-05:00","updated_at":"2026-01-16T23:23:37.781421169-05:00","closed_at":"2026-01-16T23:23:37.781421169-05:00","close_reason":"Standard end-of-cycle, looping","dependencies":[{"issue_id":"hq-wisp-no6c","depends_on_id":"hq-wisp-87xr","type":"parent-child","created_at":"2026-01-16T23:21:26.008674649-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-no6c","depends_on_id":"hq-wisp-6ric","type":"blocks","created_at":"2026-01-16T23:21:27.739787054-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-np8s","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:27:24.237737427-05:00","updated_at":"2026-01-16T01:52:13.771550905-05:00","closed_at":"2026-01-16T01:52:13.771550905-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-np8s","depends_on_id":"hq-wisp-nv4o","type":"parent-child","created_at":"2026-01-16T01:27:24.333317244-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-np8s","depends_on_id":"hq-wisp-m7zn","type":"blocks","created_at":"2026-01-16T01:27:24.513383723-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-npce","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","assignee":"deacon","created_at":"2026-01-16T22:15:29.21246735-05:00","updated_at":"2026-01-17T00:36:33.475430922-05:00","closed_at":"2026-01-17T00:36:33.475430922-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-npo8","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:48:28.027850811-05:00","updated_at":"2026-01-16T22:12:49.676931477-05:00","closed_at":"2026-01-16T22:12:49.676931477-05:00","close_reason":"Orphaned wisp step - cleanup","dependencies":[{"issue_id":"hq-wisp-npo8","depends_on_id":"hq-wisp-mwjb","type":"parent-child","created_at":"2026-01-16T21:48:28.035282089-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-nq4ui","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon/","created_at":"2026-01-17T00:27:58.213394403-05:00","updated_at":"2026-01-17T00:35:05.443981823-05:00","closed_at":"2026-01-17T00:35:05.443981823-05:00","close_reason":"Cleanup","ephemeral":true}
{"id":"hq-wisp-nr2yc","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T10:48:25.420442172-05:00","updated_at":"2026-01-17T10:48:35.64656173-05:00","closed_at":"2026-01-17T10:48:35.64656173-05:00","close_reason":"Patrol 16 complete","ephemeral":true}
{"id":"hq-wisp-nsma","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:19:36.435722405-05:00","updated_at":"2026-01-16T23:21:10.888768483-05:00","closed_at":"2026-01-16T23:21:10.888768483-05:00","close_reason":"Standard cleanup, context low, looping","dependencies":[{"issue_id":"hq-wisp-nsma","depends_on_id":"hq-wisp-pfs9","type":"parent-child","created_at":"2026-01-16T23:19:37.555100636-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-nsma","depends_on_id":"hq-wisp-lchj","type":"blocks","created_at":"2026-01-16T23:19:39.058320108-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ntacb","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T02:00:44.567319189-05:00","updated_at":"2026-01-17T02:01:50.745854183-05:00","closed_at":"2026-01-17T02:01:50.745854183-05:00","close_reason":"Idle patrol","dependencies":[{"issue_id":"hq-wisp-ntacb","depends_on_id":"hq-wisp-9a1wp","type":"parent-child","created_at":"2026-01-17T02:00:46.453514909-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ntacb","depends_on_id":"hq-wisp-cpaes","type":"blocks","created_at":"2026-01-17T02:00:58.995126386-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ntfk0","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:47:34.368999586-05:00","updated_at":"2026-01-16T23:49:14.616308281-05:00","closed_at":"2026-01-16T23:49:14.616308281-05:00","close_reason":"Town idle patrol","dependencies":[{"issue_id":"hq-wisp-ntfk0","depends_on_id":"hq-wisp-ql31w","type":"parent-child","created_at":"2026-01-16T23:47:34.97282355-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ntfk0","depends_on_id":"hq-wisp-7cnr4","type":"blocks","created_at":"2026-01-16T23:47:37.109371282-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ntfqr","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T00:29:26.083547105-05:00","updated_at":"2026-01-17T00:35:05.1286231-05:00","closed_at":"2026-01-17T00:35:05.1286231-05:00","close_reason":"Cleanup","ephemeral":true}
{"id":"hq-wisp-nu8a2","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:48:14.905290149-05:00","updated_at":"2026-01-17T00:35:31.747053791-05:00","closed_at":"2026-01-17T00:35:31.747053791-05:00","close_reason":"Cleanup","ephemeral":true}
{"id":"hq-wisp-nv4o","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T01:27:24.233191806-05:00","updated_at":"2026-01-16T01:52:13.888771319-05:00","closed_at":"2026-01-16T01:52:13.888771319-05:00","close_reason":"Orphaned wisp cleanup","ephemeral":true}
{"id":"hq-wisp-nve0","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:21:24.47186351-05:00","updated_at":"2026-01-16T23:23:37.508491079-05:00","closed_at":"2026-01-16T23:23:37.508491079-05:00","close_reason":"Standard end-of-cycle, looping","dependencies":[{"issue_id":"hq-wisp-nve0","depends_on_id":"hq-wisp-87xr","type":"parent-child","created_at":"2026-01-16T23:21:25.724099268-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-nve0","depends_on_id":"hq-wisp-zwr9","type":"blocks","created_at":"2026-01-16T23:21:27.471984422-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-nwsic","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:50:35.401317298-05:00","updated_at":"2026-01-16T23:51:22.577086058-05:00","closed_at":"2026-01-16T23:51:22.577086058-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-nwsic","depends_on_id":"hq-wisp-t8b5z","type":"parent-child","created_at":"2026-01-16T23:50:37.095925466-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-nwsic","depends_on_id":"hq-wisp-oa8fe","type":"blocks","created_at":"2026-01-16T23:50:39.835558424-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-nwwah","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:02:22.559315355-05:00","updated_at":"2026-01-17T01:04:31.906829243-05:00","closed_at":"2026-01-17T01:04:31.906829243-05:00","close_reason":"Cost command hangs, skipped","dependencies":[{"issue_id":"hq-wisp-nwwah","depends_on_id":"hq-wisp-xwv1q","type":"parent-child","created_at":"2026-01-17T01:02:30.701167296-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-nwwah","depends_on_id":"hq-wisp-4s27y","type":"blocks","created_at":"2026-01-17T01:02:42.25022053-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-nx40","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T22:09:18.081785126-05:00","updated_at":"2026-01-16T22:12:13.823736599-05:00","closed_at":"2026-01-16T22:12:13.823736599-05:00","close_reason":"Orphaned - bulk cleanup","ephemeral":true}
{"id":"hq-wisp-nxbv","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:19:43.919391397-05:00","updated_at":"2026-01-17T00:35:59.778221154-05:00","closed_at":"2026-01-17T00:35:59.778221154-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-nxinm","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:28:49.923338607-05:00","updated_at":"2026-01-17T00:29:01.061692064-05:00","closed_at":"2026-01-17T00:29:01.061692064-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-nxinm","depends_on_id":"hq-wisp-9l1zx","type":"parent-child","created_at":"2026-01-17T00:28:49.937850961-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-nzfs","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:56:35.922285434-05:00","updated_at":"2026-01-16T22:13:02.181034575-05:00","closed_at":"2026-01-16T22:13:02.181034575-05:00","close_reason":"Orphaned - forced cleanup","dependencies":[{"issue_id":"hq-wisp-nzfs","depends_on_id":"hq-wisp-8d7d","type":"parent-child","created_at":"2026-01-16T01:56:35.951135569-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-nzfs","depends_on_id":"hq-wisp-omk3","type":"blocks","created_at":"2026-01-16T01:56:36.002008597-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-nzo6r","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:49:35.721879754-05:00","updated_at":"2026-01-16T23:50:19.814589662-05:00","closed_at":"2026-01-16T23:50:19.814589662-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-nzo6r","depends_on_id":"hq-wisp-n4f70","type":"parent-child","created_at":"2026-01-16T23:49:36.813688974-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-nzo6r","depends_on_id":"hq-wisp-02syo","type":"blocks","created_at":"2026-01-16T23:49:39.528769368-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-nzywz","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:52:28.533682056-05:00","updated_at":"2026-01-16T23:52:49.379432731-05:00","closed_at":"2026-01-16T23:52:49.379432731-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-nzywz","depends_on_id":"hq-wisp-en6ig","type":"parent-child","created_at":"2026-01-16T23:52:30.086580893-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-nzywz","depends_on_id":"hq-wisp-lens0","type":"blocks","created_at":"2026-01-16T23:52:33.565461403-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-o1dj2","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:43:00.964111354-05:00","updated_at":"2026-01-17T00:51:59.350737616-05:00","closed_at":"2026-01-17T00:51:59.350737616-05:00","close_reason":"Logs rotated","dependencies":[{"issue_id":"hq-wisp-o1dj2","depends_on_id":"hq-wisp-jgnad","type":"parent-child","created_at":"2026-01-17T00:43:08.070108045-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-o1dj2","depends_on_id":"hq-wisp-7nzgp","type":"blocks","created_at":"2026-01-17T00:43:17.687872329-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-o2a8t","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:41:51.251649394-05:00","updated_at":"2026-01-16T23:42:42.184231163-05:00","closed_at":"2026-01-16T23:42:42.184231163-05:00","close_reason":"No issues found","dependencies":[{"issue_id":"hq-wisp-o2a8t","depends_on_id":"hq-wisp-tnkch","type":"parent-child","created_at":"2026-01-16T23:41:52.200440146-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-o2a8t","depends_on_id":"hq-wisp-u9asm","type":"blocks","created_at":"2026-01-16T23:41:54.303572417-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-o2ep","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:05:01.100879719-05:00","updated_at":"2026-01-16T22:12:53.895919389-05:00","closed_at":"2026-01-16T22:12:53.895919389-05:00","close_reason":"Orphaned wisp step - cleanup","dependencies":[{"issue_id":"hq-wisp-o2ep","depends_on_id":"hq-wisp-xrtb","type":"parent-child","created_at":"2026-01-16T22:05:01.12168261-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-o2ep","depends_on_id":"hq-wisp-57yq","type":"blocks","created_at":"2026-01-16T22:05:01.264119055-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-o47kv","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:41:51.247871978-05:00","updated_at":"2026-01-16T23:42:27.85208189-05:00","closed_at":"2026-01-16T23:42:27.85208189-05:00","close_reason":"Nothing pending","dependencies":[{"issue_id":"hq-wisp-o47kv","depends_on_id":"hq-wisp-tnkch","type":"parent-child","created_at":"2026-01-16T23:41:51.360013338-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-o47kv","depends_on_id":"hq-wisp-2u8ir","type":"blocks","created_at":"2026-01-16T23:41:53.243450637-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-o4v14","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:47:24.586005809-05:00","updated_at":"2026-01-17T10:47:24.586005851-05:00","dependencies":[{"issue_id":"hq-wisp-o4v14","depends_on_id":"hq-wisp-jag69","type":"parent-child","created_at":"2026-01-17T10:47:25.085658767-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-o4v14","depends_on_id":"hq-wisp-dd62e","type":"blocks","created_at":"2026-01-17T10:47:25.753389876-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-o56v1","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:09:41.609586348-05:00","updated_at":"2026-01-17T01:10:37.830113213-05:00","closed_at":"2026-01-17T01:10:37.830113213-05:00","close_reason":"No notifications","dependencies":[{"issue_id":"hq-wisp-o56v1","depends_on_id":"hq-wisp-fsms9","type":"parent-child","created_at":"2026-01-17T01:09:45.194630064-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-o56v1","depends_on_id":"hq-wisp-p7kp6","type":"blocks","created_at":"2026-01-17T01:09:56.210713386-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-o5ago","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:28:49.92780635-05:00","updated_at":"2026-01-17T00:29:04.40789246-05:00","closed_at":"2026-01-17T00:29:04.40789246-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-o5ago","depends_on_id":"hq-wisp-9l1zx","type":"parent-child","created_at":"2026-01-17T00:28:51.281798687-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-o5ago","depends_on_id":"hq-wisp-ub9q9","type":"blocks","created_at":"2026-01-17T00:28:55.292062562-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-o5iy","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:21:24.469080386-05:00","updated_at":"2026-01-16T23:22:59.199887049-05:00","closed_at":"2026-01-16T23:22:59.199887049-05:00","close_reason":"No zombies, dogs present","dependencies":[{"issue_id":"hq-wisp-o5iy","depends_on_id":"hq-wisp-87xr","type":"parent-child","created_at":"2026-01-16T23:21:25.134374343-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-o5iy","depends_on_id":"hq-wisp-e3e0","type":"blocks","created_at":"2026-01-16T23:21:26.861127249-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-o5jr","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:54:43.652554759-05:00","updated_at":"2026-01-16T01:56:30.770570086-05:00","closed_at":"2026-01-16T01:56:30.770570086-05:00","close_reason":"Orphan cleanup","dependencies":[{"issue_id":"hq-wisp-o5jr","depends_on_id":"hq-wisp-8okt","type":"parent-child","created_at":"2026-01-16T01:54:43.685942556-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-o5jr","depends_on_id":"hq-wisp-jmnm","type":"blocks","created_at":"2026-01-16T01:54:43.740658996-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-o5vic","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:39:19.1220949-05:00","updated_at":"2026-01-17T00:35:49.181637336-05:00","closed_at":"2026-01-17T00:35:49.181637336-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-o7bbu","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:43:56.996716816-05:00","updated_at":"2026-01-16T23:44:20.214111225-05:00","closed_at":"2026-01-16T23:44:20.214111225-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-o7bbu","depends_on_id":"hq-wisp-ywecn","type":"parent-child","created_at":"2026-01-16T23:43:58.55327949-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-o7bbu","depends_on_id":"hq-wisp-hqyxm","type":"blocks","created_at":"2026-01-16T23:44:00.657237718-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-o7e0b","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:50:35.396921308-05:00","updated_at":"2026-01-16T23:51:24.509341767-05:00","closed_at":"2026-01-16T23:51:24.509341767-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-o7e0b","depends_on_id":"hq-wisp-t8b5z","type":"parent-child","created_at":"2026-01-16T23:50:36.045816954-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-o7e0b","depends_on_id":"hq-wisp-67aiw","type":"blocks","created_at":"2026-01-16T23:50:38.509740494-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-o7el","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:54:43.649790928-05:00","updated_at":"2026-01-16T01:56:25.996110703-05:00","closed_at":"2026-01-16T01:56:25.996110703-05:00","close_reason":"Orphan cleanup","dependencies":[{"issue_id":"hq-wisp-o7el","depends_on_id":"hq-wisp-8okt","type":"parent-child","created_at":"2026-01-16T01:54:43.666955201-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-o7el","depends_on_id":"hq-wisp-i1a9","type":"blocks","created_at":"2026-01-16T01:54:43.704058828-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-o7iq4","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:54:08.829310025-05:00","updated_at":"2026-01-16T23:55:00.985955545-05:00","closed_at":"2026-01-16T23:55:00.985955545-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-o7iq4","depends_on_id":"hq-wisp-oecdp","type":"parent-child","created_at":"2026-01-16T23:54:09.477809068-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-o7iq4","depends_on_id":"hq-wisp-aejyz","type":"blocks","created_at":"2026-01-16T23:54:12.379531461-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-o909m","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:49:41.442011715-05:00","updated_at":"2026-01-16T23:50:34.900845064-05:00","closed_at":"2026-01-16T23:50:34.900845064-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-o909m","depends_on_id":"hq-wisp-q54v3","type":"parent-child","created_at":"2026-01-16T23:49:41.59425691-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-o909m","depends_on_id":"hq-wisp-jixob","type":"blocks","created_at":"2026-01-16T23:49:44.135969199-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-o98gy","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T10:47:55.316316494-05:00","updated_at":"2026-01-17T10:53:29.425920291-05:00","closed_at":"2026-01-17T10:53:29.425920291-05:00","close_reason":"Nothing to process","dependencies":[{"issue_id":"hq-wisp-o98gy","depends_on_id":"hq-wisp-9hr1x","type":"parent-child","created_at":"2026-01-17T10:47:55.437260299-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-o98gy","depends_on_id":"hq-wisp-mgzp1","type":"blocks","created_at":"2026-01-17T10:47:56.117112859-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-o9sho","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:43:06.008658492-05:00","updated_at":"2026-01-16T23:43:39.037937306-05:00","closed_at":"2026-01-16T23:43:39.037937306-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-o9sho","depends_on_id":"hq-wisp-p7g8j","type":"parent-child","created_at":"2026-01-16T23:43:06.334531418-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-o9sho","depends_on_id":"hq-wisp-gza76","type":"blocks","created_at":"2026-01-16T23:43:08.279579516-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-oa8fe","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:50:35.400787341-05:00","updated_at":"2026-01-16T23:51:22.8555033-05:00","closed_at":"2026-01-16T23:51:22.8555033-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-oa8fe","depends_on_id":"hq-wisp-t8b5z","type":"parent-child","created_at":"2026-01-16T23:50:36.966433483-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-oa8fe","depends_on_id":"hq-wisp-pubid","type":"blocks","created_at":"2026-01-16T23:50:39.70319611-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-oagy","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:53:28.897978727-05:00","updated_at":"2026-01-16T01:54:17.608456112-05:00","closed_at":"2026-01-16T01:54:17.608456112-05:00","close_reason":"Orphan cleanup","dependencies":[{"issue_id":"hq-wisp-oagy","depends_on_id":"hq-wisp-eke2","type":"parent-child","created_at":"2026-01-16T01:53:28.909916714-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-oagy","depends_on_id":"hq-wisp-myg7","type":"blocks","created_at":"2026-01-16T01:53:28.94849913-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-obln","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:55:03.037691074-05:00","updated_at":"2026-01-16T01:52:14.229521823-05:00","closed_at":"2026-01-16T01:52:14.229521823-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-obln","depends_on_id":"hq-wisp-7be","type":"parent-child","created_at":"2026-01-16T00:55:03.058478664-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-obln","depends_on_id":"hq-wisp-uuyy","type":"blocks","created_at":"2026-01-16T00:55:03.112528472-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ocw37","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:49:41.445576957-05:00","updated_at":"2026-01-16T23:50:28.065146521-05:00","closed_at":"2026-01-16T23:50:28.065146521-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-ocw37","depends_on_id":"hq-wisp-q54v3","type":"parent-child","created_at":"2026-01-16T23:49:42.576167713-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ocw37","depends_on_id":"hq-wisp-j48c1","type":"blocks","created_at":"2026-01-16T23:49:45.429473501-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-od1uw","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:12:55.891560144-05:00","updated_at":"2026-01-17T02:00:08.363794521-05:00","closed_at":"2026-01-17T02:00:08.363794521-05:00","close_reason":"Inbox already clean","dependencies":[{"issue_id":"hq-wisp-od1uw","depends_on_id":"hq-wisp-i2n82","type":"parent-child","created_at":"2026-01-17T01:13:05.656621648-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-od1uw","depends_on_id":"hq-wisp-9lhcg","type":"blocks","created_at":"2026-01-17T01:13:18.020535166-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-odcn","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:15:01.20015889-05:00","updated_at":"2026-01-16T23:18:55.927226468-05:00","closed_at":"2026-01-16T23:18:55.927226468-05:00","close_reason":"No cost wisps to digest","dependencies":[{"issue_id":"hq-wisp-odcn","depends_on_id":"hq-wisp-9osz","type":"parent-child","created_at":"2026-01-16T23:15:02.170551536-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-odcn","depends_on_id":"hq-wisp-co50","type":"blocks","created_at":"2026-01-16T23:15:03.600968699-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-oecdp","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:54:08.825260195-05:00","updated_at":"2026-01-16T23:55:04.76999316-05:00","closed_at":"2026-01-16T23:55:04.76999316-05:00","close_reason":"Patrol cycle 17 complete","ephemeral":true}
{"id":"hq-wisp-of0wi","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:53:25.148716421-05:00","updated_at":"2026-01-16T23:53:51.32869253-05:00","closed_at":"2026-01-16T23:53:51.32869253-05:00","close_reason":"Patrol 20 complete","ephemeral":true}
{"id":"hq-wisp-ogebh","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:46:10.402031591-05:00","updated_at":"2026-01-17T10:46:10.402031633-05:00","dependencies":[{"issue_id":"hq-wisp-ogebh","depends_on_id":"hq-wisp-bio5t","type":"parent-child","created_at":"2026-01-17T10:46:10.472130008-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ogebh","depends_on_id":"hq-wisp-tt8zk","type":"blocks","created_at":"2026-01-17T10:46:10.82581501-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-oj97c","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:08:16.851007967-05:00","updated_at":"2026-01-17T01:10:46.203115385-05:00","closed_at":"2026-01-17T01:10:46.203115385-05:00","close_reason":"Final patrol","dependencies":[{"issue_id":"hq-wisp-oj97c","depends_on_id":"hq-wisp-vrsc5","type":"parent-child","created_at":"2026-01-17T01:08:22.303886764-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-oj97c","depends_on_id":"hq-wisp-6my2t","type":"blocks","created_at":"2026-01-17T01:08:34.471847589-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ojaf","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:22:20.089396574-05:00","updated_at":"2026-01-16T01:52:14.025137754-05:00","closed_at":"2026-01-16T01:52:14.025137754-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-ojaf","depends_on_id":"hq-wisp-gvqg","type":"parent-child","created_at":"2026-01-16T01:22:20.181086187-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ojaf","depends_on_id":"hq-wisp-zbtb","type":"blocks","created_at":"2026-01-16T01:22:20.294639194-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ojmum","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:31:03.248751332-05:00","updated_at":"2026-01-17T00:31:24.723370515-05:00","closed_at":"2026-01-17T00:31:24.723370515-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-ojmum","depends_on_id":"hq-wisp-apmz9","type":"parent-child","created_at":"2026-01-17T00:31:05.302766471-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ojmum","depends_on_id":"hq-wisp-zizic","type":"blocks","created_at":"2026-01-17T00:31:10.562115197-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-oju6w","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:43:00.956487158-05:00","updated_at":"2026-01-17T00:51:13.485179908-05:00","closed_at":"2026-01-17T00:51:13.485179908-05:00","close_reason":"No notifications pending","dependencies":[{"issue_id":"hq-wisp-oju6w","depends_on_id":"hq-wisp-jgnad","type":"parent-child","created_at":"2026-01-17T00:43:03.810270975-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-oju6w","depends_on_id":"hq-wisp-brdrk","type":"blocks","created_at":"2026-01-17T00:43:12.392172561-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-okmju","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:54:08.828112651-05:00","updated_at":"2026-01-16T23:55:02.002034064-05:00","closed_at":"2026-01-16T23:55:02.002034064-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-okmju","depends_on_id":"hq-wisp-oecdp","type":"parent-child","created_at":"2026-01-16T23:54:09.158698022-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-okmju","depends_on_id":"hq-wisp-aejyz","type":"blocks","created_at":"2026-01-16T23:54:12.058451124-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ol9r","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:36:59.340788203-05:00","updated_at":"2026-01-16T23:38:15.821151751-05:00","closed_at":"2026-01-16T23:38:15.821151751-05:00","close_reason":"No convoy completions or cross-rig resolutions to notify","dependencies":[{"issue_id":"hq-wisp-ol9r","depends_on_id":"hq-wisp-c8tl","type":"parent-child","created_at":"2026-01-16T23:36:59.830918473-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ol9r","depends_on_id":"hq-wisp-k59d","type":"blocks","created_at":"2026-01-16T23:37:01.304763741-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-omhx","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:15:01.197736516-05:00","updated_at":"2026-01-16T23:18:37.835124346-05:00","closed_at":"2026-01-16T23:18:37.835124346-05:00","close_reason":"No zombies, dog pool present","dependencies":[{"issue_id":"hq-wisp-omhx","depends_on_id":"hq-wisp-9osz","type":"parent-child","created_at":"2026-01-16T23:15:01.753531593-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-omhx","depends_on_id":"hq-wisp-65g1","type":"blocks","created_at":"2026-01-16T23:15:03.160737511-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-omk3","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:56:35.921985351-05:00","updated_at":"2026-01-16T22:13:02.184652487-05:00","closed_at":"2026-01-16T22:13:02.184652487-05:00","close_reason":"Orphaned - forced cleanup","dependencies":[{"issue_id":"hq-wisp-omk3","depends_on_id":"hq-wisp-8d7d","type":"parent-child","created_at":"2026-01-16T01:56:35.948608114-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-omk3","depends_on_id":"hq-wisp-brq0","type":"blocks","created_at":"2026-01-16T01:56:35.998541684-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-omwnx","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:52:58.279913425-05:00","updated_at":"2026-01-16T23:53:16.550692494-05:00","closed_at":"2026-01-16T23:53:16.550692494-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-omwnx","depends_on_id":"hq-wisp-a5ye3","type":"parent-child","created_at":"2026-01-16T23:52:59.919835913-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-omwnx","depends_on_id":"hq-wisp-3bz1l","type":"blocks","created_at":"2026-01-16T23:53:03.242841774-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-omz23","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:08:16.849186803-05:00","updated_at":"2026-01-17T01:10:30.19769759-05:00","closed_at":"2026-01-17T01:10:30.19769759-05:00","close_reason":"Final patrol","dependencies":[{"issue_id":"hq-wisp-omz23","depends_on_id":"hq-wisp-vrsc5","type":"parent-child","created_at":"2026-01-17T01:08:21.09284941-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-omz23","depends_on_id":"hq-wisp-izxww","type":"blocks","created_at":"2026-01-17T01:08:32.007968405-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-omz23","depends_on_id":"hq-wisp-feju9","type":"blocks","created_at":"2026-01-17T01:08:32.625573938-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-omz23","depends_on_id":"hq-wisp-50byl","type":"blocks","created_at":"2026-01-17T01:08:33.239110852-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-on4vb","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:49:35.725030289-05:00","updated_at":"2026-01-16T23:50:18.516348538-05:00","closed_at":"2026-01-16T23:50:18.516348538-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-on4vb","depends_on_id":"hq-wisp-n4f70","type":"parent-child","created_at":"2026-01-16T23:49:37.626870328-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-on4vb","depends_on_id":"hq-wisp-c5vaz","type":"blocks","created_at":"2026-01-16T23:49:40.37013445-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-onoh","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:26:29.475101586-05:00","updated_at":"2026-01-16T01:52:13.979456346-05:00","closed_at":"2026-01-16T01:52:13.979456346-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-onoh","depends_on_id":"hq-wisp-zv2x","type":"parent-child","created_at":"2026-01-16T01:26:29.516693626-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-onoh","depends_on_id":"hq-wisp-dspn","type":"blocks","created_at":"2026-01-16T01:26:29.633783879-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-op9m8","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:08:16.844890852-05:00","updated_at":"2026-01-17T01:10:06.231039185-05:00","closed_at":"2026-01-17T01:10:06.231039185-05:00","close_reason":"Final patrol","dependencies":[{"issue_id":"hq-wisp-op9m8","depends_on_id":"hq-wisp-vrsc5","type":"parent-child","created_at":"2026-01-17T01:08:18.074407094-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-op9m8","depends_on_id":"hq-wisp-r347z","type":"blocks","created_at":"2026-01-17T01:08:28.973216864-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-oqqk3","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:48:51.082265135-05:00","updated_at":"2026-01-16T23:49:09.610638691-05:00","closed_at":"2026-01-16T23:49:09.610638691-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-oqqk3","depends_on_id":"hq-wisp-de87j","type":"parent-child","created_at":"2026-01-16T23:48:53.610857163-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-oqqk3","depends_on_id":"hq-wisp-qlnhf","type":"blocks","created_at":"2026-01-16T23:48:56.48557386-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-osuqu","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T00:43:43.372357764-05:00","updated_at":"2026-01-17T00:44:04.540964982-05:00","closed_at":"2026-01-17T00:44:04.540964982-05:00","close_reason":"OK","ephemeral":true}
{"id":"hq-wisp-otr7","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:26:29.478237416-05:00","updated_at":"2026-01-16T01:52:13.902689012-05:00","closed_at":"2026-01-16T01:52:13.902689012-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-otr7","depends_on_id":"hq-wisp-zv2x","type":"parent-child","created_at":"2026-01-16T01:26:29.59311413-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-otr7","depends_on_id":"hq-wisp-gb4c","type":"blocks","created_at":"2026-01-16T01:26:29.736805397-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-oujdk","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:08:16.859305746-05:00","updated_at":"2026-01-17T01:10:59.681479641-05:00","closed_at":"2026-01-17T01:10:59.681479641-05:00","close_reason":"Final patrol","dependencies":[{"issue_id":"hq-wisp-oujdk","depends_on_id":"hq-wisp-vrsc5","type":"parent-child","created_at":"2026-01-17T01:08:27.155151127-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-oujdk","depends_on_id":"hq-wisp-kbwbc","type":"blocks","created_at":"2026-01-17T01:08:39.366521176-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ovsbe","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:07:28.971810466-05:00","updated_at":"2026-01-17T01:09:13.874528736-05:00","closed_at":"2026-01-17T01:09:13.874528736-05:00","close_reason":"No abandoned work","dependencies":[{"issue_id":"hq-wisp-ovsbe","depends_on_id":"hq-wisp-fnimo","type":"parent-child","created_at":"2026-01-17T01:07:35.999873838-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ovsbe","depends_on_id":"hq-wisp-ehvhp","type":"blocks","created_at":"2026-01-17T01:07:47.672772855-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ovv7","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:21:24.470624219-05:00","updated_at":"2026-01-16T23:23:17.153429826-05:00","closed_at":"2026-01-16T23:23:17.153429826-05:00","close_reason":"No orphaned work","dependencies":[{"issue_id":"hq-wisp-ovv7","depends_on_id":"hq-wisp-87xr","type":"parent-child","created_at":"2026-01-16T23:21:25.470249967-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ovv7","depends_on_id":"hq-wisp-1go3","type":"blocks","created_at":"2026-01-16T23:21:27.207329789-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-owgs","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:53:28.906978467-05:00","updated_at":"2026-01-16T01:54:17.550151425-05:00","closed_at":"2026-01-16T01:54:17.550151425-05:00","close_reason":"Orphan cleanup","dependencies":[{"issue_id":"hq-wisp-owgs","depends_on_id":"hq-wisp-eke2","type":"parent-child","created_at":"2026-01-16T01:53:28.946385007-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-owgs","depends_on_id":"hq-wisp-4faw","type":"blocks","created_at":"2026-01-16T01:53:29.001670197-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-owh0h","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:12:55.889524064-05:00","updated_at":"2026-01-17T02:00:06.389086085-05:00","closed_at":"2026-01-17T02:00:06.389086085-05:00","close_reason":"Cost aggregation skipped","dependencies":[{"issue_id":"hq-wisp-owh0h","depends_on_id":"hq-wisp-i2n82","type":"parent-child","created_at":"2026-01-17T01:13:04.442242132-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-owh0h","depends_on_id":"hq-wisp-0x7f1","type":"blocks","created_at":"2026-01-17T01:13:16.782078396-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-owhh","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T22:09:21.461776215-05:00","updated_at":"2026-01-16T22:11:31.675418563-05:00","closed_at":"2026-01-16T22:11:31.675418563-05:00","close_reason":"Already digested","ephemeral":true}
{"id":"hq-wisp-owue","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:53:28.905512343-05:00","updated_at":"2026-01-16T01:54:17.569786321-05:00","closed_at":"2026-01-16T01:54:17.569786321-05:00","close_reason":"Orphan cleanup","dependencies":[{"issue_id":"hq-wisp-owue","depends_on_id":"hq-wisp-eke2","type":"parent-child","created_at":"2026-01-16T01:53:28.936359893-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-owue","depends_on_id":"hq-wisp-swrk","type":"blocks","created_at":"2026-01-16T01:53:28.985692673-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-p1tv","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T22:08:59.26732252-05:00","updated_at":"2026-01-16T22:12:13.833462379-05:00","closed_at":"2026-01-16T22:12:13.833462379-05:00","close_reason":"Orphaned - bulk cleanup","ephemeral":true}
{"id":"hq-wisp-p21sr","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:00:26.067870966-05:00","updated_at":"2026-01-17T01:02:07.249964544-05:00","closed_at":"2026-01-17T01:02:07.249964544-05:00","close_reason":"Context low","dependencies":[{"issue_id":"hq-wisp-p21sr","depends_on_id":"hq-wisp-5yxyi","type":"parent-child","created_at":"2026-01-17T01:00:35.465611855-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-p21sr","depends_on_id":"hq-wisp-m89eg","type":"blocks","created_at":"2026-01-17T01:00:46.604226717-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-p2ml2","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:02:45.691788977-05:00","updated_at":"2026-01-17T01:05:11.954782288-05:00","closed_at":"2026-01-17T01:05:11.954782288-05:00","close_reason":"Idle town patrol","dependencies":[{"issue_id":"hq-wisp-p2ml2","depends_on_id":"hq-wisp-ji9jj","type":"parent-child","created_at":"2026-01-17T01:02:48.039428624-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-p2ml2","depends_on_id":"hq-wisp-3vhl0","type":"blocks","created_at":"2026-01-17T01:02:58.620505152-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-p67t7","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:46:10.408528671-05:00","updated_at":"2026-01-17T10:46:10.408528671-05:00","dependencies":[{"issue_id":"hq-wisp-p67t7","depends_on_id":"hq-wisp-bio5t","type":"parent-child","created_at":"2026-01-17T10:46:10.631299249-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-p67t7","depends_on_id":"hq-wisp-jyac5","type":"blocks","created_at":"2026-01-17T10:46:11.035807429-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-p6n3y","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:49:59.363838121-05:00","updated_at":"2026-01-17T10:49:59.363838163-05:00","dependencies":[{"issue_id":"hq-wisp-p6n3y","depends_on_id":"hq-wisp-wxw0u","type":"parent-child","created_at":"2026-01-17T10:50:00.077619412-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-p6n3y","depends_on_id":"hq-wisp-eazru","type":"blocks","created_at":"2026-01-17T10:50:01.059235087-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-p6rd5","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:50:35.401828047-05:00","updated_at":"2026-01-16T23:51:22.419647805-05:00","closed_at":"2026-01-16T23:51:22.419647805-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-p6rd5","depends_on_id":"hq-wisp-t8b5z","type":"parent-child","created_at":"2026-01-16T23:50:37.225895449-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-p6rd5","depends_on_id":"hq-wisp-nwsic","type":"blocks","created_at":"2026-01-16T23:50:39.967422489-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-p6wj3","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:47:34.371959527-05:00","updated_at":"2026-01-16T23:49:13.570352332-05:00","closed_at":"2026-01-16T23:49:13.570352332-05:00","close_reason":"Town idle patrol","dependencies":[{"issue_id":"hq-wisp-p6wj3","depends_on_id":"hq-wisp-ql31w","type":"parent-child","created_at":"2026-01-16T23:47:35.560571901-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-p6wj3","depends_on_id":"hq-wisp-16ked","type":"blocks","created_at":"2026-01-16T23:47:37.960651929-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-p7g8j","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:43:06.005147799-05:00","updated_at":"2026-01-16T23:43:42.781968572-05:00","closed_at":"2026-01-16T23:43:42.781968572-05:00","close_reason":"Patrol cycle 8 complete","ephemeral":true}
{"id":"hq-wisp-p7jwn","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:24:43.302540658-05:00","updated_at":"2026-01-17T00:25:25.421828567-05:00","closed_at":"2026-01-17T00:25:25.421828567-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-p7jwn","depends_on_id":"hq-wisp-5fw2b","type":"parent-child","created_at":"2026-01-17T00:24:46.224390267-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-p7jwn","depends_on_id":"hq-wisp-l8g7z","type":"blocks","created_at":"2026-01-17T00:24:50.200821041-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-p7kp6","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:09:41.608326392-05:00","updated_at":"2026-01-17T01:10:36.693522828-05:00","closed_at":"2026-01-17T01:10:36.693522828-05:00","close_reason":"No external deps","dependencies":[{"issue_id":"hq-wisp-p7kp6","depends_on_id":"hq-wisp-fsms9","type":"parent-child","created_at":"2026-01-17T01:09:44.604029031-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-p7kp6","depends_on_id":"hq-wisp-usgke","type":"blocks","created_at":"2026-01-17T01:09:55.600468551-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-p803c","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T10:43:55.70324007-05:00","updated_at":"2026-01-17T10:44:32.064979446-05:00","closed_at":"2026-01-17T10:44:32.064979446-05:00","close_reason":"Patrol 5 complete","ephemeral":true}
{"id":"hq-wisp-p8lln","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:28:49.924877355-05:00","updated_at":"2026-01-17T00:29:02.323672245-05:00","closed_at":"2026-01-17T00:29:02.323672245-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-p8lln","depends_on_id":"hq-wisp-9l1zx","type":"parent-child","created_at":"2026-01-17T00:28:50.383753567-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-p8lln","depends_on_id":"hq-wisp-nxinm","type":"blocks","created_at":"2026-01-17T00:28:54.388877533-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-p8n2g","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T01:05:32.481112508-05:00","updated_at":"2026-01-17T01:07:24.211889251-05:00","closed_at":"2026-01-17T01:07:24.211889251-05:00","close_reason":"Patrol #19: idle town","ephemeral":true}
{"id":"hq-wisp-p9ofh","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:46:50.726159205-05:00","updated_at":"2026-01-17T10:46:50.726159205-05:00","dependencies":[{"issue_id":"hq-wisp-p9ofh","depends_on_id":"hq-wisp-2vhlh","type":"parent-child","created_at":"2026-01-17T10:46:50.963825774-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-p9ofh","depends_on_id":"hq-wisp-bm8pk","type":"blocks","created_at":"2026-01-17T10:46:51.497156545-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-pahey","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:52:50.338877478-05:00","updated_at":"2026-01-17T00:56:23.555910535-05:00","closed_at":"2026-01-17T00:56:23.555910535-05:00","close_reason":"Context low","dependencies":[{"issue_id":"hq-wisp-pahey","depends_on_id":"hq-wisp-xo3wl","type":"parent-child","created_at":"2026-01-17T00:52:59.608210314-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-pahey","depends_on_id":"hq-wisp-vgahj","type":"blocks","created_at":"2026-01-17T00:53:10.58739373-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-pahrl","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:50:53.901687262-05:00","updated_at":"2026-01-16T23:51:21.104419034-05:00","closed_at":"2026-01-16T23:51:21.104419034-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-pahrl","depends_on_id":"hq-wisp-47par","type":"parent-child","created_at":"2026-01-16T23:50:56.457189863-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-pahrl","depends_on_id":"hq-wisp-guj80","type":"blocks","created_at":"2026-01-16T23:50:59.350210285-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-pb3lr","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:50:35.403945084-05:00","updated_at":"2026-01-16T23:51:21.546385774-05:00","closed_at":"2026-01-16T23:51:21.546385774-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-pb3lr","depends_on_id":"hq-wisp-t8b5z","type":"parent-child","created_at":"2026-01-16T23:50:37.755332663-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-pb3lr","depends_on_id":"hq-wisp-pxji4","type":"blocks","created_at":"2026-01-16T23:50:40.514550856-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-pbcd8","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:39:29.834777967-05:00","updated_at":"2026-01-17T00:35:48.417958011-05:00","closed_at":"2026-01-17T00:35:48.417958011-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-pblh","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:55:36.783315251-05:00","updated_at":"2026-01-16T01:56:25.973096853-05:00","closed_at":"2026-01-16T01:56:25.973096853-05:00","close_reason":"Orphan cleanup","dependencies":[{"issue_id":"hq-wisp-pblh","depends_on_id":"hq-wisp-ndqt","type":"parent-child","created_at":"2026-01-16T01:55:36.853996049-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-pblh","depends_on_id":"hq-wisp-gjda","type":"blocks","created_at":"2026-01-16T01:55:36.993581147-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-pbux","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:26:29.477760916-05:00","updated_at":"2026-01-16T01:52:13.916091373-05:00","closed_at":"2026-01-16T01:52:13.916091373-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-pbux","depends_on_id":"hq-wisp-zv2x","type":"parent-child","created_at":"2026-01-16T01:26:29.580490268-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-pby1","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","assignee":"deacon","created_at":"2026-01-16T22:15:40.014531841-05:00","updated_at":"2026-01-17T00:36:32.243459902-05:00","closed_at":"2026-01-17T00:36:32.243459902-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-pc777","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:45:48.834076051-05:00","updated_at":"2026-01-16T23:46:22.269975913-05:00","closed_at":"2026-01-16T23:46:22.269975913-05:00","close_reason":"Inbox empty","dependencies":[{"issue_id":"hq-wisp-pc777","depends_on_id":"hq-wisp-2heyl","type":"parent-child","created_at":"2026-01-16T23:45:48.846421172-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-pced7","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:04:43.447534554-05:00","updated_at":"2026-01-17T01:07:20.192644627-05:00","closed_at":"2026-01-17T01:07:20.192644627-05:00","close_reason":"Inbox clear","dependencies":[{"issue_id":"hq-wisp-pced7","depends_on_id":"hq-wisp-bkl5l","type":"parent-child","created_at":"2026-01-17T01:04:52.99507802-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-pced7","depends_on_id":"hq-wisp-n20i2","type":"blocks","created_at":"2026-01-17T01:05:04.945166068-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-pdlug","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:43:06.013967947-05:00","updated_at":"2026-01-16T23:43:30.352663816-05:00","closed_at":"2026-01-16T23:43:30.352663816-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-pdlug","depends_on_id":"hq-wisp-p7g8j","type":"parent-child","created_at":"2026-01-16T23:43:07.519274131-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-pdlug","depends_on_id":"hq-wisp-motjv","type":"blocks","created_at":"2026-01-16T23:43:09.772453401-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-peu9","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:27:24.239015217-05:00","updated_at":"2026-01-16T01:52:13.73219274-05:00","closed_at":"2026-01-16T01:52:13.73219274-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-peu9","depends_on_id":"hq-wisp-nv4o","type":"parent-child","created_at":"2026-01-16T01:27:24.377511989-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-pex77","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:41:51.254935935-05:00","updated_at":"2026-01-16T23:42:47.915571638-05:00","closed_at":"2026-01-16T23:42:47.915571638-05:00","close_reason":"Routine checks passed","dependencies":[{"issue_id":"hq-wisp-pex77","depends_on_id":"hq-wisp-tnkch","type":"parent-child","created_at":"2026-01-16T23:41:52.925872553-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-pex77","depends_on_id":"hq-wisp-rtzni","type":"blocks","created_at":"2026-01-16T23:41:55.058111819-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-pezd","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T22:24:13.391696319-05:00","updated_at":"2026-01-17T00:36:20.34315259-05:00","closed_at":"2026-01-17T00:36:20.34315259-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-pfs9","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:19:36.428597656-05:00","updated_at":"2026-01-17T00:36:00.16616564-05:00","closed_at":"2026-01-17T00:36:00.16616564-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-pgkuw","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:24:43.299379624-05:00","updated_at":"2026-01-17T00:25:16.281389815-05:00","closed_at":"2026-01-17T00:25:16.281389815-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-pgkuw","depends_on_id":"hq-wisp-5fw2b","type":"parent-child","created_at":"2026-01-17T00:24:45.244622784-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-pgkuw","depends_on_id":"hq-wisp-nek75","type":"blocks","created_at":"2026-01-17T00:24:49.196030106-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-pk0oq","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:51:56.837763396-05:00","updated_at":"2026-01-16T23:52:19.927765608-05:00","closed_at":"2026-01-16T23:52:19.927765608-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-pk0oq","depends_on_id":"hq-wisp-ri9se","type":"parent-child","created_at":"2026-01-16T23:51:59.793686852-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-pk0oq","depends_on_id":"hq-wisp-ypq6q","type":"blocks","created_at":"2026-01-16T23:52:03.158249326-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-plca","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:05:01.101808468-05:00","updated_at":"2026-01-16T22:13:02.043214333-05:00","closed_at":"2026-01-16T22:13:02.043214333-05:00","close_reason":"Orphaned - forced cleanup","dependencies":[{"issue_id":"hq-wisp-plca","depends_on_id":"hq-wisp-xrtb","type":"parent-child","created_at":"2026-01-16T22:05:01.145120163-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-plca","depends_on_id":"hq-wisp-gl6e","type":"blocks","created_at":"2026-01-16T22:05:01.288129358-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-plkuf","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:02:22.55607911-05:00","updated_at":"2026-01-17T01:04:16.916196443-05:00","closed_at":"2026-01-17T01:04:16.916196443-05:00","close_reason":"Dog pool adequate","dependencies":[{"issue_id":"hq-wisp-plkuf","depends_on_id":"hq-wisp-xwv1q","type":"parent-child","created_at":"2026-01-17T01:02:28.409912395-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-plkuf","depends_on_id":"hq-wisp-pz700","type":"blocks","created_at":"2026-01-17T01:02:39.928006344-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-pltm","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:46:01.529335659-05:00","updated_at":"2026-01-16T01:47:47.690399595-05:00","closed_at":"2026-01-16T01:47:47.690399595-05:00","close_reason":"No pending gates to evaluate","dependencies":[{"issue_id":"hq-wisp-pltm","depends_on_id":"hq-wisp-xunp","type":"parent-child","created_at":"2026-01-16T01:46:01.553243758-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-pltm","depends_on_id":"hq-wisp-1ggz","type":"blocks","created_at":"2026-01-16T01:46:01.728839609-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-pm9i0","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:49:41.450604945-05:00","updated_at":"2026-01-16T23:50:11.796308148-05:00","closed_at":"2026-01-16T23:50:11.796308148-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-pm9i0","depends_on_id":"hq-wisp-q54v3","type":"parent-child","created_at":"2026-01-16T23:49:43.572365567-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-pm9i0","depends_on_id":"hq-wisp-1oo3m","type":"blocks","created_at":"2026-01-16T23:49:46.44897451-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-pnhq6","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:24:43.296166466-05:00","updated_at":"2026-01-17T00:25:09.494833216-05:00","closed_at":"2026-01-17T00:25:09.494833216-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-pnhq6","depends_on_id":"hq-wisp-5fw2b","type":"parent-child","created_at":"2026-01-17T00:24:44.27054102-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-pnhq6","depends_on_id":"hq-wisp-55yh5","type":"blocks","created_at":"2026-01-17T00:24:47.798324805-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-pq83c","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:12:55.882894449-05:00","updated_at":"2026-01-17T01:59:28.344010137-05:00","closed_at":"2026-01-17T01:59:28.344010137-05:00","close_reason":"No notifications needed, town idle","dependencies":[{"issue_id":"hq-wisp-pq83c","depends_on_id":"hq-wisp-i2n82","type":"parent-child","created_at":"2026-01-17T01:12:59.56477356-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-pq83c","depends_on_id":"hq-wisp-u2e0z","type":"blocks","created_at":"2026-01-17T01:13:10.58600668-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-pqco","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:46:01.528976409-05:00","updated_at":"2026-01-16T01:47:33.540735887-05:00","closed_at":"2026-01-16T01:47:33.540735887-05:00","close_reason":"No pending spawns, gt deacon pending not yet implemented","dependencies":[{"issue_id":"hq-wisp-pqco","depends_on_id":"hq-wisp-xunp","type":"parent-child","created_at":"2026-01-16T01:46:01.543760518-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-pqco","depends_on_id":"hq-wisp-1ggz","type":"blocks","created_at":"2026-01-16T01:46:01.718657204-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ptk","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T00:42:55.358211491-05:00","updated_at":"2026-01-16T01:50:39.573321793-05:00","closed_at":"2026-01-16T01:50:39.573321793-05:00","close_reason":"Stale patrol wisp cleanup","ephemeral":true}
{"id":"hq-wisp-ptlb","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T22:43:13.998712363-05:00","updated_at":"2026-01-17T00:36:17.844134894-05:00","closed_at":"2026-01-17T00:36:17.844134894-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-ptsl","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:55:09.579074587-05:00","updated_at":"2026-01-16T00:55:16.033825699-05:00","closed_at":"2026-01-16T00:55:16.033825699-05:00","close_reason":"Town healthy","dependencies":[{"issue_id":"hq-wisp-ptsl","depends_on_id":"hq-wisp-3o9w","type":"parent-child","created_at":"2026-01-16T00:55:09.616132641-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ptsl","depends_on_id":"hq-wisp-rvcm","type":"blocks","created_at":"2026-01-16T00:55:09.713456629-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ptsl","depends_on_id":"hq-wisp-0iru","type":"blocks","created_at":"2026-01-16T00:55:09.719024923-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-pubid","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:50:35.400251592-05:00","updated_at":"2026-01-16T23:51:23.011592429-05:00","closed_at":"2026-01-16T23:51:23.011592429-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-pubid","depends_on_id":"hq-wisp-t8b5z","type":"parent-child","created_at":"2026-01-16T23:50:36.835064794-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-pubid","depends_on_id":"hq-wisp-y039q","type":"blocks","created_at":"2026-01-16T23:50:39.571608004-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-puhr","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:05:01.101208136-05:00","updated_at":"2026-01-16T22:13:02.0490242-05:00","closed_at":"2026-01-16T22:13:02.0490242-05:00","close_reason":"Orphaned - forced cleanup","dependencies":[{"issue_id":"hq-wisp-puhr","depends_on_id":"hq-wisp-xrtb","type":"parent-child","created_at":"2026-01-16T22:05:01.129477725-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-puhr","depends_on_id":"hq-wisp-o2ep","type":"blocks","created_at":"2026-01-16T22:05:01.272063961-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-pusme","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:47:34.37141553-05:00","updated_at":"2026-01-16T23:49:13.715726-05:00","closed_at":"2026-01-16T23:49:13.715726-05:00","close_reason":"Town idle patrol","dependencies":[{"issue_id":"hq-wisp-pusme","depends_on_id":"hq-wisp-ql31w","type":"parent-child","created_at":"2026-01-16T23:47:35.442338902-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-pusme","depends_on_id":"hq-wisp-9mvk9","type":"blocks","created_at":"2026-01-16T23:47:37.839128907-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-putuv","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:37:49.091415641-05:00","updated_at":"2026-01-16T23:40:12.921359298-05:00","closed_at":"2026-01-16T23:40:12.921359298-05:00","close_reason":"dog pool maintenance not implemented","dependencies":[{"issue_id":"hq-wisp-putuv","depends_on_id":"hq-wisp-2zuj","type":"parent-child","created_at":"2026-01-16T23:37:49.988082899-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-putuv","depends_on_id":"hq-wisp-qdxl","type":"blocks","created_at":"2026-01-16T23:37:51.800056622-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-pv2xc","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:47:34.374517053-05:00","updated_at":"2026-01-16T23:49:12.249652509-05:00","closed_at":"2026-01-16T23:49:12.249652509-05:00","close_reason":"Town idle patrol","dependencies":[{"issue_id":"hq-wisp-pv2xc","depends_on_id":"hq-wisp-ql31w","type":"parent-child","created_at":"2026-01-16T23:47:36.154928213-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-pv2xc","depends_on_id":"hq-wisp-uxuhw","type":"blocks","created_at":"2026-01-16T23:47:38.57313909-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-pwlv2","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:47:34.375552964-05:00","updated_at":"2026-01-16T23:49:11.907163248-05:00","closed_at":"2026-01-16T23:49:11.907163248-05:00","close_reason":"Town idle patrol","dependencies":[{"issue_id":"hq-wisp-pwlv2","depends_on_id":"hq-wisp-ql31w","type":"parent-child","created_at":"2026-01-16T23:47:36.400839155-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-pwlv2","depends_on_id":"hq-wisp-yr729","type":"blocks","created_at":"2026-01-16T23:47:38.823917795-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-px9wd","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:03:11.637850999-05:00","updated_at":"2026-01-17T01:04:06.645720523-05:00","closed_at":"2026-01-17T01:04:06.645720523-05:00","close_reason":"No notifications","dependencies":[{"issue_id":"hq-wisp-px9wd","depends_on_id":"hq-wisp-zx2sm","type":"parent-child","created_at":"2026-01-17T01:03:15.235102372-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-px9wd","depends_on_id":"hq-wisp-traed","type":"blocks","created_at":"2026-01-17T01:03:26.074782428-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-pxji4","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:50:35.403432794-05:00","updated_at":"2026-01-16T23:51:21.774473222-05:00","closed_at":"2026-01-16T23:51:21.774473222-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-pxji4","depends_on_id":"hq-wisp-t8b5z","type":"parent-child","created_at":"2026-01-16T23:50:37.615877771-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-pxji4","depends_on_id":"hq-wisp-cbau5","type":"blocks","created_at":"2026-01-16T23:50:40.375480964-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-pxy4c","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:58:39.902377578-05:00","updated_at":"2026-01-17T01:00:13.075746351-05:00","closed_at":"2026-01-17T01:00:13.075746351-05:00","close_reason":"Inbox clear","dependencies":[{"issue_id":"hq-wisp-pxy4c","depends_on_id":"hq-wisp-0nlhz","type":"parent-child","created_at":"2026-01-17T00:58:48.656522647-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-pxy4c","depends_on_id":"hq-wisp-iybfy","type":"blocks","created_at":"2026-01-17T00:58:59.744278998-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-py5p","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T01:26:29.040815913-05:00","updated_at":"2026-01-16T01:50:39.307319417-05:00","closed_at":"2026-01-16T01:50:39.307319417-05:00","close_reason":"Stale patrol wisp cleanup","ephemeral":true}
{"id":"hq-wisp-py9k5","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:43:56.991725859-05:00","updated_at":"2026-01-16T23:44:34.017262068-05:00","closed_at":"2026-01-16T23:44:34.017262068-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-py9k5","depends_on_id":"hq-wisp-ywecn","type":"parent-child","created_at":"2026-01-16T23:43:57.406904472-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-py9k5","depends_on_id":"hq-wisp-n8jfa","type":"blocks","created_at":"2026-01-16T23:43:59.279734146-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-pz700","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:02:22.553494697-05:00","updated_at":"2026-01-17T01:04:15.084120262-05:00","closed_at":"2026-01-17T01:04:15.084120262-05:00","close_reason":"Town idle, health check skipped","dependencies":[{"issue_id":"hq-wisp-pz700","depends_on_id":"hq-wisp-xwv1q","type":"parent-child","created_at":"2026-01-17T01:02:26.679752207-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-pz700","depends_on_id":"hq-wisp-uw9ll","type":"blocks","created_at":"2026-01-17T01:02:37.050483145-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-pz700","depends_on_id":"hq-wisp-7es1a","type":"blocks","created_at":"2026-01-17T01:02:37.628047999-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-pz700","depends_on_id":"hq-wisp-zb7b0","type":"blocks","created_at":"2026-01-17T01:02:38.198476113-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-pza0c","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:40:19.87619665-05:00","updated_at":"2026-01-16T23:41:29.425745754-05:00","closed_at":"2026-01-16T23:41:29.425745754-05:00","close_reason":"No issues found","dependencies":[{"issue_id":"hq-wisp-pza0c","depends_on_id":"hq-wisp-6gnpy","type":"parent-child","created_at":"2026-01-16T23:40:20.757186703-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-pza0c","depends_on_id":"hq-wisp-v0zr6","type":"blocks","created_at":"2026-01-16T23:40:22.735467823-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-pzkc5","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:07:28.966113808-05:00","updated_at":"2026-01-17T01:08:54.121580077-05:00","closed_at":"2026-01-17T01:08:54.121580077-05:00","close_reason":"No external deps","dependencies":[{"issue_id":"hq-wisp-pzkc5","depends_on_id":"hq-wisp-fnimo","type":"parent-child","created_at":"2026-01-17T01:07:31.938191864-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-pzkc5","depends_on_id":"hq-wisp-3jtkw","type":"blocks","created_at":"2026-01-17T01:07:42.348957773-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-q1kb9","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:37:49.094920973-05:00","updated_at":"2026-01-16T23:45:34.085819401-05:00","closed_at":"2026-01-16T23:45:34.085819401-05:00","close_reason":"Patrol complete, looping","dependencies":[{"issue_id":"hq-wisp-q1kb9","depends_on_id":"hq-wisp-2zuj","type":"parent-child","created_at":"2026-01-16T23:37:50.710901138-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-q1kb9","depends_on_id":"hq-wisp-wrvnc","type":"blocks","created_at":"2026-01-16T23:37:52.544523234-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-q1z1","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:05:01.102111009-05:00","updated_at":"2026-01-16T22:13:02.037393423-05:00","closed_at":"2026-01-16T22:13:02.037393423-05:00","close_reason":"Orphaned - forced cleanup","dependencies":[{"issue_id":"hq-wisp-q1z1","depends_on_id":"hq-wisp-xrtb","type":"parent-child","created_at":"2026-01-16T22:05:01.152875487-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-q1z1","depends_on_id":"hq-wisp-plca","type":"blocks","created_at":"2026-01-16T22:05:01.296558305-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-q2pd6","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:04:43.444974017-05:00","updated_at":"2026-01-17T01:06:50.467842985-05:00","closed_at":"2026-01-17T01:06:50.467842985-05:00","close_reason":"No cleanup","dependencies":[{"issue_id":"hq-wisp-q2pd6","depends_on_id":"hq-wisp-bkl5l","type":"parent-child","created_at":"2026-01-17T01:04:51.102406642-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-q2pd6","depends_on_id":"hq-wisp-9rfof","type":"blocks","created_at":"2026-01-17T01:05:03.137615765-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-q40sq","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:23:02.710043332-05:00","updated_at":"2026-01-17T00:24:26.326405332-05:00","closed_at":"2026-01-17T00:24:26.326405332-05:00","close_reason":"Cycle complete","dependencies":[{"issue_id":"hq-wisp-q40sq","depends_on_id":"hq-wisp-93kdl","type":"parent-child","created_at":"2026-01-17T00:23:05.55543752-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-q40sq","depends_on_id":"hq-wisp-69zre","type":"blocks","created_at":"2026-01-17T00:23:09.508246477-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-q4pks","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:47:24.579177688-05:00","updated_at":"2026-01-17T10:47:24.57917773-05:00","dependencies":[{"issue_id":"hq-wisp-q4pks","depends_on_id":"hq-wisp-jag69","type":"parent-child","created_at":"2026-01-17T10:47:24.713509984-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-q4pks","depends_on_id":"hq-wisp-n9zhv","type":"blocks","created_at":"2026-01-17T10:47:25.274186365-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-q4z4","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:43:15.716976185-05:00","updated_at":"2026-01-16T21:44:37.87625469-05:00","closed_at":"2026-01-16T21:44:37.87625469-05:00","close_reason":"Closed","dependencies":[{"issue_id":"hq-wisp-q4z4","depends_on_id":"hq-wisp-l7vn","type":"parent-child","created_at":"2026-01-16T21:43:15.72946208-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-q4z4","depends_on_id":"hq-wisp-dn75","type":"blocks","created_at":"2026-01-16T21:43:15.790942679-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-q54v3","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:49:41.43994872-05:00","updated_at":"2026-01-16T23:50:42.540757867-05:00","closed_at":"2026-01-16T23:50:42.540757867-05:00","close_reason":"Patrol cycle 13 complete","ephemeral":true}
{"id":"hq-wisp-q5ety","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:07:28.972660173-05:00","updated_at":"2026-01-17T01:09:22.911701004-05:00","closed_at":"2026-01-17T01:09:22.911701004-05:00","close_reason":"No cleanup","dependencies":[{"issue_id":"hq-wisp-q5ety","depends_on_id":"hq-wisp-fnimo","type":"parent-child","created_at":"2026-01-17T01:07:36.580347013-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-q5ety","depends_on_id":"hq-wisp-ovsbe","type":"blocks","created_at":"2026-01-17T01:07:48.255079944-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-q5l5","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:54:43.650368678-05:00","updated_at":"2026-01-16T01:56:30.792990645-05:00","closed_at":"2026-01-16T01:56:30.792990645-05:00","close_reason":"Orphan cleanup","dependencies":[{"issue_id":"hq-wisp-q5l5","depends_on_id":"hq-wisp-8okt","type":"parent-child","created_at":"2026-01-16T01:54:43.670696072-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-q5l5","depends_on_id":"hq-wisp-ngen","type":"blocks","created_at":"2026-01-16T01:54:43.715309315-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-q79jk","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:08:16.847491889-05:00","updated_at":"2026-01-17T01:10:08.286077965-05:00","closed_at":"2026-01-17T01:10:08.286077965-05:00","close_reason":"Final patrol","dependencies":[{"issue_id":"hq-wisp-q79jk","depends_on_id":"hq-wisp-vrsc5","type":"parent-child","created_at":"2026-01-17T01:08:19.887010131-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-q79jk","depends_on_id":"hq-wisp-d0jmw","type":"blocks","created_at":"2026-01-17T01:08:30.799147464-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-q8xky","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:02:22.560095895-05:00","updated_at":"2026-01-17T01:04:37.743053754-05:00","closed_at":"2026-01-17T01:04:37.743053754-05:00","close_reason":"Log size OK","dependencies":[{"issue_id":"hq-wisp-q8xky","depends_on_id":"hq-wisp-xwv1q","type":"parent-child","created_at":"2026-01-17T01:02:31.279809356-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-q8xky","depends_on_id":"hq-wisp-nwwah","type":"blocks","created_at":"2026-01-17T01:02:42.832501251-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-qbxwu","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:49:59.361370706-05:00","updated_at":"2026-01-17T10:49:59.361370747-05:00","dependencies":[{"issue_id":"hq-wisp-qbxwu","depends_on_id":"hq-wisp-wxw0u","type":"parent-child","created_at":"2026-01-17T10:49:59.943236824-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-qbxwu","depends_on_id":"hq-wisp-i8q1e","type":"blocks","created_at":"2026-01-17T10:50:00.907845342-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-qd1hf","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"hooked","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T10:44:41.992408562-05:00","updated_at":"2026-01-17T10:44:42.886893178-05:00","ephemeral":true}
{"id":"hq-wisp-qdo07","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T10:47:55.314329079-05:00","updated_at":"2026-01-17T10:50:17.205103766-05:00","closed_at":"2026-01-17T10:50:17.205103766-05:00","close_reason":"Inbox empty, no callbacks","dependencies":[{"issue_id":"hq-wisp-qdo07","depends_on_id":"hq-wisp-9hr1x","type":"parent-child","created_at":"2026-01-17T10:47:55.326080447-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-qdxl","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:37:49.090075557-05:00","updated_at":"2026-01-16T23:39:56.526183207-05:00","closed_at":"2026-01-16T23:39:56.526183207-05:00","close_reason":"Town idle, skip health nudges per Idle Town Protocol","dependencies":[{"issue_id":"hq-wisp-qdxl","depends_on_id":"hq-wisp-2zuj","type":"parent-child","created_at":"2026-01-16T23:37:49.719688351-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-qdxl","depends_on_id":"hq-wisp-m53q","type":"blocks","created_at":"2026-01-16T23:37:51.344606598-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-qdxl","depends_on_id":"hq-wisp-ckn7","type":"blocks","created_at":"2026-01-16T23:37:51.434743461-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-qdxl","depends_on_id":"hq-wisp-enzl","type":"blocks","created_at":"2026-01-16T23:37:51.525059991-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-qe2w","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"hooked","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T22:38:22.262834645-05:00","updated_at":"2026-01-17T10:31:47.43651572-05:00","ephemeral":true}
{"id":"hq-wisp-qe6n6","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:46:50.731935035-05:00","updated_at":"2026-01-17T10:46:50.731935035-05:00","dependencies":[{"issue_id":"hq-wisp-qe6n6","depends_on_id":"hq-wisp-2vhlh","type":"parent-child","created_at":"2026-01-17T10:46:51.17038107-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-qe6n6","depends_on_id":"hq-wisp-wznph","type":"blocks","created_at":"2026-01-17T10:46:51.732566366-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-qf0sb","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:44:41.995214176-05:00","updated_at":"2026-01-17T10:44:41.995214218-05:00","dependencies":[{"issue_id":"hq-wisp-qf0sb","depends_on_id":"hq-wisp-qd1hf","type":"parent-child","created_at":"2026-01-17T10:44:42.036094521-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-qf0sb","depends_on_id":"hq-wisp-utk0g","type":"blocks","created_at":"2026-01-17T10:44:42.279769266-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-qfo","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T00:42:57.518147694-05:00","updated_at":"2026-01-16T01:50:39.545423449-05:00","closed_at":"2026-01-16T01:50:39.545423449-05:00","close_reason":"Stale patrol wisp cleanup","ephemeral":true}
{"id":"hq-wisp-qfy5q","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:43:56.995842233-05:00","updated_at":"2026-01-16T23:44:21.84510972-05:00","closed_at":"2026-01-16T23:44:21.84510972-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-qfy5q","depends_on_id":"hq-wisp-ywecn","type":"parent-child","created_at":"2026-01-16T23:43:58.3490221-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-qfy5q","depends_on_id":"hq-wisp-10avo","type":"blocks","created_at":"2026-01-16T23:44:00.440121871-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-qg7t","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T22:22:02.072441379-05:00","updated_at":"2026-01-17T00:36:21.293462503-05:00","closed_at":"2026-01-17T00:36:21.293462503-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-qhzl","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:00:24.740119434-05:00","updated_at":"2026-01-17T00:36:13.755240603-05:00","closed_at":"2026-01-17T00:36:13.755240603-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-qicx2","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:05:32.489214703-05:00","updated_at":"2026-01-17T01:06:18.306726272-05:00","closed_at":"2026-01-17T01:06:18.306726272-05:00","close_reason":"Idle town","dependencies":[{"issue_id":"hq-wisp-qicx2","depends_on_id":"hq-wisp-p8n2g","type":"parent-child","created_at":"2026-01-17T01:05:35.462882818-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-qicx2","depends_on_id":"hq-wisp-u33nw","type":"blocks","created_at":"2026-01-17T01:05:46.511763067-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-qjiet","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:44:42.002027484-05:00","updated_at":"2026-01-17T10:44:42.002027525-05:00","dependencies":[{"issue_id":"hq-wisp-qjiet","depends_on_id":"hq-wisp-qd1hf","type":"parent-child","created_at":"2026-01-17T10:44:42.172708296-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-qjiet","depends_on_id":"hq-wisp-cjylh","type":"blocks","created_at":"2026-01-17T10:44:42.465932271-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-qjzfm","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:04:43.436703821-05:00","updated_at":"2026-01-17T01:06:04.156058735-05:00","closed_at":"2026-01-17T01:06:04.156058735-05:00","close_reason":"No gate-ready","dependencies":[{"issue_id":"hq-wisp-qjzfm","depends_on_id":"hq-wisp-bkl5l","type":"parent-child","created_at":"2026-01-17T01:04:45.194859492-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-qjzfm","depends_on_id":"hq-wisp-fqic4","type":"blocks","created_at":"2026-01-17T01:04:55.990092927-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ql31w","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:47:34.363658577-05:00","updated_at":"2026-01-16T23:49:20.950751633-05:00","closed_at":"2026-01-16T23:49:20.950751633-05:00","close_reason":"Patrol cycle 8 complete, town idle","ephemeral":true}
{"id":"hq-wisp-ql8o","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:37:49.087721766-05:00","updated_at":"2026-01-16T23:38:43.602401682-05:00","closed_at":"2026-01-16T23:38:43.602401682-05:00","close_reason":"No open gates","dependencies":[{"issue_id":"hq-wisp-ql8o","depends_on_id":"hq-wisp-2zuj","type":"parent-child","created_at":"2026-01-16T23:37:49.273836159-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ql8o","depends_on_id":"hq-wisp-rf4o","type":"blocks","created_at":"2026-01-16T23:37:50.891758948-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-qlnhf","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:48:51.081725928-05:00","updated_at":"2026-01-16T23:49:12.832736971-05:00","closed_at":"2026-01-16T23:49:12.832736971-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-qlnhf","depends_on_id":"hq-wisp-de87j","type":"parent-child","created_at":"2026-01-16T23:48:53.464978745-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-qlnhf","depends_on_id":"hq-wisp-xoy8k","type":"blocks","created_at":"2026-01-16T23:48:56.340370149-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-qlqrm","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:46:10.411088586-05:00","updated_at":"2026-01-17T10:46:10.411088586-05:00","dependencies":[{"issue_id":"hq-wisp-qlqrm","depends_on_id":"hq-wisp-bio5t","type":"parent-child","created_at":"2026-01-17T10:46:10.709669869-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-qlqrm","depends_on_id":"hq-wisp-ieezk","type":"blocks","created_at":"2026-01-17T10:46:11.126612834-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-qn14e","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:46:56.440604972-05:00","updated_at":"2026-01-17T00:35:33.727718701-05:00","closed_at":"2026-01-17T00:35:33.727718701-05:00","close_reason":"Cleanup","ephemeral":true}
{"id":"hq-wisp-qolkq","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:02:45.69574143-05:00","updated_at":"2026-01-17T01:05:27.967546898-05:00","closed_at":"2026-01-17T01:05:27.967546898-05:00","close_reason":"Idle town patrol","dependencies":[{"issue_id":"hq-wisp-qolkq","depends_on_id":"hq-wisp-ji9jj","type":"parent-child","created_at":"2026-01-17T01:02:50.970477823-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-qolkq","depends_on_id":"hq-wisp-jstx7","type":"blocks","created_at":"2026-01-17T01:03:02.753740234-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-qph9y","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:07:28.977255291-05:00","updated_at":"2026-01-17T01:09:34.377216221-05:00","closed_at":"2026-01-17T01:09:34.377216221-05:00","close_reason":"Looping - patrol 19 of 20","dependencies":[{"issue_id":"hq-wisp-qph9y","depends_on_id":"hq-wisp-fnimo","type":"parent-child","created_at":"2026-01-17T01:07:39.470420905-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-qph9y","depends_on_id":"hq-wisp-bgrao","type":"blocks","created_at":"2026-01-17T01:07:51.187831644-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-qpxat","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T02:00:44.573301145-05:00","updated_at":"2026-01-17T02:01:53.91482803-05:00","closed_at":"2026-01-17T02:01:53.91482803-05:00","close_reason":"Idle patrol","dependencies":[{"issue_id":"hq-wisp-qpxat","depends_on_id":"hq-wisp-9a1wp","type":"parent-child","created_at":"2026-01-17T02:00:51.984042581-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-qpxat","depends_on_id":"hq-wisp-yw2sm","type":"blocks","created_at":"2026-01-17T02:01:04.702774824-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-qqhr","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:14:58.367611432-05:00","updated_at":"2026-01-17T00:36:01.720685123-05:00","closed_at":"2026-01-17T00:36:01.720685123-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-qqlky","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:47:53.506469146-05:00","updated_at":"2026-01-16T23:48:24.207434798-05:00","closed_at":"2026-01-16T23:48:24.207434798-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-qqlky","depends_on_id":"hq-wisp-wj52z","type":"parent-child","created_at":"2026-01-16T23:47:55.642513882-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-qqlky","depends_on_id":"hq-wisp-14v3d","type":"blocks","created_at":"2026-01-16T23:47:58.368162166-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-qr0","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T00:41:38.925257355-05:00","updated_at":"2026-01-16T01:50:39.642320385-05:00","closed_at":"2026-01-16T01:50:39.642320385-05:00","close_reason":"Stale patrol wisp cleanup","ephemeral":true}
{"id":"hq-wisp-qrg5x","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:45:48.834703003-05:00","updated_at":"2026-01-16T23:46:31.21252476-05:00","closed_at":"2026-01-16T23:46:31.21252476-05:00","close_reason":"gt deacon pending not implemented","dependencies":[{"issue_id":"hq-wisp-qrg5x","depends_on_id":"hq-wisp-2heyl","type":"parent-child","created_at":"2026-01-16T23:45:48.971087116-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-qrg5x","depends_on_id":"hq-wisp-pc777","type":"blocks","created_at":"2026-01-16T23:45:51.259011937-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-qsnye","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:30:03.171823023-05:00","updated_at":"2026-01-17T00:30:26.188756417-05:00","closed_at":"2026-01-17T00:30:26.188756417-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-qsnye","depends_on_id":"hq-wisp-8d16m","type":"parent-child","created_at":"2026-01-17T00:30:03.426397168-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-qsnye","depends_on_id":"hq-wisp-ulxlo","type":"blocks","created_at":"2026-01-17T00:30:07.741990364-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-qtrc","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T22:08:18.807015232-05:00","updated_at":"2026-01-16T22:12:13.852673146-05:00","closed_at":"2026-01-16T22:12:13.852673146-05:00","close_reason":"Orphaned - bulk cleanup","ephemeral":true}
{"id":"hq-wisp-qvh6","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:46:01.53094149-05:00","updated_at":"2026-01-16T01:50:45.598941646-05:00","closed_at":"2026-01-16T01:50:45.598941646-05:00","close_reason":"No notifications to fire this cycle","dependencies":[{"issue_id":"hq-wisp-qvh6","depends_on_id":"hq-wisp-xunp","type":"parent-child","created_at":"2026-01-16T01:46:01.590818509-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-qvh6","depends_on_id":"hq-wisp-hxii","type":"blocks","created_at":"2026-01-16T01:46:01.768567358-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-qwa4u","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:05:32.493681654-05:00","updated_at":"2026-01-17T01:06:55.166388267-05:00","closed_at":"2026-01-17T01:06:55.166388267-05:00","close_reason":"Idle town","dependencies":[{"issue_id":"hq-wisp-qwa4u","depends_on_id":"hq-wisp-p8n2g","type":"parent-child","created_at":"2026-01-17T01:05:37.838309957-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-qwa4u","depends_on_id":"hq-wisp-tcn9q","type":"blocks","created_at":"2026-01-17T01:05:50.087834526-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-qz2t4","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T10:40:44.350137407-05:00","updated_at":"2026-01-17T10:43:40.103050652-05:00","closed_at":"2026-01-17T10:43:40.103050652-05:00","close_reason":"Patrol cycle 4 complete","ephemeral":true}
{"id":"hq-wisp-qzn8","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:55:36.785381582-05:00","updated_at":"2026-01-16T01:56:37.835305017-05:00","closed_at":"2026-01-16T01:56:37.835305017-05:00","close_reason":"Closed","dependencies":[{"issue_id":"hq-wisp-qzn8","depends_on_id":"hq-wisp-ndqt","type":"parent-child","created_at":"2026-01-16T01:55:36.89486263-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-qzn8","depends_on_id":"hq-wisp-8aa4","type":"blocks","created_at":"2026-01-16T01:55:37.04007043-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-qzv5","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:56:35.921108394-05:00","updated_at":"2026-01-16T22:13:02.195348223-05:00","closed_at":"2026-01-16T22:13:02.195348223-05:00","close_reason":"Orphaned - forced cleanup","dependencies":[{"issue_id":"hq-wisp-qzv5","depends_on_id":"hq-wisp-8d7d","type":"parent-child","created_at":"2026-01-16T01:56:35.942540912-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-qzv5","depends_on_id":"hq-wisp-aap3","type":"blocks","created_at":"2026-01-16T01:56:35.989703527-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-qzv7l","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:45:48.836321278-05:00","updated_at":"2026-01-16T23:46:30.012117331-05:00","closed_at":"2026-01-16T23:46:30.012117331-05:00","close_reason":"No open convoys","dependencies":[{"issue_id":"hq-wisp-qzv7l","depends_on_id":"hq-wisp-2heyl","type":"parent-child","created_at":"2026-01-16T23:45:49.346164811-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-qzv7l","depends_on_id":"hq-wisp-pc777","type":"blocks","created_at":"2026-01-16T23:45:51.63623436-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-r0bsf","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:28:49.924172939-05:00","updated_at":"2026-01-17T00:29:02.547944191-05:00","closed_at":"2026-01-17T00:29:02.547944191-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-r0bsf","depends_on_id":"hq-wisp-9l1zx","type":"parent-child","created_at":"2026-01-17T00:28:50.163548885-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-r0bsf","depends_on_id":"hq-wisp-nxinm","type":"blocks","created_at":"2026-01-17T00:28:54.167339937-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-r347z","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:08:16.842672564-05:00","updated_at":"2026-01-17T01:10:09.848607308-05:00","closed_at":"2026-01-17T01:10:09.848607308-05:00","close_reason":"Final patrol","dependencies":[{"issue_id":"hq-wisp-r347z","depends_on_id":"hq-wisp-vrsc5","type":"parent-child","created_at":"2026-01-17T01:08:16.86109091-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-r3w7z","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:58:39.903188201-05:00","updated_at":"2026-01-17T01:00:18.038297937-05:00","closed_at":"2026-01-17T01:00:18.038297937-05:00","close_reason":"Context low","dependencies":[{"issue_id":"hq-wisp-r3w7z","depends_on_id":"hq-wisp-0nlhz","type":"parent-child","created_at":"2026-01-17T00:58:49.209545305-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-r3w7z","depends_on_id":"hq-wisp-pxy4c","type":"blocks","created_at":"2026-01-17T00:59:00.301627359-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-r5iwu","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:08:16.857747207-05:00","updated_at":"2026-01-17T01:10:56.236407372-05:00","closed_at":"2026-01-17T01:10:56.236407372-05:00","close_reason":"Final patrol","dependencies":[{"issue_id":"hq-wisp-r5iwu","depends_on_id":"hq-wisp-vrsc5","type":"parent-child","created_at":"2026-01-17T01:08:25.953218592-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-r5iwu","depends_on_id":"hq-wisp-t2siu","type":"blocks","created_at":"2026-01-17T01:08:38.13439198-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-r7eue","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:03:11.647332904-05:00","updated_at":"2026-01-17T01:04:35.688869045-05:00","closed_at":"2026-01-17T01:04:35.688869045-05:00","close_reason":"Context low","dependencies":[{"issue_id":"hq-wisp-r7eue","depends_on_id":"hq-wisp-zx2sm","type":"parent-child","created_at":"2026-01-17T01:03:21.869412171-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-r7eue","depends_on_id":"hq-wisp-j4ayh","type":"blocks","created_at":"2026-01-17T01:03:34.009270112-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-r7j8","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:48:28.032350844-05:00","updated_at":"2026-01-16T22:13:02.096920431-05:00","closed_at":"2026-01-16T22:13:02.096920431-05:00","close_reason":"Orphaned - forced cleanup","dependencies":[{"issue_id":"hq-wisp-r7j8","depends_on_id":"hq-wisp-mwjb","type":"parent-child","created_at":"2026-01-16T21:48:28.078057764-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-r7j8","depends_on_id":"hq-wisp-gsr9","type":"blocks","created_at":"2026-01-16T21:48:28.170129267-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-r7va8","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:41:51.252589644-05:00","updated_at":"2026-01-16T23:42:41.795039138-05:00","closed_at":"2026-01-16T23:42:41.795039138-05:00","close_reason":"No issues found","dependencies":[{"issue_id":"hq-wisp-r7va8","depends_on_id":"hq-wisp-tnkch","type":"parent-child","created_at":"2026-01-16T23:41:52.40877787-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-r7va8","depends_on_id":"hq-wisp-1yp82","type":"blocks","created_at":"2026-01-16T23:41:54.516135764-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-r9bop","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:41:51.253082144-05:00","updated_at":"2026-01-16T23:42:41.982086148-05:00","closed_at":"2026-01-16T23:42:41.982086148-05:00","close_reason":"No issues found","dependencies":[{"issue_id":"hq-wisp-r9bop","depends_on_id":"hq-wisp-tnkch","type":"parent-child","created_at":"2026-01-16T23:41:52.511988481-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-r9bop","depends_on_id":"hq-wisp-r7va8","type":"blocks","created_at":"2026-01-16T23:41:54.624215542-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-rakbu","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:48:51.074735319-05:00","updated_at":"2026-01-16T23:49:28.50121338-05:00","closed_at":"2026-01-16T23:49:28.50121338-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-rakbu","depends_on_id":"hq-wisp-de87j","type":"parent-child","created_at":"2026-01-16T23:48:51.498665644-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-rakbu","depends_on_id":"hq-wisp-w7quv","type":"blocks","created_at":"2026-01-16T23:48:54.038501563-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-rbvve","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:58:39.897391961-05:00","updated_at":"2026-01-17T00:59:56.582159236-05:00","closed_at":"2026-01-17T00:59:56.582159236-05:00","close_reason":"No stuck dogs","dependencies":[{"issue_id":"hq-wisp-rbvve","depends_on_id":"hq-wisp-0nlhz","type":"parent-child","created_at":"2026-01-17T00:58:45.908988241-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-rbvve","depends_on_id":"hq-wisp-kpqnr","type":"blocks","created_at":"2026-01-17T00:58:56.961815769-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-rbxv9","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:49:57.518049534-05:00","updated_at":"2026-01-17T10:49:57.518049576-05:00","dependencies":[{"issue_id":"hq-wisp-rbxv9","depends_on_id":"hq-wisp-8agmn","type":"parent-child","created_at":"2026-01-17T10:49:57.645222876-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-rbxv9","depends_on_id":"hq-wisp-ctarq","type":"blocks","created_at":"2026-01-17T10:49:58.335182973-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-rc1q8","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:44:42.003662269-05:00","updated_at":"2026-01-17T10:44:42.003662311-05:00","dependencies":[{"issue_id":"hq-wisp-rc1q8","depends_on_id":"hq-wisp-qd1hf","type":"parent-child","created_at":"2026-01-17T10:44:42.199182363-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-rc1q8","depends_on_id":"hq-wisp-z6dr7","type":"blocks","created_at":"2026-01-17T10:44:42.500542848-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-rcj5","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:42:27.173902088-05:00","updated_at":"2026-01-16T01:52:13.615306784-05:00","closed_at":"2026-01-16T01:52:13.615306784-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-rcj5","depends_on_id":"hq-wisp-wqti","type":"parent-child","created_at":"2026-01-16T01:42:27.260652202-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-rcj5","depends_on_id":"hq-wisp-68c8","type":"blocks","created_at":"2026-01-16T01:42:27.478647756-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-rcj5","depends_on_id":"hq-wisp-islc","type":"blocks","created_at":"2026-01-16T01:42:27.491439992-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-rcj5","depends_on_id":"hq-wisp-1294","type":"blocks","created_at":"2026-01-16T01:42:27.50372352-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-rcvst","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:27:30.735410499-05:00","updated_at":"2026-01-17T00:27:56.25101957-05:00","closed_at":"2026-01-17T00:27:56.25101957-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-rcvst","depends_on_id":"hq-wisp-72ja3","type":"parent-child","created_at":"2026-01-17T00:27:32.006700455-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-rcvst","depends_on_id":"hq-wisp-6erjz","type":"blocks","created_at":"2026-01-17T00:27:35.767392525-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-rd4pm","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:09:41.604263315-05:00","updated_at":"2026-01-17T01:10:25.848618113-05:00","closed_at":"2026-01-17T01:10:25.848618113-05:00","close_reason":"Inbox clear","dependencies":[{"issue_id":"hq-wisp-rd4pm","depends_on_id":"hq-wisp-fsms9","type":"parent-child","created_at":"2026-01-17T01:09:41.620906497-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-rdwpv","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:46:10.402915007-05:00","updated_at":"2026-01-17T10:46:10.402915049-05:00","dependencies":[{"issue_id":"hq-wisp-rdwpv","depends_on_id":"hq-wisp-bio5t","type":"parent-child","created_at":"2026-01-17T10:46:10.49152733-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-rdwpv","depends_on_id":"hq-wisp-bczni","type":"blocks","created_at":"2026-01-17T10:46:10.84585579-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-rf4o","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:37:49.086744724-05:00","updated_at":"2026-01-16T23:38:17.782127787-05:00","closed_at":"2026-01-16T23:38:17.782127787-05:00","close_reason":"Inbox empty, no callbacks","dependencies":[{"issue_id":"hq-wisp-rf4o","depends_on_id":"hq-wisp-2zuj","type":"parent-child","created_at":"2026-01-16T23:37:49.09567864-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-rfpi","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T00:59:23.00688364-05:00","updated_at":"2026-01-16T01:50:39.419365669-05:00","closed_at":"2026-01-16T01:50:39.419365669-05:00","close_reason":"Stale patrol wisp cleanup","ephemeral":true}
{"id":"hq-wisp-ri7hr","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:07:28.973487797-05:00","updated_at":"2026-01-17T01:09:29.42023094-05:00","closed_at":"2026-01-17T01:09:29.42023094-05:00","close_reason":"Costs not tracked","dependencies":[{"issue_id":"hq-wisp-ri7hr","depends_on_id":"hq-wisp-fnimo","type":"parent-child","created_at":"2026-01-17T01:07:37.160289647-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ri7hr","depends_on_id":"hq-wisp-q5ety","type":"blocks","created_at":"2026-01-17T01:07:48.836703575-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ri9se","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:51:56.824259698-05:00","updated_at":"2026-01-16T23:52:54.1309152-05:00","closed_at":"2026-01-16T23:52:54.1309152-05:00","close_reason":"Patrol cycle 15 complete","ephemeral":true}
{"id":"hq-wisp-rjogw","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:53:05.623457734-05:00","updated_at":"2026-01-16T23:53:53.31197488-05:00","closed_at":"2026-01-16T23:53:53.31197488-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-rjogw","depends_on_id":"hq-wisp-xtx6n","type":"parent-child","created_at":"2026-01-16T23:53:07.383839171-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-rjogw","depends_on_id":"hq-wisp-feqrq","type":"blocks","created_at":"2026-01-16T23:53:10.85210267-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-rjrbn","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:26:33.626435057-05:00","updated_at":"2026-01-17T00:26:59.744266085-05:00","closed_at":"2026-01-17T00:26:59.744266085-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-rjrbn","depends_on_id":"hq-wisp-3h08u","type":"parent-child","created_at":"2026-01-17T00:26:34.45316805-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-rjrbn","depends_on_id":"hq-wisp-ivaul","type":"blocks","created_at":"2026-01-17T00:26:38.099782767-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-rmc","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T00:44:36.49202424-05:00","updated_at":"2026-01-16T00:52:44.222620099-05:00","closed_at":"2026-01-16T00:52:44.222620099-05:00","close_reason":"Patrol cycle complete","ephemeral":true}
{"id":"hq-wisp-ro3i8","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:23:02.707043173-05:00","updated_at":"2026-01-17T00:24:20.908519615-05:00","closed_at":"2026-01-17T00:24:20.908519615-05:00","close_reason":"Town idle/healthy","dependencies":[{"issue_id":"hq-wisp-ro3i8","depends_on_id":"hq-wisp-93kdl","type":"parent-child","created_at":"2026-01-17T00:23:04.991429787-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ro3i8","depends_on_id":"hq-wisp-8pecv","type":"blocks","created_at":"2026-01-17T00:23:08.889183046-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-rphq0","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:40:19.872011401-05:00","updated_at":"2026-01-16T23:41:10.445139579-05:00","closed_at":"2026-01-16T23:41:10.445139579-05:00","close_reason":"No messages","dependencies":[{"issue_id":"hq-wisp-rphq0","depends_on_id":"hq-wisp-6gnpy","type":"parent-child","created_at":"2026-01-16T23:40:19.881491608-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-rphz","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:55:36.779895005-05:00","updated_at":"2026-01-16T01:55:58.102064997-05:00","closed_at":"2026-01-16T01:55:58.102064997-05:00","close_reason":"Closed","dependencies":[{"issue_id":"hq-wisp-rphz","depends_on_id":"hq-wisp-ndqt","type":"parent-child","created_at":"2026-01-16T01:55:36.786565247-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-rpjb","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:19:36.433687655-05:00","updated_at":"2026-01-16T23:20:43.52639966-05:00","closed_at":"2026-01-16T23:20:43.52639966-05:00","close_reason":"No zombies, dogs present","dependencies":[{"issue_id":"hq-wisp-rpjb","depends_on_id":"hq-wisp-pfs9","type":"parent-child","created_at":"2026-01-16T23:19:37.184086142-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-rpjb","depends_on_id":"hq-wisp-e5vk","type":"blocks","created_at":"2026-01-16T23:19:38.673336491-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-rpnph","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:23:02.702015269-05:00","updated_at":"2026-01-17T00:24:09.770618594-05:00","closed_at":"2026-01-17T00:24:09.770618594-05:00","close_reason":"No activity","dependencies":[{"issue_id":"hq-wisp-rpnph","depends_on_id":"hq-wisp-93kdl","type":"parent-child","created_at":"2026-01-17T00:23:03.479519142-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-rpnph","depends_on_id":"hq-wisp-1rj6c","type":"blocks","created_at":"2026-01-17T00:23:06.943889137-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-rq8dy","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:55:26.112362628-05:00","updated_at":"2026-01-17T00:35:11.164835765-05:00","closed_at":"2026-01-17T00:35:11.164835765-05:00","close_reason":"Cleanup","ephemeral":true}
{"id":"hq-wisp-rrcs","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:43:15.719574722-05:00","updated_at":"2026-01-16T22:12:53.940714416-05:00","closed_at":"2026-01-16T22:12:53.940714416-05:00","close_reason":"Orphaned wisp step - cleanup","dependencies":[{"issue_id":"hq-wisp-rrcs","depends_on_id":"hq-wisp-l7vn","type":"parent-child","created_at":"2026-01-16T21:43:15.760315192-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-rrcs","depends_on_id":"hq-wisp-ghjl","type":"blocks","created_at":"2026-01-16T21:43:15.832405356-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-rrwqw","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:40:19.874881942-05:00","updated_at":"2026-01-16T23:41:18.113720131-05:00","closed_at":"2026-01-16T23:41:18.113720131-05:00","close_reason":"Nothing to process","dependencies":[{"issue_id":"hq-wisp-rrwqw","depends_on_id":"hq-wisp-6gnpy","type":"parent-child","created_at":"2026-01-16T23:40:20.465397366-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-rrwqw","depends_on_id":"hq-wisp-d1pfx","type":"blocks","created_at":"2026-01-16T23:40:22.241046428-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-rsanv","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:30:03.175838392-05:00","updated_at":"2026-01-17T00:30:28.379768282-05:00","closed_at":"2026-01-17T00:30:28.379768282-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-rsanv","depends_on_id":"hq-wisp-8d16m","type":"parent-child","created_at":"2026-01-17T00:30:04.63183178-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-rsanv","depends_on_id":"hq-wisp-s5tic","type":"blocks","created_at":"2026-01-17T00:30:08.956557173-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-rsqbr","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:47:34.372503149-05:00","updated_at":"2026-01-16T23:49:13.419338801-05:00","closed_at":"2026-01-16T23:49:13.419338801-05:00","close_reason":"Town idle patrol","dependencies":[{"issue_id":"hq-wisp-rsqbr","depends_on_id":"hq-wisp-ql31w","type":"parent-child","created_at":"2026-01-16T23:47:35.68136551-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-rsqbr","depends_on_id":"hq-wisp-p6wj3","type":"blocks","created_at":"2026-01-16T23:47:38.079932505-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-rsxz","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:33:51.733347327-05:00","updated_at":"2026-01-17T00:35:51.925421488-05:00","closed_at":"2026-01-17T00:35:51.925421488-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-rtvg","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:19:36.434501364-05:00","updated_at":"2026-01-16T23:21:00.702801732-05:00","closed_at":"2026-01-16T23:21:00.702801732-05:00","close_reason":"No orphaned work","dependencies":[{"issue_id":"hq-wisp-rtvg","depends_on_id":"hq-wisp-pfs9","type":"parent-child","created_at":"2026-01-16T23:19:37.330535998-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-rtvg","depends_on_id":"hq-wisp-sdlq","type":"blocks","created_at":"2026-01-16T23:19:38.827196471-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-rtzni","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:41:51.254482685-05:00","updated_at":"2026-01-16T23:42:47.809593731-05:00","closed_at":"2026-01-16T23:42:47.809593731-05:00","close_reason":"Routine checks passed","dependencies":[{"issue_id":"hq-wisp-rtzni","depends_on_id":"hq-wisp-tnkch","type":"parent-child","created_at":"2026-01-16T23:41:52.822776608-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-rtzni","depends_on_id":"hq-wisp-0eum4","type":"blocks","created_at":"2026-01-16T23:41:54.949638375-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-rvcm","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:55:09.578064795-05:00","updated_at":"2026-01-16T00:55:16.039593909-05:00","closed_at":"2026-01-16T00:55:16.039593909-05:00","close_reason":"Town healthy","dependencies":[{"issue_id":"hq-wisp-rvcm","depends_on_id":"hq-wisp-3o9w","type":"parent-child","created_at":"2026-01-16T00:55:09.597097135-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-rvypl","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:52:58.280466674-05:00","updated_at":"2026-01-16T23:53:16.379419292-05:00","closed_at":"2026-01-16T23:53:16.379419292-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-rvypl","depends_on_id":"hq-wisp-a5ye3","type":"parent-child","created_at":"2026-01-16T23:53:00.085382953-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-rvypl","depends_on_id":"hq-wisp-omwnx","type":"blocks","created_at":"2026-01-16T23:53:03.408750646-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-rwc00","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:43:56.994055942-05:00","updated_at":"2026-01-16T23:44:28.245035377-05:00","closed_at":"2026-01-16T23:44:28.245035377-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-rwc00","depends_on_id":"hq-wisp-ywecn","type":"parent-child","created_at":"2026-01-16T23:43:57.926959571-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-rwc00","depends_on_id":"hq-wisp-u5lip","type":"blocks","created_at":"2026-01-16T23:44:00.017832217-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-rx9l4","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:26:33.62508156-05:00","updated_at":"2026-01-17T00:27:00.0226186-05:00","closed_at":"2026-01-17T00:27:00.0226186-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-rx9l4","depends_on_id":"hq-wisp-3h08u","type":"parent-child","created_at":"2026-01-17T00:26:34.045876751-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-rx9l4","depends_on_id":"hq-wisp-ivaul","type":"blocks","created_at":"2026-01-17T00:26:37.683665401-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-rz3yt","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:43:56.991214692-05:00","updated_at":"2026-01-16T23:44:34.723423962-05:00","closed_at":"2026-01-16T23:44:34.723423962-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-rz3yt","depends_on_id":"hq-wisp-ywecn","type":"parent-child","created_at":"2026-01-16T23:43:57.305331902-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-rz3yt","depends_on_id":"hq-wisp-njhz7","type":"blocks","created_at":"2026-01-16T23:43:59.174170451-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-rz64","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T01:51:12.932943494-05:00","updated_at":"2026-01-16T01:51:51.673688509-05:00","closed_at":"2026-01-16T01:51:51.673688509-05:00","close_reason":"Orphaned wisp cleanup","ephemeral":true}
{"id":"hq-wisp-rzdz","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:37:31.428549593-05:00","updated_at":"2026-01-17T00:35:50.882533843-05:00","closed_at":"2026-01-17T00:35:50.882533843-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-s0h1","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:21:24.467488803-05:00","updated_at":"2026-01-16T23:21:54.22775203-05:00","closed_at":"2026-01-16T23:21:54.22775203-05:00","close_reason":"No gates/convoys/pending","dependencies":[{"issue_id":"hq-wisp-s0h1","depends_on_id":"hq-wisp-87xr","type":"parent-child","created_at":"2026-01-16T23:21:24.80292426-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-s0h1","depends_on_id":"hq-wisp-epei","type":"blocks","created_at":"2026-01-16T23:21:26.347642023-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-s0h4f","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:45:48.845280184-05:00","updated_at":"2026-01-16T23:47:15.147621113-05:00","closed_at":"2026-01-16T23:47:15.147621113-05:00","close_reason":"Under patrol threshold, continue","dependencies":[{"issue_id":"hq-wisp-s0h4f","depends_on_id":"hq-wisp-2heyl","type":"parent-child","created_at":"2026-01-16T23:45:50.99862604-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-s0h4f","depends_on_id":"hq-wisp-1iewy","type":"blocks","created_at":"2026-01-16T23:45:53.564858321-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-s10v0","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:30:39.085861368-05:00","updated_at":"2026-01-17T00:30:55.808809113-05:00","closed_at":"2026-01-17T00:30:55.808809113-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-s10v0","depends_on_id":"hq-wisp-tjzfo","type":"parent-child","created_at":"2026-01-17T00:30:40.861962227-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-s10v0","depends_on_id":"hq-wisp-ut5y4","type":"blocks","created_at":"2026-01-17T00:30:45.404395024-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-s10v0","depends_on_id":"hq-wisp-wvgb8","type":"blocks","created_at":"2026-01-17T00:30:45.661405749-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-s10v0","depends_on_id":"hq-wisp-67k6z","type":"blocks","created_at":"2026-01-17T00:30:45.921292012-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-s1r4p","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:43:06.007193932-05:00","updated_at":"2026-01-16T23:43:40.783359872-05:00","closed_at":"2026-01-16T23:43:40.783359872-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-s1r4p","depends_on_id":"hq-wisp-p7g8j","type":"parent-child","created_at":"2026-01-16T23:43:06.123060762-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-s1r4p","depends_on_id":"hq-wisp-wy2ji","type":"blocks","created_at":"2026-01-16T23:43:08.061569216-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-s1wpx","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:49:57.516378577-05:00","updated_at":"2026-01-17T10:49:57.516378577-05:00","dependencies":[{"issue_id":"hq-wisp-s1wpx","depends_on_id":"hq-wisp-8agmn","type":"parent-child","created_at":"2026-01-17T10:49:57.568479171-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-s1wpx","depends_on_id":"hq-wisp-gtj8g","type":"blocks","created_at":"2026-01-17T10:49:58.256672019-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-s395r","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:45:48.839637201-05:00","updated_at":"2026-01-16T23:46:40.171062969-05:00","closed_at":"2026-01-16T23:46:40.171062969-05:00","close_reason":"No notifications needed","dependencies":[{"issue_id":"hq-wisp-s395r","depends_on_id":"hq-wisp-2heyl","type":"parent-child","created_at":"2026-01-16T23:45:49.598939913-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-s395r","depends_on_id":"hq-wisp-xsuyd","type":"blocks","created_at":"2026-01-16T23:45:51.887307063-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-s4kar","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:08:16.852505006-05:00","updated_at":"2026-01-17T01:10:35.545690793-05:00","closed_at":"2026-01-17T01:10:35.545690793-05:00","close_reason":"Final patrol","dependencies":[{"issue_id":"hq-wisp-s4kar","depends_on_id":"hq-wisp-vrsc5","type":"parent-child","created_at":"2026-01-17T01:08:22.908490317-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-s4kar","depends_on_id":"hq-wisp-omz23","type":"blocks","created_at":"2026-01-17T01:08:35.082541258-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-s4p8","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:53:28.906435676-05:00","updated_at":"2026-01-16T01:54:17.557978375-05:00","closed_at":"2026-01-16T01:54:17.557978375-05:00","close_reason":"Orphan cleanup","dependencies":[{"issue_id":"hq-wisp-s4p8","depends_on_id":"hq-wisp-eke2","type":"parent-child","created_at":"2026-01-16T01:53:28.942533595-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-s4q4p","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:46:50.73035041-05:00","updated_at":"2026-01-17T10:46:50.730350452-05:00","dependencies":[{"issue_id":"hq-wisp-s4q4p","depends_on_id":"hq-wisp-2vhlh","type":"parent-child","created_at":"2026-01-17T10:46:51.117686059-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-s4q4p","depends_on_id":"hq-wisp-zvtnw","type":"blocks","created_at":"2026-01-17T10:46:51.671917568-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-s4vqw","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:02:45.692572393-05:00","updated_at":"2026-01-17T01:05:30.322049028-05:00","closed_at":"2026-01-17T01:05:30.322049028-05:00","close_reason":"Idle town patrol","dependencies":[{"issue_id":"hq-wisp-s4vqw","depends_on_id":"hq-wisp-ji9jj","type":"parent-child","created_at":"2026-01-17T01:02:48.614165731-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-s4vqw","depends_on_id":"hq-wisp-p2ml2","type":"blocks","created_at":"2026-01-17T01:02:59.206423034-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-s4yuv","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:46:10.405314839-05:00","updated_at":"2026-01-17T10:46:10.405314881-05:00","dependencies":[{"issue_id":"hq-wisp-s4yuv","depends_on_id":"hq-wisp-bio5t","type":"parent-child","created_at":"2026-01-17T10:46:10.531004099-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-s4yuv","depends_on_id":"hq-wisp-eqrox","type":"blocks","created_at":"2026-01-17T10:46:10.885815683-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-s571g","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:00:26.065509136-05:00","updated_at":"2026-01-17T01:02:04.208809599-05:00","closed_at":"2026-01-17T01:02:04.208809599-05:00","close_reason":"Costs not tracked","dependencies":[{"issue_id":"hq-wisp-s571g","depends_on_id":"hq-wisp-5yxyi","type":"parent-child","created_at":"2026-01-17T01:00:33.797372307-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-s571g","depends_on_id":"hq-wisp-1bngg","type":"blocks","created_at":"2026-01-17T01:00:44.919438529-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-s5dac","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:56:40.342609403-05:00","updated_at":"2026-01-17T00:58:26.063310304-05:00","closed_at":"2026-01-17T00:58:26.063310304-05:00","close_reason":"Inbox clear","dependencies":[{"issue_id":"hq-wisp-s5dac","depends_on_id":"hq-wisp-an994","type":"parent-child","created_at":"2026-01-17T00:56:49.258009648-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-s5dac","depends_on_id":"hq-wisp-0jq8e","type":"blocks","created_at":"2026-01-17T00:57:00.63095438-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-s5tic","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:30:03.175145976-05:00","updated_at":"2026-01-17T00:30:27.192722144-05:00","closed_at":"2026-01-17T00:30:27.192722144-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-s5tic","depends_on_id":"hq-wisp-8d16m","type":"parent-child","created_at":"2026-01-17T00:30:04.382650253-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-s5tic","depends_on_id":"hq-wisp-h5s6o","type":"blocks","created_at":"2026-01-17T00:30:08.714682801-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-s6om7","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:24:43.293544222-05:00","updated_at":"2026-01-17T00:25:08.504741297-05:00","closed_at":"2026-01-17T00:25:08.504741297-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-s6om7","depends_on_id":"hq-wisp-5fw2b","type":"parent-child","created_at":"2026-01-17T00:24:43.502009458-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-s6om7","depends_on_id":"hq-wisp-51y9d","type":"blocks","created_at":"2026-01-17T00:24:47.007540626-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-s8mx4","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:58:39.893903175-05:00","updated_at":"2026-01-17T00:59:52.391261752-05:00","closed_at":"2026-01-17T00:59:52.391261752-05:00","close_reason":"All healthy","dependencies":[{"issue_id":"hq-wisp-s8mx4","depends_on_id":"hq-wisp-0nlhz","type":"parent-child","created_at":"2026-01-17T00:58:43.723119647-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-s8mx4","depends_on_id":"hq-wisp-1i840","type":"blocks","created_at":"2026-01-17T00:58:53.59887084-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-s8mx4","depends_on_id":"hq-wisp-umi8y","type":"blocks","created_at":"2026-01-17T00:58:54.167421306-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-s8mx4","depends_on_id":"hq-wisp-zuidw","type":"blocks","created_at":"2026-01-17T00:58:54.744370008-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-s90va","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:44:11.728530786-05:00","updated_at":"2026-01-17T00:35:36.787785617-05:00","closed_at":"2026-01-17T00:35:36.787785617-05:00","close_reason":"Cleanup","ephemeral":true}
{"id":"hq-wisp-sa7wu","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:47:24.580350521-05:00","updated_at":"2026-01-17T10:47:24.580350562-05:00","dependencies":[{"issue_id":"hq-wisp-sa7wu","depends_on_id":"hq-wisp-jag69","type":"parent-child","created_at":"2026-01-17T10:47:24.776195739-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-sa7wu","depends_on_id":"hq-wisp-g4cho","type":"blocks","created_at":"2026-01-17T10:47:25.338043494-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-sbhw2","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:50:35.393787649-05:00","updated_at":"2026-01-16T23:51:14.200820681-05:00","closed_at":"2026-01-16T23:51:14.200820681-05:00","close_reason":"Inbox empty","dependencies":[{"issue_id":"hq-wisp-sbhw2","depends_on_id":"hq-wisp-t8b5z","type":"parent-child","created_at":"2026-01-16T23:50:35.404671874-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-scal","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:36:59.342105245-05:00","updated_at":"2026-01-16T23:39:18.932781842-05:00","closed_at":"2026-01-16T23:39:18.932781842-05:00","close_reason":"No plugins to execute - only README.md in plugins directory","dependencies":[{"issue_id":"hq-wisp-scal","depends_on_id":"hq-wisp-c8tl","type":"parent-child","created_at":"2026-01-16T23:37:00.072961192-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-scal","depends_on_id":"hq-wisp-iw1c","type":"blocks","created_at":"2026-01-16T23:37:01.716990104-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-sdlq","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:19:36.434087364-05:00","updated_at":"2026-01-16T23:20:51.105039199-05:00","closed_at":"2026-01-16T23:20:51.105039199-05:00","close_reason":"No plugins, no stuck dogs","dependencies":[{"issue_id":"hq-wisp-sdlq","depends_on_id":"hq-wisp-pfs9","type":"parent-child","created_at":"2026-01-16T23:19:37.256840299-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-sdlq","depends_on_id":"hq-wisp-rpjb","type":"blocks","created_at":"2026-01-16T23:19:38.750578065-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-sfdxe","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:00:26.05686365-05:00","updated_at":"2026-01-17T01:01:14.67594672-05:00","closed_at":"2026-01-17T01:01:14.67594672-05:00","close_reason":"No gate-ready molecules","dependencies":[{"issue_id":"hq-wisp-sfdxe","depends_on_id":"hq-wisp-5yxyi","type":"parent-child","created_at":"2026-01-17T01:00:27.724990532-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-sfdxe","depends_on_id":"hq-wisp-4o2pg","type":"blocks","created_at":"2026-01-17T01:00:37.681582696-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-sfuwq","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:53:05.629435021-05:00","updated_at":"2026-01-16T23:53:40.96474192-05:00","closed_at":"2026-01-16T23:53:40.96474192-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-sfuwq","depends_on_id":"hq-wisp-xtx6n","type":"parent-child","created_at":"2026-01-16T23:53:08.762192069-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-sfuwq","depends_on_id":"hq-wisp-2975x","type":"blocks","created_at":"2026-01-16T23:53:12.271820161-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-sge1h","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:49:41.443037463-05:00","updated_at":"2026-01-16T23:50:32.899567043-05:00","closed_at":"2026-01-16T23:50:32.899567043-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-sge1h","depends_on_id":"hq-wisp-q54v3","type":"parent-child","created_at":"2026-01-16T23:49:41.876940807-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-sge1h","depends_on_id":"hq-wisp-fnkrw","type":"blocks","created_at":"2026-01-16T23:49:44.425513081-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-sjfjx","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:56:40.329923756-05:00","updated_at":"2026-01-17T00:57:33.783676647-05:00","closed_at":"2026-01-17T00:57:33.783676647-05:00","close_reason":"No pending spawns","dependencies":[{"issue_id":"hq-wisp-sjfjx","depends_on_id":"hq-wisp-an994","type":"parent-child","created_at":"2026-01-17T00:56:40.885284609-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-sjfjx","depends_on_id":"hq-wisp-2uibz","type":"blocks","created_at":"2026-01-17T00:56:51.065954-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-sjzmw","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:27:30.731035881-05:00","updated_at":"2026-01-17T00:27:52.471470861-05:00","closed_at":"2026-01-17T00:27:52.471470861-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-sjzmw","depends_on_id":"hq-wisp-72ja3","type":"parent-child","created_at":"2026-01-17T00:27:30.743683446-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-skcr0","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:48:51.079722849-05:00","updated_at":"2026-01-16T23:49:18.169437015-05:00","closed_at":"2026-01-16T23:49:18.169437015-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-skcr0","depends_on_id":"hq-wisp-de87j","type":"parent-child","created_at":"2026-01-16T23:48:52.903103901-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-skcr0","depends_on_id":"hq-wisp-7rf5r","type":"blocks","created_at":"2026-01-16T23:48:55.764767044-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-skr05","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:28:16.223150646-05:00","updated_at":"2026-01-17T00:28:35.627495334-05:00","closed_at":"2026-01-17T00:28:35.627495334-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-skr05","depends_on_id":"hq-wisp-tbive","type":"parent-child","created_at":"2026-01-17T00:28:16.881807445-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-skr05","depends_on_id":"hq-wisp-e2j5i","type":"blocks","created_at":"2026-01-17T00:28:20.871046726-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-skujs","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:47:24.582068228-05:00","updated_at":"2026-01-17T10:47:24.58206827-05:00","dependencies":[{"issue_id":"hq-wisp-skujs","depends_on_id":"hq-wisp-jag69","type":"parent-child","created_at":"2026-01-17T10:47:24.867763436-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-skujs","depends_on_id":"hq-wisp-ixkqa","type":"blocks","created_at":"2026-01-17T10:47:25.505912479-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-sldzh","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:49:41.446564621-05:00","updated_at":"2026-01-16T23:50:22.790370795-05:00","closed_at":"2026-01-16T23:50:22.790370795-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-sldzh","depends_on_id":"hq-wisp-q54v3","type":"parent-child","created_at":"2026-01-16T23:49:42.860958731-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-sldzh","depends_on_id":"hq-wisp-j48c1","type":"blocks","created_at":"2026-01-16T23:49:45.721162419-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-sm7wo","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:40:19.873589817-05:00","updated_at":"2026-01-16T23:41:17.849050332-05:00","closed_at":"2026-01-16T23:41:17.849050332-05:00","close_reason":"Nothing to process","dependencies":[{"issue_id":"hq-wisp-sm7wo","depends_on_id":"hq-wisp-6gnpy","type":"parent-child","created_at":"2026-01-16T23:40:20.172793904-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-sm7wo","depends_on_id":"hq-wisp-69i1c","type":"blocks","created_at":"2026-01-16T23:40:21.942310175-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-sn5a","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T22:07:31.636984858-05:00","updated_at":"2026-01-16T22:12:18.864758673-05:00","closed_at":"2026-01-16T22:12:18.864758673-05:00","close_reason":"Orphaned - bulk cleanup","ephemeral":true}
{"id":"hq-wisp-snch9","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:49:35.727043159-05:00","updated_at":"2026-01-16T23:50:18.134340367-05:00","closed_at":"2026-01-16T23:50:18.134340367-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-snch9","depends_on_id":"hq-wisp-n4f70","type":"parent-child","created_at":"2026-01-16T23:49:37.892907847-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-snch9","depends_on_id":"hq-wisp-0kfk5","type":"blocks","created_at":"2026-01-16T23:49:40.646542237-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-sns7","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","assignee":"deacon","created_at":"2026-01-16T22:15:32.438091725-05:00","updated_at":"2026-01-17T00:36:32.862283824-05:00","closed_at":"2026-01-17T00:36:32.862283824-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-sosqh","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:52:28.535988346-05:00","updated_at":"2026-01-16T23:52:48.39208674-05:00","closed_at":"2026-01-16T23:52:48.39208674-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-sosqh","depends_on_id":"hq-wisp-en6ig","type":"parent-child","created_at":"2026-01-16T23:52:30.788145932-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-sosqh","depends_on_id":"hq-wisp-m57ur","type":"blocks","created_at":"2026-01-16T23:52:34.266066359-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-spb2","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T01:28:08.498171382-05:00","updated_at":"2026-01-16T01:50:39.250479937-05:00","closed_at":"2026-01-16T01:50:39.250479937-05:00","close_reason":"Stale patrol wisp cleanup","ephemeral":true}
{"id":"hq-wisp-spyv","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:23:28.654702113-05:00","updated_at":"2026-01-17T00:35:54.166708873-05:00","closed_at":"2026-01-17T00:35:54.166708873-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-srb8i","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:47:34.373040979-05:00","updated_at":"2026-01-16T23:49:12.748913329-05:00","closed_at":"2026-01-16T23:49:12.748913329-05:00","close_reason":"Town idle patrol","dependencies":[{"issue_id":"hq-wisp-srb8i","depends_on_id":"hq-wisp-ql31w","type":"parent-child","created_at":"2026-01-16T23:47:35.800419505-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-srb8i","depends_on_id":"hq-wisp-rsqbr","type":"blocks","created_at":"2026-01-16T23:47:38.203052101-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-srigs","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:03:11.631805007-05:00","updated_at":"2026-01-17T01:03:52.407676048-05:00","closed_at":"2026-01-17T01:03:52.407676048-05:00","close_reason":"Inbox clear","dependencies":[{"issue_id":"hq-wisp-srigs","depends_on_id":"hq-wisp-zx2sm","type":"parent-child","created_at":"2026-01-17T01:03:11.649191276-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-stqk","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:46:26.941821269-05:00","updated_at":"2026-01-16T01:51:58.124853609-05:00","closed_at":"2026-01-16T01:51:58.124853609-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-stqk","depends_on_id":"hq-wisp-ybkc","type":"parent-child","created_at":"2026-01-16T01:46:27.134653268-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-stqk","depends_on_id":"hq-wisp-c0nj","type":"blocks","created_at":"2026-01-16T01:46:27.368656557-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-sudi","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:36:59.346459494-05:00","updated_at":"2026-01-16T23:40:10.80197328-05:00","closed_at":"2026-01-16T23:40:10.80197328-05:00","close_reason":"Patrol count 8, context moderate, looping","dependencies":[{"issue_id":"hq-wisp-sudi","depends_on_id":"hq-wisp-c8tl","type":"parent-child","created_at":"2026-01-16T23:37:00.813457304-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-sudi","depends_on_id":"hq-wisp-k018","type":"blocks","created_at":"2026-01-16T23:37:02.486704296-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-suovp","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:44:43.643409591-05:00","updated_at":"2026-01-16T23:45:24.662412754-05:00","closed_at":"2026-01-16T23:45:24.662412754-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-suovp","depends_on_id":"hq-wisp-bhwu0","type":"parent-child","created_at":"2026-01-16T23:44:44.959908298-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-suovp","depends_on_id":"hq-wisp-z474a","type":"blocks","created_at":"2026-01-16T23:44:47.150328141-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-suqt8","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:51:56.83598148-05:00","updated_at":"2026-01-16T23:52:22.635196257-05:00","closed_at":"2026-01-16T23:52:22.635196257-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-suqt8","depends_on_id":"hq-wisp-ri9se","type":"parent-child","created_at":"2026-01-16T23:51:59.298331945-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-suqt8","depends_on_id":"hq-wisp-w5748","type":"blocks","created_at":"2026-01-16T23:52:02.63551594-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-swrk","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:53:28.90523376-05:00","updated_at":"2026-01-16T01:54:17.573537691-05:00","closed_at":"2026-01-16T01:54:17.573537691-05:00","close_reason":"Orphan cleanup","dependencies":[{"issue_id":"hq-wisp-swrk","depends_on_id":"hq-wisp-eke2","type":"parent-child","created_at":"2026-01-16T01:53:28.934369937-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-swrk","depends_on_id":"hq-wisp-nmt0","type":"blocks","created_at":"2026-01-16T01:53:28.982641343-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-sx5q3","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T00:37:30.306029175-05:00","updated_at":"2026-01-17T00:37:45.061751053-05:00","closed_at":"2026-01-17T00:37:45.061751053-05:00","close_reason":"Town healthy","ephemeral":true}
{"id":"hq-wisp-sx94r","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:58:39.898404459-05:00","updated_at":"2026-01-17T01:00:02.173893569-05:00","closed_at":"2026-01-17T01:00:02.173893569-05:00","close_reason":"No abandoned work","dependencies":[{"issue_id":"hq-wisp-sx94r","depends_on_id":"hq-wisp-0nlhz","type":"parent-child","created_at":"2026-01-17T00:58:46.45991182-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-sx94r","depends_on_id":"hq-wisp-rbvve","type":"blocks","created_at":"2026-01-17T00:58:57.519547504-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-sxptk","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:56:41.904609244-05:00","updated_at":"2026-01-17T00:35:09.936539323-05:00","closed_at":"2026-01-17T00:35:09.936539323-05:00","close_reason":"Cleanup","ephemeral":true}
{"id":"hq-wisp-sykhw","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:23:02.711944827-05:00","updated_at":"2026-01-17T00:24:26.982321214-05:00","closed_at":"2026-01-17T00:24:26.982321214-05:00","close_reason":"Cycle complete","dependencies":[{"issue_id":"hq-wisp-sykhw","depends_on_id":"hq-wisp-93kdl","type":"parent-child","created_at":"2026-01-17T00:23:06.158726324-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-sykhw","depends_on_id":"hq-wisp-a2ocv","type":"blocks","created_at":"2026-01-17T00:23:10.089878083-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-syrk7","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:48:51.075273734-05:00","updated_at":"2026-01-16T23:49:27.926193233-05:00","closed_at":"2026-01-16T23:49:27.926193233-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-syrk7","depends_on_id":"hq-wisp-de87j","type":"parent-child","created_at":"2026-01-16T23:48:51.637397828-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-syrk7","depends_on_id":"hq-wisp-fjhz7","type":"blocks","created_at":"2026-01-16T23:48:54.182353068-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-szn0","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:48:28.030053557-05:00","updated_at":"2026-01-16T22:12:53.914939865-05:00","closed_at":"2026-01-16T22:12:53.914939865-05:00","close_reason":"Orphaned wisp step - cleanup","dependencies":[{"issue_id":"hq-wisp-szn0","depends_on_id":"hq-wisp-mwjb","type":"parent-child","created_at":"2026-01-16T21:48:28.0527696-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-szn0","depends_on_id":"hq-wisp-npo8","type":"blocks","created_at":"2026-01-16T21:48:28.129869339-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-szyf","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:55:09.581765713-05:00","updated_at":"2026-01-16T00:55:16.04487741-05:00","closed_at":"2026-01-16T00:55:16.04487741-05:00","close_reason":"Town healthy","dependencies":[{"issue_id":"hq-wisp-szyf","depends_on_id":"hq-wisp-3o9w","type":"parent-child","created_at":"2026-01-16T00:55:09.671079574-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-t0jg","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:05:01.102418384-05:00","updated_at":"2026-01-16T22:13:02.031389681-05:00","closed_at":"2026-01-16T22:13:02.031389681-05:00","close_reason":"Orphaned - forced cleanup","dependencies":[{"issue_id":"hq-wisp-t0jg","depends_on_id":"hq-wisp-xrtb","type":"parent-child","created_at":"2026-01-16T22:05:01.160683269-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-t0jg","depends_on_id":"hq-wisp-mz3y","type":"blocks","created_at":"2026-01-16T22:05:01.305217253-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-t0jg","depends_on_id":"hq-wisp-puhr","type":"blocks","created_at":"2026-01-16T22:05:01.313764242-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-t0jg","depends_on_id":"hq-wisp-q1z1","type":"blocks","created_at":"2026-01-16T22:05:01.32218119-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-t1x6s","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:47:24.58486856-05:00","updated_at":"2026-01-17T10:47:24.584868601-05:00","dependencies":[{"issue_id":"hq-wisp-t1x6s","depends_on_id":"hq-wisp-jag69","type":"parent-child","created_at":"2026-01-17T10:47:25.022715012-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-t1x6s","depends_on_id":"hq-wisp-2iclo","type":"blocks","created_at":"2026-01-17T10:47:25.683077875-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-t27da","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:52:50.327726417-05:00","updated_at":"2026-01-17T00:54:59.095357433-05:00","closed_at":"2026-01-17T00:54:59.095357433-05:00","close_reason":"No convoys to check","dependencies":[{"issue_id":"hq-wisp-t27da","depends_on_id":"hq-wisp-xo3wl","type":"parent-child","created_at":"2026-01-17T00:52:52.492764943-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-t27da","depends_on_id":"hq-wisp-ihlml","type":"blocks","created_at":"2026-01-17T00:53:02.335561202-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-t2siu","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:08:16.856887708-05:00","updated_at":"2026-01-17T01:10:49.745253918-05:00","closed_at":"2026-01-17T01:10:49.745253918-05:00","close_reason":"Final patrol","dependencies":[{"issue_id":"hq-wisp-t2siu","depends_on_id":"hq-wisp-vrsc5","type":"parent-child","created_at":"2026-01-17T01:08:25.340107677-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-t2siu","depends_on_id":"hq-wisp-dnb3w","type":"blocks","created_at":"2026-01-17T01:08:37.530557926-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-t4rk4","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:49:03.622281717-05:00","updated_at":"2026-01-17T00:35:31.425175036-05:00","closed_at":"2026-01-17T00:35:31.425175036-05:00","close_reason":"Cleanup","ephemeral":true}
{"id":"hq-wisp-t4uk6","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:53:05.620515194-05:00","updated_at":"2026-01-16T23:53:56.748800986-05:00","closed_at":"2026-01-16T23:53:56.748800986-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-t4uk6","depends_on_id":"hq-wisp-xtx6n","type":"parent-child","created_at":"2026-01-16T23:53:06.519338378-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-t4uk6","depends_on_id":"hq-wisp-85gqv","type":"blocks","created_at":"2026-01-16T23:53:09.627106737-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-t8b5z","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:50:35.392110611-05:00","updated_at":"2026-01-16T23:51:29.440869816-05:00","closed_at":"2026-01-16T23:51:29.440869816-05:00","close_reason":"Patrol 10 complete","ephemeral":true}
{"id":"hq-wisp-t8l0","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T22:13:34.781112917-05:00","updated_at":"2026-01-17T00:36:35.876384561-05:00","closed_at":"2026-01-17T00:36:35.876384561-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-t9cop","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:47:24.577107689-05:00","updated_at":"2026-01-17T10:47:24.577107731-05:00","dependencies":[{"issue_id":"hq-wisp-t9cop","depends_on_id":"hq-wisp-jag69","type":"parent-child","created_at":"2026-01-17T10:47:24.621136663-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-t9cop","depends_on_id":"hq-wisp-n9zhv","type":"blocks","created_at":"2026-01-17T10:47:25.179295128-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-t9qfz","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:53:25.1545725-05:00","updated_at":"2026-01-16T23:53:49.519538589-05:00","closed_at":"2026-01-16T23:53:49.519538589-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-t9qfz","depends_on_id":"hq-wisp-of0wi","type":"parent-child","created_at":"2026-01-16T23:53:26.164763056-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-t9qfz","depends_on_id":"hq-wisp-ycb59","type":"blocks","created_at":"2026-01-16T23:53:29.201824053-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-t9ys3","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:50:53.893127685-05:00","updated_at":"2026-01-16T23:51:36.291601752-05:00","closed_at":"2026-01-16T23:51:36.291601752-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-t9ys3","depends_on_id":"hq-wisp-47par","type":"parent-child","created_at":"2026-01-16T23:50:54.185452958-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-t9ys3","depends_on_id":"hq-wisp-dmcr4","type":"blocks","created_at":"2026-01-16T23:50:56.73799552-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-tbive","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T00:28:16.219123027-05:00","updated_at":"2026-01-17T00:28:39.996753899-05:00","closed_at":"2026-01-17T00:28:39.996753899-05:00","close_reason":"Patrol cycle 7 complete","ephemeral":true}
{"id":"hq-wisp-tcn9q","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:05:32.492154448-05:00","updated_at":"2026-01-17T01:06:52.158552242-05:00","closed_at":"2026-01-17T01:06:52.158552242-05:00","close_reason":"Idle town","dependencies":[{"issue_id":"hq-wisp-tcn9q","depends_on_id":"hq-wisp-p8n2g","type":"parent-child","created_at":"2026-01-17T01:05:37.240240898-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-tcn9q","depends_on_id":"hq-wisp-ebths","type":"blocks","created_at":"2026-01-17T01:05:49.492035463-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-tebj","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:56:35.924001516-05:00","updated_at":"2026-01-16T22:13:02.15818852-05:00","closed_at":"2026-01-16T22:13:02.15818852-05:00","close_reason":"Orphaned - forced cleanup","dependencies":[{"issue_id":"hq-wisp-tebj","depends_on_id":"hq-wisp-8d7d","type":"parent-child","created_at":"2026-01-16T01:56:35.964567221-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-tebj","depends_on_id":"hq-wisp-5af7","type":"blocks","created_at":"2026-01-16T01:56:36.02596378-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-tetc","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T22:19:30.733913525-05:00","updated_at":"2026-01-17T00:36:22.25241336-05:00","closed_at":"2026-01-17T00:36:22.25241336-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-tffu","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:54:43.651214469-05:00","updated_at":"2026-01-16T01:56:30.784964571-05:00","closed_at":"2026-01-16T01:56:30.784964571-05:00","close_reason":"Orphan cleanup","dependencies":[{"issue_id":"hq-wisp-tffu","depends_on_id":"hq-wisp-8okt","type":"parent-child","created_at":"2026-01-16T01:54:43.676380733-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-tffu","depends_on_id":"hq-wisp-a3xg","type":"blocks","created_at":"2026-01-16T01:54:43.724153264-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-tfg2s","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:02:22.555176236-05:00","updated_at":"2026-01-17T01:04:28.093055156-05:00","closed_at":"2026-01-17T01:04:28.093055156-05:00","close_reason":"No plugins registered","dependencies":[{"issue_id":"hq-wisp-tfg2s","depends_on_id":"hq-wisp-xwv1q","type":"parent-child","created_at":"2026-01-17T01:02:27.845663897-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-tfg2s","depends_on_id":"hq-wisp-37eju","type":"blocks","created_at":"2026-01-17T01:02:39.35515765-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-tfhtb","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:49:41.449455031-05:00","updated_at":"2026-01-16T23:50:14.309633793-05:00","closed_at":"2026-01-16T23:50:14.309633793-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-tfhtb","depends_on_id":"hq-wisp-q54v3","type":"parent-child","created_at":"2026-01-16T23:49:43.289978586-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-tfhtb","depends_on_id":"hq-wisp-bqda7","type":"blocks","created_at":"2026-01-16T23:49:46.162231955-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-tge7z","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:47:53.504290618-05:00","updated_at":"2026-01-16T23:48:27.842715671-05:00","closed_at":"2026-01-16T23:48:27.842715671-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-tge7z","depends_on_id":"hq-wisp-wj52z","type":"parent-child","created_at":"2026-01-16T23:47:55.107328007-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-tge7z","depends_on_id":"hq-wisp-forn7","type":"blocks","created_at":"2026-01-16T23:47:57.817237886-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-tgv3q","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:30:03.17251598-05:00","updated_at":"2026-01-17T00:30:25.931658484-05:00","closed_at":"2026-01-17T00:30:25.931658484-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-tgv3q","depends_on_id":"hq-wisp-8d16m","type":"parent-child","created_at":"2026-01-17T00:30:03.665080002-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-tgv3q","depends_on_id":"hq-wisp-ulxlo","type":"blocks","created_at":"2026-01-17T00:30:07.982815404-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-thou2","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T10:47:38.790458081-05:00","updated_at":"2026-01-17T10:47:48.493542112-05:00","closed_at":"2026-01-17T10:47:48.493542112-05:00","close_reason":"Patrol 13 complete","ephemeral":true}
{"id":"hq-wisp-tjlf","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T21:46:03.443822498-05:00","updated_at":"2026-01-16T21:46:48.304783267-05:00","closed_at":"2026-01-16T21:46:48.304783267-05:00","close_reason":"Closed","ephemeral":true}
{"id":"hq-wisp-tjzfo","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T00:30:39.077358046-05:00","updated_at":"2026-01-17T00:30:57.493812474-05:00","closed_at":"2026-01-17T00:30:57.493812474-05:00","close_reason":"Patrol cycle 11 complete","ephemeral":true}
{"id":"hq-wisp-tknap","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:43:06.015592921-05:00","updated_at":"2026-01-16T23:43:28.29726359-05:00","closed_at":"2026-01-16T23:43:28.29726359-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-tknap","depends_on_id":"hq-wisp-p7g8j","type":"parent-child","created_at":"2026-01-16T23:43:07.84275668-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-tknap","depends_on_id":"hq-wisp-avs4h","type":"blocks","created_at":"2026-01-16T23:43:10.108561661-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-tlnw","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:15:01.19893139-05:00","updated_at":"2026-01-16T23:18:43.23206469-05:00","closed_at":"2026-01-16T23:18:43.23206469-05:00","close_reason":"No plugins, no stuck dogs","dependencies":[{"issue_id":"hq-wisp-tlnw","depends_on_id":"hq-wisp-9osz","type":"parent-child","created_at":"2026-01-16T23:15:01.961176669-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-tlnw","depends_on_id":"hq-wisp-8o8b","type":"blocks","created_at":"2026-01-16T23:15:03.382465167-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-tmah","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T01:42:51.445581953-05:00","updated_at":"2026-01-16T01:50:38.997119629-05:00","closed_at":"2026-01-16T01:50:38.997119629-05:00","close_reason":"Stale patrol wisp cleanup","ephemeral":true}
{"id":"hq-wisp-tnkch","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:41:51.24556727-05:00","updated_at":"2026-01-16T23:42:56.54652728-05:00","closed_at":"2026-01-16T23:42:56.54652728-05:00","close_reason":"Patrol cycle 7 complete","ephemeral":true}
{"id":"hq-wisp-tp8x","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T22:14:07.038409193-05:00","updated_at":"2026-01-17T00:36:35.56595308-05:00","closed_at":"2026-01-17T00:36:35.56595308-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-tp9wz","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:56:40.330845088-05:00","updated_at":"2026-01-17T00:57:36.82157265-05:00","closed_at":"2026-01-17T00:57:36.82157265-05:00","close_reason":"No async gates","dependencies":[{"issue_id":"hq-wisp-tp9wz","depends_on_id":"hq-wisp-an994","type":"parent-child","created_at":"2026-01-17T00:56:41.434154348-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-tp9wz","depends_on_id":"hq-wisp-2uibz","type":"blocks","created_at":"2026-01-17T00:56:51.611875837-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-tpvdo","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T02:00:44.565635231-05:00","updated_at":"2026-01-17T02:01:48.234118872-05:00","closed_at":"2026-01-17T02:01:48.234118872-05:00","close_reason":"Idle patrol","dependencies":[{"issue_id":"hq-wisp-tpvdo","depends_on_id":"hq-wisp-9a1wp","type":"parent-child","created_at":"2026-01-17T02:00:45.207839897-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-tpvdo","depends_on_id":"hq-wisp-ijfsf","type":"blocks","created_at":"2026-01-17T02:00:57.733746587-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-tpwpk","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:45:39.912367523-05:00","updated_at":"2026-01-17T00:35:34.406031907-05:00","closed_at":"2026-01-17T00:35:34.406031907-05:00","close_reason":"Cleanup","ephemeral":true}
{"id":"hq-wisp-tqjts","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T00:32:40.981613009-05:00","updated_at":"2026-01-17T00:34:58.798364845-05:00","closed_at":"2026-01-17T00:34:58.798364845-05:00","close_reason":"Cleanup","ephemeral":true}
{"id":"hq-wisp-tr35k","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:47:55.322550324-05:00","updated_at":"2026-01-17T10:47:55.322550366-05:00","dependencies":[{"issue_id":"hq-wisp-tr35k","depends_on_id":"hq-wisp-9hr1x","type":"parent-child","created_at":"2026-01-17T10:47:55.847302184-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-tr35k","depends_on_id":"hq-wisp-i4jex","type":"blocks","created_at":"2026-01-17T10:47:56.652469213-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-tr40","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:23:47.736914033-05:00","updated_at":"2026-01-16T23:25:09.622768073-05:00","closed_at":"2026-01-16T23:25:09.622768073-05:00","close_reason":"No plugins, no stuck dogs","dependencies":[{"issue_id":"hq-wisp-tr40","depends_on_id":"hq-wisp-9we3","type":"parent-child","created_at":"2026-01-16T23:23:48.794711561-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-tr40","depends_on_id":"hq-wisp-5mtp","type":"blocks","created_at":"2026-01-16T23:23:50.749870514-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-tr4s7","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:46:50.721262374-05:00","updated_at":"2026-01-17T10:46:50.721262416-05:00","dependencies":[{"issue_id":"hq-wisp-tr4s7","depends_on_id":"hq-wisp-2vhlh","type":"parent-child","created_at":"2026-01-17T10:46:50.758551769-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-tr4s7","depends_on_id":"hq-wisp-14ebq","type":"blocks","created_at":"2026-01-17T10:46:51.223080164-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-traed","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:03:11.636964625-05:00","updated_at":"2026-01-17T01:04:05.476093308-05:00","closed_at":"2026-01-17T01:04:05.476093308-05:00","close_reason":"No external deps","dependencies":[{"issue_id":"hq-wisp-traed","depends_on_id":"hq-wisp-zx2sm","type":"parent-child","created_at":"2026-01-17T01:03:14.634978769-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-traed","depends_on_id":"hq-wisp-lztam","type":"blocks","created_at":"2026-01-17T01:03:25.47825232-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-trhbs","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:52:50.334743528-05:00","updated_at":"2026-01-17T00:56:01.272111434-05:00","closed_at":"2026-01-17T00:56:01.272111434-05:00","close_reason":"No abandoned work","dependencies":[{"issue_id":"hq-wisp-trhbs","depends_on_id":"hq-wisp-xo3wl","type":"parent-child","created_at":"2026-01-17T00:52:56.824062995-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-trhbs","depends_on_id":"hq-wisp-xkhcb","type":"blocks","created_at":"2026-01-17T00:53:07.828760737-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-tt8zk","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:46:10.401217675-05:00","updated_at":"2026-01-17T10:46:10.401217716-05:00","dependencies":[{"issue_id":"hq-wisp-tt8zk","depends_on_id":"hq-wisp-bio5t","type":"parent-child","created_at":"2026-01-17T10:46:10.452640353-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-tt8zk","depends_on_id":"hq-wisp-bczni","type":"blocks","created_at":"2026-01-17T10:46:10.806027396-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ttxj","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:55:09.579594296-05:00","updated_at":"2026-01-16T00:55:16.050373704-05:00","closed_at":"2026-01-16T00:55:16.050373704-05:00","close_reason":"Town healthy","dependencies":[{"issue_id":"hq-wisp-ttxj","depends_on_id":"hq-wisp-3o9w","type":"parent-child","created_at":"2026-01-16T00:55:09.62601256-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-tvo7l","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:05:32.49461007-05:00","updated_at":"2026-01-17T01:06:30.60780801-05:00","closed_at":"2026-01-17T01:06:30.60780801-05:00","close_reason":"Idle town","dependencies":[{"issue_id":"hq-wisp-tvo7l","depends_on_id":"hq-wisp-p8n2g","type":"parent-child","created_at":"2026-01-17T01:05:38.424474452-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-tvo7l","depends_on_id":"hq-wisp-ebths","type":"blocks","created_at":"2026-01-17T01:05:50.680469677-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-u1nfw","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:43:00.966585684-05:00","updated_at":"2026-01-17T00:52:23.661830589-05:00","closed_at":"2026-01-17T00:52:23.661830589-05:00","close_reason":"Inbox clear","dependencies":[{"issue_id":"hq-wisp-u1nfw","depends_on_id":"hq-wisp-jgnad","type":"parent-child","created_at":"2026-01-17T00:43:08.587499999-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-u1nfw","depends_on_id":"hq-wisp-o1dj2","type":"blocks","created_at":"2026-01-17T00:43:18.174642246-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-u2e0z","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:12:55.882023617-05:00","updated_at":"2026-01-17T01:59:25.986839226-05:00","closed_at":"2026-01-17T01:59:25.986839226-05:00","close_reason":"No recent closures, town idle","dependencies":[{"issue_id":"hq-wisp-u2e0z","depends_on_id":"hq-wisp-i2n82","type":"parent-child","created_at":"2026-01-17T01:12:58.924622646-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-u2e0z","depends_on_id":"hq-wisp-470rc","type":"blocks","created_at":"2026-01-17T01:13:09.98140121-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-u2t7i","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:53:25.162236202-05:00","updated_at":"2026-01-16T23:53:46.852576807-05:00","closed_at":"2026-01-16T23:53:46.852576807-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-u2t7i","depends_on_id":"hq-wisp-of0wi","type":"parent-child","created_at":"2026-01-16T23:53:28.183457211-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-u2t7i","depends_on_id":"hq-wisp-fd7wp","type":"blocks","created_at":"2026-01-16T23:53:31.614807613-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-u2z19","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:00:26.057612816-05:00","updated_at":"2026-01-17T01:01:08.403761043-05:00","closed_at":"2026-01-17T01:01:08.403761043-05:00","close_reason":"No convoys","dependencies":[{"issue_id":"hq-wisp-u2z19","depends_on_id":"hq-wisp-5yxyi","type":"parent-child","created_at":"2026-01-17T01:00:28.270001204-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-u2z19","depends_on_id":"hq-wisp-ckrms","type":"blocks","created_at":"2026-01-17T01:00:38.241908094-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-u33nw","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:05:32.488077913-05:00","updated_at":"2026-01-17T01:06:17.6637857-05:00","closed_at":"2026-01-17T01:06:17.6637857-05:00","close_reason":"Idle town","dependencies":[{"issue_id":"hq-wisp-u33nw","depends_on_id":"hq-wisp-p8n2g","type":"parent-child","created_at":"2026-01-17T01:05:34.873272954-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-u33nw","depends_on_id":"hq-wisp-w1g8e","type":"blocks","created_at":"2026-01-17T01:05:45.912910509-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-u4mvq","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:47:53.505407236-05:00","updated_at":"2026-01-16T23:48:25.882054217-05:00","closed_at":"2026-01-16T23:48:25.882054217-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-u4mvq","depends_on_id":"hq-wisp-wj52z","type":"parent-child","created_at":"2026-01-16T23:47:55.374465072-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-u4mvq","depends_on_id":"hq-wisp-l45xc","type":"blocks","created_at":"2026-01-16T23:47:58.091265118-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-u4mw","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:19:36.431231572-05:00","updated_at":"2026-01-16T23:20:18.63943504-05:00","closed_at":"2026-01-16T23:20:18.63943504-05:00","close_reason":"No gates/convoys/pending","dependencies":[{"issue_id":"hq-wisp-u4mw","depends_on_id":"hq-wisp-pfs9","type":"parent-child","created_at":"2026-01-16T23:19:36.741582699-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-u4mw","depends_on_id":"hq-wisp-bd21","type":"blocks","created_at":"2026-01-16T23:19:38.077341193-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-u5lip","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:43:56.993624067-05:00","updated_at":"2026-01-16T23:44:29.257732434-05:00","closed_at":"2026-01-16T23:44:29.257732434-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-u5lip","depends_on_id":"hq-wisp-ywecn","type":"parent-child","created_at":"2026-01-16T23:43:57.820029377-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-u5lip","depends_on_id":"hq-wisp-f665i","type":"blocks","created_at":"2026-01-16T23:43:59.911571439-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-u5p1c","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T00:33:43.459617035-05:00","updated_at":"2026-01-17T00:34:58.476129841-05:00","closed_at":"2026-01-17T00:34:58.476129841-05:00","close_reason":"Cleanup","ephemeral":true}
{"id":"hq-wisp-u5qyi","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:47:34.369793707-05:00","updated_at":"2026-01-16T23:49:14.351566926-05:00","closed_at":"2026-01-16T23:49:14.351566926-05:00","close_reason":"Town idle patrol","dependencies":[{"issue_id":"hq-wisp-u5qyi","depends_on_id":"hq-wisp-ql31w","type":"parent-child","created_at":"2026-01-16T23:47:35.090170846-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-u5qyi","depends_on_id":"hq-wisp-ntfk0","type":"blocks","created_at":"2026-01-16T23:47:37.231765715-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-u85et","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:47:48.010485179-05:00","updated_at":"2026-01-17T00:35:32.726385659-05:00","closed_at":"2026-01-17T00:35:32.726385659-05:00","close_reason":"Cleanup","ephemeral":true}
{"id":"hq-wisp-u8f3","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:23:47.733774117-05:00","updated_at":"2026-01-16T23:24:51.498780733-05:00","closed_at":"2026-01-16T23:24:51.498780733-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-u8f3","depends_on_id":"hq-wisp-9we3","type":"parent-child","created_at":"2026-01-16T23:23:48.409478445-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-u8f3","depends_on_id":"hq-wisp-f6x3","type":"blocks","created_at":"2026-01-16T23:23:50.161832632-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-u8f3","depends_on_id":"hq-wisp-j2tz","type":"blocks","created_at":"2026-01-16T23:23:50.258875995-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-u8f3","depends_on_id":"hq-wisp-fb21","type":"blocks","created_at":"2026-01-16T23:23:50.356297482-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-u9asm","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:41:51.251170644-05:00","updated_at":"2026-01-16T23:42:37.302922951-05:00","closed_at":"2026-01-16T23:42:37.302922951-05:00","close_reason":"Town idle / pool at capacity","dependencies":[{"issue_id":"hq-wisp-u9asm","depends_on_id":"hq-wisp-tnkch","type":"parent-child","created_at":"2026-01-16T23:41:52.096352785-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-u9asm","depends_on_id":"hq-wisp-ijoir","type":"blocks","created_at":"2026-01-16T23:41:54.199877222-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-u9fu","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:15:01.194759808-05:00","updated_at":"2026-01-16T23:15:59.213980429-05:00","closed_at":"2026-01-16T23:15:59.213980429-05:00","close_reason":"No gates, convoys, or pending polecats","dependencies":[{"issue_id":"hq-wisp-u9fu","depends_on_id":"hq-wisp-9osz","type":"parent-child","created_at":"2026-01-16T23:15:01.271190957-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-u9fu","depends_on_id":"hq-wisp-mut6","type":"blocks","created_at":"2026-01-16T23:15:02.520331579-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-uavs","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T01:46:32.73424858-05:00","updated_at":"2026-01-16T01:50:38.941410065-05:00","closed_at":"2026-01-16T01:50:38.941410065-05:00","close_reason":"Stale patrol wisp cleanup","ephemeral":true}
{"id":"hq-wisp-ub9q9","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:28:49.927013393-05:00","updated_at":"2026-01-17T00:29:03.216695569-05:00","closed_at":"2026-01-17T00:29:03.216695569-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-ub9q9","depends_on_id":"hq-wisp-9l1zx","type":"parent-child","created_at":"2026-01-17T00:28:51.061083964-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ub9q9","depends_on_id":"hq-wisp-yjvv0","type":"blocks","created_at":"2026-01-17T00:28:55.061275479-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-uband","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T00:06:46.281658053-05:00","updated_at":"2026-01-17T00:35:07.298762592-05:00","closed_at":"2026-01-17T00:35:07.298762592-05:00","close_reason":"Cleanup","ephemeral":true}
{"id":"hq-wisp-uckl","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:05:01.103908966-05:00","updated_at":"2026-01-16T22:13:02.000051804-05:00","closed_at":"2026-01-16T22:13:02.000051804-05:00","close_reason":"Orphaned - forced cleanup","dependencies":[{"issue_id":"hq-wisp-uckl","depends_on_id":"hq-wisp-xrtb","type":"parent-child","created_at":"2026-01-16T22:05:01.200531885-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-uckl","depends_on_id":"hq-wisp-9g6u","type":"blocks","created_at":"2026-01-16T22:05:01.366526425-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-udjx9","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:07:28.961581732-05:00","updated_at":"2026-01-17T01:08:47.390970322-05:00","closed_at":"2026-01-17T01:08:47.390970322-05:00","close_reason":"Inbox clear","dependencies":[{"issue_id":"hq-wisp-udjx9","depends_on_id":"hq-wisp-fnimo","type":"parent-child","created_at":"2026-01-17T01:07:28.978464039-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-udn1h","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T00:14:05.232706573-05:00","updated_at":"2026-01-17T00:35:06.993459146-05:00","closed_at":"2026-01-17T00:35:06.993459146-05:00","close_reason":"Cleanup","ephemeral":true}
{"id":"hq-wisp-ueo5b","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:03:11.640349329-05:00","updated_at":"2026-01-17T01:04:22.496349896-05:00","closed_at":"2026-01-17T01:04:22.496349896-05:00","close_reason":"No plugins","dependencies":[{"issue_id":"hq-wisp-ueo5b","depends_on_id":"hq-wisp-zx2sm","type":"parent-child","created_at":"2026-01-17T01:03:17.015866956-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ueo5b","depends_on_id":"hq-wisp-2uwwm","type":"blocks","created_at":"2026-01-17T01:03:29.110464262-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ueois","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T00:39:29.516885338-05:00","updated_at":"2026-01-17T00:39:47.13964107-05:00","closed_at":"2026-01-17T00:39:47.13964107-05:00","close_reason":"OK","ephemeral":true}
{"id":"hq-wisp-uet7","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:56:35.923416891-05:00","updated_at":"2026-01-16T22:13:02.166130802-05:00","closed_at":"2026-01-16T22:13:02.166130802-05:00","close_reason":"Orphaned - forced cleanup","dependencies":[{"issue_id":"hq-wisp-uet7","depends_on_id":"hq-wisp-8d7d","type":"parent-child","created_at":"2026-01-16T01:56:35.960134601-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-uet7","depends_on_id":"hq-wisp-jce6","type":"blocks","created_at":"2026-01-16T01:56:36.018717412-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-uf6tn","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:43:06.01161786-05:00","updated_at":"2026-01-16T23:43:34.768905899-05:00","closed_at":"2026-01-16T23:43:34.768905899-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-uf6tn","depends_on_id":"hq-wisp-p7g8j","type":"parent-child","created_at":"2026-01-16T23:43:06.981562055-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-uf6tn","depends_on_id":"hq-wisp-zph4x","type":"blocks","created_at":"2026-01-16T23:43:09.159378755-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ugvkw","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:05:32.497145607-05:00","updated_at":"2026-01-17T01:06:54.587132299-05:00","closed_at":"2026-01-17T01:06:54.587132299-05:00","close_reason":"Idle town","dependencies":[{"issue_id":"hq-wisp-ugvkw","depends_on_id":"hq-wisp-p8n2g","type":"parent-child","created_at":"2026-01-17T01:05:40.275585999-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ugvkw","depends_on_id":"hq-wisp-7eg6s","type":"blocks","created_at":"2026-01-17T01:05:52.4992624-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-uhyo","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:53:28.901025432-05:00","updated_at":"2026-01-16T01:54:17.600479662-05:00","closed_at":"2026-01-16T01:54:17.600479662-05:00","close_reason":"Orphan cleanup","dependencies":[{"issue_id":"hq-wisp-uhyo","depends_on_id":"hq-wisp-eke2","type":"parent-child","created_at":"2026-01-16T01:53:28.916184123-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-uhyo","depends_on_id":"hq-wisp-myg7","type":"blocks","created_at":"2026-01-16T01:53:28.954684957-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ujbb2","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T02:00:44.576058686-05:00","updated_at":"2026-01-17T02:01:55.778530552-05:00","closed_at":"2026-01-17T02:01:55.778530552-05:00","close_reason":"Idle patrol","dependencies":[{"issue_id":"hq-wisp-ujbb2","depends_on_id":"hq-wisp-9a1wp","type":"parent-child","created_at":"2026-01-17T02:00:53.912778161-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ujbb2","depends_on_id":"hq-wisp-5z6z9","type":"blocks","created_at":"2026-01-17T02:01:06.677116512-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ulxlo","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:30:03.171051065-05:00","updated_at":"2026-01-17T00:30:24.520778532-05:00","closed_at":"2026-01-17T00:30:24.520778532-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-ulxlo","depends_on_id":"hq-wisp-8d16m","type":"parent-child","created_at":"2026-01-17T00:30:03.18717446-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-umi8y","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:58:39.890913222-05:00","updated_at":"2026-01-17T00:59:42.927795218-05:00","closed_at":"2026-01-17T00:59:42.927795218-05:00","close_reason":"No gate-ready molecules","dependencies":[{"issue_id":"hq-wisp-umi8y","depends_on_id":"hq-wisp-0nlhz","type":"parent-child","created_at":"2026-01-17T00:58:41.530497605-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-umi8y","depends_on_id":"hq-wisp-9b66w","type":"blocks","created_at":"2026-01-17T00:58:51.392158822-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-un17","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:21:24.467889428-05:00","updated_at":"2026-01-16T23:22:16.07003926-05:00","closed_at":"2026-01-16T23:22:16.07003926-05:00","close_reason":"No recent closures","dependencies":[{"issue_id":"hq-wisp-un17","depends_on_id":"hq-wisp-87xr","type":"parent-child","created_at":"2026-01-16T23:21:24.885687916-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-un17","depends_on_id":"hq-wisp-s0h1","type":"blocks","created_at":"2026-01-16T23:21:26.432434845-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-unbvr","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:53:05.622295735-05:00","updated_at":"2026-01-16T23:53:54.608063299-05:00","closed_at":"2026-01-16T23:53:54.608063299-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-unbvr","depends_on_id":"hq-wisp-xtx6n","type":"parent-child","created_at":"2026-01-16T23:53:07.032308483-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-unbvr","depends_on_id":"hq-wisp-feqrq","type":"blocks","created_at":"2026-01-16T23:53:10.50006494-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-unqis","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T10:47:55.319126243-05:00","updated_at":"2026-01-17T10:54:45.145290817-05:00","closed_at":"2026-01-17T10:54:45.145290817-05:00","close_reason":"Town idle, dog pool healthy (8 idle), no polecats","dependencies":[{"issue_id":"hq-wisp-unqis","depends_on_id":"hq-wisp-9hr1x","type":"parent-child","created_at":"2026-01-17T10:47:55.622668523-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-unqis","depends_on_id":"hq-wisp-vwkwi","type":"blocks","created_at":"2026-01-17T10:47:56.397861695-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-uofae","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:52:50.332468907-05:00","updated_at":"2026-01-17T00:55:54.241606574-05:00","closed_at":"2026-01-17T00:55:54.241606574-05:00","close_reason":"Dog pool healthy","dependencies":[{"issue_id":"hq-wisp-uofae","depends_on_id":"hq-wisp-xo3wl","type":"parent-child","created_at":"2026-01-17T00:52:55.733176331-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-uofae","depends_on_id":"hq-wisp-444g8","type":"blocks","created_at":"2026-01-17T00:53:06.730654004-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-up3n","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:43:15.718455641-05:00","updated_at":"2026-01-16T21:48:19.610644406-05:00","closed_at":"2026-01-16T21:48:19.610644406-05:00","close_reason":"Closed","dependencies":[{"issue_id":"hq-wisp-up3n","depends_on_id":"hq-wisp-l7vn","type":"parent-child","created_at":"2026-01-16T21:43:15.746818049-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-up3n","depends_on_id":"hq-wisp-35bd","type":"blocks","created_at":"2026-01-16T21:43:15.808404273-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-up3n","depends_on_id":"hq-wisp-9sdd","type":"blocks","created_at":"2026-01-16T21:43:15.812333933-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-up3n","depends_on_id":"hq-wisp-6hkl","type":"blocks","created_at":"2026-01-16T21:43:15.816435426-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-uq4kl","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T02:00:44.580034517-05:00","updated_at":"2026-01-17T02:01:57.666997648-05:00","closed_at":"2026-01-17T02:01:57.666997648-05:00","close_reason":"Idle patrol","dependencies":[{"issue_id":"hq-wisp-uq4kl","depends_on_id":"hq-wisp-9a1wp","type":"parent-child","created_at":"2026-01-17T02:00:55.824260415-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-uq4kl","depends_on_id":"hq-wisp-hyean","type":"blocks","created_at":"2026-01-17T02:01:08.612855215-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-uqjc0","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:52:28.531982391-05:00","updated_at":"2026-01-16T23:52:49.927683934-05:00","closed_at":"2026-01-16T23:52:49.927683934-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-uqjc0","depends_on_id":"hq-wisp-en6ig","type":"parent-child","created_at":"2026-01-16T23:52:29.575637665-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-uqjc0","depends_on_id":"hq-wisp-4ibhk","type":"blocks","created_at":"2026-01-16T23:52:32.690174624-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-usgke","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:09:41.607570227-05:00","updated_at":"2026-01-17T01:10:29.953159639-05:00","closed_at":"2026-01-17T01:10:29.953159639-05:00","close_reason":"No convoys","dependencies":[{"issue_id":"hq-wisp-usgke","depends_on_id":"hq-wisp-fsms9","type":"parent-child","created_at":"2026-01-17T01:09:44.010160795-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-usgke","depends_on_id":"hq-wisp-rd4pm","type":"blocks","created_at":"2026-01-17T01:09:54.986172013-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ut5y4","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:30:39.080170167-05:00","updated_at":"2026-01-17T00:30:52.782192413-05:00","closed_at":"2026-01-17T00:30:52.782192413-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-ut5y4","depends_on_id":"hq-wisp-tjzfo","type":"parent-child","created_at":"2026-01-17T00:30:39.344187133-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ut5y4","depends_on_id":"hq-wisp-efpag","type":"blocks","created_at":"2026-01-17T00:30:43.889096343-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-utk0g","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:44:41.993708432-05:00","updated_at":"2026-01-17T10:44:41.993708473-05:00","dependencies":[{"issue_id":"hq-wisp-utk0g","depends_on_id":"hq-wisp-qd1hf","type":"parent-child","created_at":"2026-01-17T10:44:42.007298839-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-uu5j6","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T00:40:29.367683841-05:00","updated_at":"2026-01-17T00:40:47.775166904-05:00","closed_at":"2026-01-17T00:40:47.775166904-05:00","close_reason":"OK","ephemeral":true}
{"id":"hq-wisp-uujr","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:19:36.430826656-05:00","updated_at":"2026-01-16T23:20:28.787518063-05:00","closed_at":"2026-01-16T23:20:28.787518063-05:00","close_reason":"No activity, no gated mols","dependencies":[{"issue_id":"hq-wisp-uujr","depends_on_id":"hq-wisp-pfs9","type":"parent-child","created_at":"2026-01-16T23:19:36.666253-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-uujr","depends_on_id":"hq-wisp-5m63","type":"blocks","created_at":"2026-01-16T23:19:38.002835161-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-uumat","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:25:52.714229492-05:00","updated_at":"2026-01-16T23:26:32.319754074-05:00","closed_at":"2026-01-16T23:26:32.319754074-05:00","close_reason":"No gates/convoys/pending","dependencies":[{"issue_id":"hq-wisp-uumat","depends_on_id":"hq-wisp-w4tn2","type":"parent-child","created_at":"2026-01-16T23:25:52.818779562-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-uumat","depends_on_id":"hq-wisp-123hh","type":"blocks","created_at":"2026-01-16T23:25:54.499979176-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-uummf","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:49:59.365440912-05:00","updated_at":"2026-01-17T10:49:59.365440995-05:00","dependencies":[{"issue_id":"hq-wisp-uummf","depends_on_id":"hq-wisp-wxw0u","type":"parent-child","created_at":"2026-01-17T10:50:00.166154276-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-uummf","depends_on_id":"hq-wisp-xlm78","type":"blocks","created_at":"2026-01-17T10:50:01.16040432-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-uuyy","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:55:03.037334199-05:00","updated_at":"2026-01-16T01:52:14.231859779-05:00","closed_at":"2026-01-16T01:52:14.231859779-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-uuyy","depends_on_id":"hq-wisp-7be","type":"parent-child","created_at":"2026-01-16T00:55:03.055602913-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-uw7gz","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:46:10.411673835-05:00","updated_at":"2026-01-17T10:46:10.411673835-05:00","dependencies":[{"issue_id":"hq-wisp-uw7gz","depends_on_id":"hq-wisp-bio5t","type":"parent-child","created_at":"2026-01-17T10:46:10.728691692-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-uw7gz","depends_on_id":"hq-wisp-qlqrm","type":"blocks","created_at":"2026-01-17T10:46:11.150281403-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-uw9ll","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:02:22.548480289-05:00","updated_at":"2026-01-17T01:03:56.728529551-05:00","closed_at":"2026-01-17T01:03:56.728529551-05:00","close_reason":"No pending polecats","dependencies":[{"issue_id":"hq-wisp-uw9ll","depends_on_id":"hq-wisp-xwv1q","type":"parent-child","created_at":"2026-01-17T01:02:23.136900292-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-uw9ll","depends_on_id":"hq-wisp-jdost","type":"blocks","created_at":"2026-01-17T01:02:33.606377577-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-uwinq","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:07:28.975194711-05:00","updated_at":"2026-01-17T01:09:31.664138677-05:00","closed_at":"2026-01-17T01:09:31.664138677-05:00","close_reason":"Inbox clear","dependencies":[{"issue_id":"hq-wisp-uwinq","depends_on_id":"hq-wisp-fnimo","type":"parent-child","created_at":"2026-01-17T01:07:38.313777716-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-uwinq","depends_on_id":"hq-wisp-godc7","type":"blocks","created_at":"2026-01-17T01:07:50.002626958-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-uxg7q","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:49:35.728138865-05:00","updated_at":"2026-01-16T23:50:17.981800298-05:00","closed_at":"2026-01-16T23:50:17.981800298-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-uxg7q","depends_on_id":"hq-wisp-n4f70","type":"parent-child","created_at":"2026-01-16T23:49:38.027866581-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-uxg7q","depends_on_id":"hq-wisp-snch9","type":"blocks","created_at":"2026-01-16T23:49:40.785867377-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-uxuhw","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:47:34.374009181-05:00","updated_at":"2026-01-16T23:49:12.455466206-05:00","closed_at":"2026-01-16T23:49:12.455466206-05:00","close_reason":"Town idle patrol","dependencies":[{"issue_id":"hq-wisp-uxuhw","depends_on_id":"hq-wisp-ql31w","type":"parent-child","created_at":"2026-01-16T23:47:36.036540048-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-uxuhw","depends_on_id":"hq-wisp-7sg0e","type":"blocks","created_at":"2026-01-16T23:47:38.446761931-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-uyot","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:20:12.710506055-05:00","updated_at":"2026-01-17T00:35:58.7571016-05:00","closed_at":"2026-01-17T00:35:58.7571016-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-uzura","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:45:12.287306491-05:00","updated_at":"2026-01-17T00:35:35.098320842-05:00","closed_at":"2026-01-17T00:35:35.098320842-05:00","close_reason":"Cleanup","ephemeral":true}
{"id":"hq-wisp-v0p41","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:31:03.245882503-05:00","updated_at":"2026-01-17T00:31:17.664100802-05:00","closed_at":"2026-01-17T00:31:17.664100802-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-v0p41","depends_on_id":"hq-wisp-apmz9","type":"parent-child","created_at":"2026-01-17T00:31:04.267929538-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-v0p41","depends_on_id":"hq-wisp-1vntb","type":"blocks","created_at":"2026-01-17T00:31:08.881735277-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-v0zr6","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:40:19.8757624-05:00","updated_at":"2026-01-16T23:41:28.120915589-05:00","closed_at":"2026-01-16T23:41:28.120915589-05:00","close_reason":"Pool at capacity / scan not available","dependencies":[{"issue_id":"hq-wisp-v0zr6","depends_on_id":"hq-wisp-6gnpy","type":"parent-child","created_at":"2026-01-16T23:40:20.660079632-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-v0zr6","depends_on_id":"hq-wisp-7lot5","type":"blocks","created_at":"2026-01-16T23:40:22.635687627-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-v1feq","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:09:41.605949437-05:00","updated_at":"2026-01-17T01:10:33.256044089-05:00","closed_at":"2026-01-17T01:10:33.256044089-05:00","close_reason":"No async gates","dependencies":[{"issue_id":"hq-wisp-v1feq","depends_on_id":"hq-wisp-fsms9","type":"parent-child","created_at":"2026-01-17T01:09:42.811691798-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-v1feq","depends_on_id":"hq-wisp-rd4pm","type":"blocks","created_at":"2026-01-17T01:09:53.726180738-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-v3dak","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:46:10.406506338-05:00","updated_at":"2026-01-17T10:46:10.40650638-05:00","dependencies":[{"issue_id":"hq-wisp-v3dak","depends_on_id":"hq-wisp-bio5t","type":"parent-child","created_at":"2026-01-17T10:46:10.571037325-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-v3dak","depends_on_id":"hq-wisp-vhfc0","type":"blocks","created_at":"2026-01-17T10:46:10.970891133-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-v4hid","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:03:11.641100037-05:00","updated_at":"2026-01-17T01:04:14.361087391-05:00","closed_at":"2026-01-17T01:04:14.361087391-05:00","close_reason":"Pool healthy","dependencies":[{"issue_id":"hq-wisp-v4hid","depends_on_id":"hq-wisp-zx2sm","type":"parent-child","created_at":"2026-01-17T01:03:17.621723802-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-v4hid","depends_on_id":"hq-wisp-d3ra0","type":"blocks","created_at":"2026-01-17T01:03:29.720135143-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-v4ri","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:02:26.553709259-05:00","updated_at":"2026-01-16T23:14:43.896345467-05:00","closed_at":"2026-01-16T23:14:43.896345467-05:00","close_reason":"Duplicate patrol wisp, cleaned up","ephemeral":true}
{"id":"hq-wisp-vake","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T22:20:19.158407611-05:00","updated_at":"2026-01-17T00:36:21.944388376-05:00","closed_at":"2026-01-17T00:36:21.944388376-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-vckv","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:15:41.212403129-05:00","updated_at":"2026-01-17T00:36:01.108944523-05:00","closed_at":"2026-01-17T00:36:01.108944523-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-vd6rl","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:53:25.158382664-05:00","updated_at":"2026-01-16T23:53:48.36355427-05:00","closed_at":"2026-01-16T23:53:48.36355427-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-vd6rl","depends_on_id":"hq-wisp-of0wi","type":"parent-child","created_at":"2026-01-16T23:53:27.16904395-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-vd6rl","depends_on_id":"hq-wisp-8kaiy","type":"blocks","created_at":"2026-01-16T23:53:30.56849371-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-vdwj","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:36:59.339907912-05:00","updated_at":"2026-01-16T23:37:39.168146425-05:00","closed_at":"2026-01-16T23:37:39.168146425-05:00","close_reason":"Nothing pending","dependencies":[{"issue_id":"hq-wisp-vdwj","depends_on_id":"hq-wisp-c8tl","type":"parent-child","created_at":"2026-01-16T23:36:59.669529452-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-vdwj","depends_on_id":"hq-wisp-exeb","type":"blocks","created_at":"2026-01-16T23:37:01.140536012-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-vgahj","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:52:50.338062355-05:00","updated_at":"2026-01-17T00:56:22.517718568-05:00","closed_at":"2026-01-17T00:56:22.517718568-05:00","close_reason":"Inbox clear","dependencies":[{"issue_id":"hq-wisp-vgahj","depends_on_id":"hq-wisp-xo3wl","type":"parent-child","created_at":"2026-01-17T00:52:59.066226954-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-vgahj","depends_on_id":"hq-wisp-1gsz0","type":"blocks","created_at":"2026-01-17T00:53:10.037040346-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-vgod","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:15:01.195178683-05:00","updated_at":"2026-01-16T23:15:59.033717846-05:00","closed_at":"2026-01-16T23:15:59.033717846-05:00","close_reason":"No gates, convoys, or pending polecats","dependencies":[{"issue_id":"hq-wisp-vgod","depends_on_id":"hq-wisp-9osz","type":"parent-child","created_at":"2026-01-16T23:15:01.339254982-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-vgod","depends_on_id":"hq-wisp-mut6","type":"blocks","created_at":"2026-01-16T23:15:02.590724437-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-vhfc0","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:46:10.405924339-05:00","updated_at":"2026-01-17T10:46:10.40592438-05:00","dependencies":[{"issue_id":"hq-wisp-vhfc0","depends_on_id":"hq-wisp-bio5t","type":"parent-child","created_at":"2026-01-17T10:46:10.551011754-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-vhfc0","depends_on_id":"hq-wisp-4aa7m","type":"blocks","created_at":"2026-01-17T10:46:10.906272796-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-vhfc0","depends_on_id":"hq-wisp-ogebh","type":"blocks","created_at":"2026-01-17T10:46:10.9282232-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-vhfc0","depends_on_id":"hq-wisp-s4yuv","type":"blocks","created_at":"2026-01-17T10:46:10.949670229-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-viq4","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:27:24.235730887-05:00","updated_at":"2026-01-16T01:52:13.814838483-05:00","closed_at":"2026-01-16T01:52:13.814838483-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-viq4","depends_on_id":"hq-wisp-nv4o","type":"parent-child","created_at":"2026-01-16T01:27:24.28291513-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-viq4","depends_on_id":"hq-wisp-dyyq","type":"blocks","created_at":"2026-01-16T01:27:24.438563343-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-vj08","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:56:35.922558267-05:00","updated_at":"2026-01-16T22:13:02.177859871-05:00","closed_at":"2026-01-16T22:13:02.177859871-05:00","close_reason":"Orphaned - forced cleanup","dependencies":[{"issue_id":"hq-wisp-vj08","depends_on_id":"hq-wisp-8d7d","type":"parent-child","created_at":"2026-01-16T01:56:35.953438317-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-vj08","depends_on_id":"hq-wisp-nzfs","type":"blocks","created_at":"2026-01-16T01:56:36.005794052-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-vkkp","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T21:43:29.827577711-05:00","updated_at":"2026-01-16T21:45:51.824652687-05:00","closed_at":"2026-01-16T21:45:51.824652687-05:00","close_reason":"Closed","ephemeral":true}
{"id":"hq-wisp-vkrx","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:19:36.436108572-05:00","updated_at":"2026-01-16T23:21:11.012172884-05:00","closed_at":"2026-01-16T23:21:11.012172884-05:00","close_reason":"Standard cleanup, context low, looping","dependencies":[{"issue_id":"hq-wisp-vkrx","depends_on_id":"hq-wisp-pfs9","type":"parent-child","created_at":"2026-01-16T23:19:37.628785209-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-vkrx","depends_on_id":"hq-wisp-nsma","type":"blocks","created_at":"2026-01-16T23:19:39.13783589-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-vllyd","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:04:43.439257859-05:00","updated_at":"2026-01-17T01:06:06.674276941-05:00","closed_at":"2026-01-17T01:06:06.674276941-05:00","close_reason":"No notifications","dependencies":[{"issue_id":"hq-wisp-vllyd","depends_on_id":"hq-wisp-bkl5l","type":"parent-child","created_at":"2026-01-17T01:04:46.946676132-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-vllyd","depends_on_id":"hq-wisp-bdss1","type":"blocks","created_at":"2026-01-17T01:04:57.770655146-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-vn3t7","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:54:08.829871525-05:00","updated_at":"2026-01-16T23:55:00.55263079-05:00","closed_at":"2026-01-16T23:55:00.55263079-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-vn3t7","depends_on_id":"hq-wisp-oecdp","type":"parent-child","created_at":"2026-01-16T23:54:09.638651236-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-vn3t7","depends_on_id":"hq-wisp-o7iq4","type":"blocks","created_at":"2026-01-16T23:54:12.541863211-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-vnel","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:55:09.581292213-05:00","updated_at":"2026-01-16T00:55:16.056128247-05:00","closed_at":"2026-01-16T00:55:16.056128247-05:00","close_reason":"Town healthy","dependencies":[{"issue_id":"hq-wisp-vnel","depends_on_id":"hq-wisp-3o9w","type":"parent-child","created_at":"2026-01-16T00:55:09.660776321-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-vp00","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T22:26:12.901089308-05:00","updated_at":"2026-01-17T00:36:19.744434178-05:00","closed_at":"2026-01-17T00:36:19.744434178-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-vrns7","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:38:38.665766907-05:00","updated_at":"2026-01-17T00:27:43.274116518-05:00","closed_at":"2026-01-17T00:27:43.274116518-05:00","close_reason":"Patrol cycle 6 complete","ephemeral":true}
{"id":"hq-wisp-vrogi","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:56:40.333314334-05:00","updated_at":"2026-01-17T00:57:44.829217926-05:00","closed_at":"2026-01-17T00:57:44.829217926-05:00","close_reason":"No external deps","dependencies":[{"issue_id":"hq-wisp-vrogi","depends_on_id":"hq-wisp-an994","type":"parent-child","created_at":"2026-01-17T00:56:43.065463255-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-vrogi","depends_on_id":"hq-wisp-bn7j4","type":"blocks","created_at":"2026-01-17T00:56:53.264075699-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-vrsc5","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T01:08:16.841212816-05:00","updated_at":"2026-01-17T01:11:07.570820654-05:00","closed_at":"2026-01-17T01:11:07.570820654-05:00","close_reason":"Patrol #20 complete - handoff threshold reached","ephemeral":true}
{"id":"hq-wisp-vs5wm","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:49:57.518829034-05:00","updated_at":"2026-01-17T10:49:57.518829075-05:00","dependencies":[{"issue_id":"hq-wisp-vs5wm","depends_on_id":"hq-wisp-8agmn","type":"parent-child","created_at":"2026-01-17T10:49:57.682219813-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-vs5wm","depends_on_id":"hq-wisp-gtj8g","type":"blocks","created_at":"2026-01-17T10:49:58.375171866-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-vu2re","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:51:56.827840778-05:00","updated_at":"2026-01-16T23:52:51.302953876-05:00","closed_at":"2026-01-16T23:52:51.302953876-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-vu2re","depends_on_id":"hq-wisp-ri9se","type":"parent-child","created_at":"2026-01-16T23:51:57.165130725-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-vu2re","depends_on_id":"hq-wisp-2y91t","type":"blocks","created_at":"2026-01-16T23:52:00.126061011-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-vwkwi","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T10:47:55.318563285-05:00","updated_at":"2026-01-17T10:54:12.629110803-05:00","closed_at":"2026-01-17T10:54:12.629110803-05:00","close_reason":"All witnesses and refineries running, town idle","dependencies":[{"issue_id":"hq-wisp-vwkwi","depends_on_id":"hq-wisp-9hr1x","type":"parent-child","created_at":"2026-01-17T10:47:55.585296379-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-vwkwi","depends_on_id":"hq-wisp-6qmq6","type":"blocks","created_at":"2026-01-17T10:47:56.276180058-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-vwkwi","depends_on_id":"hq-wisp-o98gy","type":"blocks","created_at":"2026-01-17T10:47:56.316302576-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-vwkwi","depends_on_id":"hq-wisp-5ot2b","type":"blocks","created_at":"2026-01-17T10:47:56.357678968-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-vxnla","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:43:56.998360941-05:00","updated_at":"2026-01-16T23:44:18.673309076-05:00","closed_at":"2026-01-16T23:44:18.673309076-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-vxnla","depends_on_id":"hq-wisp-ywecn","type":"parent-child","created_at":"2026-01-16T23:43:58.758387297-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-vxnla","depends_on_id":"hq-wisp-x8afi","type":"blocks","created_at":"2026-01-16T23:44:00.872741982-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-vxp6z","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:56:40.334488082-05:00","updated_at":"2026-01-17T00:57:45.840231777-05:00","closed_at":"2026-01-17T00:57:45.840231777-05:00","close_reason":"No notifications","dependencies":[{"issue_id":"hq-wisp-vxp6z","depends_on_id":"hq-wisp-an994","type":"parent-child","created_at":"2026-01-17T00:56:43.618308612-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-vxp6z","depends_on_id":"hq-wisp-vrogi","type":"blocks","created_at":"2026-01-17T00:56:53.884575453-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-vy1cp","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:52:28.529043893-05:00","updated_at":"2026-01-16T23:52:50.885485614-05:00","closed_at":"2026-01-16T23:52:50.885485614-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-vy1cp","depends_on_id":"hq-wisp-en6ig","type":"parent-child","created_at":"2026-01-16T23:52:28.711486127-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-vy1cp","depends_on_id":"hq-wisp-gc9or","type":"blocks","created_at":"2026-01-16T23:52:31.824220629-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-vy7wm","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:52:58.274325804-05:00","updated_at":"2026-01-16T23:53:18.237248655-05:00","closed_at":"2026-01-16T23:53:18.237248655-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-vy7wm","depends_on_id":"hq-wisp-a5ye3","type":"parent-child","created_at":"2026-01-16T23:52:58.450001502-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-vy7wm","depends_on_id":"hq-wisp-b9h7w","type":"blocks","created_at":"2026-01-16T23:53:01.408009143-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-w12cw","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:49:59.357038667-05:00","updated_at":"2026-01-17T10:49:59.357038708-05:00","dependencies":[{"issue_id":"hq-wisp-w12cw","depends_on_id":"hq-wisp-wxw0u","type":"parent-child","created_at":"2026-01-17T10:49:59.634174296-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-w12cw","depends_on_id":"hq-wisp-l16x5","type":"blocks","created_at":"2026-01-17T10:50:00.434805661-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-w1g8e","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:05:32.483703253-05:00","updated_at":"2026-01-17T01:06:15.86635386-05:00","closed_at":"2026-01-17T01:06:15.86635386-05:00","close_reason":"Idle town","dependencies":[{"issue_id":"hq-wisp-w1g8e","depends_on_id":"hq-wisp-p8n2g","type":"parent-child","created_at":"2026-01-17T01:05:32.502693849-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-w1lo","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:55:36.780255671-05:00","updated_at":"2026-01-16T01:56:08.192412092-05:00","closed_at":"2026-01-16T01:56:08.192412092-05:00","close_reason":"Orphan wisp cleanup","dependencies":[{"issue_id":"hq-wisp-w1lo","depends_on_id":"hq-wisp-ndqt","type":"parent-child","created_at":"2026-01-16T01:55:36.794061031-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-w1lo","depends_on_id":"hq-wisp-rphz","type":"blocks","created_at":"2026-01-16T01:55:36.914987691-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-w26ti","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:49:57.52537203-05:00","updated_at":"2026-01-17T10:49:57.525372072-05:00","dependencies":[{"issue_id":"hq-wisp-w26ti","depends_on_id":"hq-wisp-8agmn","type":"parent-child","created_at":"2026-01-17T10:49:58.027867819-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-w26ti","depends_on_id":"hq-wisp-n2yzo","type":"blocks","created_at":"2026-01-17T10:49:58.810830069-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-w2xmz","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:47:34.367644136-05:00","updated_at":"2026-01-16T23:49:14.907488409-05:00","closed_at":"2026-01-16T23:49:14.907488409-05:00","close_reason":"Town idle patrol","dependencies":[{"issue_id":"hq-wisp-w2xmz","depends_on_id":"hq-wisp-ql31w","type":"parent-child","created_at":"2026-01-16T23:47:34.733308486-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-w2xmz","depends_on_id":"hq-wisp-j9dts","type":"blocks","created_at":"2026-01-16T23:47:36.870805213-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-w38er","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:56:40.338748992-05:00","updated_at":"2026-01-17T00:58:01.625091755-05:00","closed_at":"2026-01-17T00:58:01.625091755-05:00","close_reason":"No stuck dogs","dependencies":[{"issue_id":"hq-wisp-w38er","depends_on_id":"hq-wisp-an994","type":"parent-child","created_at":"2026-01-17T00:56:46.456253204-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-w38er","depends_on_id":"hq-wisp-c6w4d","type":"blocks","created_at":"2026-01-17T00:56:57.807618601-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-w4tn2","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:25:52.711636951-05:00","updated_at":"2026-01-17T00:35:52.586147513-05:00","closed_at":"2026-01-17T00:35:52.586147513-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-w5748","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:51:56.835373439-05:00","updated_at":"2026-01-16T23:52:24.466741378-05:00","closed_at":"2026-01-16T23:52:24.466741378-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-w5748","depends_on_id":"hq-wisp-ri9se","type":"parent-child","created_at":"2026-01-16T23:51:59.136422487-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-w5748","depends_on_id":"hq-wisp-b28s8","type":"blocks","created_at":"2026-01-16T23:52:02.467495695-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-w5d8","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:36:59.343840828-05:00","updated_at":"2026-01-16T23:39:28.551409508-05:00","closed_at":"2026-01-16T23:39:28.551409508-05:00","close_reason":"Cleanup needs already identified in cycle 4 - skipping redundant check","dependencies":[{"issue_id":"hq-wisp-w5d8","depends_on_id":"hq-wisp-c8tl","type":"parent-child","created_at":"2026-01-16T23:37:00.401545649-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-w5d8","depends_on_id":"hq-wisp-dsd8","type":"blocks","created_at":"2026-01-16T23:37:02.055636269-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-w5z6p","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T00:29:36.056272713-05:00","updated_at":"2026-01-17T00:29:56.662471924-05:00","closed_at":"2026-01-17T00:29:56.662471924-05:00","close_reason":"Patrol cycle 9 complete","ephemeral":true}
{"id":"hq-wisp-w6cxk","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:51:56.829846652-05:00","updated_at":"2026-01-16T23:52:44.468137861-05:00","closed_at":"2026-01-16T23:52:44.468137861-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-w6cxk","depends_on_id":"hq-wisp-ri9se","type":"parent-child","created_at":"2026-01-16T23:51:57.65293243-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-w6cxk","depends_on_id":"hq-wisp-mzpqk","type":"blocks","created_at":"2026-01-16T23:52:00.620388211-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-w76s","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:23:47.7328472-05:00","updated_at":"2026-01-16T23:24:27.100302966-05:00","closed_at":"2026-01-16T23:24:27.100302966-05:00","close_reason":"No activity, no pending","dependencies":[{"issue_id":"hq-wisp-w76s","depends_on_id":"hq-wisp-9we3","type":"parent-child","created_at":"2026-01-16T23:23:48.220072511-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-w76s","depends_on_id":"hq-wisp-ewec","type":"blocks","created_at":"2026-01-16T23:23:49.970048324-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-w7ej","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:42:27.176316252-05:00","updated_at":"2026-01-16T01:52:13.533676539-05:00","closed_at":"2026-01-16T01:52:13.533676539-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-w7ej","depends_on_id":"hq-wisp-wqti","type":"parent-child","created_at":"2026-01-16T01:42:27.368222668-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-w7quv","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:48:51.074194528-05:00","updated_at":"2026-01-16T23:49:28.992276719-05:00","closed_at":"2026-01-16T23:49:28.992276719-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-w7quv","depends_on_id":"hq-wisp-de87j","type":"parent-child","created_at":"2026-01-16T23:48:51.359726502-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-w7quv","depends_on_id":"hq-wisp-fjhz7","type":"blocks","created_at":"2026-01-16T23:48:53.895173265-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-w8sqv","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:48:51.08020464-05:00","updated_at":"2026-01-16T23:49:17.567312596-05:00","closed_at":"2026-01-16T23:49:17.567312596-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-w8sqv","depends_on_id":"hq-wisp-de87j","type":"parent-child","created_at":"2026-01-16T23:48:53.042352209-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-w8sqv","depends_on_id":"hq-wisp-skcr0","type":"blocks","created_at":"2026-01-16T23:48:55.909149007-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-wb167","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:23:02.704020764-05:00","updated_at":"2026-01-17T00:24:19.748877643-05:00","closed_at":"2026-01-17T00:24:19.748877643-05:00","close_reason":"Town idle/healthy","dependencies":[{"issue_id":"hq-wisp-wb167","depends_on_id":"hq-wisp-93kdl","type":"parent-child","created_at":"2026-01-17T00:23:04.043308876-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-wb167","depends_on_id":"hq-wisp-094qa","type":"blocks","created_at":"2026-01-17T00:23:07.525465535-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-wb167","depends_on_id":"hq-wisp-dq5ps","type":"blocks","created_at":"2026-01-17T00:23:07.72078647-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-wb167","depends_on_id":"hq-wisp-02z3k","type":"blocks","created_at":"2026-01-17T00:23:07.915578864-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-wbik","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T01:09:46.021496192-05:00","updated_at":"2026-01-16T01:50:39.391532783-05:00","closed_at":"2026-01-16T01:50:39.391532783-05:00","close_reason":"Stale patrol wisp cleanup","ephemeral":true}
{"id":"hq-wisp-wbkd3","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T00:00:36.2576676-05:00","updated_at":"2026-01-17T00:35:08.533407358-05:00","closed_at":"2026-01-17T00:35:08.533407358-05:00","close_reason":"Cleanup","ephemeral":true}
{"id":"hq-wisp-wc3v4","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:46:10.409747545-05:00","updated_at":"2026-01-17T10:46:10.409747586-05:00","dependencies":[{"issue_id":"hq-wisp-wc3v4","depends_on_id":"hq-wisp-bio5t","type":"parent-child","created_at":"2026-01-17T10:46:10.670525851-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-wc3v4","depends_on_id":"hq-wisp-jjtor","type":"blocks","created_at":"2026-01-17T10:46:11.080533652-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-wd5z","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:53:28.90431822-05:00","updated_at":"2026-01-16T01:54:17.584369888-05:00","closed_at":"2026-01-16T01:54:17.584369888-05:00","close_reason":"Orphan cleanup","dependencies":[{"issue_id":"hq-wisp-wd5z","depends_on_id":"hq-wisp-eke2","type":"parent-child","created_at":"2026-01-16T01:53:28.927496069-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-wd5z","depends_on_id":"hq-wisp-ia4v","type":"blocks","created_at":"2026-01-16T01:53:28.973714852-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-we8q5","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:02:22.562545433-05:00","updated_at":"2026-01-17T01:04:41.417289266-05:00","closed_at":"2026-01-17T01:04:41.417289266-05:00","close_reason":"Patrol complete, looping","dependencies":[{"issue_id":"hq-wisp-we8q5","depends_on_id":"hq-wisp-xwv1q","type":"parent-child","created_at":"2026-01-17T01:02:33.033626716-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-we8q5","depends_on_id":"hq-wisp-k0mt3","type":"blocks","created_at":"2026-01-17T01:02:44.590822604-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-wewt","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:27:24.23656322-05:00","updated_at":"2026-01-16T01:52:13.800997832-05:00","closed_at":"2026-01-16T01:52:13.800997832-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-wewt","depends_on_id":"hq-wisp-nv4o","type":"parent-child","created_at":"2026-01-16T01:27:24.299409446-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-wewt","depends_on_id":"hq-wisp-2y2a","type":"blocks","created_at":"2026-01-16T01:27:24.45690374-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-wewt","depends_on_id":"hq-wisp-5hbw","type":"blocks","created_at":"2026-01-16T01:27:24.467449354-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-wewt","depends_on_id":"hq-wisp-hlv3","type":"blocks","created_at":"2026-01-16T01:27:24.476216428-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-wge8","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:23:43.500140045-05:00","updated_at":"2026-01-17T00:35:53.847094865-05:00","closed_at":"2026-01-17T00:35:53.847094865-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-wggie","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:46:50.727884495-05:00","updated_at":"2026-01-17T10:46:50.727884537-05:00","dependencies":[{"issue_id":"hq-wisp-wggie","depends_on_id":"hq-wisp-2vhlh","type":"parent-child","created_at":"2026-01-17T10:46:51.041213562-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-wggie","depends_on_id":"hq-wisp-fd7zu","type":"blocks","created_at":"2026-01-17T10:46:51.583567411-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-wgpch","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:44:43.646507475-05:00","updated_at":"2026-01-16T23:45:11.696246808-05:00","closed_at":"2026-01-16T23:45:11.696246808-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-wgpch","depends_on_id":"hq-wisp-bhwu0","type":"parent-child","created_at":"2026-01-16T23:44:45.390944615-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-wgpch","depends_on_id":"hq-wisp-j8mp5","type":"blocks","created_at":"2026-01-16T23:44:47.60462359-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-wgsda","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:37:49.092741974-05:00","updated_at":"2026-01-16T23:41:55.888848254-05:00","closed_at":"2026-01-16T23:41:55.888848254-05:00","close_reason":"Cleanup needs detected (5 stale locks), but dog dispatch not implemented","dependencies":[{"issue_id":"hq-wisp-wgsda","depends_on_id":"hq-wisp-2zuj","type":"parent-child","created_at":"2026-01-16T23:37:50.254291698-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-wgsda","depends_on_id":"hq-wisp-h44sg","type":"blocks","created_at":"2026-01-16T23:37:52.077114128-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-wgst5","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:43:00.968585556-05:00","updated_at":"2026-01-17T00:52:37.48079756-05:00","closed_at":"2026-01-17T00:52:37.48079756-05:00","close_reason":"Looping - patrol 12 of 20","dependencies":[{"issue_id":"hq-wisp-wgst5","depends_on_id":"hq-wisp-jgnad","type":"parent-child","created_at":"2026-01-17T00:43:09.540308783-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-wgst5","depends_on_id":"hq-wisp-zc1mn","type":"blocks","created_at":"2026-01-17T00:43:19.138083514-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-wgv86","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T02:00:44.568978272-05:00","updated_at":"2026-01-17T02:01:50.119679345-05:00","closed_at":"2026-01-17T02:01:50.119679345-05:00","close_reason":"Idle patrol","dependencies":[{"issue_id":"hq-wisp-wgv86","depends_on_id":"hq-wisp-9a1wp","type":"parent-child","created_at":"2026-01-17T02:00:47.828442705-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-wgv86","depends_on_id":"hq-wisp-wjkwl","type":"blocks","created_at":"2026-01-17T02:01:00.255059936-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-whr8h","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T10:44:41.334640716-05:00","updated_at":"2026-01-17T10:45:36.999457335-05:00","closed_at":"2026-01-17T10:45:36.999457335-05:00","close_reason":"Patrol 6 complete","ephemeral":true}
{"id":"hq-wisp-wir3g","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:24:43.294881802-05:00","updated_at":"2026-01-17T00:25:09.253248299-05:00","closed_at":"2026-01-17T00:25:09.253248299-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-wir3g","depends_on_id":"hq-wisp-5fw2b","type":"parent-child","created_at":"2026-01-17T00:24:43.888052964-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-wir3g","depends_on_id":"hq-wisp-m043e","type":"blocks","created_at":"2026-01-17T00:24:47.404792775-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-wj30","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:21:24.469862219-05:00","updated_at":"2026-01-16T23:22:59.097631271-05:00","closed_at":"2026-01-16T23:22:59.097631271-05:00","close_reason":"No zombies, dogs present","dependencies":[{"issue_id":"hq-wisp-wj30","depends_on_id":"hq-wisp-87xr","type":"parent-child","created_at":"2026-01-16T23:21:25.30148678-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-wj30","depends_on_id":"hq-wisp-e3e0","type":"blocks","created_at":"2026-01-16T23:21:27.032022644-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-wj52z","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:47:53.494863841-05:00","updated_at":"2026-01-16T23:48:41.277769068-05:00","closed_at":"2026-01-16T23:48:41.277769068-05:00","close_reason":"Patrol cycle 11 complete","ephemeral":true}
{"id":"hq-wisp-wjkwl","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T02:00:44.568122647-05:00","updated_at":"2026-01-17T02:01:49.501686377-05:00","closed_at":"2026-01-17T02:01:49.501686377-05:00","close_reason":"Idle patrol","dependencies":[{"issue_id":"hq-wisp-wjkwl","depends_on_id":"hq-wisp-9a1wp","type":"parent-child","created_at":"2026-01-17T02:00:47.070972084-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-wjkwl","depends_on_id":"hq-wisp-ijfsf","type":"blocks","created_at":"2026-01-17T02:00:59.609476021-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-wjm3c","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:09:41.619696708-05:00","updated_at":"2026-01-17T01:11:08.282248206-05:00","closed_at":"2026-01-17T01:11:08.282248206-05:00","close_reason":"Handoff - patrol 20 complete","dependencies":[{"issue_id":"hq-wisp-wjm3c","depends_on_id":"hq-wisp-fsms9","type":"parent-child","created_at":"2026-01-17T01:09:52.516322883-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-wjm3c","depends_on_id":"hq-wisp-kpzev","type":"blocks","created_at":"2026-01-17T01:10:04.996186287-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-wjq8y","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:27:48.817881267-05:00","updated_at":"2026-01-16T23:37:36.30927517-05:00","closed_at":"2026-01-16T23:37:36.30927517-05:00","close_reason":"Patrol cycle complete","ephemeral":true}
{"id":"hq-wisp-wlm01","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T00:44:55.027898831-05:00","updated_at":"2026-01-17T00:45:20.083420399-05:00","closed_at":"2026-01-17T00:45:20.083420399-05:00","close_reason":"OK","ephemeral":true}
{"id":"hq-wisp-wlqws","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:52:28.530235184-05:00","updated_at":"2026-01-16T23:52:50.485721421-05:00","closed_at":"2026-01-16T23:52:50.485721421-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-wlqws","depends_on_id":"hq-wisp-en6ig","type":"parent-child","created_at":"2026-01-16T23:52:29.058257608-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-wlqws","depends_on_id":"hq-wisp-8c7bd","type":"blocks","created_at":"2026-01-16T23:52:32.170075527-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-wlsa","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:27:24.239279717-05:00","updated_at":"2026-01-16T01:52:13.724090874-05:00","closed_at":"2026-01-16T01:52:13.724090874-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-wlsa","depends_on_id":"hq-wisp-nv4o","type":"parent-child","created_at":"2026-01-16T01:27:24.386084939-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-wlsa","depends_on_id":"hq-wisp-peu9","type":"blocks","created_at":"2026-01-16T01:27:24.569251998-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-wmln","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T01:56:40.115821826-05:00","updated_at":"2026-01-16T22:12:29.18010874-05:00","closed_at":"2026-01-16T22:12:29.18010874-05:00","close_reason":"Orphaned - bulk cleanup","ephemeral":true}
{"id":"hq-wisp-wmmo","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:22:20.088131284-05:00","updated_at":"2026-01-16T01:52:14.051709934-05:00","closed_at":"2026-01-16T01:52:14.051709934-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-wmmo","depends_on_id":"hq-wisp-gvqg","type":"parent-child","created_at":"2026-01-16T01:22:20.155559047-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-wmnh","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:36:59.33845412-05:00","updated_at":"2026-01-16T23:37:39.260312621-05:00","closed_at":"2026-01-16T23:37:39.260312621-05:00","close_reason":"Nothing pending","dependencies":[{"issue_id":"hq-wisp-wmnh","depends_on_id":"hq-wisp-c8tl","type":"parent-child","created_at":"2026-01-16T23:36:59.508521682-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-wmnh","depends_on_id":"hq-wisp-exeb","type":"blocks","created_at":"2026-01-16T23:37:00.976984825-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-wn1y8","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:23:02.702677559-05:00","updated_at":"2026-01-17T00:24:10.173844599-05:00","closed_at":"2026-01-17T00:24:10.173844599-05:00","close_reason":"No activity","dependencies":[{"issue_id":"hq-wisp-wn1y8","depends_on_id":"hq-wisp-93kdl","type":"parent-child","created_at":"2026-01-17T00:23:03.66527635-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-wn1y8","depends_on_id":"hq-wisp-rpnph","type":"blocks","created_at":"2026-01-17T00:23:07.134866999-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-wn6pp","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:27:30.731872796-05:00","updated_at":"2026-01-17T00:27:53.92556922-05:00","closed_at":"2026-01-17T00:27:53.92556922-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-wn6pp","depends_on_id":"hq-wisp-72ja3","type":"parent-child","created_at":"2026-01-17T00:27:30.948767608-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-wn6pp","depends_on_id":"hq-wisp-sjzmw","type":"blocks","created_at":"2026-01-17T00:27:34.72007037-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-wo748","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:44:43.640021001-05:00","updated_at":"2026-01-16T23:45:28.558455103-05:00","closed_at":"2026-01-16T23:45:28.558455103-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-wo748","depends_on_id":"hq-wisp-bhwu0","type":"parent-child","created_at":"2026-01-16T23:44:44.528013323-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-wo748","depends_on_id":"hq-wisp-eh1aj","type":"blocks","created_at":"2026-01-16T23:44:46.709757632-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-wof8","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:04:28.263519913-05:00","updated_at":"2026-01-16T23:14:43.620108657-05:00","closed_at":"2026-01-16T23:14:43.620108657-05:00","close_reason":"Duplicate patrol wisp, cleaned up","ephemeral":true}
{"id":"hq-wisp-wot3","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:22:50.555428595-05:00","updated_at":"2026-01-17T00:35:54.484034009-05:00","closed_at":"2026-01-17T00:35:54.484034009-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-wql5l","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:25:52.721033158-05:00","updated_at":"2026-01-16T23:27:52.47022742-05:00","closed_at":"2026-01-16T23:27:52.47022742-05:00","close_reason":"No cost wisps","dependencies":[{"issue_id":"hq-wisp-wql5l","depends_on_id":"hq-wisp-w4tn2","type":"parent-child","created_at":"2026-01-16T23:25:54.036893319-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-wql5l","depends_on_id":"hq-wisp-zuvmu","type":"blocks","created_at":"2026-01-16T23:25:55.939863863-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-wqti","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-16T01:42:27.171058632-05:00","updated_at":"2026-01-16T01:52:13.683244085-05:00","closed_at":"2026-01-16T01:52:13.683244085-05:00","close_reason":"Orphaned wisp cleanup","ephemeral":true}
{"id":"hq-wisp-wrste","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:50:53.896376641-05:00","updated_at":"2026-01-16T23:51:31.924160556-05:00","closed_at":"2026-01-16T23:51:31.924160556-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-wrste","depends_on_id":"hq-wisp-47par","type":"parent-child","created_at":"2026-01-16T23:50:55.040904962-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-wrste","depends_on_id":"hq-wisp-ms1lx","type":"blocks","created_at":"2026-01-16T23:50:57.88906346-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-wrvnc","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:37:49.094501515-05:00","updated_at":"2026-01-16T23:45:23.173634769-05:00","closed_at":"2026-01-16T23:45:23.173634769-05:00","close_reason":"Patrol count 12, under threshold, continue","dependencies":[{"issue_id":"hq-wisp-wrvnc","depends_on_id":"hq-wisp-2zuj","type":"parent-child","created_at":"2026-01-16T23:37:50.617462067-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-wrvnc","depends_on_id":"hq-wisp-h34b9","type":"blocks","created_at":"2026-01-16T23:37:52.450569121-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ws4d8","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:54:08.833952063-05:00","updated_at":"2026-01-16T23:54:54.84070279-05:00","closed_at":"2026-01-16T23:54:54.84070279-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-ws4d8","depends_on_id":"hq-wisp-oecdp","type":"parent-child","created_at":"2026-01-16T23:54:10.757867625-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ws4d8","depends_on_id":"hq-wisp-kyk8d","type":"blocks","created_at":"2026-01-16T23:54:14.018912199-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-wt12x","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:37:49.09185714-05:00","updated_at":"2026-01-16T23:40:38.371249846-05:00","closed_at":"2026-01-16T23:40:38.371249846-05:00","close_reason":"No dogs to check (dog pool not implemented)","dependencies":[{"issue_id":"hq-wisp-wt12x","depends_on_id":"hq-wisp-2zuj","type":"parent-child","created_at":"2026-01-16T23:37:50.076680846-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-wt12x","depends_on_id":"hq-wisp-putuv","type":"blocks","created_at":"2026-01-16T23:37:51.892153902-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-wt1xp","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:31:27.067060157-05:00","updated_at":"2026-01-17T00:31:52.486919182-05:00","closed_at":"2026-01-17T00:31:52.486919182-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-wt1xp","depends_on_id":"hq-wisp-6cqlz","type":"parent-child","created_at":"2026-01-17T00:31:28.08477359-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-wt1xp","depends_on_id":"hq-wisp-fp4qm","type":"blocks","created_at":"2026-01-17T00:31:32.630278549-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-wtm1","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:55:36.783633626-05:00","updated_at":"2026-01-16T01:56:27.993750027-05:00","closed_at":"2026-01-16T01:56:27.993750027-05:00","close_reason":"Closed","dependencies":[{"issue_id":"hq-wisp-wtm1","depends_on_id":"hq-wisp-ndqt","type":"parent-child","created_at":"2026-01-16T01:55:36.860253084-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-wtm1","depends_on_id":"hq-wisp-pblh","type":"blocks","created_at":"2026-01-16T01:55:37.000875597-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-wttjk","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T00:25:35.617346751-05:00","updated_at":"2026-01-17T00:35:06.069542735-05:00","closed_at":"2026-01-17T00:35:06.069542735-05:00","close_reason":"Cleanup","ephemeral":true}
{"id":"hq-wisp-wtvw","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:46:26.938276023-05:00","updated_at":"2026-01-16T01:47:56.845488245-05:00","closed_at":"2026-01-16T01:47:56.845488245-05:00","close_reason":"No work found","dependencies":[{"issue_id":"hq-wisp-wtvw","depends_on_id":"hq-wisp-ybkc","type":"parent-child","created_at":"2026-01-16T01:46:26.98381564-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-wtvw","depends_on_id":"hq-wisp-3c9p","type":"blocks","created_at":"2026-01-16T01:46:27.178691012-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-wuybk","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:42:48.80798434-05:00","updated_at":"2026-01-17T00:35:37.472576022-05:00","closed_at":"2026-01-17T00:35:37.472576022-05:00","close_reason":"Cleanup","ephemeral":true}
{"id":"hq-wisp-wv2p","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:37:49.089177808-05:00","updated_at":"2026-01-16T23:39:27.862919181-05:00","closed_at":"2026-01-16T23:39:27.862919181-05:00","close_reason":"No recent cross-rig closures to propagate","dependencies":[{"issue_id":"hq-wisp-wv2p","depends_on_id":"hq-wisp-2zuj","type":"parent-child","created_at":"2026-01-16T23:37:49.540985165-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-wv2p","depends_on_id":"hq-wisp-1z8z","type":"blocks","created_at":"2026-01-16T23:37:51.162078121-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-wvgb8","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:30:39.081808582-05:00","updated_at":"2026-01-17T00:30:54.275778582-05:00","closed_at":"2026-01-17T00:30:54.275778582-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-wvgb8","depends_on_id":"hq-wisp-tjzfo","type":"parent-child","created_at":"2026-01-17T00:30:39.84863393-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-wvgb8","depends_on_id":"hq-wisp-e2rv7","type":"blocks","created_at":"2026-01-17T00:30:44.390707978-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-wvwb7","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:31:03.24676321-05:00","updated_at":"2026-01-17T00:31:19.524541687-05:00","closed_at":"2026-01-17T00:31:19.524541687-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-wvwb7","depends_on_id":"hq-wisp-apmz9","type":"parent-child","created_at":"2026-01-17T00:31:04.520091853-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-wvwb7","depends_on_id":"hq-wisp-v0p41","type":"blocks","created_at":"2026-01-17T00:31:09.192584552-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-wwy85","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:05:32.501731183-05:00","updated_at":"2026-01-17T01:07:18.155544525-05:00","closed_at":"2026-01-17T01:07:18.155544525-05:00","close_reason":"Idle town","dependencies":[{"issue_id":"hq-wisp-wwy85","depends_on_id":"hq-wisp-p8n2g","type":"parent-child","created_at":"2026-01-17T01:05:43.534530291-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-wwy85","depends_on_id":"hq-wisp-7eecb","type":"blocks","created_at":"2026-01-17T01:05:55.490477196-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-wxuo8","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:50:53.90011093-05:00","updated_at":"2026-01-16T23:51:26.66884605-05:00","closed_at":"2026-01-16T23:51:26.66884605-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-wxuo8","depends_on_id":"hq-wisp-47par","type":"parent-child","created_at":"2026-01-16T23:50:56.031387526-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-wxuo8","depends_on_id":"hq-wisp-lvq6d","type":"blocks","created_at":"2026-01-16T23:50:58.911653959-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-wxw0u","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"hooked","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T10:49:59.351860545-05:00","updated_at":"2026-01-17T10:50:01.665847607-05:00","ephemeral":true}
{"id":"hq-wisp-wxwl0","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:52:28.53835497-05:00","updated_at":"2026-01-16T23:52:47.46718091-05:00","closed_at":"2026-01-16T23:52:47.46718091-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-wxwl0","depends_on_id":"hq-wisp-en6ig","type":"parent-child","created_at":"2026-01-16T23:52:31.477235023-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-wxwl0","depends_on_id":"hq-wisp-8881c","type":"blocks","created_at":"2026-01-16T23:52:34.970712271-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-wy2ji","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:43:06.006644191-05:00","updated_at":"2026-01-16T23:43:42.22748531-05:00","closed_at":"2026-01-16T23:43:42.22748531-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-wy2ji","depends_on_id":"hq-wisp-p7g8j","type":"parent-child","created_at":"2026-01-16T23:43:06.017015231-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-wybk","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:46:01.532911988-05:00","updated_at":"2026-01-16T01:52:13.318339024-05:00","closed_at":"2026-01-16T01:52:13.318339024-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-wybk","depends_on_id":"hq-wisp-xunp","type":"parent-child","created_at":"2026-01-16T01:46:01.658325602-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-wybk","depends_on_id":"hq-wisp-jber","type":"blocks","created_at":"2026-01-16T01:46:01.859324968-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-wz2yl","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:25:52.723515116-05:00","updated_at":"2026-01-16T23:27:57.475101523-05:00","closed_at":"2026-01-16T23:27:57.475101523-05:00","close_reason":"End-of-patrol, handoff","dependencies":[{"issue_id":"hq-wisp-wz2yl","depends_on_id":"hq-wisp-w4tn2","type":"parent-child","created_at":"2026-01-16T23:25:54.406117605-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-wz2yl","depends_on_id":"hq-wisp-6biiw","type":"blocks","created_at":"2026-01-16T23:25:56.329880229-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-wznph","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:46:50.731097452-05:00","updated_at":"2026-01-17T10:46:50.731097493-05:00","dependencies":[{"issue_id":"hq-wisp-wznph","depends_on_id":"hq-wisp-2vhlh","type":"parent-child","created_at":"2026-01-17T10:46:51.14359796-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-wznph","depends_on_id":"hq-wisp-s4q4p","type":"blocks","created_at":"2026-01-17T10:46:51.702274633-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-x0a7","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:19:36.432861697-05:00","updated_at":"2026-01-16T23:20:43.427898631-05:00","closed_at":"2026-01-16T23:20:43.427898631-05:00","close_reason":"No zombies, dogs present","dependencies":[{"issue_id":"hq-wisp-x0a7","depends_on_id":"hq-wisp-pfs9","type":"parent-child","created_at":"2026-01-16T23:19:37.033707453-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-x0a7","depends_on_id":"hq-wisp-e5vk","type":"blocks","created_at":"2026-01-16T23:19:38.523354511-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-x1p4","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:46:26.94029727-05:00","updated_at":"2026-01-16T01:51:58.191939328-05:00","closed_at":"2026-01-16T01:51:58.191939328-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-x1p4","depends_on_id":"hq-wisp-ybkc","type":"parent-child","created_at":"2026-01-16T01:46:27.069327756-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-x1p4","depends_on_id":"hq-wisp-9eak","type":"blocks","created_at":"2026-01-16T01:46:27.295260053-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-x1ww","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:35:41.427911951-05:00","updated_at":"2026-01-17T00:35:51.586844718-05:00","closed_at":"2026-01-17T00:35:51.586844718-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-x4xrk","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:49:57.527430862-05:00","updated_at":"2026-01-17T10:49:57.527430904-05:00","dependencies":[{"issue_id":"hq-wisp-x4xrk","depends_on_id":"hq-wisp-8agmn","type":"parent-child","created_at":"2026-01-17T10:49:58.139586004-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-x4xrk","depends_on_id":"hq-wisp-9hkxz","type":"blocks","created_at":"2026-01-17T10:49:58.937718995-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-x72zc","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:47:24.583770602-05:00","updated_at":"2026-01-17T10:47:24.583770644-05:00","dependencies":[{"issue_id":"hq-wisp-x72zc","depends_on_id":"hq-wisp-jag69","type":"parent-child","created_at":"2026-01-17T10:47:24.960342965-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-x72zc","depends_on_id":"hq-wisp-h1zpl","type":"blocks","created_at":"2026-01-17T10:47:25.611307042-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-x8afi","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:43:56.997767525-05:00","updated_at":"2026-01-16T23:44:19.370289899-05:00","closed_at":"2026-01-16T23:44:19.370289899-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-x8afi","depends_on_id":"hq-wisp-ywecn","type":"parent-child","created_at":"2026-01-16T23:43:58.655790769-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-x8afi","depends_on_id":"hq-wisp-o7bbu","type":"blocks","created_at":"2026-01-16T23:44:00.765159287-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-x8un","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:55:36.780943712-05:00","updated_at":"2026-01-16T01:56:11.536559658-05:00","closed_at":"2026-01-16T01:56:11.536559658-05:00","close_reason":"Closed","dependencies":[{"issue_id":"hq-wisp-x8un","depends_on_id":"hq-wisp-ndqt","type":"parent-child","created_at":"2026-01-16T01:55:36.807246975-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-x8un","depends_on_id":"hq-wisp-hwwk","type":"blocks","created_at":"2026-01-16T01:55:36.928589551-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-x9uc","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:19:36.434895447-05:00","updated_at":"2026-01-16T23:21:06.141089168-05:00","closed_at":"2026-01-16T23:21:06.141089168-05:00","close_reason":"Cleanup noted, no idle dogs","dependencies":[{"issue_id":"hq-wisp-x9uc","depends_on_id":"hq-wisp-pfs9","type":"parent-child","created_at":"2026-01-16T23:19:37.40567453-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-x9uc","depends_on_id":"hq-wisp-rtvg","type":"blocks","created_at":"2026-01-16T23:19:38.903307253-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-xa7pf","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T02:00:44.574169145-05:00","updated_at":"2026-01-17T02:01:54.535444954-05:00","closed_at":"2026-01-17T02:01:54.535444954-05:00","close_reason":"Idle patrol","dependencies":[{"issue_id":"hq-wisp-xa7pf","depends_on_id":"hq-wisp-9a1wp","type":"parent-child","created_at":"2026-01-17T02:00:52.646147906-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-xa7pf","depends_on_id":"hq-wisp-qpxat","type":"blocks","created_at":"2026-01-17T02:01:05.360303068-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-xamf","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:15:01.196452724-05:00","updated_at":"2026-01-16T23:18:14.64124724-05:00","closed_at":"2026-01-16T23:18:14.64124724-05:00","close_reason":"No activity, no gated mols","dependencies":[{"issue_id":"hq-wisp-xamf","depends_on_id":"hq-wisp-9osz","type":"parent-child","created_at":"2026-01-16T23:15:01.54652435-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-xamf","depends_on_id":"hq-wisp-bxtx","type":"blocks","created_at":"2026-01-16T23:15:02.804808512-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-xaym","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:56:35.919829604-05:00","updated_at":"2026-01-16T22:12:53.959689642-05:00","closed_at":"2026-01-16T22:12:53.959689642-05:00","close_reason":"Orphaned wisp step - cleanup","dependencies":[{"issue_id":"hq-wisp-xaym","depends_on_id":"hq-wisp-8d7d","type":"parent-child","created_at":"2026-01-16T01:56:35.93409738-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-xaym","depends_on_id":"hq-wisp-gy61","type":"blocks","created_at":"2026-01-16T01:56:35.973281462-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-xbxj","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:54:43.651762676-05:00","updated_at":"2026-01-16T01:56:30.779633243-05:00","closed_at":"2026-01-16T01:56:30.779633243-05:00","close_reason":"Orphan cleanup","dependencies":[{"issue_id":"hq-wisp-xbxj","depends_on_id":"hq-wisp-8okt","type":"parent-child","created_at":"2026-01-16T01:54:43.680441103-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-xbxj","depends_on_id":"hq-wisp-bqrb","type":"blocks","created_at":"2026-01-16T01:54:43.730562715-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-xcad","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-16T01:43:41.517041885-05:00","updated_at":"2026-01-16T01:52:13.487000548-05:00","closed_at":"2026-01-16T01:52:13.487000548-05:00","close_reason":"Orphaned wisp cleanup","ephemeral":true}
{"id":"hq-wisp-xdflg","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:54:08.827537235-05:00","updated_at":"2026-01-16T23:55:03.198346717-05:00","closed_at":"2026-01-16T23:55:03.198346717-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-xdflg","depends_on_id":"hq-wisp-oecdp","type":"parent-child","created_at":"2026-01-16T23:54:08.999399228-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-xdflg","depends_on_id":"hq-wisp-aejyz","type":"blocks","created_at":"2026-01-16T23:54:11.895753624-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-xdzp9","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:31:03.249968372-05:00","updated_at":"2026-01-17T00:31:24.422949395-05:00","closed_at":"2026-01-17T00:31:24.422949395-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-xdzp9","depends_on_id":"hq-wisp-apmz9","type":"parent-child","created_at":"2026-01-17T00:31:05.818047128-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-xdzp9","depends_on_id":"hq-wisp-zizic","type":"blocks","created_at":"2026-01-17T00:31:11.075544196-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-xeoav","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:08:16.853696213-05:00","updated_at":"2026-01-17T01:10:39.07990763-05:00","closed_at":"2026-01-17T01:10:39.07990763-05:00","close_reason":"Final patrol","dependencies":[{"issue_id":"hq-wisp-xeoav","depends_on_id":"hq-wisp-vrsc5","type":"parent-child","created_at":"2026-01-17T01:08:23.524177562-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-xeoav","depends_on_id":"hq-wisp-s4kar","type":"blocks","created_at":"2026-01-17T01:08:35.693796884-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-xfai","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:21:24.467052969-05:00","updated_at":"2026-01-16T23:21:58.634139638-05:00","closed_at":"2026-01-16T23:21:58.634139638-05:00","close_reason":"No gated mols","dependencies":[{"issue_id":"hq-wisp-xfai","depends_on_id":"hq-wisp-87xr","type":"parent-child","created_at":"2026-01-16T23:21:24.719865479-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-xfai","depends_on_id":"hq-wisp-afmq","type":"blocks","created_at":"2026-01-16T23:21:26.2628802-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-xfxwe","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:53:25.16025337-05:00","updated_at":"2026-01-16T23:53:47.722466513-05:00","closed_at":"2026-01-16T23:53:47.722466513-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-xfxwe","depends_on_id":"hq-wisp-of0wi","type":"parent-child","created_at":"2026-01-16T23:53:27.6668549-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-xfxwe","depends_on_id":"hq-wisp-3rda0","type":"blocks","created_at":"2026-01-16T23:53:31.084480938-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-xhvqb","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T00:38:19.364259192-05:00","updated_at":"2026-01-17T00:42:59.306884904-05:00","closed_at":"2026-01-17T00:42:59.306884904-05:00","close_reason":"Patrol cycle 11 complete","ephemeral":true}
{"id":"hq-wisp-xjlq","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:55:36.781274795-05:00","updated_at":"2026-01-16T01:56:07.462151428-05:00","closed_at":"2026-01-16T01:56:07.462151428-05:00","close_reason":"Orphan wisp cleanup","dependencies":[{"issue_id":"hq-wisp-xjlq","depends_on_id":"hq-wisp-ndqt","type":"parent-child","created_at":"2026-01-16T01:55:36.814046009-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-xjlq","depends_on_id":"hq-wisp-rphz","type":"blocks","created_at":"2026-01-16T01:55:36.93576346-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-xjqlz","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:50:35.397464599-05:00","updated_at":"2026-01-16T23:51:24.275448949-05:00","closed_at":"2026-01-16T23:51:24.275448949-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-xjqlz","depends_on_id":"hq-wisp-t8b5z","type":"parent-child","created_at":"2026-01-16T23:50:36.174652702-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-xjqlz","depends_on_id":"hq-wisp-o7e0b","type":"blocks","created_at":"2026-01-16T23:50:38.640125352-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-xkhcb","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:52:50.33387553-05:00","updated_at":"2026-01-17T00:55:55.266179232-05:00","closed_at":"2026-01-17T00:55:55.266179232-05:00","close_reason":"No stuck dogs","dependencies":[{"issue_id":"hq-wisp-xkhcb","depends_on_id":"hq-wisp-xo3wl","type":"parent-child","created_at":"2026-01-17T00:52:56.274904857-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-xkhcb","depends_on_id":"hq-wisp-uofae","type":"blocks","created_at":"2026-01-17T00:53:07.281875762-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-xkq9n","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:23:02.704633012-05:00","updated_at":"2026-01-17T00:24:19.96071112-05:00","closed_at":"2026-01-17T00:24:19.96071112-05:00","close_reason":"Town idle/healthy","dependencies":[{"issue_id":"hq-wisp-xkq9n","depends_on_id":"hq-wisp-93kdl","type":"parent-child","created_at":"2026-01-17T00:23:04.235186111-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-xkq9n","depends_on_id":"hq-wisp-wb167","type":"blocks","created_at":"2026-01-17T00:23:08.110191593-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-xlm78","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:49:59.364656245-05:00","updated_at":"2026-01-17T10:49:59.364656287-05:00","dependencies":[{"issue_id":"hq-wisp-xlm78","depends_on_id":"hq-wisp-wxw0u","type":"parent-child","created_at":"2026-01-17T10:50:00.122995052-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-xlm78","depends_on_id":"hq-wisp-p6n3y","type":"blocks","created_at":"2026-01-17T10:50:01.109246558-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-xm8on","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:26:33.62577335-05:00","updated_at":"2026-01-17T00:27:01.410806137-05:00","closed_at":"2026-01-17T00:27:01.410806137-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-xm8on","depends_on_id":"hq-wisp-3h08u","type":"parent-child","created_at":"2026-01-17T00:26:34.249385193-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-xm8on","depends_on_id":"hq-wisp-rx9l4","type":"blocks","created_at":"2026-01-17T00:26:37.887085717-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-xmd1a","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:02:22.560897686-05:00","updated_at":"2026-01-17T01:04:39.048400924-05:00","closed_at":"2026-01-17T01:04:39.048400924-05:00","close_reason":"Inbox empty","dependencies":[{"issue_id":"hq-wisp-xmd1a","depends_on_id":"hq-wisp-xwv1q","type":"parent-child","created_at":"2026-01-17T01:02:31.859245539-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-xmd1a","depends_on_id":"hq-wisp-q8xky","type":"blocks","created_at":"2026-01-17T01:02:43.406853942-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-xmlr6","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:49:35.716757349-05:00","updated_at":"2026-01-16T23:50:16.088962154-05:00","closed_at":"2026-01-16T23:50:16.088962154-05:00","close_reason":"Inbox empty","dependencies":[{"issue_id":"hq-wisp-xmlr6","depends_on_id":"hq-wisp-n4f70","type":"parent-child","created_at":"2026-01-16T23:49:35.729476237-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-xo3wl","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T00:52:50.322894259-05:00","updated_at":"2026-01-17T00:56:35.882836182-05:00","closed_at":"2026-01-17T00:56:35.882836182-05:00","close_reason":"Patrol 13 complete","ephemeral":true}
{"id":"hq-wisp-xoy8k","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:48:51.081217471-05:00","updated_at":"2026-01-16T23:49:15.904194387-05:00","closed_at":"2026-01-16T23:49:15.904194387-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-xoy8k","depends_on_id":"hq-wisp-de87j","type":"parent-child","created_at":"2026-01-16T23:48:53.324285233-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-xoy8k","depends_on_id":"hq-wisp-0sk3i","type":"blocks","created_at":"2026-01-16T23:48:56.197862307-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-xphdw","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:23:47.740677741-05:00","updated_at":"2026-01-16T23:25:43.142043824-05:00","closed_at":"2026-01-16T23:25:43.142043824-05:00","close_reason":"End-of-cycle, looping","dependencies":[{"issue_id":"hq-wisp-xphdw","depends_on_id":"hq-wisp-9we3","type":"parent-child","created_at":"2026-01-16T23:23:49.28997283-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-xphdw","depends_on_id":"hq-wisp-axmec","type":"blocks","created_at":"2026-01-16T23:23:51.255634614-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-xr4dn","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:52:58.28180709-05:00","updated_at":"2026-01-16T23:53:16.034933849-05:00","closed_at":"2026-01-16T23:53:16.034933849-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-xr4dn","depends_on_id":"hq-wisp-a5ye3","type":"parent-child","created_at":"2026-01-16T23:53:00.411005744-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-xr4dn","depends_on_id":"hq-wisp-f2fz8","type":"blocks","created_at":"2026-01-16T23:53:03.744376263-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-xrs04","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:50:35.394945813-05:00","updated_at":"2026-01-16T23:51:25.060665506-05:00","closed_at":"2026-01-16T23:51:25.060665506-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-xrs04","depends_on_id":"hq-wisp-t8b5z","type":"parent-child","created_at":"2026-01-16T23:50:35.659480835-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-xrs04","depends_on_id":"hq-wisp-sbhw2","type":"blocks","created_at":"2026-01-16T23:50:38.059273261-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-xrtb","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T22:05:01.09939243-05:00","updated_at":"2026-01-16T22:12:18.886439854-05:00","closed_at":"2026-01-16T22:12:18.886439854-05:00","close_reason":"Orphaned - bulk cleanup","ephemeral":true}
{"id":"hq-wisp-xsuyd","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:45:48.838795544-05:00","updated_at":"2026-01-16T23:46:39.028090071-05:00","closed_at":"2026-01-16T23:46:39.028090071-05:00","close_reason":"No cross-rig closures","dependencies":[{"issue_id":"hq-wisp-xsuyd","depends_on_id":"hq-wisp-2heyl","type":"parent-child","created_at":"2026-01-16T23:45:49.472533154-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-xsuyd","depends_on_id":"hq-wisp-qzv7l","type":"blocks","created_at":"2026-01-16T23:45:51.761659754-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-xt8ms","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:04:43.442514687-05:00","updated_at":"2026-01-17T01:06:15.079382056-05:00","closed_at":"2026-01-17T01:06:15.079382056-05:00","close_reason":"Pool healthy","dependencies":[{"issue_id":"hq-wisp-xt8ms","depends_on_id":"hq-wisp-bkl5l","type":"parent-child","created_at":"2026-01-17T01:04:49.325171959-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-xt8ms","depends_on_id":"hq-wisp-ir19j","type":"blocks","created_at":"2026-01-17T01:05:01.328114174-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-xtbl","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:01:49.248161017-05:00","updated_at":"2026-01-16T23:14:44.149232699-05:00","closed_at":"2026-01-16T23:14:44.149232699-05:00","close_reason":"Duplicate patrol wisp, cleaned up","ephemeral":true}
{"id":"hq-wisp-xtmg9","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:43:00.961050276-05:00","updated_at":"2026-01-17T00:51:39.0477445-05:00","closed_at":"2026-01-17T00:51:39.0477445-05:00","close_reason":"No stuck dogs","dependencies":[{"issue_id":"hq-wisp-xtmg9","depends_on_id":"hq-wisp-jgnad","type":"parent-child","created_at":"2026-01-17T00:43:06.177089583-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-xtmg9","depends_on_id":"hq-wisp-krm9s","type":"blocks","created_at":"2026-01-17T00:43:15.731586547-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-xtmrv","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:08:16.854912628-05:00","updated_at":"2026-01-17T01:10:40.548171788-05:00","closed_at":"2026-01-17T01:10:40.548171788-05:00","close_reason":"Final patrol","dependencies":[{"issue_id":"hq-wisp-xtmrv","depends_on_id":"hq-wisp-vrsc5","type":"parent-child","created_at":"2026-01-17T01:08:24.131230195-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-xtmrv","depends_on_id":"hq-wisp-xeoav","type":"blocks","created_at":"2026-01-17T01:08:36.307435715-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-xtx6n","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:53:05.61566349-05:00","updated_at":"2026-01-16T23:53:59.946228026-05:00","closed_at":"2026-01-16T23:53:59.946228026-05:00","close_reason":"Patrol cycle 16 complete","ephemeral":true}
{"id":"hq-wisp-xunp","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T01:46:01.527925368-05:00","updated_at":"2026-01-16T01:50:38.955361425-05:00","closed_at":"2026-01-16T01:50:38.955361425-05:00","close_reason":"Stale patrol wisp cleanup","ephemeral":true}
{"id":"hq-wisp-xv6t","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T01:27:23.780248445-05:00","updated_at":"2026-01-16T01:52:13.895820187-05:00","closed_at":"2026-01-16T01:52:13.895820187-05:00","close_reason":"Orphaned wisp cleanup","ephemeral":true}
{"id":"hq-wisp-xwrs","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T01:00:42.952030098-05:00","updated_at":"2026-01-16T01:50:39.405544685-05:00","closed_at":"2026-01-16T01:50:39.405544685-05:00","close_reason":"Stale patrol wisp cleanup","ephemeral":true}
{"id":"hq-wisp-xwv1q","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T01:02:22.54455217-05:00","updated_at":"2026-01-17T01:05:07.49255634-05:00","closed_at":"2026-01-17T01:05:07.49255634-05:00","close_reason":"Patrol #18 complete: idle town","ephemeral":true}
{"id":"hq-wisp-xxd87","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:05:32.500166769-05:00","updated_at":"2026-01-17T01:07:16.922881413-05:00","closed_at":"2026-01-17T01:07:16.922881413-05:00","close_reason":"Idle town","dependencies":[{"issue_id":"hq-wisp-xxd87","depends_on_id":"hq-wisp-p8n2g","type":"parent-child","created_at":"2026-01-17T01:05:42.19999014-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-xxd87","depends_on_id":"hq-wisp-mqaw7","type":"blocks","created_at":"2026-01-17T01:05:54.292751288-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-xxi3","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T22:28:19.643819501-05:00","updated_at":"2026-01-17T00:36:19.440801979-05:00","closed_at":"2026-01-17T00:36:19.440801979-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-xxs3","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T01:38:43.73451129-05:00","updated_at":"2026-01-16T01:50:39.080439747-05:00","closed_at":"2026-01-16T01:50:39.080439747-05:00","close_reason":"Stale patrol wisp cleanup","ephemeral":true}
{"id":"hq-wisp-xy5tf","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:51:56.830420026-05:00","updated_at":"2026-01-16T23:52:43.378542373-05:00","closed_at":"2026-01-16T23:52:43.378542373-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-xy5tf","depends_on_id":"hq-wisp-ri9se","type":"parent-child","created_at":"2026-01-16T23:51:57.824742213-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-xy5tf","depends_on_id":"hq-wisp-w6cxk","type":"blocks","created_at":"2026-01-16T23:52:00.791426328-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-xzn07","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:12:55.87908783-05:00","updated_at":"2026-01-17T01:15:04.212788981-05:00","closed_at":"2026-01-17T01:15:04.212788981-05:00","close_reason":"No pending gates","dependencies":[{"issue_id":"hq-wisp-xzn07","depends_on_id":"hq-wisp-i2n82","type":"parent-child","created_at":"2026-01-17T01:12:57.10906953-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-xzn07","depends_on_id":"hq-wisp-k2tqt","type":"blocks","created_at":"2026-01-17T01:13:08.110899514-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-y039q","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:50:35.399741594-05:00","updated_at":"2026-01-16T23:51:23.234496798-05:00","closed_at":"2026-01-16T23:51:23.234496798-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-y039q","depends_on_id":"hq-wisp-t8b5z","type":"parent-child","created_at":"2026-01-16T23:50:36.704076645-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-y039q","depends_on_id":"hq-wisp-a0l5a","type":"blocks","created_at":"2026-01-16T23:50:39.440389106-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-y0ei2","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:09:41.617152545-05:00","updated_at":"2026-01-17T01:11:03.981889069-05:00","closed_at":"2026-01-17T01:11:03.981889069-05:00","close_reason":"Logs rotated","dependencies":[{"issue_id":"hq-wisp-y0ei2","depends_on_id":"hq-wisp-fsms9","type":"parent-child","created_at":"2026-01-17T01:09:50.697457525-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-y0ei2","depends_on_id":"hq-wisp-bjgky","type":"blocks","created_at":"2026-01-17T01:10:03.156856294-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-y4je8","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:47:55.319682326-05:00","updated_at":"2026-01-17T10:47:55.319682367-05:00","dependencies":[{"issue_id":"hq-wisp-y4je8","depends_on_id":"hq-wisp-9hr1x","type":"parent-child","created_at":"2026-01-17T10:47:55.659784418-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-y4je8","depends_on_id":"hq-wisp-unqis","type":"blocks","created_at":"2026-01-17T10:47:56.439961254-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-y6dm","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:46:26.938780189-05:00","updated_at":"2026-01-16T01:50:46.910800217-05:00","closed_at":"2026-01-16T01:50:46.910800217-05:00","close_reason":"No notifications to send","dependencies":[{"issue_id":"hq-wisp-y6dm","depends_on_id":"hq-wisp-ybkc","type":"parent-child","created_at":"2026-01-16T01:46:27.0052237-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-y6dm","depends_on_id":"hq-wisp-54ol","type":"blocks","created_at":"2026-01-16T01:46:27.201657987-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-y6sb","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:22:20.085538036-05:00","updated_at":"2026-01-16T01:52:14.099333507-05:00","closed_at":"2026-01-16T01:52:14.099333507-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-y6sb","depends_on_id":"hq-wisp-gvqg","type":"parent-child","created_at":"2026-01-16T01:22:20.105332099-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-y7cu5","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:25:52.715712909-05:00","updated_at":"2026-01-16T23:26:32.129960974-05:00","closed_at":"2026-01-16T23:26:32.129960974-05:00","close_reason":"No gates/convoys/pending","dependencies":[{"issue_id":"hq-wisp-y7cu5","depends_on_id":"hq-wisp-w4tn2","type":"parent-child","created_at":"2026-01-16T23:25:53.094623317-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-y7cu5","depends_on_id":"hq-wisp-123hh","type":"blocks","created_at":"2026-01-16T23:25:54.791886096-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-y7hqg","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:24:43.303178282-05:00","updated_at":"2026-01-17T00:25:25.618490187-05:00","closed_at":"2026-01-17T00:25:25.618490187-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-y7hqg","depends_on_id":"hq-wisp-5fw2b","type":"parent-child","created_at":"2026-01-17T00:24:46.418600182-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-y7hqg","depends_on_id":"hq-wisp-p7jwn","type":"blocks","created_at":"2026-01-17T00:24:50.402825818-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-y87h","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","assignee":"deacon","created_at":"2026-01-16T22:16:03.016877344-05:00","updated_at":"2026-01-17T00:36:22.854351142-05:00","closed_at":"2026-01-17T00:36:22.854351142-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-y8zd","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:21:24.469490136-05:00","updated_at":"2026-01-16T23:23:07.724314601-05:00","closed_at":"2026-01-16T23:23:07.724314601-05:00","close_reason":"No plugins, no stuck dogs","dependencies":[{"issue_id":"hq-wisp-y8zd","depends_on_id":"hq-wisp-87xr","type":"parent-child","created_at":"2026-01-16T23:21:25.217679083-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-y8zd","depends_on_id":"hq-wisp-o5iy","type":"blocks","created_at":"2026-01-16T23:21:26.946679905-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ya8st","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:04:43.445779349-05:00","updated_at":"2026-01-17T01:07:14.877977198-05:00","closed_at":"2026-01-17T01:07:14.877977198-05:00","close_reason":"Costs not tracked","dependencies":[{"issue_id":"hq-wisp-ya8st","depends_on_id":"hq-wisp-bkl5l","type":"parent-child","created_at":"2026-01-17T01:04:51.733166699-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ya8st","depends_on_id":"hq-wisp-q2pd6","type":"blocks","created_at":"2026-01-17T01:05:03.732991252-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-yarnl","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:23:02.710712747-05:00","updated_at":"2026-01-17T00:24:26.586651315-05:00","closed_at":"2026-01-17T00:24:26.586651315-05:00","close_reason":"Cycle complete","dependencies":[{"issue_id":"hq-wisp-yarnl","depends_on_id":"hq-wisp-93kdl","type":"parent-child","created_at":"2026-01-17T00:23:05.764695213-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-yarnl","depends_on_id":"hq-wisp-q40sq","type":"blocks","created_at":"2026-01-17T00:23:09.700493002-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-yazmn","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:50:35.394418689-05:00","updated_at":"2026-01-16T23:51:25.216568427-05:00","closed_at":"2026-01-16T23:51:25.216568427-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-yazmn","depends_on_id":"hq-wisp-t8b5z","type":"parent-child","created_at":"2026-01-16T23:50:35.532570916-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-yazmn","depends_on_id":"hq-wisp-sbhw2","type":"blocks","created_at":"2026-01-16T23:50:37.890671641-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ybkc","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T01:46:26.936342233-05:00","updated_at":"2026-01-16T01:51:58.273211573-05:00","closed_at":"2026-01-16T01:51:58.273211573-05:00","close_reason":"Orphaned wisp cleanup","ephemeral":true}
{"id":"hq-wisp-ycb59","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:53:25.154006375-05:00","updated_at":"2026-01-16T23:53:49.690868915-05:00","closed_at":"2026-01-16T23:53:49.690868915-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-ycb59","depends_on_id":"hq-wisp-of0wi","type":"parent-child","created_at":"2026-01-16T23:53:26.000050141-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ycb59","depends_on_id":"hq-wisp-k12br","type":"blocks","created_at":"2026-01-16T23:53:29.033014724-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ycg5r","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:49:35.720298466-05:00","updated_at":"2026-01-16T23:50:20.336834638-05:00","closed_at":"2026-01-16T23:50:20.336834638-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-ycg5r","depends_on_id":"hq-wisp-n4f70","type":"parent-child","created_at":"2026-01-16T23:49:36.40574882-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ycg5r","depends_on_id":"hq-wisp-h6126","type":"blocks","created_at":"2026-01-16T23:49:38.845054385-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ycvp","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T01:53:35.974785437-05:00","updated_at":"2026-01-16T22:12:29.242345411-05:00","closed_at":"2026-01-16T22:12:29.242345411-05:00","close_reason":"Orphaned - bulk cleanup","ephemeral":true}
{"id":"hq-wisp-ydb0","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:55:36.785730457-05:00","updated_at":"2026-01-16T01:56:30.746598862-05:00","closed_at":"2026-01-16T01:56:30.746598862-05:00","close_reason":"Orphan cleanup","dependencies":[{"issue_id":"hq-wisp-ydb0","depends_on_id":"hq-wisp-ndqt","type":"parent-child","created_at":"2026-01-16T01:55:36.901256956-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ydb0","depends_on_id":"hq-wisp-qzn8","type":"blocks","created_at":"2026-01-16T01:55:37.047906505-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ydkz","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:22:20.087603493-05:00","updated_at":"2026-01-16T01:52:14.061613131-05:00","closed_at":"2026-01-16T01:52:14.061613131-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-ydkz","depends_on_id":"hq-wisp-gvqg","type":"parent-child","created_at":"2026-01-16T01:22:20.145473807-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ye5q2","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:44:42.006085635-05:00","updated_at":"2026-01-17T10:44:42.006085677-05:00","dependencies":[{"issue_id":"hq-wisp-ye5q2","depends_on_id":"hq-wisp-qd1hf","type":"parent-child","created_at":"2026-01-17T10:44:42.252012705-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ye5q2","depends_on_id":"hq-wisp-0qcqq","type":"blocks","created_at":"2026-01-17T10:44:42.574170944-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ye8u","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:22:20.086046702-05:00","updated_at":"2026-01-16T01:52:14.090109142-05:00","closed_at":"2026-01-16T01:52:14.090109142-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-ye8u","depends_on_id":"hq-wisp-gvqg","type":"parent-child","created_at":"2026-01-16T01:22:20.115451714-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-yf11","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:22:17.004327475-05:00","updated_at":"2026-01-17T00:35:54.801685479-05:00","closed_at":"2026-01-17T00:35:54.801685479-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-ygqi","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:46:01.532085239-05:00","updated_at":"2026-01-16T01:52:21.495197328-05:00","closed_at":"2026-01-16T01:52:21.495197328-05:00","close_reason":"Dog pool healthy: 1 idle available","dependencies":[{"issue_id":"hq-wisp-ygqi","depends_on_id":"hq-wisp-xunp","type":"parent-child","created_at":"2026-01-16T01:46:01.62852551-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ygqi","depends_on_id":"hq-wisp-2r4u","type":"blocks","created_at":"2026-01-16T01:46:01.828842001-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-yijs3","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:45:48.840223737-05:00","updated_at":"2026-01-16T23:46:46.198763957-05:00","closed_at":"2026-01-16T23:46:46.198763957-05:00","close_reason":"Town idle, skip health nudges","dependencies":[{"issue_id":"hq-wisp-yijs3","depends_on_id":"hq-wisp-2heyl","type":"parent-child","created_at":"2026-01-16T23:45:49.739443524-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-yijs3","depends_on_id":"hq-wisp-qrg5x","type":"blocks","created_at":"2026-01-16T23:45:52.014108276-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-yijs3","depends_on_id":"hq-wisp-1jmuo","type":"blocks","created_at":"2026-01-16T23:45:52.140975947-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-yijs3","depends_on_id":"hq-wisp-s395r","type":"blocks","created_at":"2026-01-16T23:45:52.269868305-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-yj5m","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:05:01.104795173-05:00","updated_at":"2026-01-16T22:13:01.981464036-05:00","closed_at":"2026-01-16T22:13:01.981464036-05:00","close_reason":"Orphaned - forced cleanup","dependencies":[{"issue_id":"hq-wisp-yj5m","depends_on_id":"hq-wisp-xrtb","type":"parent-child","created_at":"2026-01-16T22:05:01.224158813-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-yj5m","depends_on_id":"hq-wisp-6xyr","type":"blocks","created_at":"2026-01-16T22:05:01.393826266-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-yjvv0","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:28:49.926350186-05:00","updated_at":"2026-01-17T00:29:02.06082983-05:00","closed_at":"2026-01-17T00:29:02.06082983-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-yjvv0","depends_on_id":"hq-wisp-9l1zx","type":"parent-child","created_at":"2026-01-17T00:28:50.83650983-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-yjvv0","depends_on_id":"hq-wisp-nxinm","type":"blocks","created_at":"2026-01-17T00:28:54.834917681-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-yjyar","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:44:41.995798341-05:00","updated_at":"2026-01-17T10:44:41.995798382-05:00","dependencies":[{"issue_id":"hq-wisp-yjyar","depends_on_id":"hq-wisp-qd1hf","type":"parent-child","created_at":"2026-01-17T10:44:42.049085806-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-yjyar","depends_on_id":"hq-wisp-qf0sb","type":"blocks","created_at":"2026-01-17T10:44:42.294508544-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-yklj","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:46:26.937993731-05:00","updated_at":"2026-01-16T01:50:29.333045574-05:00","closed_at":"2026-01-16T01:50:29.333045574-05:00","close_reason":"No work found","dependencies":[{"issue_id":"hq-wisp-yklj","depends_on_id":"hq-wisp-ybkc","type":"parent-child","created_at":"2026-01-16T01:46:26.973678734-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-yklj","depends_on_id":"hq-wisp-jrty","type":"blocks","created_at":"2026-01-16T01:46:27.167620483-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ykx2","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:36:59.34122312-05:00","updated_at":"2026-01-16T23:38:48.710733227-05:00","closed_at":"2026-01-16T23:38:48.710733227-05:00","close_reason":"Town idle - skipped nudges per protocol. Gastown witness/refinery sessions not present but no active work requires them","dependencies":[{"issue_id":"hq-wisp-ykx2","depends_on_id":"hq-wisp-c8tl","type":"parent-child","created_at":"2026-01-16T23:36:59.911696588-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ykx2","depends_on_id":"hq-wisp-i92c","type":"blocks","created_at":"2026-01-16T23:37:01.386625939-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ykx2","depends_on_id":"hq-wisp-6dz9","type":"blocks","created_at":"2026-01-16T23:37:01.46927922-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ykx2","depends_on_id":"hq-wisp-ol9r","type":"blocks","created_at":"2026-01-16T23:37:01.551482001-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ym7cn","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T02:00:44.572354604-05:00","updated_at":"2026-01-17T02:01:53.29068119-05:00","closed_at":"2026-01-17T02:01:53.29068119-05:00","close_reason":"Idle patrol","dependencies":[{"issue_id":"hq-wisp-ym7cn","depends_on_id":"hq-wisp-9a1wp","type":"parent-child","created_at":"2026-01-17T02:00:51.205729968-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ym7cn","depends_on_id":"hq-wisp-iuqkz","type":"blocks","created_at":"2026-01-17T02:01:04.064095865-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ymazc","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:53:05.624595691-05:00","updated_at":"2026-01-16T23:53:52.092623484-05:00","closed_at":"2026-01-16T23:53:52.092623484-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-ymazc","depends_on_id":"hq-wisp-xtx6n","type":"parent-child","created_at":"2026-01-16T23:53:07.729630738-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ymazc","depends_on_id":"hq-wisp-2bx35","type":"blocks","created_at":"2026-01-16T23:53:11.204936648-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ynldu","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:53:05.627400314-05:00","updated_at":"2026-01-16T23:53:46.147934641-05:00","closed_at":"2026-01-16T23:53:46.147934641-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-ynldu","depends_on_id":"hq-wisp-xtx6n","type":"parent-child","created_at":"2026-01-16T23:53:08.244333842-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ynldu","depends_on_id":"hq-wisp-giwh3","type":"blocks","created_at":"2026-01-16T23:53:11.73595174-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ypq6q","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:51:56.837207729-05:00","updated_at":"2026-01-16T23:52:20.81273288-05:00","closed_at":"2026-01-16T23:52:20.81273288-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-ypq6q","depends_on_id":"hq-wisp-ri9se","type":"parent-child","created_at":"2026-01-16T23:51:59.628782855-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ypq6q","depends_on_id":"hq-wisp-eovp5","type":"blocks","created_at":"2026-01-16T23:52:02.978765257-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-yqgx","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","assignee":"deacon","created_at":"2026-01-16T22:15:56.725326101-05:00","updated_at":"2026-01-17T00:36:23.45497226-05:00","closed_at":"2026-01-17T00:36:23.45497226-05:00","close_reason":"GC","ephemeral":true}
{"id":"hq-wisp-yr729","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:47:34.37499805-05:00","updated_at":"2026-01-16T23:49:12.100504099-05:00","closed_at":"2026-01-16T23:49:12.100504099-05:00","close_reason":"Town idle patrol","dependencies":[{"issue_id":"hq-wisp-yr729","depends_on_id":"hq-wisp-ql31w","type":"parent-child","created_at":"2026-01-16T23:47:36.280058254-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-yr729","depends_on_id":"hq-wisp-pv2xc","type":"blocks","created_at":"2026-01-16T23:47:38.700040038-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-yr75e","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:29:36.062976912-05:00","updated_at":"2026-01-17T00:29:55.67332976-05:00","closed_at":"2026-01-17T00:29:55.67332976-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-yr75e","depends_on_id":"hq-wisp-w5z6p","type":"parent-child","created_at":"2026-01-17T00:29:37.985765025-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-yr75e","depends_on_id":"hq-wisp-it9ic","type":"blocks","created_at":"2026-01-17T00:29:42.806437018-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ytsw1","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:28:16.221071983-05:00","updated_at":"2026-01-17T00:28:32.227029286-05:00","closed_at":"2026-01-17T00:28:32.227029286-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-ytsw1","depends_on_id":"hq-wisp-tbive","type":"parent-child","created_at":"2026-01-17T00:28:16.233827173-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-yw2sm","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T02:00:44.570622521-05:00","updated_at":"2026-01-17T02:01:52.011440856-05:00","closed_at":"2026-01-17T02:01:52.011440856-05:00","close_reason":"Idle patrol","dependencies":[{"issue_id":"hq-wisp-yw2sm","depends_on_id":"hq-wisp-9a1wp","type":"parent-child","created_at":"2026-01-17T02:00:49.525514457-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-yw2sm","depends_on_id":"hq-wisp-tpvdo","type":"blocks","created_at":"2026-01-17T02:01:01.552153221-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-yw2sm","depends_on_id":"hq-wisp-ntacb","type":"blocks","created_at":"2026-01-17T02:01:02.192091013-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-yw2sm","depends_on_id":"hq-wisp-1zxhh","type":"blocks","created_at":"2026-01-17T02:01:02.817658435-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ywecn","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:43:56.986815859-05:00","updated_at":"2026-01-16T23:44:38.011721135-05:00","closed_at":"2026-01-16T23:44:38.011721135-05:00","close_reason":"Patrol cycle 9 complete","ephemeral":true}
{"id":"hq-wisp-ywkx2","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:00:26.063098515-05:00","updated_at":"2026-01-17T01:01:27.802484588-05:00","closed_at":"2026-01-17T01:01:27.802484588-05:00","close_reason":"No stuck dogs","dependencies":[{"issue_id":"hq-wisp-ywkx2","depends_on_id":"hq-wisp-5yxyi","type":"parent-child","created_at":"2026-01-17T01:00:32.14487965-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ywkx2","depends_on_id":"hq-wisp-1id0r","type":"blocks","created_at":"2026-01-17T01:00:43.245899448-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-ywu7","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:42:27.173137213-05:00","updated_at":"2026-01-16T01:52:13.641235297-05:00","closed_at":"2026-01-16T01:52:13.641235297-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-ywu7","depends_on_id":"hq-wisp-wqti","type":"parent-child","created_at":"2026-01-16T01:42:27.224919532-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ywu7","depends_on_id":"hq-wisp-7xkx","type":"blocks","created_at":"2026-01-16T01:42:27.441389546-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-yxr42","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:04:43.441687938-05:00","updated_at":"2026-01-17T01:06:33.080807537-05:00","closed_at":"2026-01-17T01:06:33.080807537-05:00","close_reason":"No plugins","dependencies":[{"issue_id":"hq-wisp-yxr42","depends_on_id":"hq-wisp-bkl5l","type":"parent-child","created_at":"2026-01-17T01:04:48.708886422-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-yxr42","depends_on_id":"hq-wisp-6h08g","type":"blocks","created_at":"2026-01-17T01:05:00.744730585-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-yyvb","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T01:22:19.744831183-05:00","updated_at":"2026-01-16T01:50:39.349624787-05:00","closed_at":"2026-01-16T01:50:39.349624787-05:00","close_reason":"Stale patrol wisp cleanup","ephemeral":true}
{"id":"hq-wisp-yyvdp","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:47:42.956009356-05:00","updated_at":"2026-01-17T00:35:33.046010084-05:00","closed_at":"2026-01-17T00:35:33.046010084-05:00","close_reason":"Cleanup","ephemeral":true}
{"id":"hq-wisp-yztp9","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:45:48.842359465-05:00","updated_at":"2026-01-16T23:46:54.403936682-05:00","closed_at":"2026-01-16T23:46:54.403936682-05:00","close_reason":"No dogs to check","dependencies":[{"issue_id":"hq-wisp-yztp9","depends_on_id":"hq-wisp-2heyl","type":"parent-child","created_at":"2026-01-16T23:45:50.234938166-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-yztp9","depends_on_id":"hq-wisp-121ik","type":"blocks","created_at":"2026-01-16T23:45:52.790381935-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-yzut","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:55:36.784351708-05:00","updated_at":"2026-01-16T01:56:32.646434502-05:00","closed_at":"2026-01-16T01:56:32.646434502-05:00","close_reason":"Closed","dependencies":[{"issue_id":"hq-wisp-yzut","depends_on_id":"hq-wisp-ndqt","type":"parent-child","created_at":"2026-01-16T01:55:36.874142819-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-yzut","depends_on_id":"hq-wisp-8prl","type":"blocks","created_at":"2026-01-16T01:55:37.016977705-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-z3nfp","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:09:41.613113593-05:00","updated_at":"2026-01-17T01:10:48.814397877-05:00","closed_at":"2026-01-17T01:10:48.814397877-05:00","close_reason":"Pool healthy","dependencies":[{"issue_id":"hq-wisp-z3nfp","depends_on_id":"hq-wisp-fsms9","type":"parent-child","created_at":"2026-01-17T01:09:47.697220018-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-z3nfp","depends_on_id":"hq-wisp-1jhdg","type":"blocks","created_at":"2026-01-17T01:09:59.86306533-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-z4703","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:48:51.077314938-05:00","updated_at":"2026-01-16T23:49:23.096900116-05:00","closed_at":"2026-01-16T23:49:23.096900116-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-z4703","depends_on_id":"hq-wisp-de87j","type":"parent-child","created_at":"2026-01-16T23:48:52.201316959-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-z4703","depends_on_id":"hq-wisp-jm2rr","type":"blocks","created_at":"2026-01-16T23:48:55.039846197-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-z474a","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:44:43.642635474-05:00","updated_at":"2026-01-16T23:45:25.598770944-05:00","closed_at":"2026-01-16T23:45:25.598770944-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-z474a","depends_on_id":"hq-wisp-bhwu0","type":"parent-child","created_at":"2026-01-16T23:44:44.851156354-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-z474a","depends_on_id":"hq-wisp-9t7zk","type":"blocks","created_at":"2026-01-16T23:44:47.039647759-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-z4dsy","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:56:33.987086022-05:00","updated_at":"2026-01-17T00:35:10.248468676-05:00","closed_at":"2026-01-17T00:35:10.248468676-05:00","close_reason":"Cleanup","ephemeral":true}
{"id":"hq-wisp-z6dr7","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:44:42.002913314-05:00","updated_at":"2026-01-17T10:44:42.002913355-05:00","dependencies":[{"issue_id":"hq-wisp-z6dr7","depends_on_id":"hq-wisp-qd1hf","type":"parent-child","created_at":"2026-01-17T10:44:42.186170245-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-z6dr7","depends_on_id":"hq-wisp-qjiet","type":"blocks","created_at":"2026-01-17T10:44:42.48322283-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-z77ud","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:51:56.832659608-05:00","updated_at":"2026-01-16T23:52:38.919556208-05:00","closed_at":"2026-01-16T23:52:38.919556208-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-z77ud","depends_on_id":"hq-wisp-ri9se","type":"parent-child","created_at":"2026-01-16T23:51:58.482041078-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-z77ud","depends_on_id":"hq-wisp-i3bqt","type":"blocks","created_at":"2026-01-16T23:52:01.799744838-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-z78q","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T22:08:03.94771488-05:00","updated_at":"2026-01-16T22:12:13.902767416-05:00","closed_at":"2026-01-16T22:12:13.902767416-05:00","close_reason":"Orphaned - bulk cleanup","ephemeral":true}
{"id":"hq-wisp-z8yzk","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:02:22.549335412-05:00","updated_at":"2026-01-17T01:03:58.129672196-05:00","closed_at":"2026-01-17T01:03:58.129672196-05:00","close_reason":"No pending gates","dependencies":[{"issue_id":"hq-wisp-z8yzk","depends_on_id":"hq-wisp-xwv1q","type":"parent-child","created_at":"2026-01-17T01:02:23.701766956-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-z8yzk","depends_on_id":"hq-wisp-jdost","type":"blocks","created_at":"2026-01-17T01:02:34.181785933-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-z9ofl","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:43:00.954959535-05:00","updated_at":"2026-01-17T00:50:44.466517561-05:00","closed_at":"2026-01-17T00:50:44.466517561-05:00","close_reason":"No convoys to check","dependencies":[{"issue_id":"hq-wisp-z9ofl","depends_on_id":"hq-wisp-jgnad","type":"parent-child","created_at":"2026-01-17T00:43:02.866217636-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-z9ofl","depends_on_id":"hq-wisp-9ztqh","type":"blocks","created_at":"2026-01-17T00:43:11.443276813-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-za4fx","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:50:53.899025889-05:00","updated_at":"2026-01-16T23:51:27.991570441-05:00","closed_at":"2026-01-16T23:51:27.991570441-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-za4fx","depends_on_id":"hq-wisp-47par","type":"parent-child","created_at":"2026-01-16T23:50:55.745941956-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-za4fx","depends_on_id":"hq-wisp-4xcz6","type":"blocks","created_at":"2026-01-16T23:50:58.614171148-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-za9t4","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T00:37:50.20846701-05:00","updated_at":"2026-01-17T00:38:04.631168069-05:00","closed_at":"2026-01-17T00:38:04.631168069-05:00","close_reason":"Healthy","ephemeral":true}
{"id":"hq-wisp-zb7b0","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:02:22.552677449-05:00","updated_at":"2026-01-17T01:04:04.587091988-05:00","closed_at":"2026-01-17T01:04:04.587091988-05:00","close_reason":"No notifications needed","dependencies":[{"issue_id":"hq-wisp-zb7b0","depends_on_id":"hq-wisp-xwv1q","type":"parent-child","created_at":"2026-01-17T01:02:26.110668257-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-zb7b0","depends_on_id":"hq-wisp-2izgc","type":"blocks","created_at":"2026-01-17T01:02:36.469945088-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-zboi","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:42:27.176558585-05:00","updated_at":"2026-01-16T01:52:13.523962758-05:00","closed_at":"2026-01-16T01:52:13.523962758-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-zboi","depends_on_id":"hq-wisp-wqti","type":"parent-child","created_at":"2026-01-16T01:42:27.38008703-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-zboi","depends_on_id":"hq-wisp-w7ej","type":"blocks","created_at":"2026-01-16T01:42:27.633374921-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-zbtb","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:22:20.089138949-05:00","updated_at":"2026-01-16T01:52:14.03032079-05:00","closed_at":"2026-01-16T01:52:14.03032079-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-zbtb","depends_on_id":"hq-wisp-gvqg","type":"parent-child","created_at":"2026-01-16T01:22:20.175846026-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-zbtb","depends_on_id":"hq-wisp-d9i0","type":"blocks","created_at":"2026-01-16T01:22:20.288554117-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-zc1mn","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:43:00.96770289-05:00","updated_at":"2026-01-17T00:52:31.034124328-05:00","closed_at":"2026-01-17T00:52:31.034124328-05:00","close_reason":"Context low, within limits","dependencies":[{"issue_id":"hq-wisp-zc1mn","depends_on_id":"hq-wisp-jgnad","type":"parent-child","created_at":"2026-01-17T00:43:09.068946258-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-zc1mn","depends_on_id":"hq-wisp-u1nfw","type":"blocks","created_at":"2026-01-17T00:43:18.657471712-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-zducj","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:52:50.33643415-05:00","updated_at":"2026-01-17T00:56:10.92590691-05:00","closed_at":"2026-01-17T00:56:10.92590691-05:00","close_reason":"Costs not tracked this cycle","dependencies":[{"issue_id":"hq-wisp-zducj","depends_on_id":"hq-wisp-xo3wl","type":"parent-child","created_at":"2026-01-17T00:52:57.920795355-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-zducj","depends_on_id":"hq-wisp-e0kvi","type":"blocks","created_at":"2026-01-17T00:53:08.921959104-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-zeaj8","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:44:43.637687776-05:00","updated_at":"2026-01-16T23:45:31.11289434-05:00","closed_at":"2026-01-16T23:45:31.11289434-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-zeaj8","depends_on_id":"hq-wisp-bhwu0","type":"parent-child","created_at":"2026-01-16T23:44:44.201743783-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-zeaj8","depends_on_id":"hq-wisp-e86go","type":"blocks","created_at":"2026-01-16T23:44:46.152607302-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-zedgm","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:41:11.916330181-05:00","updated_at":"2026-01-17T00:35:38.108182543-05:00","closed_at":"2026-01-17T00:35:38.108182543-05:00","close_reason":"Cleanup","ephemeral":true}
{"id":"hq-wisp-zevyw","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:03:11.633529463-05:00","updated_at":"2026-01-17T01:03:55.695087123-05:00","closed_at":"2026-01-17T01:03:55.695087123-05:00","close_reason":"No async gates","dependencies":[{"issue_id":"hq-wisp-zevyw","depends_on_id":"hq-wisp-zx2sm","type":"parent-child","created_at":"2026-01-17T01:03:12.832564337-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-zevyw","depends_on_id":"hq-wisp-srigs","type":"blocks","created_at":"2026-01-17T01:03:23.657794912-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-zfst","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T01:40:27.118410687-05:00","updated_at":"2026-01-16T01:50:39.038665668-05:00","closed_at":"2026-01-16T01:50:39.038665668-05:00","close_reason":"Stale patrol wisp cleanup","ephemeral":true}
{"id":"hq-wisp-zgbd","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:54:43.649225221-05:00","updated_at":"2026-01-16T01:56:11.453929081-05:00","closed_at":"2026-01-16T01:56:11.453929081-05:00","close_reason":"Orphan wisp cleanup","dependencies":[{"issue_id":"hq-wisp-zgbd","depends_on_id":"hq-wisp-8okt","type":"parent-child","created_at":"2026-01-16T01:54:43.663076789-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-zgbd","depends_on_id":"hq-wisp-3yqg","type":"blocks","created_at":"2026-01-16T01:54:43.698553417-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-zhdmw","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T23:44:48.915218817-05:00","updated_at":"2026-01-17T00:35:35.820456939-05:00","closed_at":"2026-01-17T00:35:35.820456939-05:00","close_reason":"Cleanup","ephemeral":true}
{"id":"hq-wisp-ziyz","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:46:01.531815448-05:00","updated_at":"2026-01-16T01:52:13.362713934-05:00","closed_at":"2026-01-16T01:52:13.362713934-05:00","close_reason":"Orphaned wisp cleanup","dependencies":[{"issue_id":"hq-wisp-ziyz","depends_on_id":"hq-wisp-xunp","type":"parent-child","created_at":"2026-01-16T01:46:01.619166561-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-ziyz","depends_on_id":"hq-wisp-ddnq","type":"blocks","created_at":"2026-01-16T01:46:01.818856345-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-zizic","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:31:03.248109708-05:00","updated_at":"2026-01-17T00:31:23.048856886-05:00","closed_at":"2026-01-17T00:31:23.048856886-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-zizic","depends_on_id":"hq-wisp-apmz9","type":"parent-child","created_at":"2026-01-17T00:31:05.024953066-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-zizic","depends_on_id":"hq-wisp-kitc4","type":"blocks","created_at":"2026-01-17T00:31:09.712145495-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-zizic","depends_on_id":"hq-wisp-aa5xc","type":"blocks","created_at":"2026-01-17T00:31:10.02823093-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-zizic","depends_on_id":"hq-wisp-4s1yl","type":"blocks","created_at":"2026-01-17T00:31:10.301897465-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-zjn7","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:55:36.782508002-05:00","updated_at":"2026-01-16T01:56:25.983652924-05:00","closed_at":"2026-01-16T01:56:25.983652924-05:00","close_reason":"Orphan cleanup","dependencies":[{"issue_id":"hq-wisp-zjn7","depends_on_id":"hq-wisp-ndqt","type":"parent-child","created_at":"2026-01-16T01:55:36.840417606-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-zjn7","depends_on_id":"hq-wisp-gjda","type":"blocks","created_at":"2026-01-16T01:55:36.979069621-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-zmeg0","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:09:41.61390755-05:00","updated_at":"2026-01-17T01:10:50.80865446-05:00","closed_at":"2026-01-17T01:10:50.80865446-05:00","close_reason":"No stuck dogs","dependencies":[{"issue_id":"hq-wisp-zmeg0","depends_on_id":"hq-wisp-fsms9","type":"parent-child","created_at":"2026-01-17T01:09:48.292118711-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-zmeg0","depends_on_id":"hq-wisp-z3nfp","type":"blocks","created_at":"2026-01-17T01:10:00.471734501-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-zmq86","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:44:42.000718864-05:00","updated_at":"2026-01-17T10:44:42.000718864-05:00","dependencies":[{"issue_id":"hq-wisp-zmq86","depends_on_id":"hq-wisp-qd1hf","type":"parent-child","created_at":"2026-01-17T10:44:42.145425983-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-zmq86","depends_on_id":"hq-wisp-fpw0o","type":"blocks","created_at":"2026-01-17T10:44:42.432623855-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-zph4x","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:43:06.011125285-05:00","updated_at":"2026-01-16T23:43:35.699318193-05:00","closed_at":"2026-01-16T23:43:35.699318193-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-zph4x","depends_on_id":"hq-wisp-p7g8j","type":"parent-child","created_at":"2026-01-16T23:43:06.874135088-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-zph4x","depends_on_id":"hq-wisp-dc7su","type":"blocks","created_at":"2026-01-16T23:43:09.049363372-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-zq73z","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:07:28.963572896-05:00","updated_at":"2026-01-17T01:08:51.671994286-05:00","closed_at":"2026-01-17T01:08:51.671994286-05:00","close_reason":"No async gates","dependencies":[{"issue_id":"hq-wisp-zq73z","depends_on_id":"hq-wisp-fnimo","type":"parent-child","created_at":"2026-01-17T01:07:30.202961497-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-zq73z","depends_on_id":"hq-wisp-udjx9","type":"blocks","created_at":"2026-01-17T01:07:40.629469715-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-zre9l","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:43:06.016167245-05:00","updated_at":"2026-01-16T23:43:27.806278799-05:00","closed_at":"2026-01-16T23:43:27.806278799-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-zre9l","depends_on_id":"hq-wisp-p7g8j","type":"parent-child","created_at":"2026-01-16T23:43:07.952291154-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-zre9l","depends_on_id":"hq-wisp-tknap","type":"blocks","created_at":"2026-01-16T23:43:10.220897465-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-zs8z5","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:49:41.45167736-05:00","updated_at":"2026-01-16T23:50:09.52205154-05:00","closed_at":"2026-01-16T23:50:09.52205154-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-zs8z5","depends_on_id":"hq-wisp-q54v3","type":"parent-child","created_at":"2026-01-16T23:49:43.852042305-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-zs8z5","depends_on_id":"hq-wisp-l3dxf","type":"blocks","created_at":"2026-01-16T23:49:46.738140768-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-zstq","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:56:35.919472062-05:00","updated_at":"2026-01-16T22:13:02.2206214-05:00","closed_at":"2026-01-16T22:13:02.2206214-05:00","close_reason":"Orphaned - forced cleanup","dependencies":[{"issue_id":"hq-wisp-zstq","depends_on_id":"hq-wisp-8d7d","type":"parent-child","created_at":"2026-01-16T01:56:35.93192409-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-zstq","depends_on_id":"hq-wisp-g0v8","type":"blocks","created_at":"2026-01-16T01:56:35.971109631-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-zt3r","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:46:26.939301813-05:00","updated_at":"2026-01-16T01:51:56.355795369-05:00","closed_at":"2026-01-16T01:51:56.355795369-05:00","close_reason":"No zombies detected","dependencies":[{"issue_id":"hq-wisp-zt3r","depends_on_id":"hq-wisp-ybkc","type":"parent-child","created_at":"2026-01-16T01:46:27.027358134-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-zt3r","depends_on_id":"hq-wisp-f24f","type":"blocks","created_at":"2026-01-16T01:46:27.247916187-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-zthb6","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:44:43.645031199-05:00","updated_at":"2026-01-16T23:45:23.400612891-05:00","closed_at":"2026-01-16T23:45:23.400612891-05:00","close_reason":"Routine patrol","dependencies":[{"issue_id":"hq-wisp-zthb6","depends_on_id":"hq-wisp-bhwu0","type":"parent-child","created_at":"2026-01-16T23:44:45.176721318-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-zthb6","depends_on_id":"hq-wisp-bijru","type":"blocks","created_at":"2026-01-16T23:44:47.373224014-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-zu17e","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:27:30.736668789-05:00","updated_at":"2026-01-17T00:27:57.684209001-05:00","closed_at":"2026-01-17T00:27:57.684209001-05:00","close_reason":"Town idle","dependencies":[{"issue_id":"hq-wisp-zu17e","depends_on_id":"hq-wisp-72ja3","type":"parent-child","created_at":"2026-01-17T00:27:32.420113733-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-zu17e","depends_on_id":"hq-wisp-9ile6","type":"blocks","created_at":"2026-01-17T00:27:36.620496126-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-zuidw","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:58:39.893120843-05:00","updated_at":"2026-01-17T00:59:46.252758624-05:00","closed_at":"2026-01-17T00:59:46.252758624-05:00","close_reason":"No notifications","dependencies":[{"issue_id":"hq-wisp-zuidw","depends_on_id":"hq-wisp-0nlhz","type":"parent-child","created_at":"2026-01-17T00:58:43.172451401-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-zuidw","depends_on_id":"hq-wisp-4z1dm","type":"blocks","created_at":"2026-01-17T00:58:53.037812112-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-zuvmu","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:25:52.720579241-05:00","updated_at":"2026-01-16T23:27:35.714222419-05:00","closed_at":"2026-01-16T23:27:35.714222419-05:00","close_reason":"Cleanup noted","dependencies":[{"issue_id":"hq-wisp-zuvmu","depends_on_id":"hq-wisp-w4tn2","type":"parent-child","created_at":"2026-01-16T23:25:53.944206998-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-zuvmu","depends_on_id":"hq-wisp-keqqj","type":"blocks","created_at":"2026-01-16T23:25:55.84319675-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-zv2x","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-16T01:26:29.472317255-05:00","updated_at":"2026-01-16T01:50:39.289803061-05:00","closed_at":"2026-01-16T01:50:39.289803061-05:00","close_reason":"Stale patrol wisp cleanup","ephemeral":true}
{"id":"hq-wisp-zvtnw","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:46:50.729468244-05:00","updated_at":"2026-01-17T10:46:50.729468286-05:00","dependencies":[{"issue_id":"hq-wisp-zvtnw","depends_on_id":"hq-wisp-2vhlh","type":"parent-child","created_at":"2026-01-17T10:46:51.091598532-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-zvtnw","depends_on_id":"hq-wisp-i20qn","type":"blocks","created_at":"2026-01-17T10:46:51.642299835-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-zw1ev","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T10:49:59.358882415-05:00","updated_at":"2026-01-17T10:49:59.358882457-05:00","dependencies":[{"issue_id":"hq-wisp-zw1ev","depends_on_id":"hq-wisp-wxw0u","type":"parent-child","created_at":"2026-01-17T10:49:59.765957344-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-zw1ev","depends_on_id":"hq-wisp-guri6","type":"blocks","created_at":"2026-01-17T10:50:00.674015979-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-zwr9","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:21:24.471405886-05:00","updated_at":"2026-01-16T23:23:37.402753593-05:00","closed_at":"2026-01-16T23:23:37.402753593-05:00","close_reason":"Standard end-of-cycle, looping","dependencies":[{"issue_id":"hq-wisp-zwr9","depends_on_id":"hq-wisp-87xr","type":"parent-child","created_at":"2026-01-16T23:21:25.640224237-05:00","created_by":"deacon"},{"issue_id":"hq-wisp-zwr9","depends_on_id":"hq-wisp-huma","type":"blocks","created_at":"2026-01-16T23:21:27.383265225-05:00","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-zx2sm","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"closed","priority":2,"issue_type":"epic","assignee":"deacon","created_at":"2026-01-17T01:03:11.630365509-05:00","updated_at":"2026-01-17T01:04:42.361262542-05:00","closed_at":"2026-01-17T01:04:42.361262542-05:00","close_reason":"Patrol 17 complete","ephemeral":true}
{"id":"hq-wjvlw","title":"Digest: mol-deacon-patrol","description":"Patrol 18: Idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:02:49.615183587-05:00","updated_at":"2026-01-17T00:02:49.615183587-05:00","closed_at":"2026-01-17T00:02:49.615138712-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-wjvlw","depends_on_id":"hq-wisp-h0zwb","type":"parent-child","created_at":"2026-01-17T00:02:49.616310961-05:00","created_by":"deacon"}]}
{"id":"hq-wjvm","title":"Digest: mol-deacon-patrol","description":"Patrol 13","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:08:54.874569297-05:00","updated_at":"2026-01-16T22:08:54.874569297-05:00","closed_at":"2026-01-16T22:08:54.874507131-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-wjvm","depends_on_id":"hq-wisp-479m","type":"parent-child","created_at":"2026-01-16T22:08:54.875450963-05:00","created_by":"deacon"}]}
{"id":"hq-wk4zb","title":"Digest: mol-deacon-patrol","description":"Patrol 13: inbox empty, town idle, added dog hotel","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:47:39.748343086-05:00","updated_at":"2026-01-16T23:47:39.748343086-05:00","closed_at":"2026-01-16T23:47:39.630522501-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-wk4zb","depends_on_id":"hq-wisp-al98y","type":"parent-child","created_at":"2026-01-16T23:47:39.749597037-05:00","created_by":"deacon"}]}
{"id":"hq-wsf0k","title":"Digest: mol-deacon-patrol","description":"Patrol 11: town idle, all checks passed","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:49:26.326210713-05:00","updated_at":"2026-01-16T23:49:26.326210713-05:00","closed_at":"2026-01-16T23:49:26.27642166-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-wsf0k","depends_on_id":"hq-wisp-il37x","type":"parent-child","created_at":"2026-01-16T23:49:26.327602543-05:00","created_by":"deacon"}]}
{"id":"hq-wuh","title":"Digest: mol-deacon-patrol","description":"Patrol 9: idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T23:17:37.530771863-05:00","updated_at":"2026-01-15T23:17:37.530771863-05:00","closed_at":"2026-01-15T23:17:37.530722863-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-xdo1","title":"Digest: mol-deacon-patrol","description":"Patrol #2: 0 messages, cleared 2 stale dogs, dispatched session-gc, town idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:54:18.467280917-05:00","updated_at":"2026-01-16T22:54:18.467280917-05:00","closed_at":"2026-01-16T22:54:18.467227126-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-xdo1","depends_on_id":"hq-wisp-loui","type":"parent-child","created_at":"2026-01-16T22:54:18.468135834-05:00","created_by":"deacon"}]}
{"id":"hq-xf8x","title":"Digest: mol-deacon-patrol","description":"Cleanup: orphaned patrol","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:45:19.308674622-05:00","updated_at":"2026-01-16T01:45:19.308674622-05:00","closed_at":"2026-01-16T01:45:19.299919298-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-xf8x","depends_on_id":"hq-wisp-8ztf","type":"parent-child","created_at":"2026-01-16T01:45:19.309985371-05:00","created_by":"deacon"}]}
{"id":"hq-xgpmw","title":"Digest: mol-deacon-patrol","description":"Patrol 10: Idle town, efficient batch close","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:45:05.937086397-05:00","updated_at":"2026-01-16T23:45:05.937086397-05:00","closed_at":"2026-01-16T23:45:05.935406831-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-xgpmw","depends_on_id":"hq-wisp-d6x49","type":"parent-child","created_at":"2026-01-16T23:45:05.938276218-05:00","created_by":"deacon"}]}
{"id":"hq-xh9","title":"Digest: mol-deacon-patrol","description":"Patrol 16: idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T23:20:47.417482927-05:00","updated_at":"2026-01-15T23:20:47.417482927-05:00","closed_at":"2026-01-15T23:20:47.417421261-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-xipsf","title":"Digest: mol-deacon-patrol","description":"Patrol 11: healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T10:47:18.033429476-05:00","updated_at":"2026-01-17T10:47:18.033429476-05:00","closed_at":"2026-01-17T10:47:18.033378726-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-xipsf","depends_on_id":"hq-wisp-8vsav","type":"parent-child","created_at":"2026-01-17T10:47:18.034592142-05:00","created_by":"deacon"}]}
{"id":"hq-xjktg","title":"Digest: mol-deacon-patrol","description":"Patrol 15: idle town","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:21:11.485723449-05:00","updated_at":"2026-01-16T23:21:11.485723449-05:00","closed_at":"2026-01-16T23:21:11.48567024-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-xjktg","depends_on_id":"hq-wisp-8mlf","type":"parent-child","created_at":"2026-01-16T23:21:11.48664174-05:00","created_by":"deacon"}]}
{"id":"hq-xjphx","title":"Digest: mol-deacon-patrol","description":"Patrol 6: town healthy and idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T10:45:37.629214107-05:00","updated_at":"2026-01-17T10:45:37.629214107-05:00","closed_at":"2026-01-17T10:45:37.629153857-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-xjphx","depends_on_id":"hq-wisp-whr8h","type":"parent-child","created_at":"2026-01-17T10:45:37.630487521-05:00","created_by":"deacon"}]}
{"id":"hq-xm7g3","title":"Digest: mol-deacon-patrol","description":"Patrol 9: town idle, no incidents","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:51:12.692792517-05:00","updated_at":"2026-01-16T23:51:12.692792517-05:00","closed_at":"2026-01-16T23:51:06.506419233-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-xm7g3","depends_on_id":"hq-wisp-dd7xu","type":"parent-child","created_at":"2026-01-16T23:51:12.693907308-05:00","created_by":"deacon"}]}
{"id":"hq-xs1ez","title":"Digest: mol-deacon-patrol","description":"Patrol cycle 9: Town idle. No callbacks, no gates, no polecats. 5 dogs idle.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:01:43.08113885-05:00","updated_at":"2026-01-16T23:01:43.08113885-05:00","closed_at":"2026-01-16T23:01:43.081094475-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-xs1ez","depends_on_id":"hq-wisp-jepa","type":"parent-child","created_at":"2026-01-16T23:01:43.082105724-05:00","created_by":"deacon"}]}
{"id":"hq-xsk9h","title":"Digest: mol-deacon-patrol","description":"Patrol 18: Town idle, extraordinary_action flagged externally, handing off","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:08:20.363608532-05:00","updated_at":"2026-01-17T00:08:20.363608532-05:00","closed_at":"2026-01-17T00:08:20.363555157-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-xsk9h","depends_on_id":"hq-wisp-uband","type":"parent-child","created_at":"2026-01-17T00:08:20.36480278-05:00","created_by":"deacon"}]}
{"id":"hq-xty0n","title":"Digest: mol-deacon-patrol","description":"Patrol 8: Town idle, rapid cycle.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:42:38.073267089-05:00","updated_at":"2026-01-16T23:42:38.073267089-05:00","closed_at":"2026-01-16T23:42:37.974479399-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-xty0n","depends_on_id":"hq-wisp-zedgm","type":"parent-child","created_at":"2026-01-16T23:42:38.074675108-05:00","created_by":"deacon"}]}
{"id":"hq-xxq6","title":"Digest: mol-deacon-patrol","description":"Patrol: town idle, all healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:54:39.300598538-05:00","updated_at":"2026-01-16T01:54:39.300598538-05:00","closed_at":"2026-01-16T01:54:39.255136171-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-xxq6","depends_on_id":"hq-wisp-b9ea","type":"parent-child","created_at":"2026-01-16T01:54:39.301584704-05:00","created_by":"deacon"}]}
{"id":"hq-y09","title":"Digest: mol-deacon-patrol","description":"Patrol cycle 10: town idle, preparing handoff","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T17:24:11.686524733-05:00","updated_at":"2026-01-15T17:24:11.686524733-05:00","closed_at":"2026-01-15T17:24:11.686477983-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-y12tu","title":"Digest: mol-deacon-patrol","description":"Patrol 8: Idle town","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:38:32.929785695-05:00","updated_at":"2026-01-17T00:38:32.929785695-05:00","closed_at":"2026-01-17T00:38:19.753811343-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-y2xt5","title":"Digest: mol-deacon-patrol","description":"Patrol 12: quick scan, nominal","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:47:33.259355596-05:00","updated_at":"2026-01-17T00:47:33.259355596-05:00","closed_at":"2026-01-17T00:47:33.259302263-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-yby8k","title":"Digest: mol-deacon-patrol","description":"Patrol 17: Idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:00:53.919554492-05:00","updated_at":"2026-01-17T00:00:53.919554492-05:00","closed_at":"2026-01-17T00:00:53.919504575-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-yby8k","depends_on_id":"hq-wisp-wbkd3","type":"parent-child","created_at":"2026-01-17T00:00:53.920641282-05:00","created_by":"deacon"}]}
{"id":"hq-ycsq","title":"Digest: mol-deacon-patrol","description":"Patrol 3: idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T21:47:34.303422163-05:00","updated_at":"2026-01-16T21:47:34.303422163-05:00","closed_at":"2026-01-16T21:47:34.303366829-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-ycsq","depends_on_id":"hq-wisp-agsn","type":"parent-child","created_at":"2026-01-16T21:47:34.304403994-05:00","created_by":"deacon"}]}
{"id":"hq-yhak","title":"Digest: mol-deacon-patrol","description":"Patrol 10","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:07:57.011173683-05:00","updated_at":"2026-01-16T22:07:57.011173683-05:00","closed_at":"2026-01-16T22:07:57.0111166-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-yhak","depends_on_id":"hq-wisp-sn5a","type":"parent-child","created_at":"2026-01-16T22:07:57.012049849-05:00","created_by":"deacon"}]}
{"id":"hq-ynvzq","title":"Digest: mol-deacon-patrol","description":"Patrol 4: town idle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:02:06.050028468-05:00","updated_at":"2026-01-16T23:02:06.050028468-05:00","closed_at":"2026-01-16T23:02:06.017269358-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-ynvzq","depends_on_id":"hq-wisp-qhzl","type":"parent-child","created_at":"2026-01-16T23:02:06.051034884-05:00","created_by":"deacon"}]}
{"id":"hq-yobyb","title":"Digest: mol-deacon-patrol","description":"Patrol complete: inbox empty, no pending spawns, no convoys, no gates, no gated molecules, witness/refinery healthy, no zombies, no orphans, no plugins, doctor found missing beads (outside scope), costs digest timed out","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:23:29.365108696-05:00","updated_at":"2026-01-17T00:23:29.365108696-05:00","closed_at":"2026-01-17T00:23:29.343674999-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-yt9q","title":"Digest: mol-deacon-patrol","description":"Patrol 5: all healthy, quick cycle","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:02:40.035352854-05:00","updated_at":"2026-01-16T22:02:40.035352854-05:00","closed_at":"2026-01-16T22:02:40.035302187-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-yt9q","depends_on_id":"hq-wisp-6o2o","type":"parent-child","created_at":"2026-01-16T22:02:40.036298478-05:00","created_by":"deacon"}]}
{"id":"hq-z2l11","title":"Digest: mol-deacon-patrol","description":"Patrol 17: witness/refinery healthy, fixed alpha/charlie stuck dogs","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:07:15.535711002-05:00","updated_at":"2026-01-17T01:07:15.535711002-05:00","closed_at":"2026-01-17T01:07:15.46123841-05:00","close_reason":"Squashed from 19 wisps"}
{"id":"hq-z8ov","title":"Digest: mol-deacon-patrol","description":"Patrol 4: all healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:20:15.78181434-05:00","updated_at":"2026-01-16T22:20:15.78181434-05:00","closed_at":"2026-01-16T22:20:15.781759965-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-z8ov","depends_on_id":"hq-wisp-tetc","type":"parent-child","created_at":"2026-01-16T22:20:15.782645839-05:00","created_by":"deacon"}]}
{"id":"hq-zfaa","title":"Digest: mol-deacon-patrol","description":"Patrol complete: 0 inbox msgs, cleared 2 orphaned dogs (alpha/bravo), dispatched session-gc for 5 stale locks, witness OK, refinery idle (expected)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:09:10.680832297-05:00","updated_at":"2026-01-16T01:09:10.680832297-05:00","closed_at":"2026-01-16T01:09:10.680775839-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-zfaa","depends_on_id":"hq-wisp-xwrs","type":"parent-child","created_at":"2026-01-16T01:09:10.681580671-05:00","created_by":"deacon"}]}
{"id":"hq-zspe","title":"Digest: mol-deacon-patrol","description":"Patrol 17 complete: all healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:29:24.597375549-05:00","updated_at":"2026-01-16T01:29:24.597375549-05:00","closed_at":"2026-01-16T01:29:24.597324549-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-zspe","depends_on_id":"hq-wisp-c41f","type":"parent-child","created_at":"2026-01-16T01:29:24.598063506-05:00","created_by":"deacon"}]}
{"id":"hq-ztjh","title":"Digest: mol-deacon-patrol","description":"Patrol #4: Routine, all healthy","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:59:08.669187911-05:00","updated_at":"2026-01-16T00:59:08.669187911-05:00","closed_at":"2026-01-16T00:59:08.669141162-05:00","close_reason":"Squashed from 19 wisps","dependencies":[{"issue_id":"hq-ztjh","depends_on_id":"hq-wisp-7amw","type":"parent-child","created_at":"2026-01-16T00:59:08.669894411-05:00","created_by":"deacon"}]}
{"id":"mol-deacon-patrol","title":"mol-deacon-patrol","description":"Mayor's daemon patrol loop.\n\nThe Deacon is the Mayor's background process that runs continuously, handling callbacks, monitoring rig health, and performing cleanup. Each patrol cycle runs these steps in sequence, then loops or exits.\n\n## Idle Town Principle\n\n**The Deacon should be silent/invisible when the town is healthy and idle.**\n\n- Skip HEALTH_CHECK nudges when no active work exists\n- Sleep 60+ seconds between patrol cycles (longer when idle)\n- Let the feed subscription wake agents on actual events\n- The daemon (10-minute heartbeat) is the safety net for dead sessions\n\nThis prevents flooding idle agents with health checks every few seconds.\n\n## Second-Order Monitoring\n\nWitnesses send WITNESS_PING messages to verify the Deacon is alive. This\nprevents the \"who watches the watchers\" problem - if the Deacon dies,\nWitnesses detect it and escalate to the Mayor.\n\nThe Deacon's agent bead last_activity timestamp is updated during each patrol\ncycle. Witnesses check this timestamp to verify health.","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-15T16:59:08.212114135-05:00","updated_at":"2026-01-15T16:59:08.212114176-05:00","labels":["template"],"is_template":true}
{"id":"mol-deacon-patrol.check-convoy-completion","title":"Check convoy completion","description":"Check convoy completion status.\n\nConvoys are coordination beads that track multiple issues across rigs. When all tracked issues close, the convoy auto-closes.\n\n**Step 1: Find open convoys**\n```bash\nbd list --type=convoy --status=open\n```\n\n**Step 2: For each open convoy, check tracked issues**\n```bash\nbd show \u003cconvoy-id\u003e\n# Look for 'tracks' or 'dependencies' field listing tracked issues\n```\n\n**Step 3: If all tracked issues are closed, close the convoy**\n```bash\n# Check each tracked issue\nfor issue in tracked_issues:\n    bd show \u003cissue-id\u003e\n    # If status is open/in_progress, convoy stays open\n    # If all are closed (completed, wontfix, etc.), convoy is complete\n\n# Close convoy when all tracked issues are done\nbd close \u003cconvoy-id\u003e --reason \"All tracked issues completed\"\n```\n\n**Note**: Convoys support cross-prefix tracking (e.g., hq-* convoy can track gt-*, bd-* issues). Use full IDs when checking.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-15T16:59:08.212120468-05:00","updated_at":"2026-01-15T16:59:08.21212051-05:00","dependencies":[{"issue_id":"mol-deacon-patrol.check-convoy-completion","depends_on_id":"mol-deacon-patrol","type":"parent-child","created_at":"2026-01-15T16:59:08.228574702-05:00","created_by":"deacon"},{"issue_id":"mol-deacon-patrol.check-convoy-completion","depends_on_id":"mol-deacon-patrol.inbox-check","type":"blocks","created_at":"2026-01-15T16:59:08.2387179-05:00","created_by":"deacon"}],"is_template":true}
{"id":"mol-deacon-patrol.context-check","title":"Check own context limit","description":"Check own context limit.\n\nThe Deacon runs in a Claude session with finite context. Check if approaching the limit:\n\n```bash\ngt context --usage\n```\n\nIf context is high (\u003e80%), prepare for handoff:\n- Summarize current state\n- Note any pending work\n- Write handoff to molecule state\n\nThis enables the Deacon to burn and respawn cleanly.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-15T16:59:08.212129593-05:00","updated_at":"2026-01-15T16:59:08.212129635-05:00","dependencies":[{"issue_id":"mol-deacon-patrol.context-check","depends_on_id":"mol-deacon-patrol","type":"parent-child","created_at":"2026-01-15T16:59:08.234994321-05:00","created_by":"deacon"},{"issue_id":"mol-deacon-patrol.context-check","depends_on_id":"mol-deacon-patrol.patrol-cleanup","type":"blocks","created_at":"2026-01-15T16:59:08.249281515-05:00","created_by":"deacon"}],"is_template":true}
{"id":"mol-deacon-patrol.costs-digest","title":"Aggregate daily costs","description":"**DAILY DIGEST** - Aggregate yesterday's session cost wisps.\n\nSession costs are recorded as ephemeral wisps (not exported to JSONL) to avoid\nlog-in-database pollution. This step aggregates them into a permanent daily\n\"Cost Report YYYY-MM-DD\" bead for audit purposes.\n\n**Step 1: Check if digest is needed**\n```bash\n# Preview yesterday's costs (dry run)\ngt costs digest --yesterday --dry-run\n```\n\nIf output shows \"No session cost wisps found\", skip to Step 3.\n\n**Step 2: Create the digest**\n```bash\ngt costs digest --yesterday\n```\n\nThis:\n- Queries all session.ended wisps from yesterday\n- Creates a single \"Cost Report YYYY-MM-DD\" bead with aggregated data\n- Deletes the source wisps\n\n**Step 3: Verify**\nThe digest appears in `gt costs --week` queries.\nDaily digests preserve audit trail without per-session pollution.\n\n**Timing**: Run once per morning patrol cycle. The --yesterday flag ensures\nwe don't try to digest today's incomplete data.\n\n**Exit criteria:** Yesterday's costs digested (or no wisps to digest).","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-15T16:59:08.212128176-05:00","updated_at":"2026-01-15T16:59:08.212128218-05:00","dependencies":[{"issue_id":"mol-deacon-patrol.costs-digest","depends_on_id":"mol-deacon-patrol","type":"parent-child","created_at":"2026-01-15T16:59:08.233516156-05:00","created_by":"deacon"},{"issue_id":"mol-deacon-patrol.costs-digest","depends_on_id":"mol-deacon-patrol.session-gc","type":"blocks","created_at":"2026-01-15T16:59:08.247089142-05:00","created_by":"deacon"}],"is_template":true}
{"id":"mol-deacon-patrol.dispatch-gated-molecules","title":"Dispatch molecules with resolved gates","description":"Find molecules blocked on gates that have now closed and dispatch them.\n\nThis completes the async resume cycle without explicit waiter tracking.\nThe molecule state IS the waiter - patrol discovers reality each cycle.\n\n**Step 1: Find gate-ready molecules**\n```bash\nbd mol ready --gated --json\n```\n\nThis returns molecules where:\n- Status is in_progress\n- Current step has a gate dependency\n- The gate bead is now closed\n- No polecat currently has it hooked\n\n**Step 2: For each ready molecule, dispatch to the appropriate rig**\n```bash\n# Determine target rig from molecule metadata\nbd mol show \u003cmol-id\u003e --json\n# Look for rig field or infer from prefix\n\n# Dispatch to that rig's polecat pool\ngt sling \u003cmol-id\u003e \u003crig\u003e/polecats\n```\n\n**Step 3: Log dispatch**\nNote which molecules were dispatched for observability:\n```bash\n# Molecule \u003cmol-id\u003e dispatched to \u003crig\u003e/polecats (gate \u003cgate-id\u003e cleared)\n```\n\n**If no gate-ready molecules:**\nSkip - nothing to dispatch. Gates haven't closed yet or molecules\nalready have active polecats working on them.\n\n**Exit criteria:** All gate-ready molecules dispatched to polecats.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-15T16:59:08.212117468-05:00","updated_at":"2026-01-15T16:59:08.21211751-05:00","dependencies":[{"issue_id":"mol-deacon-patrol.dispatch-gated-molecules","depends_on_id":"mol-deacon-patrol","type":"parent-child","created_at":"2026-01-15T16:59:08.228076328-05:00","created_by":"deacon"},{"issue_id":"mol-deacon-patrol.dispatch-gated-molecules","depends_on_id":"mol-deacon-patrol.gate-evaluation","type":"blocks","created_at":"2026-01-15T16:59:08.238013901-05:00","created_by":"deacon"}],"is_template":true}
{"id":"mol-deacon-patrol.dog-health-check","title":"Check for stuck dogs","description":"Check for dogs that have been working too long (stuck).\n\nDogs dispatched via `gt dog dispatch --plugin` are marked as \"working\" with\na work description like \"plugin:rebuild-gt\". If a dog hangs, crashes, or\ntakes too long, it needs intervention.\n\n**Step 1: List working dogs**\n```bash\ngt dog list --json\n# Filter for state: \"working\"\n```\n\n**Step 2: Check work duration**\nFor each working dog:\n```bash\ngt dog status \u003cname\u003e --json\n# Check: work_started_at, current_work\n```\n\nCompare against timeout:\n- If plugin has [execution] timeout in plugin.md, use that\n- Default timeout: 10 minutes for infrastructure tasks\n\n**Duration calculation:**\n```\nstuck_threshold = plugin_timeout or 10m\nduration = now - work_started_at\nis_stuck = duration \u003e stuck_threshold\n```\n\n**Step 3: Handle stuck dogs**\n\nFor dogs working \u003e timeout:\n```bash\n# Option A: File death warrant (Boot handles termination)\ngt warrant file deacon/dogs/\u003cname\u003e --reason \"Stuck: working on \u003cwork\u003e for \u003cduration\u003e\"\n\n# Option B: Force clear work and notify\ngt dog clear \u003cname\u003e --force\ngt mail send deacon/ -s \"DOG_TIMEOUT \u003cname\u003e\" -m \"Dog \u003cname\u003e timed out on \u003cwork\u003e after \u003cduration\u003e\"\n```\n\n**Decision matrix:**\n\n| Duration over timeout | Action |\n|----------------------|--------|\n| \u003c 2x timeout | Log warning, check next cycle |\n| 2x - 5x timeout | File death warrant |\n| \u003e 5x timeout | Force clear + escalate to Mayor |\n\n**Step 4: Track chronic failures**\nIf same dog gets stuck repeatedly:\n```bash\ngt mail send mayor/ -s \"Dog \u003cname\u003e chronic failures\" -m \"Dog has timed out N times in last 24h. Consider removing from pool.\"\n```\n\n**Exit criteria:** All stuck dogs handled (warrant filed or cleared).","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-15T16:59:08.212125885-05:00","updated_at":"2026-01-15T16:59:08.212125926-05:00","dependencies":[{"issue_id":"mol-deacon-patrol.dog-health-check","depends_on_id":"mol-deacon-patrol","type":"parent-child","created_at":"2026-01-15T16:59:08.232034282-05:00","created_by":"deacon"},{"issue_id":"mol-deacon-patrol.dog-health-check","depends_on_id":"mol-deacon-patrol.dog-pool-maintenance","type":"blocks","created_at":"2026-01-15T16:59:08.24460977-05:00","created_by":"deacon"}],"is_template":true}
{"id":"mol-deacon-patrol.dog-pool-maintenance","title":"Maintain dog pool","description":"Ensure dog pool has available workers for dispatch.\n\n**Step 1: Check dog pool status**\n```bash\ngt dog status\n# Shows idle/working counts\n```\n\n**Step 2: Ensure minimum idle dogs**\nIf idle count is 0 and working count is at capacity, consider spawning:\n```bash\n# If no idle dogs available\ngt dog add \u003cname\u003e\n# Names: alpha, bravo, charlie, delta, etc.\n```\n\n**Step 3: Retire stale dogs (optional)**\nDogs that have been idle for \u003e24 hours can be removed to save resources:\n```bash\ngt dog status \u003cname\u003e\n# Check last_active timestamp\n# If idle \u003e 24h: gt dog remove \u003cname\u003e\n```\n\n**Pool sizing guidelines:**\n- Minimum: 1 idle dog always available\n- Maximum: 4 dogs total (balance resources vs throughput)\n- Spawn on demand when pool is empty\n\n**Exit criteria:** Pool has at least 1 idle dog.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-15T16:59:08.212125676-05:00","updated_at":"2026-01-15T16:59:08.212125718-05:00","dependencies":[{"issue_id":"mol-deacon-patrol.dog-pool-maintenance","depends_on_id":"mol-deacon-patrol","type":"parent-child","created_at":"2026-01-15T16:59:08.231558949-05:00","created_by":"deacon"},{"issue_id":"mol-deacon-patrol.dog-pool-maintenance","depends_on_id":"mol-deacon-patrol.health-scan","type":"blocks","created_at":"2026-01-15T16:59:08.24391302-05:00","created_by":"deacon"}],"is_template":true}
{"id":"mol-deacon-patrol.fire-notifications","title":"Fire notifications","description":"Fire notifications for convoy and cross-rig events.\n\nAfter convoy completion or cross-rig dependency resolution, notify relevant parties.\n\n**Convoy completion notifications:**\nWhen a convoy closes (all tracked issues done), notify the Overseer:\n```bash\n# Convoy gt-convoy-xxx just completed\ngt mail send mayor/ -s \"Convoy complete: \u003cconvoy-title\u003e\" \\\n  -m \"Convoy \u003cid\u003e has completed. All tracked issues closed.\n      Duration: \u003cstart to end\u003e\n      Issues: \u003ccount\u003e\n\n      Summary: \u003cbrief description of what was accomplished\u003e\"\n```\n\n**Cross-rig resolution notifications:**\nWhen a cross-rig dependency resolves, notify the affected rig:\n```bash\n# Issue bd-xxx closed, unblocking gt-yyy\ngt mail send gastown/witness -s \"Dependency resolved: \u003cbd-xxx\u003e\" \\\n  -m \"External dependency bd-xxx has closed.\n      Unblocked: gt-yyy (\u003ctitle\u003e)\n      This issue may now proceed.\"\n```\n\n**Notification targets:**\n- Convoy complete  mayor/ (for strategic visibility)\n- Cross-rig dep resolved  \u003crig\u003e/witness (for operational awareness)\n\nKeep notifications brief and actionable. The recipient can run bd show for details.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-15T16:59:08.212122843-05:00","updated_at":"2026-01-15T16:59:08.212122885-05:00","dependencies":[{"issue_id":"mol-deacon-patrol.fire-notifications","depends_on_id":"mol-deacon-patrol","type":"parent-child","created_at":"2026-01-15T16:59:08.229592076-05:00","created_by":"deacon"},{"issue_id":"mol-deacon-patrol.fire-notifications","depends_on_id":"mol-deacon-patrol.resolve-external-deps","type":"blocks","created_at":"2026-01-15T16:59:08.239974816-05:00","created_by":"deacon"}],"is_template":true}
{"id":"mol-deacon-patrol.gate-evaluation","title":"Evaluate pending async gates","description":"Evaluate pending async gates.\n\nGates are async coordination primitives that block until conditions are met.\nThe Deacon is responsible for monitoring gates and closing them when ready.\n\n**Timer gates** (await_type: timer):\nCheck if elapsed time since creation exceeds the timeout duration.\n\n```bash\n# List all open gates\nbd gate list --json\n\n# For each timer gate, check if elapsed:\n# - CreatedAt + Timeout \u003c Now  gate is ready to close\n# - Close with: bd gate close \u003cid\u003e --reason \"Timer elapsed\"\n```\n\n**GitHub gates** (await_type: gh:run, gh:pr) - handled in separate step.\n\n**Human/Mail gates** - require external input, skip here.\n\nAfter closing a gate, the Waiters field contains mail addresses to notify.\nSend a brief notification to each waiter that the gate has cleared.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-15T16:59:08.212117093-05:00","updated_at":"2026-01-15T16:59:08.212117135-05:00","dependencies":[{"issue_id":"mol-deacon-patrol.gate-evaluation","depends_on_id":"mol-deacon-patrol","type":"parent-child","created_at":"2026-01-15T16:59:08.227572036-05:00","created_by":"deacon"},{"issue_id":"mol-deacon-patrol.gate-evaluation","depends_on_id":"mol-deacon-patrol.inbox-check","type":"blocks","created_at":"2026-01-15T16:59:08.237332318-05:00","created_by":"deacon"}],"is_template":true}
{"id":"mol-deacon-patrol.health-scan","title":"Check Witness and Refinery health","description":"Check Witness and Refinery health for each rig.\n\n**IMPORTANT: Idle Town Protocol**\nBefore sending health check nudges, check if the town is idle:\n```bash\n# Check for active work\nbd list --status=in_progress --limit=5\n```\n\nIf NO active work (empty result or only patrol molecules):\n- **Skip HEALTH_CHECK nudges** - don't disturb idle agents\n- Just verify sessions exist via status commands\n- The town should be silent when healthy and idle\n\nIf ACTIVE work exists:\n- Proceed with health check nudges below\n\n**ZFC Principle**: You (Claude) make the judgment call about what is \"stuck\" or \"unresponsive\" - there are no hardcoded thresholds in Go. Read the signals, consider context, and decide.\n\nFor each rig, run:\n```bash\ngt witness status \u003crig\u003e\ngt refinery status \u003crig\u003e\n\n# ONLY if active work exists - health ping (clears backoff as side effect)\ngt nudge \u003crig\u003e/witness 'HEALTH_CHECK from deacon'\ngt nudge \u003crig\u003e/refinery 'HEALTH_CHECK from deacon'\n```\n\n**Health Ping Benefit**: The nudge commands serve dual purposes:\n1. **Liveness verification** - Agent responds to prove it's alive\n2. **Backoff reset** - Any nudge resets agent's backoff to base interval\n\nThis ensures patrol agents remain responsive during active work periods.\n\n**Signals to assess:**\n\n| Component | Healthy Signals | Concerning Signals |\n|-----------|-----------------|-------------------|\n| Witness | State: running, recent activity | State: not running, no heartbeat |\n| Refinery | State: running, queue processing | Queue stuck, merge failures |\n\n**Tracking unresponsive cycles:**\n\nMaintain in your patrol state (persisted across cycles):\n```\nhealth_state:\n  \u003crig\u003e:\n    witness:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n    refinery:\n      unresponsive_cycles: 0\n      last_seen_healthy: \u003ctimestamp\u003e\n```\n\n**Decision matrix** (you decide the thresholds based on context):\n\n| Cycles Unresponsive | Suggested Action |\n|---------------------|------------------|\n| 1-2 | Note it, check again next cycle |\n| 3-4 | Attempt restart: gt witness restart \u003crig\u003e |\n| 5+ | Escalate to Mayor with context |\n\n**Restart commands:**\n```bash\ngt witness restart \u003crig\u003e\ngt refinery restart \u003crig\u003e\n```\n\n**Escalation:**\n```bash\ngt mail send mayor/ -s \"Health: \u003crig\u003e \u003ccomponent\u003e unresponsive\" \\\n  -m \"Component has been unresponsive for N cycles. Restart attempts failed.\n      Last healthy: \u003ctimestamp\u003e\n      Error signals: \u003cdetails\u003e\"\n```\n\nReset unresponsive_cycles to 0 when component responds normally.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-15T16:59:08.212123093-05:00","updated_at":"2026-01-15T16:59:08.212123135-05:00","dependencies":[{"issue_id":"mol-deacon-patrol.health-scan","depends_on_id":"mol-deacon-patrol","type":"parent-child","created_at":"2026-01-15T16:59:08.230088659-05:00","created_by":"deacon"},{"issue_id":"mol-deacon-patrol.health-scan","depends_on_id":"mol-deacon-patrol.trigger-pending-spawns","type":"blocks","created_at":"2026-01-15T16:59:08.240555774-05:00","created_by":"deacon"},{"issue_id":"mol-deacon-patrol.health-scan","depends_on_id":"mol-deacon-patrol.dispatch-gated-molecules","type":"blocks","created_at":"2026-01-15T16:59:08.241110773-05:00","created_by":"deacon"},{"issue_id":"mol-deacon-patrol.health-scan","depends_on_id":"mol-deacon-patrol.fire-notifications","type":"blocks","created_at":"2026-01-15T16:59:08.241807606-05:00","created_by":"deacon"}],"is_template":true}
{"id":"mol-deacon-patrol.inbox-check","title":"Handle callbacks from agents","description":"Handle callbacks from agents.\n\nCheck the Mayor's inbox for messages from:\n- Witnesses reporting polecat status\n- Refineries reporting merge results\n- Polecats requesting help or escalation\n- External triggers (webhooks, timers)\n\n```bash\ngt mail inbox\n# For each message:\ngt mail read \u003cid\u003e\n# Handle based on message type\n```\n\n**WITNESS_PING**:\nWitnesses periodically ping to verify Deacon is alive. Simply acknowledge\nand archive - the fact that you're processing mail proves you're running.\nYour agent bead last_activity is updated automatically during patrol.\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**HELP / Escalation**:\nAssess and handle or forward to Mayor.\nArchive after handling:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**LIFECYCLE messages**:\nPolecats reporting completion, refineries reporting merge results.\nArchive after processing:\n```bash\ngt mail archive \u003cmessage-id\u003e\n```\n\n**DOG_DONE messages**:\nDogs report completion after infrastructure tasks (orphan-scan, session-gc, etc.).\nSubject format: `DOG_DONE \u003chostname\u003e`\nBody contains: task name, counts, status.\n```bash\n# Parse the report, log metrics if needed\ngt mail read \u003cid\u003e\n# Archive after noting completion\ngt mail archive \u003cmessage-id\u003e\n```\nDogs return to idle automatically. The report is informational - no action needed\nunless the dog reports errors that require escalation.\n\nCallbacks may spawn new polecats, update issue state, or trigger other actions.\n\n**Hygiene principle**: Archive messages after they're fully processed.\nKeep inbox near-empty - only unprocessed items should remain.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-15T16:59:08.212115468-05:00","updated_at":"2026-01-15T16:59:08.212115468-05:00","dependencies":[{"issue_id":"mol-deacon-patrol.inbox-check","depends_on_id":"mol-deacon-patrol","type":"parent-child","created_at":"2026-01-15T16:59:08.226296996-05:00","created_by":"deacon"}],"is_template":true}
{"id":"mol-deacon-patrol.log-maintenance","title":"Rotate logs and prune state","description":"Maintain daemon logs and state files.\n\n**Step 1: Check daemon.log size**\n```bash\n# Get log file size\nls -la ~/.beads/daemon*.log 2\u003e/dev/null || ls -la ~/gt/.beads/daemon*.log 2\u003e/dev/null\n```\n\nIf daemon.log exceeds 10MB:\n```bash\n# Rotate with date suffix and gzip\nLOGFILE=\"$HOME/gt/.beads/daemon.log\"\nif [ -f \"$LOGFILE\" ] \u0026\u0026 [ $(stat -f%z \"$LOGFILE\" 2\u003e/dev/null || stat -c%s \"$LOGFILE\") -gt 10485760 ]; then\n    DATE=$(date +%Y-%m-%dT%H-%M-%S)\n    mv \"$LOGFILE\" \"${LOGFILE%.log}-${DATE}.log\"\n    gzip \"${LOGFILE%.log}-${DATE}.log\"\nfi\n```\n\n**Step 2: Archive old daemon logs**\n\nClean up daemon logs older than 7 days:\n```bash\nfind ~/gt/.beads/ -name \"daemon-*.log.gz\" -mtime +7 -delete\n```\n\n**Step 3: Prune state.json of dead sessions**\n\nThe state.json tracks active sessions. Prune entries for sessions that no longer exist:\n```bash\n# Check for stale session entries\ngt daemon status --json 2\u003e/dev/null\n```\n\nIf state.json references sessions not in tmux:\n- Remove the stale entries\n- The daemon's internal cleanup should handle this, but verify\n\n**Note**: Log rotation prevents disk bloat from long-running daemons.\nState pruning keeps runtime state accurate.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-15T16:59:08.212128926-05:00","updated_at":"2026-01-15T16:59:08.212128926-05:00","dependencies":[{"issue_id":"mol-deacon-patrol.log-maintenance","depends_on_id":"mol-deacon-patrol","type":"parent-child","created_at":"2026-01-15T16:59:08.234032072-05:00","created_by":"deacon"},{"issue_id":"mol-deacon-patrol.log-maintenance","depends_on_id":"mol-deacon-patrol.costs-digest","type":"blocks","created_at":"2026-01-15T16:59:08.24787285-05:00","created_by":"deacon"}],"is_template":true}
{"id":"mol-deacon-patrol.loop-or-exit","title":"Burn and respawn or loop","description":"Burn and let daemon respawn, or exit if context high.\n\nDecision point at end of patrol cycle:\n\nIf context is LOW:\nUse await-signal with exponential backoff to wait for activity:\n\n```bash\ngt mol step await-signal --agent-bead hq-deacon --backoff-base 60s --backoff-mult 2 --backoff-max 10m\n```\n\nThis command:\n1. Subscribes to `bd activity --follow` (beads activity feed)\n2. Returns IMMEDIATELY when any beads activity occurs\n3. If no activity, times out with exponential backoff:\n   - First timeout: 60s\n   - Second timeout: 120s\n   - Third timeout: 240s\n   - ...capped at 10 minutes max\n4. Tracks `idle:N` label on hq-deacon bead for backoff state\n\n**On signal received** (activity detected):\nReset the idle counter and start next patrol cycle:\n```bash\ngt agent state hq-deacon --set idle=0\n```\nThen return to inbox-check step.\n\n**On timeout** (no activity):\nThe idle counter was auto-incremented. Continue to next patrol cycle\n(the longer backoff will apply next time). Return to inbox-check step.\n\n**Why this approach?**\n- Any `gt` or `bd` command triggers beads activity, waking the Deacon\n- Idle towns let the Deacon sleep longer (up to 10 min between patrols)\n- Active work wakes the Deacon immediately via the feed\n- No polling or fixed sleep intervals\n\nIf context is HIGH:\n- Write state to persistent storage\n- Exit cleanly\n- Let the daemon orchestrator respawn a fresh Deacon\n\nThe daemon ensures Deacon is always running:\n```bash\n# Daemon respawns on exit\ngt daemon status\n```\n\nThis enables infinite patrol duration via context-aware respawning.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-15T16:59:08.212130968-05:00","updated_at":"2026-01-15T16:59:08.21213101-05:00","dependencies":[{"issue_id":"mol-deacon-patrol.loop-or-exit","depends_on_id":"mol-deacon-patrol","type":"parent-child","created_at":"2026-01-15T16:59:08.235474195-05:00","created_by":"deacon"},{"issue_id":"mol-deacon-patrol.loop-or-exit","depends_on_id":"mol-deacon-patrol.context-check","type":"blocks","created_at":"2026-01-15T16:59:08.249918431-05:00","created_by":"deacon"}],"is_template":true}
{"id":"mol-deacon-patrol.orphan-check","title":"Detect abandoned work","description":"**DETECT ONLY** - Check for orphaned state and dispatch to dog if found.\n\n**Step 1: Quick orphan scan**\n```bash\n# Check for in_progress issues with dead assignees\nbd list --status=in_progress --json | head -20\n```\n\nFor each in_progress issue, check if assignee session exists:\n```bash\ntmux has-session -t \u003csession\u003e 2\u003e/dev/null \u0026\u0026 echo \"alive\" || echo \"orphan\"\n```\n\n**Step 2: If orphans detected, dispatch to dog**\n```bash\n# Sling orphan-scan formula to an idle dog\ngt sling mol-orphan-scan deacon/dogs --var scope=town\n```\n\n**Important:** Do NOT fix orphans inline. Dogs handle recovery.\nThe Deacon's job is detection and dispatch, not execution.\n\n**Step 3: If no orphans detected**\nSkip dispatch - nothing to do.\n\n**Exit criteria:** Orphan scan dispatched to dog (if needed).","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-15T16:59:08.212126135-05:00","updated_at":"2026-01-15T16:59:08.212126176-05:00","dependencies":[{"issue_id":"mol-deacon-patrol.orphan-check","depends_on_id":"mol-deacon-patrol","type":"parent-child","created_at":"2026-01-15T16:59:08.23252824-05:00","created_by":"deacon"},{"issue_id":"mol-deacon-patrol.orphan-check","depends_on_id":"mol-deacon-patrol.dog-health-check","type":"blocks","created_at":"2026-01-15T16:59:08.245256852-05:00","created_by":"deacon"}],"is_template":true}
{"id":"mol-deacon-patrol.patrol-cleanup","title":"End-of-cycle inbox hygiene","description":"Verify inbox hygiene before ending patrol cycle.\n\n**Step 1: Check inbox state**\n```bash\ngt mail inbox\n```\n\nInbox should be EMPTY or contain only just-arrived unprocessed messages.\n\n**Step 2: Archive any remaining processed messages**\n\nAll message types should have been archived during inbox-check processing:\n- WITNESS_PING  archived after acknowledging\n- HELP/Escalation  archived after handling\n- LIFECYCLE  archived after processing\n\nIf any were missed:\n```bash\n# For each stale message found:\ngt mail archive \u003cmessage-id\u003e\n```\n\n**Goal**: Inbox should have 2 active messages at end of cycle.\nDeacon mail should flow through quickly - no accumulation.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-15T16:59:08.212129343-05:00","updated_at":"2026-01-15T16:59:08.212129343-05:00","dependencies":[{"issue_id":"mol-deacon-patrol.patrol-cleanup","depends_on_id":"mol-deacon-patrol","type":"parent-child","created_at":"2026-01-15T16:59:08.234518238-05:00","created_by":"deacon"},{"issue_id":"mol-deacon-patrol.patrol-cleanup","depends_on_id":"mol-deacon-patrol.log-maintenance","type":"blocks","created_at":"2026-01-15T16:59:08.248632224-05:00","created_by":"deacon"}],"is_template":true}
{"id":"mol-deacon-patrol.plugin-run","title":"Execute registered plugins","description":"Execute registered plugins.\n\nScan ~/gt/plugins/ for plugin directories. Each plugin has a plugin.md with TOML frontmatter defining its gate (when to run) and instructions (what to do).\n\nSee docs/deacon-plugins.md for full documentation.\n\nGate types:\n- cooldown: Time since last run (e.g., 24h)\n- cron: Schedule-based (e.g., \"0 9 * * *\")\n- condition: Metric threshold (e.g., wisp count \u003e 50)\n- event: Trigger-based (e.g., startup, heartbeat)\n\nFor each plugin:\n1. Read plugin.md frontmatter to check gate\n2. Compare against state.json (last run, etc.)\n3. If gate is open, execute the plugin\n\nPlugins marked parallel: true can run concurrently using Task tool subagents. Sequential plugins run one at a time in directory order.\n\nSkip this step if ~/gt/plugins/ does not exist or is empty.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-15T16:59:08.212124051-05:00","updated_at":"2026-01-15T16:59:08.212124093-05:00","dependencies":[{"issue_id":"mol-deacon-patrol.plugin-run","depends_on_id":"mol-deacon-patrol","type":"parent-child","created_at":"2026-01-15T16:59:08.231063741-05:00","created_by":"deacon"},{"issue_id":"mol-deacon-patrol.plugin-run","depends_on_id":"mol-deacon-patrol.zombie-scan","type":"blocks","created_at":"2026-01-15T16:59:08.243236729-05:00","created_by":"deacon"}],"is_template":true}
{"id":"mol-deacon-patrol.resolve-external-deps","title":"Resolve external dependencies","description":"Resolve external dependencies across rigs.\n\nWhen an issue in one rig closes, any dependencies in other rigs should be notified. This enables cross-rig coordination without tight coupling.\n\n**Step 1: Check recent closures from feed**\n```bash\ngt feed --since 10m --plain | grep \"\"\n# Look for recently closed issues\n```\n\n**Step 2: For each closed issue, check cross-rig dependents**\n```bash\nbd show \u003cclosed-issue\u003e\n# Look at 'blocks' field - these are issues that were waiting on this one\n# If any blocked issue is in a different rig/prefix, it may now be unblocked\n```\n\n**Step 3: Update blocked status**\nFor blocked issues in other rigs, the closure should automatically unblock them (beads handles this). But verify:\n```bash\nbd blocked\n# Should no longer show the previously-blocked issue if dependency is met\n```\n\n**Cross-rig scenarios:**\n- bd-xxx closes  gt-yyy that depended on it is unblocked\n- External issue closes  internal convoy step can proceed\n- Rig A issue closes  Rig B issue waiting on it proceeds\n\nNo manual intervention needed if dependencies are properly tracked - this step just validates the propagation occurred.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-15T16:59:08.212120926-05:00","updated_at":"2026-01-15T16:59:08.212120968-05:00","dependencies":[{"issue_id":"mol-deacon-patrol.resolve-external-deps","depends_on_id":"mol-deacon-patrol","type":"parent-child","created_at":"2026-01-15T16:59:08.229070493-05:00","created_by":"deacon"},{"issue_id":"mol-deacon-patrol.resolve-external-deps","depends_on_id":"mol-deacon-patrol.check-convoy-completion","type":"blocks","created_at":"2026-01-15T16:59:08.23933115-05:00","created_by":"deacon"}],"is_template":true}
{"id":"mol-deacon-patrol.session-gc","title":"Detect cleanup needs","description":"**DETECT ONLY** - Check if cleanup is needed and dispatch to dog.\n\n**Step 1: Preview cleanup needs**\n```bash\ngt doctor -v\n# Check output for issues that need cleaning\n```\n\n**Step 2: If cleanup needed, dispatch to dog**\n```bash\n# Sling session-gc formula to an idle dog\ngt sling mol-session-gc deacon/dogs --var mode=conservative\n```\n\n**Important:** Do NOT run `gt doctor --fix` inline. Dogs handle cleanup.\nThe Deacon stays lightweight - detection only.\n\n**Step 3: If nothing to clean**\nSkip dispatch - system is healthy.\n\n**Cleanup types (for reference):**\n- orphan-sessions: Dead tmux sessions\n- orphan-processes: Orphaned Claude processes\n- wisp-gc: Old wisps past retention\n\n**Exit criteria:** Session GC dispatched to dog (if needed).","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-15T16:59:08.212126343-05:00","updated_at":"2026-01-15T16:59:08.212126385-05:00","dependencies":[{"issue_id":"mol-deacon-patrol.session-gc","depends_on_id":"mol-deacon-patrol","type":"parent-child","created_at":"2026-01-15T16:59:08.232996906-05:00","created_by":"deacon"},{"issue_id":"mol-deacon-patrol.session-gc","depends_on_id":"mol-deacon-patrol.orphan-check","type":"blocks","created_at":"2026-01-15T16:59:08.246365393-05:00","created_by":"deacon"}],"is_template":true}
{"id":"mol-deacon-patrol.trigger-pending-spawns","title":"Nudge newly spawned polecats","description":"Nudge newly spawned polecats that are ready for input.\n\nWhen polecats are spawned, their Claude session takes 10-20 seconds to initialize. The spawn command returns immediately without waiting. This step finds spawned polecats that are now ready and sends them a trigger to start working.\n\n**ZFC-Compliant Observation** (AI observes AI):\n\n```bash\n# View pending spawns with captured terminal output\ngt deacon pending\n```\n\nFor each pending session, analyze the captured output:\n- Look for Claude's prompt indicator \"\u003e \" at the start of a line\n- If prompt is visible, Claude is ready for input\n- Make the judgment call yourself - you're the AI observer\n\nFor each ready polecat:\n```bash\n# 1. Trigger the polecat\ngt nudge \u003csession\u003e \"Begin.\"\n\n# 2. Clear from pending list\ngt deacon pending \u003csession\u003e\n```\n\nThis triggers the UserPromptSubmit hook, which injects mail so the polecat sees its assignment.\n\n**Bootstrap mode** (daemon-only, no AI available):\nThe daemon uses `gt deacon trigger-pending` with regex detection. This ZFC violation is acceptable during cold startup when no AI agent is running yet.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-15T16:59:08.212116468-05:00","updated_at":"2026-01-15T16:59:08.212116468-05:00","dependencies":[{"issue_id":"mol-deacon-patrol.trigger-pending-spawns","depends_on_id":"mol-deacon-patrol","type":"parent-child","created_at":"2026-01-15T16:59:08.226987537-05:00","created_by":"deacon"},{"issue_id":"mol-deacon-patrol.trigger-pending-spawns","depends_on_id":"mol-deacon-patrol.inbox-check","type":"blocks","created_at":"2026-01-15T16:59:08.236413903-05:00","created_by":"deacon"}],"is_template":true}
{"id":"mol-deacon-patrol.zombie-scan","title":"Detect zombie polecats (NO KILL AUTHORITY)","description":"Defense-in-depth DETECTION of zombie polecats that Witness should have cleaned.\n\n** CRITICAL: The Deacon has NO kill authority.**\n\nThese are workers with context, mid-task progress, unsaved state. Every kill\ndestroys work. File the warrant and let Boot handle interrogation and execution.\nYou do NOT have kill authority.\n\n**Why this exists:**\nThe Witness is responsible for cleaning up polecats after they complete work.\nThis step provides backup DETECTION in case the Witness fails to clean up.\nDetection only - Boot handles termination.\n\n**Zombie criteria:**\n- State: idle or done (no active work assigned)\n- Session: not running (tmux session dead)\n- No hooked work (nothing pending for this polecat)\n- Last activity: older than 10 minutes\n\n**Run the zombie scan (DRY RUN ONLY):**\n```bash\ngt deacon zombie-scan --dry-run\n```\n\n**NEVER run:**\n- `gt deacon zombie-scan` (without --dry-run)\n- `tmux kill-session`\n- `gt polecat nuke`\n- Any command that terminates a session\n\n**If zombies detected:**\n1. Review the output to confirm they are truly abandoned\n2. File a death warrant for each detected zombie:\n   ```bash\n   gt warrant file \u003cpolecat\u003e --reason \"Zombie detected: no session, no hook, idle \u003e10m\"\n   ```\n3. Boot will handle interrogation and execution\n4. Notify the Mayor about Witness failure:\n   ```bash\n   gt mail send mayor/ -s \"Witness cleanup failure\" -m \"Filed death warrant for \u003cpolecat\u003e. Witness failed to clean up.\"\n   ```\n\n**If no zombies:**\nNo action needed - Witness is doing its job.\n\n**Note:** This is a backup mechanism. If you frequently detect zombies,\ninvestigate why the Witness isn't cleaning up properly.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-15T16:59:08.212123343-05:00","updated_at":"2026-01-15T16:59:08.212123385-05:00","dependencies":[{"issue_id":"mol-deacon-patrol.zombie-scan","depends_on_id":"mol-deacon-patrol","type":"parent-child","created_at":"2026-01-15T16:59:08.230589908-05:00","created_by":"deacon"},{"issue_id":"mol-deacon-patrol.zombie-scan","depends_on_id":"mol-deacon-patrol.health-scan","type":"blocks","created_at":"2026-01-15T16:59:08.24257023-05:00","created_by":"deacon"}],"is_template":true}
